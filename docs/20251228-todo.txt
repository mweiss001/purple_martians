------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
BUGS!!
------------------------------------------------------------------------------
on server, once rc quits it never stops sending rc packets

------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
TO DO
------------------------------------------------------------------------------
------------------------------------------------------------------------------
Big things:
- logging
- server control/monitoring from web
- level stats to use database
- rearrange levels again (too many crappy ones polluting the good/great ones)
- sessions timeline


OMG!!!! add level name to header!!!!
and number??
wait, do I have a level header?? I was thinking of gm...


------------------------------------------------------------------------------
in game tools  

while in a netgame I would like to be able to do things without leaving the game
kind of like a pause menu

when you press escape, instead of imediatelty exiting the game,
pop up a simple dialog
and make the player paused (frozen in place, still visible but invulnerable)
the level will still play in the background
from this pop-up menu allow a very limited set of things...
-resume
-quit
- change controls
- change sound settings
- change bottom message options
- change overlay options
- change viewport




 


------------------------------------------------------------------------------


------------------------------------------------------------------------------
server control from web:
I could make buttons to display and change settings in a table

I think I need to figure more things out, like how to get a button to do something
without reloading page





------------------------------------------------------------------------------
------------------------------------------------------------------------------

------------------------------------------------------------------------------


------------------------------------------------------------------------------

------------------------------------------------------------------------------

------------------------------------------------------------------------------
make a way to change settings on remote server
I mean, I have a way, but is it a good way?
what if I get the settings.pm file from the server
edit it and send it back
how big is it? settings.pm is 8K

------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
-----------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
-----------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
even if I change servers, I want to always keep all the sessions and games files
never lose them!!











------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------   DONE   -----------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------------------------------------


make a page to view things about the running headless server
uptime, load, disk space




remove the executable from git (and other large things)
recursively
my git is getting to be almost 1G





figure out minimum permissions needed on server
- web root and everything in path
- path to database that is used in webroot
- path to savegames that is aliased in webroot
make a script to set these persmissions
I just did a new install and the only thing I had to change was:
chmod o+x /home/m






make it so that if you enter pm as server, it will expand to the full

      if (strcmp(argument_array[1],"-c") == 0 )
      {
         char srv[256];
         sprintf(srv, "%s", argument_array[2]);
         if ((strlen(srv) == 2) && (strcmp(srv, "pm") == 0)) sprintf(srv, "%s", "purplemartians.org");

         sprintf(mNetgame.server_address, "%s", srv);











why is the icon for the executable not working...
since I changed to clion
i don't know how it used to work in in code blocks
include pm.rc as a source file, it points to the icon
















sessions and gm
---------------

health after death...still broken..fixed it again, I think...yes its good
gate levels..seem to be working
should I get the server to update sessions every 60s or so?no


add update session to fire every second so I can see changes
it seems like next level and exits stats are a bit high???
update adds all the tallies, only do at the when level done or closing session
I supposed you could update other things...
like what and why? leave it....

gm add/update to database
is it missing something?
when a client quits and rejoins the same level, that should be a new session
it is working properly




player name - make small text label above player optional
options:
- never show (0)
- remote players only (1)
- always show (2)
this could live in p[0] local - it only applies to how the local system draws players
int name_display;
save and load from config
   agci(GAME, mPlayer.loc[0].name_display, 1)
   asci(GAME, mPlayer.loc[0].name_display)
now make a control in settings..done
also do not show if health display is showing...







test many thing about sessions, make sure all works like it should

test purple coins

      if (!mLoop.ff_state) mLevel.level_data_purple_coins_collected++;
      mPlayer.syn[p].stat_purple_coins++;

exits and levels
way too high, is it getting called more than once?
like with rewind and shit??

i don;t think so...i think its not getting reset...
do that in init player...done

now tested locally and every gate or exit counts for 'next_level for all player'
'exits' only count for actual exits back to overworld and only for player that triggered it...

I am going to make it so that overworld gates do not count for next levels

it seems like all this is working...next levels, purple coins, etc


now do something about default player name

leave it like that internally, but display it differently

like in all the place it shows...start with labels above yo head

I should have a funtion in mPlayer

get_name(int p)

I already do:

   char* get_player_name(int p, char * name, int width_field = 0);
   char* get_player_name2(int p, char * name);


now I do this too:

string mwPlayer::getName(int p)
{
   string tmp(mPlayer.syn[p].name);
   if (tmp == "default") tmp = "Player:" + std::to_string(p);
   return tmp;
}

where else should I show the name like that?

in the sessions stuff...the only place in all that is player_name in sessions
could I just catch it when creating new session...done















remove filename from current session section..done




session bandwidth averages per second are all zeros...fixed I think....

details for current session
- change from 3 player options to 2
from off minimal detailed to show player details ..done
put num, icon, host in title .. done
make session player text in title font mono ..don

make saves on/off button also hide current gm section..done

duration in sessions table...done

show level icon in current saved game

clicking on player icon in gm list downloads shit!! got ride of a href...fixed

show level num in gm table..done
show very tiny level icon also??..done



















playing demo levels does not restore original player color when done





if no current session choose the most recent one..done
gm table:
show a small line of icons in a cell when showing gm table
default for gm list is current session..done
duration to be mm:ss..done
when current gm is not set make it say that instead of not found..done
have a download link on current gm title..done
show a small line of icons in a cell when showing gm table...done









when playing back a demo made with a headless server, do not show server
it mostly does not show, but its in the list of demo overlay
lets see what I can do about that...





------------------------------------------------------------------------------------------------------------------------------------------------------------
bug - play all levels and set stats is broken
void mwLevel::add_play_data_record(int lev, int type)
{
   printf("void mwLevel::add_play_data_record(int lev, int type))\n");
   int save_flag = 1;
   if (mPlayer.syn[mPlayer.active_local_player].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) save_flag = 0; // if running demo mode, don't save data
   if (mLevel.skc_trigger_demo_cheat) save_flag = 1;                        // in cheat mode save data
   if (mDemoMode.demo_debug_running_demo_saves_level_data) save_flag = 1;   // or if this is option is set
   if (lev == 1) save_flag = 0;                                             // never save data for overworld
   printf("mDemoMode.demo_debug_running_demo_saves_level_data:%d\n", mDemoMode.demo_debug_running_demo_saves_level_data);
   printf("void mwLevel::add_play_data_record(int lev, int type)) Save flag:%d  \n", save_flag);
   save_flag = 1;                                             // never save data for overworld
   if (save_flag)
fixed...not even a bug...there is a check box in misc called: "Running demo always saves level data"


also, look at this:

it should override



void mwDemoMode::play_all_demos_and_save_stats(int x, int y)
{
   printf("play_all_demos_and_save_stats(int x, int y)\n");

   if (!load_demo_file_array()) return;
   int old_demo_debug_running_demo_saves_level_data = demo_debug_running_demo_saves_level_data; // get initial state
   demo_debug_running_demo_saves_level_data = 1; // force save stats
   for (int i=0; i<num_demo_filenames; i++)
   {
      mGameMoves.load_gm(al_get_fs_entry_name(demo_FS_filenames[i]));
      play_demo_for_stats();
      mScreen.draw_percent_bar(x, y, 200, 20, (i+1)*100 / num_demo_filenames);
      al_flip_display();
   }
   demo_debug_running_demo_saves_level_data = old_demo_debug_running_demo_saves_level_data; // restore initial state
}

there was more to this...you should be able to have this not set in settings and it will be
overridden. it worked until I loaded config in player init to restore colors.
then it reset 'demo_debug_running_demo_saves_level_data' as well
changed load config so I can call it to just load player color and name...this is fixed




------------------------------------------------------------------------------------------------------------------------------------------------------------
meta section for gm files
store ints as rows
redo all gm files
unique id in meta section for gm file version
keep old reader along with new one
save in new format
------------------------------------------------------------------------------------------------------------------------------------------------------------
bug server not happy when database is erased (then don't do that :)
test...
cannot reproduce, worked fine when I tried it 20260109
------------------------------------------------------------------------------------------------------------------------------------------------------------
server is seg faulting but only when started as service and client joins
happens everytime
I wish I could easily turn on full logging
I have all the logging on and I still don't know what happens...
it dies before it can save any logs
I cant see what it prints
after many hours i divcovered I needed to set working dir for pm service
------------------------------------------------------------------------------------------------------------------------------------------------------------
find players in save game (not needed anymore)
------------------------------------------------------------------------------
make new table player names (unique with ip, hostname, color???)
------------------------------------------------------------------------------
add players from sessions and gm
------------------------------------------------------------------------------
----------------------------------------------
I can also show players in gm table now!!!
I could also make a table of players
then just link them to sessions and gm's !!!!
-------------------------------------------------------------
do something different with database creation in mSql class
check for if databse file exists
check if tables exist...
don't show as much info if all is well
------------------------------------------------------------------------------
add player name to end of level stats...done
------------------------------------------------------------------------------
add very small text name above player..done
how about only remote players have the label? I like that!!
------------------------------------------------------------------------------
it is a little convoluted how I do session logs
save them to disk, then process them periodically with cron and php
in conjunction with database..
if I could just do all that from the server and C++ and a database connection it could be much simpler
I have not done that beacuse I did not want to tie up the server
but really, how much overhead could it take to enter a few things in a database
is there really any reason to use mysql? why do I need remote network access to the database
anything the webpage shows will be on the same physical machine




if database is erase, php will try to create it...i don't want that


text duration in current session no longer lines up



show the player name and color in sessions table, maybe even a little player icon

player name and icon of current session



------------------------------------------------------------------------------
------------------------------------------------------------------------------
show buttons instead of links for sessions table filter
------------------------------------------------------------------------------
top navigation row
------------------------------------------------------------------------------
buttons to filter current session info

move all of sessions section code to php file
includes to all be at top
include to just include function not actually show until function is called
done...


I have been thinking about c string vs c++ std:string
in the words of Boromir, 'do you not suffer needlessly?'




implement player name (Do it Fool!) ... did it fool !!!
Im thinking a fixed length of 8 char max
add it to the player structure
whe a pleyer joins the game move will now need the player name
and it will need to be passed with the join packet
set it in setting, if not set, have it set to 'default' and translate that to "Player 1" etc...
when I do that, I would like to save the player name in more places
like in the game moves files


------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------

I want to change the directory structure of my project.
docs will now have all the doss
web will now have the webpage
the only reason I changed it was because github was hosting my page...
At the time it seemed like a good idea to have a free host site for my project docs
but now that I have my own server, I don't care about that anymore
change hard link in pmhelp


------------------------------------------------------------------------------

rename the godmamn scrape shit
put them in their own dir

Directory of C:\pm\scrape
2025-12-30  09:55 AM             1,841 scrape_gm.php
2024-07-14  10:28 PM               815 scrape_net
2025-12-29  12:12 AM             7,611 scrape_session.php
2024-07-14  10:28 PM               839 scrape_status
rename the cron shit: done


------------------------------------------------------------------------------
document logging better
make a folder called logging..done
------------------------------------------------------------------------------

make a variable or 2 to kill log_net and log_status

#define LOG_OTH_draw               54
#define LOG_NET_CSV                66

   i = LOG_OTH_draw;                log_types[i].group = 3;   strcpy(log_types[i].name, "LOG_OTH_draw");
   i = LOG_NET_CSV;                 log_types[i].group = 3;   strcpy(log_types[i].name, "LOG_NET_CSV"); log_types[i].action = 0;

now it shows up at the bottom of OTH
it is off by default

try this....

------------------------------------------------------------------------------

finish the notes about how to create server
see if I have the right php permissions
the answer is yes!!!
redo everything
------------------------------------------------------------------------------
fix the php scripts..done..now deploy to live server
------------------------------------------------------------------------------

exclude scrapes from git backup
in .gitignore
/scrape_cronoutput.txt
/scrape_status_cronoutput.txt
/session_scrape_cronoutput.txt

























------------------------------------------------------------------------------
------------------------------------------------------------------------------
------------------------------------------------------------------------------
crazy ideas that I probably will never do
------------------------------------------------------------------------------


------------------------------------------------------------------------------
Qt WASM 
allegro in browser also
------------------------------------------------------------------------------


There is a lot of info in level stats that would be better suited in database. Just saying..






------------------------------------------------------------------------------



show horizontal bar graph with players and how how they were active in the save game
I think I can do this with div flex box and proportional widths

how will I get this info?
i have a gm that has max frame

i can get frames of when players joined/quit

for each one of those draw a bar proportial to the active time


some test data


total = 1000;

p1 = 0-200
p2 = 200-800;
p3 = 400-1000;



each will have 3 sections, pre session and post
p1 0-0 0-200 200-1000  0 200 800
p2 0-200 200-800 800-1000 200 600 200
p3 0-400 400-1000 1000-1000 400 600 0


   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:0;    border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:200;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:800;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";

   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:200;  border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:600;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:200;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";

   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:400;  border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:600;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:0;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";

this works!!!

now how will I get the data I need?

start with gm file

you know, it might be easiest to do this in the main game and save the results in the gm header
I have as much space as I need and I will not break anything, other stuff can just ignore it..

I imagine the header could look like this:

PLAYER_START:
player_num
player_color
player_name
start_frame
end_frame
PLAYER_END:

then as many of these sections as needed

or another possibility is:

I already have linked gm's with sessions (with player info)
I could do some timestamp comparing...

i think it is pretty simple...
if the session start and end are outide the gm start and end then the player is 100%
this should be the majority of the cases...

if not then find what frame...

could I just do an absolute timeline? I have all the data...

session ------------------------------------------------
[gm --------] [gm-  ]   [gm]]]


there will never be concurrent gms



                   


------------------------

i could do this whole thing for the sessions as well

I'm looking at the table and wish I had a nice visual comparison of sessions and whether or not they overlap...

and where the saved games fit into that as well







































