<!DOCTYPE html>
<html data-bs-theme="dark" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>bs_new</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/A%20Charming%20Font.css">
    <link rel="stylesheet" href="assets/css/Pixel%20Gosub.css">
    <link rel="stylesheet" href="assets/css/Pristine.css">
    <link rel="stylesheet" href="assets/css/saucer_bbregular.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/pm_title.css">
    <link rel="stylesheet" href="assets/css/prism.css">
</head>

<body style="background: var(--bs-black);">
    <div class="container" style="color: rgb(41,33,33);background: var(--bs-black);">
        <nav class="navbar navbar-expand bg-black py-3" style="background: var(--bs-black);">
            <div class="container">
                <ul class="navbar-nav mx-auto" style="background: var(--bs-black);color: var(--bs-navbar-active-color);">
                    <li class="nav-item"><a class="nav-link active mw_link_inactive" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link mw_link_inactive" href="download.html">Download</a></li>
                    <li class="nav-item"><a class="nav-link mw_link_inactive" href="multiplayer.html">Multiplayer</a></li>
                    <li class="nav-item"><a class="nav-link mw_link_inactive" href="about.html">About</a></li>
                    <li class="nav-item"><a class="nav-link mw_link_active" href="more.html">More</a></li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="container">
        <div style="border-radius: 12px;background: radial-gradient(black, #6500ec 482%);border: 2px solid #6500ec;">
            <p id="pm_banner_title" style="text-align: center;font-family: saucer_bbregular;color: #6500ec;margin-bottom: -15px;">PURPLE MARTIANS</p>
            <p id="pm_banner_byline" style="text-align: center;font-family: saucer_bbregular;color: #191fb7;">by Michael David Weiss</p>
        </div>
    </div>
    <div class="container d-sm-flex d-md-flex d-lg-flex justify-content-sm-center align-items-sm-start justify-content-md-start align-items-md-start" style="padding-top: 16px;">
        <div class="row d-flex flex-row flex-grow-1 align-items-stretch">
            <div class="col">
                <div class="card mw_card_color_grey1" style="border-width: 5px;border-radius: 17px;margin: 8px;">
                    <div class="card-header">
                        <h5 class="mb-0">History</h5>
                    </div>
                    <div class="card-body">
                        <div style="background: #a04646;color: rgb(9,43,78);"><div><pre><code class="language-cpp">void mwNetgame::server_send_sjon_packet(int who, int level, int frame, int player_num, int player_color)
{
   char data[1024] = {0}; int pos;
   mPacketBuffer.PacketName(data, pos, "sjon");
   mPacketBuffer.PacketPutInt2(data, pos, level);
   mPacketBuffer.PacketPutInt4(data, pos, frame);
   mPacketBuffer.PacketPutInt1(data, pos, player_num);
   mPacketBuffer.PacketPutInt1(data, pos, player_color);
   ServerSendTo(data, pos, who);
}</code></pre>
</div>
</div>
                        <p>Some descriptive text</p><div><pre indent='40'><code class="language-cpp">void mwNetgame::ServerListen()
{
   char msg[256];
   char address[32];
   char data[1024] = {0};
   int pos = net_receive(ListenChannel, data, 1024, address);
   if (pos)
   {
      if (mPacketBuffer.PacketRead(data, "1234"))
      {
         mLog.add_fwf(LOG_NET, 0, 76, 10, "|", " ", "Server received initial 1234 packet from '%s'",address);
         if (!(ClientChannel[ClientNum] = net_openchannel(NetworkDriver, NULL)))
         {
            sprintf(msg, "Error: failed to open channel for %s\n", address);
            mLog.add_fwf(LOG_error, 0, 76, 10, "|", "-", msg);
            mInput.m_err(msg);
            return;
         }
         if (net_assigntarget (ClientChannel[ClientNum], address))
         {
            sprintf(msg, "Error: couldn't assign target `%s' to channel\n", address);
            mLog.add_fwf(LOG_error, 0, 76, 10, "|", "-", msg);
            net_closechannel (ClientChannel[ClientNum]);
            mInput.m_err(msg);
            return;
         }
         mPacketBuffer.PacketName(data, pos, "5678");
         ServerSendTo(data, pos, ClientNum);
         ClientNum++;
         mLog.add_fwf(LOG_NET, 0, 76, 10, "|", " ", "Server opened channel for `%s' and sent reply", address);
      }
   }
}</code></pre></div>
                        <p class="card-text">I had been trying to write a game for a long time.<br><br>In 1978, when I was 10, I learned BASIC on a Commodore PET&nbsp;and wrote a few simple programs to manipulate and draw text.<br><br>From 1980-1987, I had access to an Apple II+ and spent a lot of time learning how to program on that.&nbsp;(280 x 192 hires graphics mode!)<br><br>I made some games in BASIC, and assembly.<br><br>The BASIC games could not not get fast enough, no matter what.<br>Probably due to an interpreted language and my lack of skills.<br><br><br>Assembly was better, but my skills were not enough to write that complex of a program in assembly.<br><br>For many years I had no access to a computer, or the time or inclination to do anything about it.<br><br><br>I still wanted to create the game I had in my head, with a little man running around a level, jumping from platform to platform.<br><br><br>Then in 1997, I was in a seasonal layoff from my job over the winter, waiting on unemployment benefits, and I had a laptop and internet access.<br><br><br>I decided I was going to work on the game I had in my head.<br><br><br><br>I searched for some proper tools to create games.&nbsp;I was thinking even if I had to pirate something, I was going to figure out how to make&nbsp;my game a reality.&nbsp;All of the microsoft crap did not appeal to me, but I resigned myself to go there if I had to.<br><br><br><br>What I found instead was Allegro.&nbsp;It looked awesome.&nbsp;The more I read, the more I knew it was what I was looking for.&nbsp;And the best part was that it was free!&nbsp;Nothing to pirate!<br><br><br>The only catch... I would have to learn how to program in C.<br><br><br>I downloaded DJGPP, used RHIDE as my IDE, and added Allegro 2.2.<br><br><br>As I learned C, I was amazed at how logical, simple, precise and elegant it is.&nbsp;No gotos or line numbers.&nbsp;And it's really fast!<br><br><br>In my game I built everything from scratch. (Well, except for Allegro!)<br><br>I started by learning how to draw on the screen. Then I made some shapes to blit here and there. Early on I decided to make my game sprites 20x20 pixels.I made an bitmap editor to draw and edit these sprites.<br><br>I built my own routine for saving and loading bitmaps to disk, (one get_pixel and put_pixel at a time!)<br><br>I decided on a level size of 100x100 blocks made of these shapes.<br><br>I used an array of 10,000 ints, int l[100][100].<br><br><br><br>When I was figuring out how to run my game loop flicker free with a screen buffer,&nbsp;I created a bitmap the size of the whole level: 2000 x 2000 pixels.&nbsp;4 million pixels!<br><br><br>From 1997 to 2003 I call the first phase of the development.<br><br>I always knew I wanted to do some kind of multiplayer. The game would just be so much better with more players.<br>It had to be simultaneous multiplayer, like Bubble Bobble. Just two players taking turns was never even considered.<br>Initially, I came up with a split screen method. I created a second player and re-wrote a lot of code that assumed there was only ever going to be one player.<br><br>That worked, but the split screens were kind of small.<br><br>Still it was really cool to play simultaneously with another player.<br><br>I started to think about how amazing networked multiplayer would be.<br><br><br>I found libnet and made a simple packet exchange of moves.<br>Exchanging game move packets was easy, but synchronizing the game was not.<br><br>I spent a lot of time trying different concepts and abandoning them when I realized they wouldn't work or I thought of a better way to do it.<br><br><br>In 2003 I released version 5. The netplay stuff didn't work yet, so I disabled all traces of it with #ifdef's in the source.<br><br>I let it go for a few years until I came back with a vengeance in 2009-2010 to solve the netplay stuff.<br><br><br>I made a lot of changes and improvements, but still had sync issues.<br>It would almost run perfectly until they slightly went out of sync.<br><br><br>I had made a lot of changes, but because netplay was broken I didn't want to release without it.&nbsp;Eventually I gave up and let it go for many years.<br><br><br><br>I had been thinking about the various methods of syncing, but was still convinced my method should work.<br><br>The method I used is called deterministic lockstep, and I wrote in depth about it in netplay.txt.<br><br><br>The concept is that for the exact same set of inputs, the output will be exactly the same.&nbsp;So if I could just sync the inputs (what controls&nbsp;are pressed on what frame), the output should be identical.<br><br><br>I was almost going to try something like Unity that had built in network multiplayer.<br>I even spent a few hours building a test project in Unity and seeing what it would be like to re-do the game in that.<br><br>I decided not to for a few reasons.<br><br>I wanted do it my way.<br><br>I wanted to figure it out myself.<br><br><br><br>In 2017-2018 I came back again and tested a new idea I had.<br><br>Basically I removed all floats and replaced them with fixed point numbers.<br><br>Floats, while very precise, were not as perfectly deterministic across different systems as I needed.<br><br>Fixed points, while not as accurate, gave the exact same results every time.<br><br>After a lot of rewriting, I finally was getting good sync. I could play 3 and 4 players games with no problems.<br>I still had rare occasions that the sync would break.&nbsp;Often enough that&nbsp;I couldn't call it fixed.<br>I wrote a huge amount of logging code, trying to get to the bottom of the problem.<br><br>Eventually I started passing some state information from server to clients to tell when the game was going out of sync.<br><br><br>That grew to be more and more information until I thought, why don't I try&nbsp;to send the entire state?<br><br>I never designed the game with that in mind, and the structures and arrays holding all of that data were huge.<br><br>100 enemies, each with 16 ints and 32 fixed_point<br>500 items,&nbsp; each with 16 ints and 4 fixed_point<br>40 lifts structures, each with up to 40 steps<br>the level block array (100x100) ints<br>8 player data structures<br><br><br><br>All of that came in at over 100k.&nbsp;Way too much to sync with 1K packets.<br>I did some research and decided to try to use zlib to compress it.<br>That got my 100K down to around 6-12K.<br><br>I wrote code to split it into 1K packets and reassemble them on the clients.<br>It worked, but it was still too much data and was too slow.<br>At this point I was only using it to check and see if the game had gone out of sync.<br><br>Then I came up with a dif method.&nbsp;Instead of sending the whole 100K, I would only send what had changed.<br>I basically just subtracted one entire state from another, called that my dif, and compressed that.<br>That gave me around 600 to 1800 bytes. I would only need 1 or 2 packets!<br><br>When I got that working, I decided instead of just checking if I am out&nbsp;of sync, why don't I just use that to correct the state on the clients?<br><br>That is the way that it works now. It checks for differences, but then just overwrites with the new state anyway.<br>I still check for differences because I want to know what is drifting and see if I can find out why.<br>Its not really necessary because getting a new state fixes everything.<br><br><br>So there are two methods for the game sync:<br><br>The old original one just sync's the clients inputs.<br>Every frame, if the clients controls change, a packet with that control change is sent to the server.<br>The server then consolidates all client inputs, and syncs that back to each client independently.<br><br>The second method periodically sends a new complete state to each client in the form of a dif from the last acknowledged one.<br><br>Between these two methods, I can now play very long games, with up to 8 players, across all windows and linux versions, and it works perfectly!<br><br>Then I cleaned up a lot of things in the code that I had broken, refactored just about every line in the game, added new features, removed some old ones, went through all the levels, updated the help screens, made a fancy new rotating logo with splines for the splash screen...<br><br>Finally here we are on March 11, 2018 with Version 6.<br><br>Netplayer with up to 8 players.<br><br>Works on Windows XP, Windows 7, Windows 10, Ubuntu 16.04.<br><br><br><br>This will be the final release on Allegro 4.<br><br>For the next version, I'll convert to Allegro 5.<br><br><br><br>Well here we are again on April 22, 2018 with Version 7.<br><br>Now with Allegro 5.2.4!<br><br>Just about every line (25K) of code has been re-factored.<br><br>The display routines have been completely redone.<br><br>Now with dynamic resizing while the game is playing!<br><br>The linux version now is a precompiled executable.<br><br>Numerous small bug fixes and improvements.<br><br><br><br>Updated to Version 7.24 on October 18, 2022<br><br>Added some new items, enemies, redid levels...</p>
                    </div>
                </div>
                <div class="card mw_card_color_grey1" style="border-width: 5px;border-radius: 17px;margin: 8px;">
                    <div class="card-header">
                        <h5 class="mb-0">My Programming Journey</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Purple Martians was started in the winter of 1997 in a cold, dark, one bedroom basement apartment in Victoria, BC.<br><br>I was on a seasonal layoff from a construction job, waiting on unemployment benefits, and I had some time on my hands.<br><br>This was 1997 so the high end PC's were Pentium 120 with 16M of RAM. I had an old 486/33 Compaq laptop with 8M of RAM.<br><br>1997 was also the year I first connected the internet. I had a dial-up account with Pacific Coast Net.<br><br>It's amazing when I think of the time before the internet. What did we do without it?<br><br><br>I was unusual in that I had access to computers at a much earlier age than almost anyone I knew.<br><br>In 1978, when I was 10, my dad brought home a Commodore PET from the college where he taught electronics.<br><br>I spent a lot of time figuring out how it worked. That was my first exposure to programming.<br><br>BASIC. It seems so simplistic and crude now.<br><br>But the joy of typing in commands and seeing the results instantly...it was something I fell in love with.<br><br>A few years later the Commodore PET was replaced with an Apple II.<br><br>Kind of similar, but the one huge difference was the graphics.<br><br>Color. 280x192 hi res graphics. Commands in BASIC to draw pixels and lines.<br><br>I created programs that drew string art-moire patterns.<br><br>But what I really wanted to do was make a video game.<br><br>To have a little player jumping around from level to level, shooting and avoiding enemies,<br>climbing ladders.<br><br>Some early influences were Ms. Pac Man and Donkey Kong Junior, the only 2 games at the local convenience store.<br>The only time I could see them was during school lunch breaks, because I lived out in the country.<br>For a few years, I mostly watched other kids play, mesmerized, wanting so bad to have a quarter and a turn.<br>Lunch time was so short there was only time for a few games, so it was rare that I got a turn.<br><br>There were a few games that could be played on the Apple. A pac man clone called snoogle. Lode Runner.<br><br>Lode Runner had a big influence on the game I wanted to create. Simple block based, puzzle solving.<br><br>Other games that had a huge influence are the Mario series, Doom and of course one of my all time favorites,<br>Bubble Bobble. That game is so amazing with all of the secrets and special items. I consider it a masterpiece.<br><br>I had tried many times to make a game. At the bare minimum I wanted a player that could move and jump on platforms.<br><br>I first tried to do that in BASIC on the Apple II. The character was a simple collection of drawn lines and pixels.<br>Very simple and crude. But even that was agonizingly slow as I attempted to draw and move it across the screen.<br><br>I experimented with the vector based shape tables built into the apple, and taught myself the the basics of assembly language.<br>I made some progress, but it was such a huge task, and I did not have the skills to build a complex project like that in assembly.<br>Eventually I grew up, moved out, got a job, and left programming behind. I never did own a computer, they were all borrowed.<br>The apple that my dad brought home to learn on, and then in high school I hung out lots in the computer lab that had a bunch<br>of apples also.<br><br><br>It's hard to realize what computers were like back in those days, before the internet.<br>They were pretty much all stand alone units used for a single purpose.<br>I used some in the course of my electronics career, but mostly just to perform one specific task.<br><br>What got me back into computers was digital audio. I had been writing and recording music with analog tape<br>machines for years, and was excited to try digital recording. It looked so promising.<br>Unlimited tracks, non-linear editing, digital effects.<br><br>I started that with a Pentium 100 with 8M of RAM and a huge 1.2G HD.<br>I bought Cakewalk Pro Audio at the local Long and McQuade and a Soundblaster from Radio Shack.<br><br>At that time, consumer computer technology was just barely fast enough to record audio.<br>There was a lot of pain setting things up, and even at the best, it just barely worked.<br><br>This was also the time that I really developed a strong dislike for any garbage that Creative Labs makes.<br>The sound blaster I bought was advertised as full duplex, windows compatible.<br>Cakewalk said that all it required was a full duplex windows sound card.<br>It just would not work. It would record and it would play back, but it would not do both at once.<br>After spending many hours on the phone with tech support, I finally figured out that by design, this card could only<br>do full duplex by severely degrading the recording quality. So I returned it and bought a much more expensive<br>sound card that just simply did what it was supposed to.<br><br>In the process of getting tech support over the phone, the guys I were talking to told me about these<br>on-line tech support forums, that would probably help me way more than telephone tech support.<br><br>And that was the catalyst. That was the reason I got a dial up internet connection. I think it was $25 a month.<br>The forums were great, many people running the same software, running into the same issues, and discussing solutions.<br><br>I was able to get my DAW (Digital Audio Workstation) fully functional and did quite a lot of recording for<br>a few months before my computer and a lots of other valuable things were stolen in a break-in.<br><br>I lost all of my digital copies of my music, all I had were the cassette tapes master I had recorded from the DAW.<br><br>Months passed and I moved into a bedroom in a basement in Oak Bay. Cold, dark, dingy...sketchy people that lived in the<br>other rooms. Landlady that lived upstairs and complained about the tiniest noise. She literally complained one time about<br>the music being too loud when I was wearing headphones.<br><br>I had this old broke down 486 laptop, and I still had my internet account. I had been laid off for the winter (it happened every year)<br>so I had some time on my hands. And with the internet I had the entirety of the worlds information just waiting to be explored.<br><br>How hard could it be to make some shapes and draw them on the screen? It had been so many years since the Apple II days. The last time<br>I had tried to program. That was probably around 1987 or so, 10 years earlier.<br><br>I can't remember all the things I looked at then, but I do remember that even back then, I did not like Microsoft.<br>What they did in the browser wars, plus many other low down shady tactics, plus just using windows and getting annoyed at all the<br>stupid design decisions, locked in data, predatory business practices. But the worst for me was the crap software.<br>Barely functional, riddled with bugs, and only successful because they were the largest installed base.<br><br>But if I had to use something microsoft to make my game, I resigned myself to give it a shot.<br><br>What I found instead was Allegro, a small project by Shawn Hargreaves. It was exactly what I was looking for.<br>I did not want a game engine, what I wanted was a game programming library.<br>Some simple functions to draw shapes on the screen. Fast.<br><br>Allegro is completely free. Thus began my lifelong love of open source, freely distributable software.<br>The complete opposite of windows.<br><br>I would have to learn to program in C. I did not know anything about it, but I learned fast.<br><br>The compiler used is gcc. I am so happy I have never once had to use MSVC.<br><br>I followed the install directions to setup gcc for windows (DJGPP), installed Allegro 2.0, and set up RHIDE as my integrated development editor.<br><br>The best way to learn is by doing. I had a few books on C, and worked through a couple of examples, but then I just focused on getting things done.<br><br>Like for example:<br><br>Create a display and change its color. Then draw some different colored lines on it. Then some other graphics primitives like rectangle and circle.<br>This is pretty cool! Now back to the first days with the Apple II, I recreated some string art moire patterns. They looked great!<br>OK, enough with primitives, I want to create some sprites and draw them to the screen. That worked great also.<br><br>Then in the spirit of doing everything from scratch, I built tools to create, save and edit my own sprites.<br>I saved and loaded them one get_pixel and set_pixel at a time.<br>I learned how to save things to disk, file handles, iostreams, data formats.&nbsp;All new and all so very cool.<br><br>And also I was leaning C at the same time.<br><br>C is so simple and elegant, I like compare it to the game of chess.<br><br>Chess has a very simple set of rules about how each piece can move. Those rules can be learned very quickly.<br>However the strategies of playing the game can take a lifetime to master.<br><br>C is similar in that the core functionality of the language is very simple.<br>How you use those very simple building blocks to create more complex things is an art that can take a lifetime to master.<br><br>I had some bad habits from BASIC, but I soon overcame them. Now 25 years later I am still improving all the time.<br><br>I love to program. To me all of programming is 'managing complexity'<br><br>To simplify, abstract, to make very complex things easier to understand, implement, and maintain.<br><br><br>Now my project uses C++ objects and has over 40k lines of code.<br><br>I can't count the number of times I have refactored, I am continually learning and improving.<br><br></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/prism.js"></script>
</body>

</html>