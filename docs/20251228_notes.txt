20251228

I am back baby!

But just for a few quick things...


See if I remeber how to work with this project

I think the first thing I will do is see if I can commit to github


open Git Gui

rescan
stage
sing off
commit
push

I have password, but what is name? mweiss001

done...

now can I open the project on m36 and recompile

a complete rebuild is 5s! suck that qt creator!

now what?

go through setting up a linux dev machine...

C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20230824.txt

after a bunch of troubleshooting, found I needed to add 'sudo apt install libpulse-dev'

made a new one:
C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20251228.txt

the server is working!!!
and it takes 7W!!

C:\pm\pm_docs\HOWTO\Remote Headless Server.txt


now what?

I want to do something about logging.

What am I logging? Why so much?

there is more...how to setup the webserver

made a guide:

C:\pm\pm_docs\HOWTO\Setup Apache on headless server.txt

I wish I had a good doc that described what logging is happening.

make one now...

LOG_NET_SESSION

what do I really want?

I want to know when a player joined and how long they played for.
I want to keep this info in a database table for display

I also want to keep demo files for all the sessions...

I have something like that already....

mNetGameSessionLog

m@o3000:~/dev/purple_martians/logs$ ll
total 17608
drwxr-xr-x  5 m m    4096 Dec 28 21:18  ./
drwxrwxrwx 17 m m    4096 Dec 28 20:13  ../
-rw-rw-r--  1 m m    5740 Dec 28 20:13 '20251228-201303-[58][o3000].txt'
-rw-rw-r--  1 m m 7917793 Dec 28 20:24 '20251228-202406-[1][o3000].txt'
-rw-rw-r--  1 m m  338773 Dec 28 20:24 '20251228-202433-[2][o3000].txt'
-rw-rw-r--  1 m m  182515 Dec 28 20:25 '20251228-202508-[1][o3000].txt'
-rw-rw-r--  1 m m 3499306 Dec 28 20:29 '20251228-202946-[2][o3000].txt'
-rw-rw-r--  1 m m  164623 Dec 28 20:29 '20251228-202959-[1][o3000].txt'
-rw-rw-r--  1 m m 3313788 Dec 28 20:34 '20251228-203420-[20][o3000].txt'
-rw-rw-r--  1 m m 1786876 Dec 28 20:45 '20251228-204501-[1][o3000].txt'
-rw-rw-r--  1 m m  142306 Dec 28 21:13 '20251228-211355-[1][o3000].txt'
-rw-rw-r--  1 m m  152580 Dec 28 21:16 '20251228-211653-[1][o3000].txt'
-rw-rw-r--  1 m m  457191 Dec 28 21:18 '20251228-211800-[1][o3000].txt'
drwxr-xr-x  2 m m   24576 Dec 28 21:18  net/
drwxr-xr-x  2 m m    4096 Dec 28 21:17  session/
drwxr-xr-x  2 m m    4096 Dec 28 21:18  status/
m@o3000:~/dev/purple_martians/logs$ cd session/
m@o3000:~/dev/purple_martians/logs/session$ ll
total 28
drwxr-xr-x 2 m m 4096 Dec 28 21:17 ./
drwxr-xr-x 5 m m 4096 Dec 28 21:18 ../
-rw-rw-r-- 1 m m  504 Dec 28 21:17 .txt
-rw-rw-r-- 1 m m  549 Dec 28 20:24 20251228-201352-192.168.1.36-59650.txt
-rw-rw-r-- 1 m m  553 Dec 28 20:34 20251228-202459-192.168.1.36-62843.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:16 20251228-211638-192.168.1.36-64444.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:17 20251228-211716-192.168.1.36-62627.txt
m@o3000:~/dev/purple_martians/logs/session$ cat 20251228-211716-192.168.1.36-62627.txt
dt_start:20251228-211716
duration:32
ip:192.168.1.36
port:62627
hostname:m36
endreason:comm_loss
cdat_rx:0
player_num:1
next_levels:0
exits_activated:0
respawns:0
shots_fired:0
enemy_hits:0
player_hits:0
self_hits:0
purple_coins:0
tx_bytes_total:1199179
tx_bytes_avg_per_sec:36349
tx_bytes_max_per_frame:3650
rx_bytes_total:768772
rx_bytes_avg_per_sec:23303
rx_bytes_max_per_frame:1695
tx_packets_total:1768
tx_packets_avg_per_sec:53
tx_packets_max_per_frame:4
rx_packets_total:6400
rx_packets_avg_per_sec:193
rx_packets_max_per_frame:14
m@o3000:~/dev/purple_martians/logs/session$

and I think I have a cron job to scrape and add these to a database...

so how do I enable, disable this...

---------------------------------------------------------
Forced Settings on headless server
---------------------------------------------------------
void mwNetgame::headless_server_setup(void)
{
   mMain.classic_mode = 0;
   mLevel.unlock_all_levels();

   // ensure that only the basic LOG_NET is active and is printing to console as well as saving to file
   mLog.clear_all_log_actions();
   mLog.set_log_type_action(LOG_NET, LOG_ACTION_PRINT | LOG_ACTION_LOG);

   // make the hidden server player color taan (6)
   mPlayer.syn[0].color = 6;

   // always have session logging on
   mLog.set_log_type_action(LOG_NET_session, LOG_ACTION_LOG);

//   // add these for troubleshooting
//   mLog.set_log_type_action(LOG_NET_join_details, LOG_ACTION_PRINT | LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stak, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stdf, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_OTH_level_done, LOG_ACTION_PRINT);

   mLog.autosave_log_on_level_done = 1;
   mLog.autosave_log_on_level_quit = 1;
   mLog.autosave_log_on_program_exit = 1;

   // make sure we are always saving games
   mGameMoves.autosave_game_on_level_done = 1;

   mGameMoves.server_send_files_to_clients = 1;

   mConfig.save_config(0);

I think I have everything I need already

I want to keep the basic logging on 'LOG_NET'
but I should have a cleanup script to erase older ones to keep from using too much disk space

the LOG_SESSIONS ones I should just insert into the database and remove

the savegames I want to have a way to download them from the webserver

look up the scrape functions

I think they are PHP



---------------------------------------------------------
Setup a cron job to scrape session logs and add to database
---------------------------------------------------------

setup a cron job to scrape logs and add to database

crontab -e

*/1 * * * * php /home/m/dev/purple_martians/session_scrape.php >> /home/m/dev/purple_martians/session_scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape             >> /home/m/dev/purple_martians/scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape_status      >> /home/m/dev/purple_martians/scrape_status_cronoutput.txt 2>&1


this is an amazing one line script to change files ending in *.txt.bak to end in *.txt
for f in *.txt.bak; do mv -- "$f" "${f%.txt.bak}.txt"; done


I want to make a new folder in docs

server

like dev setup




2025-12-28 19:16:48


What do I have so far?

The server is making session logs and saving them to disk
cron is calling php scrape and adding them to database
I sometimes get some php errors that I am trying to figure out
can I make the php script output some more useful data
fixed a bug where a bad date would kill the whole batch scrape

   // test if we can create a valid date time
   if (!DateTime::createFromFormat('Ymd-His', $var['dt_start']))
   {
      echo "Error parsing dates\n";
      foreach ($var as $x => $y) echo "$x $y\n";
      return;
   }

2025-12-28 21:30:05

OK now what?

what do I do with the data in the database


I'm looking at the sessions.php in the web page


   $srvrname = "localhost";
   $database = "session_db";
   $username = "php_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "timestamp,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";


   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM session_tb";


I should change that to:




   $srvrname = "localhost";
   $database = "pm";
   $username = "pmdb_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "dt_start,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";

   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM sessions";



CREATE TABLE sessions (
  id                INT AUTO_INCREMENT,
  filename          VARCHAR(255),
  dt_start          DATETIME,
  dt_end            DATETIME,
  duration          INT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  endreason         VARCHAR(255),
  cdat_rx           INT,
  player_num        INT,
  next_levels       INT,
  exits_activated   INT,
  respawns          INT,
  shots_fired       INT,
  enemy_hits        INT,
  player_hits       INT,
  self_hits         INT,
  purple_coins      INT,
  tx_bytes_total            INT,
  tx_bytes_avg_per_sec      INT,
  tx_bytes_max_per_frame    INT,
  rx_bytes_total            INT,
  rx_bytes_avg_per_sec      INT,
  rx_bytes_max_per_frame    INT,
  tx_packets_total          INT,
  tx_packets_avg_per_sec    INT,
  tx_packets_max_per_frame  INT,
  rx_packets_total          INT,
  rx_packets_avg_per_sec    INT,
  rx_packets_max_per_frame  INT,
  PRIMARY KEY(id)
);

where do I want to do this?

on my live server

do I have sessions?

omfg it works!!!

2025-12-28 22:01:09

well I am making some progress

fix the php scripts..done..now deploy to live server
main and player work
bandwidth crashes
all says no dats

2025-12-28 23:11:21
finished the server install notes


2025-12-29 08:07:46

ran a 2 player fakekey game on new server for 7 hours
almost 100K cdats per client

must have generated a bunch of new logs

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

# fix permissions
chmod 777 ./op
sudo ./op

# compile and install libnet
cd libnet
make clean
make lib
sudo make install

# build puple martians
cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/docs/* /var/www/html

sudo systemctl start pm

2025-12-29 15:21:28


I think I have logging documented much better and able to disable status and net




2025-12-29 17:19:23

working on

download played game from server

<a href="/bs_notes.txt" download="poooop">
    <button>Download Report</button>
</a>


pscp -r -pw zaiden c:\pm\docs\* m@192.168.1.146:tmp

On the server, copy to the final place
sudo cp -r ~/tmp/* /var/www/html




2025-12-29 18:30:09


what do I want for sessions?

I want a nicer table


For a session row, I want to be able to downaload the savegame file.

There might be multiple...


maybe I could have it take me to another page with download links





-----------------------------------------------------------------------------------------------------------------------------------------

I have a really cool thing I want to try....

Method 1: Using PHP and a Query String (Full Page Reload)
This method uses a query string in the URL to determine which content to display.
When a link is clicked, the page reloads, and the PHP script processes the request and outputs the appropriate content. 
index.php
php

<?php
// Function to sanitize and get the 'page' parameter from the URL
function get_page_content($page) {
    switch ($page) {
        case 'about':
            return 'include/about.php';
        case 'contact':
            return 'include/contact.php';
        case 'home':
        default:
            return 'include/home.php';
    }
}

// Get the page parameter, default to 'home' if not set
$page = isset($_GET['page']) ? $_GET['page'] : 'home';
$content_file = get_page_content($page);
?>

<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Content</title>
</head>
<body>

<nav>
    <!-- Links with query strings -->
    <a href="index.php?page=home">Home</a> |
    <a href="index.php?page=about">About</a> |
    <a href="index.php?page=contact">Contact</a>
</nav>

<div id="content-container">
    <?php
    // Include the content file
    if (file_exists($content_file)) {
        include($content_file);
    } else {
        echo "<p>Content not found.</p>";
    }
    ?>
</div>

</body>
</html>

Include Files (create a folder named include): 

    include/home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
    include/about.php: <h2>About Page</h2><p>This is the about us information.</p>
    include/contact.php: <h2>Contact Page</h2><p>Contact us here.</p>
    
    
    
----------------------------------------------------------------------------------------------------------------------------------------------------

somehow that last example got garbled...

try this:

make dir /test/test23/index.php

and have all three files there
home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
about.php: <h2>About Page</h2><p>This is the about us information.</p>
contact.php: <h2>Contact Page</h2><p>Contact us here.</p>

<!DOCTYPE html>
<html>
<body>

<h1>Dynamic Content Example</h1>

<!-- Navigation Links -->
<a href="index.php?page=home">Home</a> | 
<a href="index.php?page=about">About</a> | 
<a href="index.php?page=contact">Contact</a>

<div id="content-area">
    <?php
    // Check if the 'page' parameter is set in the URL
    if (isset($_GET['page'])) {
        $page = $_GET['page'];

        // Use a whitelist to prevent directory traversal vulnerabilities
        $allowed_pages = ['home', 'about', 'contact'];

        if (in_array($page, $allowed_pages)) {
            // Include the corresponding PHP file
            include($page . '.php');
        } else {
            echo "<p>Content not found.</p>";
        }
    } else {
        // Default content if no parameter is set
        include('home.php');
    }
    ?>
</div>

</body>
</html>


works!!!




---------------------------------------------------------------------------------------------------------------------------------------------------
next


test24

cannot get this to work


index.html


<!DOCTYPE html>
<html>
<head>
<script src="code.jquery.com"></script>
</head>
<body>

<h1>AJAX Dynamic Content Example</h1>

<!-- Links with a class to attach an event listener -->
<a href="#" class="nav-link" data-page="home">Home</a> | 
<a href="#" class="nav-link" data-page="about">About</a> | 
<a href="#" class="nav-link" data-page="contact">Contact</a>

<div id="content-area">
    <!-- Content will be loaded here dynamically -->
    <p>Select a link to load content.</p>
</div>

<script>
$(document).ready(function(){
    $('.nav-link').on('click', function(e){
        e.preventDefault(); // Prevent the default link behavior (page reload)
        var page = $(this).data('page'); // Get the page name from the data attribute

        // Make an AJAX request to the PHP endpoint
        $('#content-area').load('\test\test24\content.php?page=' + page);
    });
});
</script>

</body>
</html>

content.php

<?php
if (isset($_GET['page'])) {
    $page = $_GET['page'];
    $allowed_pages = ['home', 'about', 'contact'];

    if (in_array($page, $allowed_pages)) {
        // Return only the content snippet without a full HTML structure
        include($page . '.php');
    } else {
        echo "<p>Content not found.</p>";
    }
}
?>



---------------------------------------------------------------------------------------------------------------------------------------------------



anyway, i thoink i might be on to something here


I could have one main html page

load different sections

like different types of tables

like downloads links based on selected session


2025-12-29 20:12:59



2025-12-30 05:36:25

when I click on a session link in the table

I want to to dyanmically load a section that show downloads for that time range



some smaller subtasks:
- can I download from another dir


datatables
get new version?
datatable.js on old site is version 3.7.0
DataTables 2.3.6

revisited datatable and updated notes in Datatable.txt


Now I really want to figure out how to call one php script from another

I want to have one sessions page the loads different tables

i want to have a separate file that fills that section

or maybe I will do something else first:
do something with a click on the the table 

made each cell an <a href tag

now how to do something with that


make a new section that is loaded from another php page 
fill.php


2025-12-30 07:51:32


I am getting somewhere !!!

my link in the table:

echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>";
               
reloads the current page with the 'data' parameter set in the url

then I include

include('fill.php');

<?php

   // Check if the 'data' parameter is set in the URL
   if (isset($_GET['data']))
   {
      $data = $_GET['data'];
      echo "<hr>" . $data . "<hr>";
   }
   else
   {
       // Default content if no parameter is set
       echo "<hr>Default<hr>";
   }
?>

2025-12-30 07:54:44

next:

make the links only in the date column

            echo "<tr>";
            foreach($row as $col => $val)
            {
               if ($col == "dt_start") echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";
            }
            echo "</tr>";


2025-12-30 08:04:55

next:

do something in fill...


find gms to download


I think the way to do this is to have another script run in cron that adds the gm files to a database

then I oould just look that up here

table: gm_files

filename
timestamp (get from filename)
level (get from filename)

in the database make a way of knowing what sessions a gm belongs to

this is not a one to one either way:

sessions can have multiple gm's (when session is longer than one level)

gm's can have muliple sessions (when more than one client)

I could have a 3rd table to link them

session_gm_links
session_id
gm_id


what are the rules for populating this table

for each closed session (with start and end)

find gm's that date range fits into

make a link from session to gm

if I have gm's that do not match??

figure that out later

right now create these tables and test

I have the gm table done and the php import script

now how am I going to create the links?

first of all create the table


Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

mysql> DESCRIBE gm;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| filename  | varchar(255) | YES  |     | NULL    |                |
| timestamp | datetime     | YES  |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

mysql> DESCRIBE gm_sessions;
+------------+------+------+-----+---------+----------------+
| Field      | Type | Null | Key | Default | Extra          |
+------------+------+------+-----+---------+----------------+
| id         | int  | NO   | PRI | NULL    | auto_increment |
| gm_id      | int  | YES  |     | NULL    |                |
| session_id | int  | YES  |     | NULL    |                |
+------------+------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SELECT * FROM gm;
+----+------------------------------------------------+---------------------+
| id | filename                                       | timestamp           |
+----+------------------------------------------------+---------------------+
|  1 | 20251229-151621-[32]-autosave on level done.gm | 2025-12-29 15:16:21 |
+----+------------------------------------------------+---------------------+
1 row in set (0.00 sec)


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link


2025-12-30 10:04:32
-------------------------------

i could just leave this part for now

I want to work on the part where I make links to downloads

fill.php

I really wish I had the session id here

now I do


2025-12-30 11:42:28

configure appache for downloads

made an alias to map /downloads/  to /home/m/dev/purple_martians/savegame

see apache file


2025-12-30 13:30:30

now I can download from there directly

what next??

-----------------------------------------------------------------------------

do the database thing


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link

also remove dead link

that could be its own script

make a php file

iterate all sessions





lets thin about think for a minute, high level

gm's are serial, none should ever overlap

sessions are not, there can be mutiple simulatanouesly

so for a session that spans a time range...

you know what else???
I can calculate the start time of a gm!!
I have the end time and the length

is this important, do I need it?...maybe

maybe I should collect more meta data about gm's for the database
start, end,
joins
quits
max players
deaths

2025-12-30 15:00:07

I am getting confused about how to tell if a gm belongs in a session

if I captured the start also....
then if either the start or the end is in the range...

lets draw ascii art diagrams

 [...se1..]
         [...se2..................................]
   [...se2.....................]
[...se4.....................]
[...gm1...][.gm2.][...gm3...][.gm4.][...gm5...]

I think I need gm start...get it...

I have done that..
2025-12-30 16:36:07

now I get start and end in gm database

2025-12-30 16:57:45

now back to link....



for testing...
remove all links,
check for links
show orphan gm
show orphan sessions

2025-12-30 19:10:55

I think I am ready to implement on the web page

when I click on a session make the info page show much more info

2025-12-31 04:31:21

I got quite a lot done yesterday.
made 2 new tables 
gm and gm_sessions
make scripts to scrape and make links
made downloads visible
make a second section of sessions page, loaded from separate script


today I want to:

make the second section way better:
show all info about the selected session
including the list of associated gm files

the list of gm files could have more info about each


is there a way to make web faster?

could I samba the entire www folder and edit direct on windows?
try it, fool! done...

2025-12-31 07:45:24

I have the nice session description done with all data

now onto the list of gm's

done...


I think I want to create some better data..

but maybe first some debug tools

php pages that show
orphan session
orphan gm
all gm

rename fill.php to show_session.php

then make ones for these other things also


2025-12-31 08:33:48
I think I have the core functionality working:

now what?

show info for save game files?

make like a table row with info and a clickable link


should I also save duration in gm?
if I do that where will I stop?
just do that for now

first of all, make sure you don't accidentally overwrite all the work done in www

-------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
-------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

change the gm table, drop and recreate ...done
edit the scrape_gm.php file and edit the db insert .. done
deploy to server

C:\pm>pscp -pw zaiden c:\pm\scrape\* m@192.168.1.146:dev/purple_martians/scrape

they are now in the db with the new column

clean up link_gm.php and test...done

add it to the cron done

add to note in sewrver setup done

thw only issue I could see is that the links are being deleted and recreated every time


2025-12-31 10:35:40

what next?

make the link line look better somehow

could I put it in a table?

make a php script that puts a list of gm's in a table with download links
why? do I think that will look better?

If I can do that, then I can also do that for the main session table

make my own varianle to tell what set of columns are shown 

session_table_column_set



the variables passed when a page is loaded, the query string, is reset when the page is reloaded

I was using this for current session id

I think I want to try a different method

sessions?



<?php
// Start the session
session_start();

// Set session variables
$_SESSION["favcolor"] = "green";
$_SESSION["favanimal"] = "cat";
$_SESSION['count'] = 1;

echo "Session variables 'favcolor', 'favanimal', and 'count' are set.";
echo '<br><a href="page2.php">Go to Page 2</a>';
?>


<?php
// Start the session to access stored data
session_start();

// Access session data
echo "Favorite color is: " . htmlspecialchars($_SESSION["favcolor"]) . ".<br>";
echo "Favorite animal is: " . htmlspecialchars($_SESSION["favanimal"]) . ".<br>";

// Update the counter variable
if(isset($_SESSION['count'])) {
    $_SESSION['count']++;
    echo "You have visited these pages " . htmlspecialchars($_SESSION['count']) . " times in this session.";
}
?>



2025-12-31 11:41:53

I think I got something here...

in main page sessions.php

   session_start();

   // if passed as query string set the session variable
   if (isset($_GET['current_session_id'])) $_SESSION['current_session_id'] = $_GET['current_session_id'];


show_current_sessions reads the sessions varaible

// Check if the 'data' parameter is set in the URL
//if (!isset($_GET['current_session_id'])) echo "<hr>no current session set<hr>";
//else 
//{
//  $current_session_id = $_GET['current_session_id'];

if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];



when clicking on the table link to chande current session, nothing changes, still reloads main page with query

            foreach($row as $col => $val)
            {
               if ($col == "id") echo "<td><a href=\"sessions.php?current_session_id=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";

now bakc to using this for table columns
done and I have killed all the oly files!!!






now lets see if I can make all work...





$t1 = array("id", "Date", "ip" );
$t2 = array("23", "skiddo", "buddday" );
var_dump($t1);
var_dump($t2);
$t3 = array_merge($t1, $t2);
var_dump($t3);

array(3) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
}
array(3) {
  [0]=>
  string(2) "23"
  [1]=>
  string(6) "skiddo"
  [2]=>
  string(7) "buddday"
}
array(6) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
  [3]=>
  string(2) "23"
  [4]=>
  string(6) "skiddo"
  [5]=>
  string(7) "buddday"
}



$t1 = "id, Date, ip";
$t2 = "23, skiddo, buddday";
var_dump($t1);
var_dump($t2);
$t3 = $t1 . $t2;
var_dump($t3);

string(12) "id, Date, ip"
string(19) "23, skiddo, buddday"
string(31) "id, Date, ip23, skiddo, buddday"


2025-12-31 13:33:39

I finally have the session table and columns thing figured out

I think I am ready to work on the game moves table

I have a script that make a link...

2025-12-31 14:56:47
I have the table done...

just need to figure out how to filter it
- all
- orphan
- link to session

0 = all
-1 = orphan
anything else is a session id

lets call it gm filter

actually i dont need to save it, just pass it as a parameter

sessions will already have current session id

SELECT gm.id, filename, dt_start, dt_end, duration FROM gm LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id WHERE gm_sessions.session_id=8 


CREATE TEMPORARY TABLE TempFilteredResults AS
SELECT column1, column2, ...
FROM OriginalTable
WHERE condition = 'filter_value'; -- Your filtering condition


this just looks too stupid

Im going to make my own table with balckjack and hookers


<?php session_start(); ?>

   <script src="../assets/js/jquery-3.7.1.slim.min.js"></script>
   <link rel="stylesheet" href="../assets/css/datatables.min.css" />
   <script src="../assets/js/datatables.min.js"></script>

<?php

function show_gm_table($filter)
{
   $col_list = array("id",   2025-12-31 15:21:53 "Filename", "Start Time",   "End Time",             "Duration"  );
   $row_list =       "gm.id,   filename,  dt_start,        dt_end,     SEC_TO_TIME(duration)";



   if ($filter == 0) $sql = "SELECT $row_list FROM gm";

   if ($filter > 0)
   {
      $sql  = "SELECT gm.id, filename, dt_start, dt_end, duration FROM gm ";
      $sql .= "LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id ";
      $sql .= "WHERE gm_sessions.session_id=$filter";
   }

   echo "sql: $sql\n";

   echo "<script>$(document).ready( function ()
         {
            $('#myTable2').DataTable(
            {
               layout: {  topStart: { buttons: ['colvis'] }, bottomStart: 'pageLength' },
               colReorder: true,
               columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: [0, 1, 2, 3, 4] } ],
               order: [  [0, 'desc'] ]
            }  );
         } );
         </script> ";


      echo "<table id='myTable2' class='display cell-border compact' style='width:90%'>";
         echo "<thead>";
            echo "<tr>";
               foreach($col_list as $col)
                  echo "<th>$col</th>";
            echo "</tr>";
         echo "</thead align='center'>";
         echo "<tbody>";
            $res = mysqli_query($conn, $sql);
            while ($row = $res->fetch_assoc())
            {
               echo "<tr>";
               foreach($row as $col => $val)
               {
                  if ($col == "filename")
                  {
                     $filename = $val;  
                     $fullpath = "/downloads/$filename";
                     echo "<td><a href=\"$fullpath\" download=\"$filename\">$filename</a></td>";
                  }
                  else echo "<td>" . $val . "</td>";
               }
               echo "</tr>";
            }
         echo "</tbody>";
      echo "</table>";

}
?>


here is a copy before I kill it all



/*
table {
  font-family: Arial, sans-serif;
  border-collapse: collapse; /* Merges borders */
  width: 100%; /* Table takes full width */
  margin-top: 15px; /* Adds space above the table */
}

caption {
  padding: 10px;
  font-weight: bold;
  caption-side: top; /* Positions caption at the top */
}

th, td {
  border: 1px solid #ddd; /* Light border color */
  text-align: left; /* Aligns text to the left */
  padding: 12px; /* Inner spacing */
}

thead th {
  background-color: #4CAF50; /* Green background for headers */
  color: white; /* White text for headers */
}

tbody tr:nth-child(even) {
  background-color: #f2f2f2; /* Gray background for even rows */
}

tbody tr:hover {
  background-color: #ddd; /* Gray background when hovering over a row */
}


2025-12-31 16:49:20

I think I have that tabel looking good


now what?

links at the top of sessions for navigation

links by the sessions table for filters only

// Check if 'current_session_id' is set in the $_SESSION
if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];

use the gm table for all and orphan...done


2025-12-31 17:47:40

wow this is coming along great...I should do a massive backup...



I have only 5 files:

sessions.php the main one
show_sessions_table.php
show_current_session.php
show_gm_table.php

and one more
show orphaned sessions..




top menu
Sessions Saved Games Debug Server Status Back to Main Menu


2026-01-01 04:48:11

should I just dive in and start on player name?

How much data do I need?
8 char * 8bits = 64bits

can I do it in one game move?

a game move entry is 4 ints
each int is 32bits


right now the most common use is:

0 - frame
1 - type
2 - player num
3 - data

options:

option 1: use multiple game moves
on the same frame as player active have 4 more game moves:

0 - frame
1 - type (player name part 1)
2 - player num
3 - data (first 4 bytes of player name)

0 - frame
1 - type (player name part 2)
2 - player num
3 - data (last 4 bytes of player name)







option 2: refactor and use one game move

use the bits from type to encode
set active, player number and color
use the last 2 bytes for the name

00000000 00000000 00000000 00000000

I need:
3 bits for player number (0-7)
4 bits for color (0-15)

1 bit to mark that it is a make active type

then I can use the last 2 ints to get 64 bits for 8 char

I like option 2

when I process them I will just check for the one bit the tell me it is a active

00000000 10000000 00000000 00000000 type active
00000000 00000000 00000000 00000xxx player num
00000000 00000000 0000xxxx 00000000 color


      {
         if (!(mLoop.state[1] == PM_PROGRAM_STATE_DEMO_RECORD))
            if (x > current_pos) current_pos = x; // index of last used gm - keep this at the most recent one, never go back

         switch (arr[x][1])
         {
            case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;


old:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

switch (arr[x][1])
{
   case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;
   case PM_GAMEMOVE_TYPE_SHOT_CONFIG:      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_MOVE:      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;
}




void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}

















new:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
//                                                 3       2       1       0
//                                          76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    0b00000000100000000000000000000000
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

int t = arr[x][1];
if (t &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)    proc_game_move_player_active(t,      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_HIDDEN)    proc_game_move_player_hidden(        arr[x][2]            ); break;
if (t == PM_GAMEMOVE_TYPE_SHOT_CONFIG)      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_MOVE)      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;


void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}


 

add to player struct:

   char name[9];
      
now how do I change state size?


show variables from settings?




old:
Variables used for netgame state exchange

mPlayer.syn         :  2400
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112480

new:
Variables used for netgame state exchange

mPlayer.syn         :  2496
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112576

this does not add up...
96/8 = 12bytes
it should be 9
I guess the min is 4 byte chunks

1 int 
mPlayer.syn         :  2432
32/8 = 4 bytes

changed 
#define STATE_SIZE 112576

done


make a place to set it


only clients make sense to save it
every computer should save it as player 0
save it to settings so it persists..done
enforce length
done when loading from disk
do it when editting..done



when adding game move



leave the original the way it was   

#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

add this:

//                                                    3       2       1       0
//                                             76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG  0b00000000100000000000000000000000


when adding, leave the old calls the same

intercept and add in new format


void mwGameMoves::add_game_move(int frame, int type, int data1, int data2)
{
   int p = data1; // alias to improve readability
   
   if (type == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
   {
      add_game_move_player_active(frame, p, data2);
      return;
   }



void mwGameMoves::add_game_move_player_active(int frame, int p, int c)
{
   // convert to new format

   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   int data1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data1 + mPlayer.syn[p].name[i] * of;
   }
   
   int data2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data2 + mPlayer.syn[p].name[i+4] * of;
   }

   add_game_move2(frame, type, data1, data2);
   
}


next 




make soem conversion routines and test

input:
player num
color
name

output 
type
d1
d2

and back

void gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  d1 & 0b0000000000000111;      // mask all except lowest 3 bits
   c =  d1 & 0b0000111100000000) / 8; // mask and shift 8

   char n[9] = { 0 };

//   name[0] = (gm2 >> 24) & 0xFF;
//   name[1] = (gm2 >> 16) & 0xFF;
//   name[2] = (gm2 >> 8)  & 0xFF;
//   name[3] = (gm2 >> 0)  & 0xFF;
//
//   name[4] = (gm3 >> 24) & 0xFF;
//   name[5] = (gm3 >> 16) & 0xFF;
//   name[6] = (gm3 >> 8)  & 0xFF;
//   name[7] = (gm3 >> 0)  & 0xFF;

   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      n[i+0] = (gm2 >> of) & 0xFF;
      n[i+4] = (gm3 >> of) & 0xFF;
   }

   snprintf(name, 9, n);

   printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}


void val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   d1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d1 += name[i] * of;
   }

   d2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d2 += name[i+4] * of;
   }

   printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}










this is the final...


void mwMiscFnx::gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  type & 0b0000000000000111;        // mask all except lowest 3 bits
   c = (type & 0b0000111100000000) / 256; // mask and shift 8

   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);
}


void mwMiscFnx::val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 256; // shift and add color

   d1 = d2 = 0;
   for (int i=0; i<4; i++)
   {
      d1 += name[i+0] << (i*8);
      d2 += name[i+4] << (i*8);
      //printf("name[%d]:%d of:%d dl:%d\n", i, name[i], of, d1);
   }
   //printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);
}


2026-01-01 09:40:43

I have it patched into the game moves thing

now let try something fun

the died, etc messages


make a function in player to get the right name

char* mwPlayer::get_player_name(int p, char * name)
{
   snprintf(name, 9, "%s", mPlayer.syn[p].name);
   if ( (!strcmp(name, "default")) || (!strcmp(name, ""))) sprintf(name, "Player %d", p);
   return name;
}

looking good!!!
now what else?
bottom msg..done


now what about saved games?
the name persists and plays back
but the color does not? apparantly not...it used to...fixed



can I play back old demos?
it looks like only first player comes active
fix this...

make something to interate all gm's and convert to new type

use default player names 'default'

I could make my code accept either type?? maybe?? hell yes!!!!

2026-01-01 10:49:35

now what?

onto the netgame stuff

cjon will now need to send name
sjon rx name and set

lets test...


how?

I need a few computers set up again...

at least one client

is asp on he list?



server crashes when client tries to join

i don't want that to happen  :(

it dies when reading playername from packet
buffer was too small 9 char
examine packet...
how and where?


fixed some bugs and cleaned up code around packet buffer add and read strings...


netgame with playername seems to working quite well...

now what?

is there something wrong with bottom msg?
actually I think I hide it when player is in the way...
commented out for now...

what else is there to do?

overlay for demo playback?

end of level

bug when playing back demo local player name overides player 0

seems to work now?

try with older demo

I think it is saving in the cfg file

no, maybe just saving in memory


what to do?

when doing a full reset, reset all players above 0 names to default
reset local color and name

where does this happen?
make it so that name is never saved except in settings...done

I think in player clear, reset all player names to 'default'
when config is loaded it will be restored

I think I have all this fixed now.
The only time name is saved is when enter is pressed after editting.
When resetting player, set all names to 'default'
When resesting player 0, reload config to restore name

next?


add to sessions database field
while i am at it I should also add color, that should not change for the session...
then I can show the player name and color in sessions table


  player_num        INT,

added:
  player_name       VARCHAR(255),
  player_color      INT,

drop and recreate table..


alter the scrape...done

alter the code that writes logs



added to session struct:

struct client_session
{
   char player_name[9];
   int player_color;




I think I have it done...
deploy to server and test...

might as well make release too...


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------

cd ~
rm -r tmp
mkdir tmp

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

chmod 777 ./op
sudo ./op

cd libnet
make clean
make lib
sudo make install

cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/web/* /var/www/html

sudo systemctl start pm


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------


2026-01-01 22:31:35

I finally have the new values showing in the sessions table


now what should I do with them?

add them to sessions table of course

bug

now that I am storing big numbers in gm file, ill need another method for determining the length

can I clamp it?

what bit am I using now? 24

2^24 = 16.7M
/40 = 420k sec
/60 = 6990 m
/60 = 116h

do I have a max time for game?
server will reload in 1H

so if I just toss any values > 16M from my end calc that should work...

no

-rw-r--r--  1 m m   57 Jan  1 22:29 '20260101-222933-[103]-autosave on level done.gm'
m@o3000:~/dev/purple_martians/savegame$ cat 20260101-222933-\[103\]-autosave\ on\ level\ done.gm
4
0
0
0
103

1
9
0
5

1
3
0
0

1
8389888
1802398064
7602297
m@o3000:~/dev/purple_martians/savega

what if I just go back chunks of 4 at a time

the problem is how I write it to the disk
i should realy just do line of 4 char separated by commas
0,2,3,111

this sounds like a major undertaking

what if i got the last 80 char, split into array on newlines

grouped them 4 at a time

I think I am on my way to finding a better way to do that




2026-01-02 06:35:32

add player and color to sessions

get player icons for all colors
I know its a small thing but it will make things look so much better!!


use code to generate

   if (1)
   {
      // save as set of icons to disk
      for (int a=0; a<16; a++)
      {
         char fn[80];
         sprintf(fn, "bitmaps/player_icon_%02d.bmp", a );
         al_save_bitmap(fn, player_tile[a][2]);
      }
   }

done

what about transparency? right now backgroud color is black


can I also save as png?

as simple a changing the extension




why am i so against css?

it seems like the easiest sollution many times...

i can put it in the head:


<!DOCTYPE html>
<html>
<head>
    <title>My Website</title>
    <!-- Internal CSS styles -->
    <style>
        body {
            background-color: lightblue;
        }
        h1 {
            color: maroon;
        }
    </style>
</head>
<body>
    <h1>This is a heading</h1>
    <p>This is a paragraph.</p>
</body>
</html>





.icon-text-container {
  display: flex;       /* Enables Flexbox layout */
  align-items: center; /* Vertically centers the items */
  gap: 10px;           /* Adds space between the icon and text */
  /* Optional styling for visibility */
  border: 1px solid #ccc;
  padding: 10px;
  width: fit-content;
}

.icon {
  width: 24px;   /* Set desired icon size */
  height: 24px;
}

.text {
  /* Text styles */
  font-size: 1rem;
}


<div class="icon-text-container">
  <!-- Use an image, an icon font (like Font Awesome), or an SVG -->
  <img src="path/to/your/icon.png" alt="Icon" class="icon">
  <span class="text">Your Text Here</span>
</div>




flex is awesome...i want to use it for everything!!!

https://css-tricks.com/snippets/css/a-guide-to-flexbox/

make css in the head
name containers for everything
one for the page and then ones for all the elements


I am working on current session...

I have flex containers for:
entire thing
title
text block

2026-01-02 13:17:32

I have current session and session table done
not much I can do with the Datatables thing..

I guess I can style individual elements, like head

i have done head tr and tr hover...probably all I'll need


Now I want to redo this all in a dark theme....

I am loving it!!!

at the top of sessions page:


<html class="dark">







<!-- 
body {
    background-color: #000000; /* Black background */
    color: #FFFFFF; /* White body text */
}

a:link {
    color: #77d7ff; /* A light blue for unvisited links */
    text-decoration: underline; /* Always use an underline for accessibility */
}

a:visited {
    color: #b39ddb; /* A light purple/violet for visited links */
}

a:hover {
    color: #FFFFFF; /* White on hover */
}



 -->




<!-- container for player icon and player name text -->

.icon-text-container
{
   display: flex;      
   align-items: center;
   gap: 10px;          
}
.icon { width: 20px; height: 20px; }
//.text { font-size: 1rem; }


<!-- hack because sometimes hr do not work in flexbox -->
.hack-hr
{
   font-size: 1rem;
   font-weight: normal;
   line-height: 0;
   margin: 0;
}




2026-01-02 16:46:01


I have spent so much time making everything line up and look nice...

now do current session to look like session 

pick a color


I want to make a frame work to make these things easier..


Frame around the whole section

section at the top for title

other section headers possible


I think what I need to do is:

One container for all
one container for the title frame, draw only bottom border
one container inside that to make the title have padding

then for any sub sections

one container for the sub section draw only bottom border
one container inside that for padding

I want to make this common, not custion for each instance

css and php helper functions

.section-frame
.section-frame-title-frame
.section-frame-title-body

.section-frame-sub-title-frame
.section-frame-sub-title-body

2026-01-03 01:59:50

I think I am done here....
I have the common stuff done for css html and all sessions pages...

it looks great...


backup it the fuck up!!!

copy from server to local and do a commit....


--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

2026-01-03 08:12:38


buttons...


three methods:

Method 1: Style an Anchor Tag (Recommended)

This approach uses a standard hyperlink and applies CSS to give it the appearance and feel of a button.
This is best for accessibility and ensures the link still works if JavaScript is disabled. 

<a href="https://www.example.com" class="button">Go to Example</a>

The target="_blank" attribute can be added to open the link in a new tab: 
<a href="https://www.example.com" class="button" target="_blank">Open in New Tab</a>

.button {
  background-color: #4CAF50; /* Green background */
  border: none; /* Remove default border */
  color: white; /* White text */
  padding: 15px 32px; /* Some padding */
  text-align: center; /* Center the text */
  text-decoration: none; /* Remove underline */
  display: inline-block; /* Make it a block-level link */
  font-size: 16px; /* Increase font size */
  cursor: pointer; /* Add a hand cursor on hover */
  border-radius: 8px; /* Rounded corners */
}

.button:hover {
  background-color: #45a049; /* Darker green on hover */
}


Method 2: Use JavaScript with a Button Tag 

This method uses the <button> element and adds a JavaScript onclick event to perform the redirection. 

<button onclick="window.location.href='https://www.example.com'">
  Go to Example
</button>

To open the link in a new tab, use the window.open() function: 

<button onclick="window.open('https://www.example.com')">
  Open in New Tab
</button>

This method requires JavaScript to be enabled in the user's browser to function.


Method 3: Using a Form

For simple navigation where JavaScript is not an option, you can wrap a submit button in a <form> tag and specify the destination in the action attribute. 

<form action="https://www.example.com">
  <button type="submit">Go to Example</button>
</form>



I did method 1 looks good,
now I want to put the buttons in the title bar





I I think I should do this by default for all...


title frame
flex box for title frame

actual title
flex frame for buttons


2026-01-03 10:11:03

that is so fucking beautiful!!
I want to get button colors from id



2026-01-03 10:34:18

now do current session
make buttons to show hide bandwidth

2026-01-03 10:50:24

all that hard work setting up the framework paid off
it was quite easy to add this button

now make one for player section and game moves also
2026-01-03 11:27:04

done

now make gm have nice header like the rest

all done...

now what?

work on top level link row

add
sessions (this) 
debug (more table)
all gm

this is what I have now:

<table><tbody><tr>
<td style='padding:2px 8px;' > <a href="../index.html"  >Back to Main Page        </a> </td>
</tr></tbody></table><hr>

done
now implement game moves and debug??  later...


I think sessions is 100% done

what did you want to do with game moves now?

have a detailed section for them like current session, current savegame
I need a good name to call these things:
SavedGames

implement the three way button for saved game list

done




make a detailed section for them like current session, current savegame
I need a good name to call these things:
Saved Games


change the gm table list

make a download button and one to select gm

I will need a new section to show details of current gm

Current Save Game
$current_gm_id
show_current_gm.php
how to rearrange table?..done


now what?

when setting current gm, find players that are in the file...

how?

I think I should run an external PHP script that parses and adds to database
for now only do it when looking at the file

I will need another few tables:

players
(to keep track of unique players)
but how unique?

same name? (of course)
same player_num and color (probably not)
same host name?
and what will I do if there is no player name, or it is default?


I think I should start by saving as much data as I can
i don't have to make use of it all

CREATE TABLE players (
  id                INT AUTO_INCREMENT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,
  PRIMARY KEY(id)
);

I can get all fields from session table

I can only get this from a gm file:
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,


create this then alter session_scrape to enter player info also...or...
I could just get it from the table already

it will be like a smaller sub table from sessions...
only 6 columns and no uqique

I really question if I need ip host port?

if I am trying to find

I don't think I will use them for matching...
for sessions, get everything

for finding a player in a gm, i might get multiple...just deal with it..list them all

why do I even need this extra table?

mostly because once I look something up I want to save it...

-------------------

make a php script to add player to db
if exists find id
in not create and find id

---------------------------------

wait I just thought of something...
we can get all the info when sessions enters the player

then when gm goes to look it up, it should aleady exist

if there are multiple player matches when searching only for num, color and name, will it really matter?
what am i planning on doing with this info anyway?



I mostly want to be able to show seme meta data for gm files

my plan is to parse the gm file and collect info

right now all I was planning on doing was getting the three player variables

why don't we just stick with that for now?

I still want to add them to a database make a link table
gm_player



script

parse_gm.php

opens gm and looks for play moves

to gma -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780
to val -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780

Process returned 0 (0x0)   execution time : 0.098 s
Press any key to continue.



else
{

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      echo "\n$ch --$rf\n";  
   }







   $n = "--------";

   var_dump($n);

   for ($i=0; $i<4; $i++)
   {
      $tv = $g2;
      echo sprintf("0 - %032b\n", $tv);
      $of = $i*8; 
      $tm = $tv >> $of;
      echo sprintf("2 - %032b\n", $tm);
      $mk = $tm & 0xFF;
      echo sprintf("3 - %032b\n", $mk);


      $ch = chr($mk);
      echo "4 - ch:$ch\n";

      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );

//      $n[$i+0] = $ch;

   }
   var_dump($n);
   echo $n;

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      
      echo "\n$ch --$rf\n";  

      var_dump($rf);

//      if ($rf == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0x0;





//      echo sprintf("[%d] - '%d' ' '%c'  fn:%d\n", $i, $n[$i], $n[$i], $found_null);

//      if ($n[$i] == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0;
   }
   
   var_dump($n);
   echo $n;


/*
   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, "%s", n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

*/


//   echo "\n\nplayer: $p color:$c name:$n\n\n";

}
}


I have the function done:


function gma_to_val($t, $g1, $g2)
{
   echo "gma_to_val($t $g1 $g2)\n";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8


   // get the player name form the next 2 32bit ints
   $n = ""; 
   for ($i=0; $i<4; $i++)
   {
      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );
   }
   echo "\n\nplayer: $p color:$c name:$n\n\n";

   // show values
   for ($i=0; $i<8; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);

   // if zero somehwere in the data, write all zeros from then after
   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      if ( ord( $ch ) == 0)  $found_null = 1;
      if ($found_null) $n[$i] = chr(0); 
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   for ($i=0; $i<9; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


}



2026-01-04 03:18:19

now what?

I am not sure I am getting the right values from gm files


better version


function gma_to_val($t, $d1, $d2)
{
   echo "gma_to_val($t $d1 $d2)  --  ";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8

   // get the player name from the next 2 32bit ints
   
   // make sure this is declared as a string
   $n = "";
   
   // detect null and force all char after to also be null
   $found_null = 0;   

   // first 4 char from d1;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d1 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i] = $ch;
   }


   // second 4 char from d2;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d2 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i+4] = $ch;
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   //for ($i=0; $i<9; $i++)
   //   echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


   echo "player: $p color:$c name:$n\n";

}





I have another crazy idea

integrate a database into the game

- i need to make sure that windows and linux versions are still the same
- do I need a networked database like mysql? could i just use sqlite?

why?
what are the benefits:
- make the way the server writes files to disk and later gets scraped a lot simpler
- the server can just write directly to the database
- make the way to adjust the config from headless mode
- replace so much of the level stats bullshit with something much simpler

cons:
would take a lot of fucking work!!

how can i start small?

add sqlite to project and make sure it works in windows and linux
then start adding things to it

first of all, sessions



2026-01-04 04:09:13

I am going to add sqlite to my project....

first save all the work in progress and commit..

2026-01-04 07:45:17






2026-01-04 11:08:21

i have the update function working...

it only updates dt_end, duration, and endreason for now


I want to call it from more places


when I close a session, I should also set session_id to 0 in player loc
then when I am checking for open sessions, I can check there


I these in sessions

         client_sessions[p].next_levels++;
         if (p == mPlayer.syn[0].level_done_player) client_sessions[p].exits++;

if that goes away, can I save it in player?

set it in tally, then make sure it gets reset


why are all these in syn?

   int stat_respawns;
   int stat_shots_fired;
   int stat_enemy_hits;
   int stat_player_hits;
   int stat_self_hits;
   int stat_purple_coins;

   int stat_enemy_exploded;
   int stat_player_exploded;
   int stat_self_exploded;

added:
   int stat_next_levels;
   int stat_exit;


mItem.pmsgtext :250000
---------------:------
total          :384080

Variables used for netgame state exchange

mPlayer.syn         :  2624
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112704

Other Large Variables



#define STATE_SIZE 112704




I have been through the whole file: session log and done all I could
I still need to do something about tally
the sql method nevers call add log or tally or clear

what calls it outside this file?


mwGameMoves will do this when client quit: session_close(p, 2); // reason 2 - client quit

this is still good


omg should I deply to 146 and try?

I should work on the tally shit now

25 fucking variables to get from db, update, and put back...



2026-01-04 16:05:44


I think I am ready to remove all the old session stuff...


2 calls to


   void session_add_entry(const char* address, const char* hostname, int p, int active, int inactive_reason);

      session_add_entry(address, hostname, 9, 0, 1); // server full
      session_add_entry(address, hostname, p, 1, 0); // join invite     


void mwNetgame::session_add_entry(const char* address, const char* hostname, int p, int active, int endreason)
{
   session_add_sql(address, hostname, p);


changed to pass end reason also


   session_add_sql(address, hostname, p, endreason);


now replace those 2 calls with the sql version
then deal with endreason
done, I no longer use any of the old session stuff

I should still make it optional

how did I used to do that?




































I also would like a meta block for gm files
I have one already, but I want a better one
append at the start when saving
start time
end time
duration
players
player names
finished?

maybe each player section could include:
name
number
color
start frame
end frame
respawns
purple coins collected
enemies killed
other players killed
enemy hits
self hits
exits triggered

I have been think about redoing how I save gm files to disk
currently:
nothing but unordered integers, one per line

1320
0
0
0
9
1
9
0
5
1
3
0
0
1
8389888
1802398064
7602297
1
8392193
1819043193
7602287
13
5
1
4
17
5
1
0

I was thinking of making it like this:

1320
0,0,0,9
1,9,0,5
1,3,0,0
1,8389888,1802398064,7602297
1,8392193,1819043193,7602287
13,5,1,4
17,5,1,0

it should not take more disk space
I would just be swapping crlf for ,

when saved on windows the lines end with CRLF
in linux its just LF

if I make this change, what would it affect?
-only the game saves and loads to disk,
-once loaded into the array the way it is stored on disk is irrelevant
-it would make it easier to parse later



what will 

magic number to start file:
PMSAVEGAME

then the meta block up to

in the meta block

VERSION:1



TIMESTAMP_START:
TIMESTAMP_END:
MAX_FRAME:
LEVEL_NUM: 


PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:



GAME_DATA_NUM_ENTRIES:
GAME_DATA_START:

each line will be 4 commas separated ints, corresponding to an array line

0,0,0,9
1,9,0,5
1,3,0,0


most times reading the file, the header can be ignored

the header can be modified with no ill effects

if the header or magic number is missing, revert to old loading behaviour


in load:

first detect magic number:

if missing do old load


int mwGameMoves::load_gm(const char *sfname)




I redid the old method, it had a read file pattern I used from my frist days of c programming:

      int loop, ch;
      char buff[2000];

      initialize();

      char fname[256];
      sprintf(fname, "%s", al_get_fs_entry_name(FS_fname));

      FILE *filepntr = fopen(fname, "r");
      if (filepntr == NULL)
      {
         printf("Error opening file:%s\n", fname);
         return 0;
      }
      else
      {

         // first get number of entries
         loop = 0;
         ch = fgetc(filepntr);
         while((ch != '\n') && (ch != EOF))
         {
            buff[loop] = ch;
            loop++;
            ch = fgetc(filepntr);
         }
         buff[loop] = 0;
         entry_pos = atoi(buff);


         // then get all the entries
         for (int x=0; x<entry_pos; x++)
            for (int y=0; y<4; y++)
            {
               loop = 0;
               ch = fgetc(filepntr);
               while((ch != '\n') && (ch != EOF))
               {
                  buff[loop] = ch;
                  loop++;
                  ch = fgetc(filepntr);
               }
               buff[loop] = 0;
               arr[x][y] = atoi(buff);
            }
         fclose(filepntr);

ewww....

new:

      for (int x=0; x<entry_pos; x++)
         for (int y=0; y<4; y++)
            if (fgets(buffer, 100, file)) arr[x][y] = atoi(buffer);


#include <stdio.h>

int main() {
    FILE *fp;
    int id;
    char firstname[50];
    char lastname[50];
    
    // Open the file in read mode ("r")
    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }
    
    // Read data in a loop, checking the return value
    // "%d,%49[^,],%49[^\\n]\\n" format:
    // %d     -> read an integer
    // ,      -> match a literal comma
    // %49[^,] -> read up to 49 characters that are NOT commas
    // %49[^\\n] -> read up to 49 characters that are NOT newlines
    // \\n    -> consume the newline character at the end of the line
    while (fscanf(fp, "%d,%49[^,],%49[^\\n]%*c", &id, firstname, lastname) == 3) {
        printf("ID: %d, First Name: %s, Last Name: %s\n", id, firstname, lastname);
    }

    // Check if the loop terminated due to end-of-file or a reading error
    if (!feof(fp)) {
         fprintf(stderr, "Error reading data or format mismatch.\n");
    }
    
    fclose(fp); // Close the file
    return 0;
}





#include <stdio.h>
#include <string.h>

int main() {
    FILE *fp;
    char line[256]; // Buffer to hold one line
    char *token;

    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }

    // Read each line using fgets
    while (fgets(line, sizeof(line), fp)) {
        // Use strtok to parse the line using a comma as a delimiter
        token = strtok(line, ",");
        while (token != NULL) {
            // Process each token (field)
            printf("Field: %s\n", token);
            // Get the next token
            token = strtok(NULL, ",");
        }
    }

    fclose(fp);
    return 0;
}



now I want to convert to csv lines

make a funtion to convert:

I need some metadata from the header that I can use in the new file


added these to the class:

   char[256] last_loaded_gm_filename;   
   int last_loaded_gm_version;
   int last_loaded_gm_last_frame;

set them in load


I have it done

version 0 oldest
version 1 with header, data still 1 val per line
version 2 with header and data 4 vals per line

what else do I want to put in there?
start time, last frame, duration
player info


I also want to make sure I do not overwrite any values in the header
how about, read everything from header, change, write
this is probably not needed, I will rarely resave one of these

If there is a timestamp, do not overwrite

TIMESTAMP_START:
MAX_FRAME:
LEVEL_NUM: 

done




now the hard part:

PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:


I also want to make all player active things the same (new version)

I just found there might not be an active game move in a gm file...?



I was playing with the gdt thing in demorecord to iterate all demo levels

just the act of loading them triggered the resave


fixed that...

I just looked at all the ones in the demo folder and they are all ok

what is going on?


am i looking at client only ones?

I don't think so, it has player 0

maybe it just has new style ones...yes...


2026-01-05 07:13:44
I am running out of time for now:

What I really want to do is convert all to the new format: version 2, with blackjack and hookers....

I want to be sure everything will go smoothly though

then run it on all in the savegame folder

I still want to keep the old read stuff around

I should make it so that whenever one is read,
if it is the old version, convert it to the new version
with a different filename?

or rename the old to .old

then once I have them all in the new format, get back to searching for players sessions within the gm



2026-01-05 12:02:15

do this one task...

make it so that loading gm will save in new format

do a few till you are sure it is working

copy an old one from demo


I think I got it....
should I just run it and let it overwrite

2026-01-05 12:54:46

done..

now all levels should be new format...

make it so that any old ones loaded will get redone...

done...
all demos are now version 2
anytime version 1 or earlier is loaded, it will be resaved as v2


2026-01-05 13:25:08

now back to looking for players in gm's

while testing, patch it in load

this might be more complicated than I thought

I could have many players and even overlapping ones
a thorough method would be by player
player 0 


wait, how about find all player_actives


I really want to be able to dowlod from server again...why is it broken?

I think I need to fix the gm scrape to work with sqlite

remove the old sessions_scrape from cron...












SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172255' AND dt_start<'20260104-174355')  OR    (dt_end  >'20260104-172255' AND dt_end  <'20260104-174355');

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172519' AND dt_start<'20260104-174358')  OR    (dt_end  >'20260104-172519' AND dt_end  <'20260104-174358');


Session id:3   -   start:20260104-181242   -   end:20260104-185051   -


SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181242' AND dt_start<'20260104-185051')  OR    (dt_end  >'20260104-181242' AND dt_end  <'20260104-185051')
Session id:4   -   start:20260104-181249   -   end:20260104-185052   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181249' AND dt_start<'20260104-185052')  OR    (dt_end  >'20260104-181249' AND dt_end  <'20260104-185052')
Session id:5   -   start:20260104-185146   -   end:20260104-185147   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-185146' AND dt_start<'20260104-185147')  OR    (dt_end  >'20260104-185146' AND dt_end  <'20260104-185147')
Session id:6   -   start:20260105-072136   -   end:20260105-072146   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-072136' AND dt_start<'20260105-072146')  OR    (dt_end  >'20260105-072136' AND dt_end  <'20260105-072146')
Session id:7   -   start:20260105-103756   -   end:20260105-104026   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103756' AND dt_start<'20260105-104026')  OR    (dt_end  >'20260105-103756' AND dt_end  <'20260105-104026')
Session id:8   -   start:20260105-103806   -   end:20260105-104015   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103806' AND dt_start<'20260105-104015')  OR    (dt_end  >'20260105-103806' AND dt_end  <'20260105-104015')
Session id:9   -   start:20260105-104042   -   end:20260105-104105   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104042' AND dt_start<'20260105-104105')  OR    (dt_end  >'20260105-104042' AND dt_end  <'20260105-104105')
Session id:10   -   start:20260105-104048   -   end:20260105-104103   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104048' AND dt_start<'20260105-104103')  OR    (dt_end  >'20260105-104048' AND dt_end  <'20260105-104103')
Session id:11   -   start:20260105-111037   -   end:20260105-111738   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111037' AND dt_start<'20260105-111738')  OR    (dt_end  >'20260105-111037' AND dt_end  <'20260105-111738')
Session id:12   -   start:20260105-111135   -   end:20260105-111418   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111135' AND dt_start<'20260105-111418')  OR    (dt_end  >'20260105-111135' AND dt_end  <'20260105-111418')  m@o3000:~/dev/purple_martians/scrape$

SELECT * FROM myTable WHERE myColumn BETWEEN '2023-01-01' AND '2023-02-01';



delete all on server and start again...

get all php from web


2026-01-05 15:22:40
done


-----------------------------
pm still segfault when client joins, but only when run as service
---------------------------------




Session log scrape: 20260105-221501

Session id:1   -   start:20260105-151441   -   end:   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'')  OR    (dt_end  >'20260105-151441' AND dt_end  <'')
Session log scrape: 20260105-221601

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221701

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221801

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221901

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-222001

I only have 2 sessions

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')  m@o3000:~/dev/purple_martians/scrape$
                                                               2026-01-05 15:15:27

sqlite> select * from gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite> select * from gm;


20260105-151541

2026-01-05 15:15:27
2026-01-05 15:15:41
20260105-151508


there it is!!!

save gm in a better date format

      // convert the datetimes to something mysql likes
//      $dt_end   = $dt_end->  format('Y-m-d H:i:s');
  //    $dt_start = $dt_start->format('Y-m-d H:i:s');


      // convert the datetimes to something sqlite likes
      $dt_end   = $dt_end->  format('Ymd His');
      $dt_start = $dt_start->format('Ymd His');



sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite>



1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite> SELECT * FROM gm_sessions;
sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite>

forgot the goddamn dash...

now it all works!!!


I can make gm's and see them soon on server...



2026-01-06 12:44:54


I was having some big ideas:


On the topic of parsing gm files and getting player info,
I was planning on embedding this in the header.

I am rethinking that...

Maybe I could just keep it all in the database.

CREATE TABLE player

could be linked to gm and session

how would all these foreign keys work?

session starts and is assigned UUID
player is created and linked to same UUID

or...

whenever a game is started:
player is created with UUID

nah...


lets just do the 

3 tables:
session
gm
player


all are linked, but how?

1 session to 1 player
1 session to many gm

1 gm to many players
1 gm to many sessions

1 session to 1 pleyer


how about each instance of purplemartians has its own UUID?
when the program is first run and the config file is created from scratch
create a UUID, save it in the config and never change it

Then when a client joins he will send the UUID

The server will create a pleyer with that UUID, and other info.
later if that UUID instance changed other stuff about them that can be updated


this is getting complicated, maybe overly complicated...
what will I gain from doing this
is there a simpler way?


I want to link players to save game files
player names are already embedded in the save game files

to start with I could make a table with just those three things:

name
color
number

whenever I read a gm file...or enter it in the gm table
make sure it has a unique id...already done

then look for players in the file and add them if they do not exist and link them to 

I think I can do this without any UUID's for now

also I want to do this in the game, not in a scrape script



2026-01-06 13:12:43

what to do to make this happen?

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id             INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'gm' Created Successfully\n");


I already have this: (duh)

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               ip                VARCHAR(255), \
               port              INT,  \
               hostname          VARCHAR(255),  \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");


remove the shit about ip, port, hostanme...leave that in sessions (which will have a 1 to 1 link with players)


do it!!!

OK this is what I have...

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");

next: remove any scrape and link things that I have in cron in the server, I am going to do this all in the game...

next, where am I going to do the in the game?

how about when reading or saving demo file?

eventually it will be when saving only, but for testing do it when reading...


void mwGameMoves::find_player_info()
{
   printf("find_player_info()\n");
   // looks in the loaded gm file and find all player active and inactive moves

   int am_count = 0;
   int im_count = 0;

//   int par[10][10] = { 0 };


   // first count active and inactive game moves
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG) am_count++;
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE) im_count++;
   }
   printf("player active/inactive moves: %d %d\n", am_count, im_count);





//      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)


}




the first thing I want to do is:

make sure there is an entry for this in gm

how can I tell if it is unique?
I don't really want to rely on filename...





I thought about it some more:

when creating generate a UUID and stick it in the header


when saving, does UUID already exist?


have a gm class or struct in my game


UUID is a member
same as filenname etc..


when loading, stick it in there and set stuff from file

when saving...


i have so many different thing I want to keep track of related to the game_moves array


have methods to:
clear
start



I already have that as game moves array class

just make that work:


have a flag to tell the status of the current array:

int status;
0 - clear
1 - game in progress
2 - client data only
3 - loaded from demo file


right now I have:
entry_pos
- indicates where next gm entry will go
- is also the size of the gm array
- used in demo mode to mark last entry

current_pos
used only when playing back in demo mode


I want to have more data:
level number
UUID

make some functions like

start new file
erases all
sets level
sets status
generates UUID

when loading from file the UUID

remind me again why I need UUID at all...

what am i trying to do here?


why can't i just use regular autoinrementing

I want to assign an ID to the gm file at creation that will never change...
I will enter it in the database, using that as the primary key
if the database gets lost later I will always have that id (if that happens...???)
what will I do with it?

link it to a session (which will also have a UUID)
this will need a separate table

link it to players







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values

instead of UUID just use auto


can I just fake it and use my own pseudo UUID



I am getting bogged down here....why is this so hard?



I think I want UUID so I can assign something at creation that will never change
why do I want that?
so I can detect duplicates?
so I persistantly link to other things?

so I can add them to a database table with proper links preserved
so I can update filepath location if it changes

I think I am just going to use a random 32 or 64 bit number

32bit 50% chance of collision after        77,000
64bit 50% chance of collision after 5,100,000,000

and even if I had a collision, what would that effect?



uint64_t generate_random_u64(void) {
    // Combine two 32-bit random numbers (assuming RAND_MAX is at least 32767)
    // The cast to uint64_t is crucial to ensure correct shifting
    uint64_t r1 = rand();
    uint64_t r2 = rand();

    // Shift the first random number to the upper 32 bits and combine with the second
    // This provides a full 64 bits of potential randomness
    return (r1 << 32) | r2;
}

int main(void) {
    // Seed the random number generator once using the current time
    // For better seeding, one could use a mix of time and other factors
    srand(time(NULL));

    uint64_t random_int = generate_random_u64();
    printf("Random 64-bit integer: %llu\n", random_int);

    return 0;



I'm going with this...







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values




added to class


   uint64_t HEADER_muid;
   int      HEADER_version;
   char*    HEADER_create_timestamp;
   char*    HEADER_modify_timestamp;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;



now implement this in save:

   fprintf(filepntr, "%s", "PMSAVEGAME\n");

   fprintf(filepntr,       "VERSION:%d\n",              HEADER_version);
   fprintf(filepntr,       "CREATE_TIMESTAMP:%s\n",     HEADER_create_timestamp);
   fprintf(filepntr,       "MODIFY_TIMESTAMP:%s\n",     mMiscFnx.get_timestamp());
   fprintf(filepntr,       "LEVEL:%d\n",                HEADER_level);
   fprintf(filepntr,       "LAST_FRAME:%d\n",           HEADER_last_frame);
   fprintf(filepntr,       "GAMEMOVE_NUM_ENTRIES:%d\n", HEADER_num_entries);
   fprintf(filepntr, "%s", "GAMEMOVE_DATA_START:\n");


now load:

first of all bump version....


save in version 3 load in 2




2026-01-07 04:09:08

when reading,
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000


if level not set, find it and set it



before loading, call initialize
in initialize set all header values to 0's
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000



2026-01-07 04:46:29

   // header variables
   string   HEADER_create_timestamp;
   string   HEADER_modify_timestamp;
   uint64_t HEADER_muid;
   int      HEADER_version;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;


void mwGameMoves::initialize(void)
{
   memset(arr, 0, sizeof arr);
   entry_pos = 0;
   current_pos = 0;

   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;

   sprintf(last_loaded_gm_filename, "%s", "");

}


I think I want to change how I get stuff from header...

this is what I have now:

   void header_key_find_int(char* line, const char* key, int &val);
   void header_key_find_string(char* line, const char* key, string &val);

and I need to extend it to work with uint_64  


what do I want to do:

pass it a line (as string)

it will look for keys and set varaiable

if it finds the end it will return 0;

bool parse_header_line(string line);


2026-01-07 06:48:47

I think I have it done

load level works for old and new versions

saves as version 3


make some tests when saving about missing header values..done


now I need to implement the status...

status clear ..done

   // 2 - demo loaded

   // 1 - level started


make a function for this:

sets status
creates muid
sets created_timesatmp
sets level

void new_level


void mwGameMoves::new_level()
{
   initialize();   
   HEADER_create_timestamp = mMiscFnx.get_timestamp();
   HEADER_muid = mMiscFnx.generate_random_u64();
   HEADER_level = mLevel.play_level;
   status = 1;   
}



where to call it?


int mwLoop::load_and_setup_level(int level, int type)
{
   if (!mLevel.load_level(level, 0, 0)) return 0;
   else
   {
      if (type != 4) mGameMoves.new_level(); // do not reset game moves in demo mode


now in save, do different thing based on status...
done....


I think I might actually be getting somewhere....


should I enter it in the database at this point?

what does my table look like?


   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               id             INTEGER PRIMARY KEY, \
               filename       VARCHAR(255), \
               dt_start       DATETIME, \
               dt_end         DATETIME, \
               duration       INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");


I was using start and end to figure out what session it might belong to...
I can still keep that


I should add all the other stuff


I'll need a function is the game to iterate all the gm's 
- check that they are in the database
- make sure the filepath is up to date



I think it will be driven by the game

at the core it will have a function to do one gm


2026-01-07 18:24:07


   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;


I am going to start over with the table....

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               muid           INTEGER PRIMARY KEY, \
               filename       TEXT, \
               dt_start       TEXT, \
               dt_end         TEXT, \
               duration       INT,  \
               level          INT,  \               
               num_entries    INT ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");




now a fucntion to add to the database

void add_gm_to_db(const char* file)
{
   // first load_gm, this will check the data
   
   // check if muid already exists
   
   if yes update values
   in no insert values
}



2026-01-08 03:23:04

why do I feel like I am getting bogged down?

is is because my plan is not fully formed?

just pick on small task

take timestamp and last frame and trun it into start, end, and duration

where can I test this...

load





do something about check for old gma right now it is called on everysave
options:
-call only on version 0
- inline check with every row written 
done.. did inline
I should just leave this forever

removed old method, saving here


void mwGameMoves::convert_active_gamemoves()
{
   // coverts all old style gm to new
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] & PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG)
      {
         int t  = arr[x][1];
         int d1 = arr[x][2];
         int d2 = arr[x][3];

         int p, c;
         char name[16];

         mMiscFnx.gma_to_val(t, d1, d2, p, c, name);

         printf("found new gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, t, d1, d2);

      }
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
      {

         int p = arr[x][2];
         int c = arr[x][3];

         int type, d1, d2;
         char name[16];
         sprintf(name, "Player %d", p);

         mMiscFnx.val_to_gma(type, d1, d2, p, c, name);

         printf("found old gma -- p:%d c:%d -- new: name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);

         arr[x][1] = type;
         arr[x][2] = d1;
         arr[x][3] = d2;
      }
   }
}
*/





2026-01-08 03:57:36

fixed some bugs, now I am actually saving and loading all header values


what if I replaced my 64 bit muid with something else...

options:


10 char string [A-Z] 
10^26 = 1.0 e26
2^64 = 1.8 e19

94274532147610
52544629916126
105437152168571
62015032799880
89777701388341
126989298070705
15 digits?

108821586384139
100759932765462
24167781002446
132229158166728
24730421704635
31181462578973
'GLWITOJHHGWSWRIO'
'VBQDBOWGANYPRZKQ'
'XANMHOPTNCLVIZUA'
'YDWNQAPQXVSVPJML'
'GMOMXLGGAPWYCQUQ'
'CPUHSVSJDHNVNUCZ'

16^26 = 2 e31


do it, replace uint64 with char[16]


done...


this is some date manip from sessions

#include <iomanip>

   // create at tm struct from start date
   struct tm timestart = {0};
   std::stringstream ss(dt_start);
   ss >> std::get_time(&timestart, "%Y%m%d-%H%M%S");
   if (ss.fail()) printf("Error parsing time\n");
   time_t st = mktime(&timestart);

   char ts[20];
   strftime(ts, sizeof(ts), "%Y%m%d-%H%M%S", &timestart);

   // create a tm struct from now
   time_t now = time(NULL);
   struct tm *timenow;
   timenow = localtime(&now);
   char dt_end[20];
   strftime(dt_end, sizeof(dt_end), "%Y%m%d-%H%M%S", timenow);

   int duration = difftime(now, st);









I have some bugs...

muid??

Loading gm: 'C:\pm\lv2'
----'YGSHQVDDEDPLKMFD'
Last frame not set from header, setting to:3793
Level number not set from header, setting to:2
HEADER_create_timestamp was not set. Setting to '20260101-000000'
HEADER_muid was not set. Setting to ''
Loaded old version of file: C:\pm\lv2  --  resaving as new version
Resave triggered, resaving:C:\pm\lv2
Filename            :C:\pm\lv2
MUID                :
VERSION             :0
CREATE_TIMESTAMP    :20260101-000000
MODIFY_TIMESTAMP    :
LEVEL               :2
LAST_FRAME          :3793
GAMEMOVE_NUM_ENTRIES:523

Saving gm:C:\pm\lv2
HEADER_muid was not set. Setting to ''

C:\pm>



string mwMiscFnx::generate_muid()
{

does not work (only works the first time)
//   string tmp;
//   for (int i=0; i<16; i++)
//   {
//     std::random_device seed;
//     std::mt19937 gen{seed()}; // seed the generator
//     std::uniform_int_distribution<> dist{65, 90}; // set min and max
//     tmp[i] = dist(gen);
//   }
////   tmp[16] = 0;
//   return tmp;



works
   char t[17];
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     t[i] = dist(gen);
   }
   t[16] = 0;
   string tmp(t);
   return tmp;


works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp += (char)dist(gen);
   }
   return tmp;

works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp.push_back((char)dist(gen));
   }
   return tmp;





ok now i think it is working


i can call gdt to iterate all levels...


i want to time it:


load only:
gdt took 0.283832 seconds to process 96 files
insert:
gdt took 1.495548 seconds to process 96 files
update:
gdt took 0.621905 seconds to process 96 files




2026-01-08 07:12:53

now what?

make update update the filenames

what is the point, just erase and get them all again

i could make update just overwrite everything...

not sure what that would gain me...

when am i planning on doing this?

- when I load a gm
- when I save a gm
that will take care of any new ones


what else do i want to do?

I need to link them to sessions

when adding to db,

check if we are in server mode

then look for active sessions

i will have the row id in player struct

then make a link

old table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");

new table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_muid           TEXT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");


2026-01-08 07:22:52

fist of all:
modify table..done
call from save...done

check if server

      if (mNetgame.ima_server)
      {
         for (int p=1; p<8; p++)
            if (mPlayer.loc[p].session_id)
            {
               sprintf(sql, "INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('%s', %d)", HEADER_muid.c_str(), mPlayer.loc[p].session_id);
               printf("sql:%s\n", sql);
               mSql.execute_sql(sql);
            }
      }

now to test....

I should really do a backup...


2026-01-08 07:32:13

got to go...


testing...I should see if everything compiles on linux
compiles clean, no warnings


./pm 


server tries to save game twice

dte:'20260108-180304'
dur:21
muid: 'GDFQAYGTSLZXNIRV' does not exist  --  inserting
sql:INSERT INTO gm ( muid, filename, dt_start, dt_end, duration, level, num_entries )                              VALUES( 'GDFQAYGTSLZXNIRV', '',     '20260108-180243',     '20260108-180304',   21,       80,    108)
sql:INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('GDFQAYGTSLZXNIRV', 1)
Error: near "NULL": syntax error
INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('GDFQAYGTSLZXNIRV', 1)
update sid:1  s:20260108-180228 e:20260108-180307 d:39


.mode column
SELECT * from gm;
SELECT * from gm_sessions;
SELECT id, dt_start, player_name FROM sessions;


2026-01-08 18:17:00
I did it!!!

test on windows

erase database

start server

on client join, play level and level done

client quits, server quits

1 gm
1 session
1 gm_session linking them!!!!

sqlite> SELECT * from gm;
muid              filename  dt_start         dt_end           duration  level  num_entries
----------------  --------  ---------------  ---------------  --------  -----  -----------
RACTOQKRHFYPWEJA            20260108-181608  20260108-181622  14        80     84

sqlite> SELECT * from gm_sessions;
id  gm_muid           session_id
--  ----------------  ----------
1   RACTOQKRHFYPWEJA  1

sqlite> SELECT id, dt_start, player_name FROM sessions;
id  dt_start         player_name
--  ---------------  -----------
1   20260108-181556  Forest
sqlite>



2 clients

sqlite> SELECT * from gm;
muid              filename  dt_start         dt_end           duration  level  num_entries
----------------  --------  ---------------  ---------------  --------  -----  -----------
RACTOQKRHFYPWEJA            20260108-181608  20260108-181622  14        80     84
ACGKQEKIYXFFWRJS            20260108-182110  20260108-182120  10        80     30

sqlite> SELECT * from gm_sessions;
id  gm_muid           session_id
--  ----------------  ----------
1   RACTOQKRHFYPWEJA  1
2   ACGKQEKIYXFFWRJS  2
3   ACGKQEKIYXFFWRJS  3

sqlite> SELECT id, dt_start, player_name FROM sessions;
id  dt_start         player_name
--  ---------------  -----------
1   20260108-181556  Forest
2   20260108-182049  Forest
3   20260108-182059  jenny!
sqlite>


this works so well, can I make it work with the webpage?

-- first a bit of house keeping:

clean up the database creation stuff..


not to get side tracked, but I think I have a better understanding now:
sessions are like players, they have a lot of player info

gm's are linked to sessions that were active when the gm was recorded

I should do more than link when saving gm
when gm is started I should link all active sessions then
if more sessions start they should link to current gm
when gm is saved

- link to active sessions when level starts
- link to active sessions when level ends (either by quitting or completing)
- if a session starts, link it to current gm

also when linking, check if link already exists first



2026-01-08 19:38:50

testing good on linux, just noticed I am not setting filename!

fixed...


running into issues on how I save the filepath

save the filename name only
it gets saved in savegame/

on server savegame is mapped to webroot/downloads ...




2026-01-08 21:35:27

I have got it working!!!!

but when I try to play the demo I just downloaded I get an crash when loading
actually, its when load calls add to db...

remind me again, why am I adding gm to db when loading?

commented it out and it plays fine....


go to bed....its really coming along well....


2026-01-08 21:39:55


2026-01-09 05:22:43

backed up, deployed to server and tested...looking good



2026-01-09 05:34:24

now that all this is working...

do I need a separate players table?

I think my plan was so that I could show what players were in a gm file

after implementing all my other stuff, i think there is another way

sessions has player info, it is what I should use
sessions is alrewady linked to gms

fix show current gm and list linked sessions..done

now show list of linked sessions (players) on show current gm

   $sql  = "SELECT sessions.id, dt_start, dt_end, duration, player_name, player_num FROM sessions ";
   $sql .= "LEFT JOIN gm_sessions ON sessions.id = session_id ";
   $sql .= "WHERE gm_muid='$current_gm_muid'";


actually a lot of the sessions info does not really apply to gm

name
number
color
host

2026-01-09 07:29:42

looking good!!!

so what can I say?
I do not need any scrape
I do not need to write any files (except gm)

session and gm's are working great
no need for separate 'players'

still to do:

no need for filename in sessions
all sqlite columns to be int or text
list of players to be table


journalctl -u <service-name>


2026-01-10 02:35:53


I am going to add logging to the database


trying to troubleshoot why headless server crashes and I am getting nothing with regular logging

can't get it to print to console or journalctl

tried adding these lines to 

sudo nano /etc/systemd/system/pm.service

StandardOutput=journal+console
StandardError=journal+console


# pm.service

[Unit]
Description= Purple Martians server
Documentation= purplemartians.org

[Service]
Type= simple
User= m
ExecStart= /home/m/dev/purple_martians/pm -sh
StandardOutput=journal+console
StandardError=journal+console

[Install]
WantedBy= multi-user.target

sudo systemctl daemon-reload
sudo systemctl enable pm
sudo systemctl start pm






2026-01-10 02:50:52


this is what I used to have

CREATE TABLE logs
(
  id              INT AUTO_INCREMENT,
  msg_type        INT,
  sub_type        INT,
  created         DATETIME(3),
  agt             DOUBLE,
  frame_num       INT,
  player          INT,
  client          INT,
  message         TEXT,
  PRIMARY KEY (id)
);




// actually adds to char array
// called both by server directly and when server rx's clog
void mwLog::add_log_net_db_row2(int type, int sub_type, double agt, int f, int p, int client, const char* msg)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;


   char txt[1000];
   sprintf(txt, "%d,%d,%s,%f,%d,%d,%d,%s\n", type, sub_type, d, agt, f, p, client, msg);
//         printf("%s", txt);





should I make a separate database?

maybe sessions and logs

i don;t want to lose stuff in sessions


2026-01-10 03:10:48

now I have 
   sprintf(filename, "%s", "data/sessions.db");
   sprintf(filename, "%s", "data/logs.db");

   sqlite3 *db;
   sqlite3 *db_logs;


   strcpy(sql, "CREATE TABLE IF NOT EXISTS logs( \
               id              INTEGER PRIMARY KEY, \
               msg_type        INT, \
               sub_type        INT, \
               created         TEXT, \
               agt             REAL, \
               frame_num       INT, \
               player          INT, \
               client          INT, \
               message         TEXT ); ");
   if (sqlite3_exec(db_logs, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'logs' \n");


SELECT * FROM logs;

SELECT created, message FROM logs;


now add some stuff to it...


when I enble LOG_NET_CSV

10,0,2026-01-10 03:14:46.645,46.808684,0,0,0,LEVEL 1 STARTED
10,0,2026-01-10 03:14:48.766,48.930611,85,0,0,Player:0 became INACTIVE!
10,0,2026-01-10 03:14:48.879,49.043502,85,0,0,Shutting down the server network


this is a very small subset of all the logs
pretty much just LOG_NET


I think I want to hook in where the main logging takes place...

do it fool!!

2026-01-10 08:08:48

got message in db, now try on server...


2026-01-10 09:22:07


curiouser and curiouser....

no databse shit is getting saved either when running as service

I can see it in top
running with user m 100%cpu

and as soon as I tried to connect it dies

when I run from shell like ./pm -sh
runing as user m 13%cpu

when client connects 17%cpu


could it just be that the database won't open?
it is a path thing?
what is the difference

YES!!!!!

it was a dir thing....

[Unit]
Description=Purple Martians server
Documentation=purplemartians.org

[Service]
Type=simple
User=m
ExecStart=/home/m/dev/purple_martians/pm -sh
WorkingDirectory=/home/m/dev/purple_martians

[Install]
WantedBy=multi-user.target

update the docs.

run sql through my custom exe functions in mwSql that will check if database is not open...done



I am itching to try CLion....

do it...


2026-01-10 13:32:57

its working


I think I can lose any savegame files in the project that are not demo or TAS

do it fool...done





in netgame when a level is done and everyone returns to overworld,
why do they all come back at different places?
was it where they were before they were sucked into the last level played?
I think it was...
should I leave it like that or force everyone to come back at the level they just played?

is it something about the last gate touched?

mPlayer.syn[0].overworld_last_touched_gate
it is saved in config also

in 
void mwItem::set_player_start_pos(int p)

   // in overworld level, player starts at the last gate they touched
   if (mLevel.play_level == 1)
   {
      for (int i=0; i<500; i++)
         if ((item[i][0] == 18) && (item[i][6] == mPlayer.syn[p].overworld_last_touched_gate)) item_to_get_start_from = i;
   }

its a little complicated:
item[i][6] is the level number of the gate
the player stores that, the last level number
then all 500 items are searched until a gate with that level number is located

this seems overly complex, why would I not just store the item index of the gate?
will it change? do I sort the items? sure i do in level editor...otherwise I can
be pretty certain they will persist...



void mwItem::proc_gate_collision(int p, int i)
{
   mPlayer.syn[p].marked_gate = i;
   set_gate_level_icon_position(i);
   int lev = item[i][6];

   if (mPlayer.syn[p].overworld_last_touched_gate != lev)
   {
      mPlayer.syn[p].overworld_last_touched_gate = lev;
      if (p == 0) mConfig.save_config(PM_CFG_SAVE_OVERWORLD_GATE_LAST_TOUCHED); // clients do not save to config
   }

when a gate is touched, store the level number of the gate in the player struct
(but only locally)


this is all mentions of the variable

I think it would be safe to just store the index of the item

look up item sort..not an issue


anyway to do what I want it to do:

I would have the server set it for all clients when a level is done
or when a level is started...better

where can I hook into that? up pressed on gate...

   // if UP pressed, enter gate (client can never locally enter gate)
   if ((mPlayer.syn[p].up) && (status > 0) && (!mNetgame.ima_client) )
   {
     
      // server to set last touched gate for all clients
      if (mNetgame.ima_server)
      {
         for (int pp=1; pp<8; pp++)
            if (mPlayer.syn[pp].active)
            {
               mPlayer.syn[pp].overworld_last_touched_gate = lev;
            }
         }
      }
      
I think that should do it...

bitmaps cannot be manipulated on a machine with no display
like headless server...find another way

put them in the icons
100 bmp 3M
200 bmp 9M
200 png 200k
400 bmp 36M
400 png 700k

I'm going to try the 200's


2026-01-11 08:51:38


I am going to test sessions, but first do a full backup...


get the session stuff from server

am I going to leave the level_icons in the assets/icons...yes







start one player on level 80
then have other players join and quit a few times while first player stays...


I have sessions for each time the player joined

I have muliple players listed in the cell on save game for current session
they all look the same, I should make the pop up show the session id

same with on current game

I think this is working like it supposed to...

make those changes to also show session id so we know they are a different player



I just played lev 80 with 15 unique players and sessions

one thing I noticed, when you come back you still have the same amount of health as you used to!!!

I should try what happens if you join out if order...
you get a different player number is all...

i did a gm with 25 sessions!!!!


three things to do:

remove filename from current session section..done

start new client game with full health and a good link to last gate touched..done

where can i do that so it won't get overwritten...
actually nothing overwrites it....
where can I save a global last gate_activated?
for use when a client joins and I want to send them to the last gate someone used
I am thinking if a client joins when everyone is on the overworld
where should I send them?
default is good

I fixed both where server sets up new client.
As soon as server finds and empty player slot, i do a full init now
and also set last overworld gate level to currently playing level




level icons are not copied. changed so they are commited...done

first time returning to overworld, clients did not all go back to first gate
2nd time they did


i did this on the server and thought it would work

      // server to set last touched gate for all clients
      if (mNetgame.ima_server)
      {
         for (int pp=1; pp<8; pp++)
            if (mPlayer.syn[pp].active)
            {
               mPlayer.syn[pp].overworld_last_touched_gate = lev;
            }
      }

it could be that the server is resetting it, but...i have looked and can't see how or where?


the only place a gate can be entered is here and only a server can do it...

loading and saving to config only happen for player 0, the local player

does it simply get erased and then try to load from level 0 and fail?

when it starts from the start block, that means it was unable to find the specified level...

I should just print what it actually looks for...

maybe I should initialize it...
you would think that when a new client joins they should start from where??

added code to see when it fails and what the value is





jenny start go to level 80

then when others join they do not have set from server because they werent there when someone enetred the gate!!!

I think I get it now, new joining players need to have that set....
to whatever level they are in now....unless its overworld...what then??..do nothing


no, actually i think of you join while in overworld you should go to the last touched gate of any player...
or maybe the last gate that was activated


also when a client quits and rejoins the same happens

set devset to also do:
speedy transitions
IJKL C

updating sessions every 1s messed with the tallies...revert and test again do it fool!!

2026-01-11 17:08:09

getting git 2.52.0 cause clion says my version 2.16.2 is unsupported...done


made player name show above player optional with settings...


2026-01-12 07:33:09

I am planning on redoing the main pm server that has been running for a few years
what should I keep?

with the newer seesions stuff, I would just keep all the gm's and session database
but the old one is different...

is there anything worth keeping?

the oldest looks like it is from 20240714

backed up sessions table and gm file to x
see mysql file for details


2026-01-12 07:34:33
I can now deply new to pmh


do it fool!

     Active: active (running) since Fri 2025-10-31 18:00:30 MDT; 2 months 11 days ago
   Main PID: 762 (pm)
      Tasks: 2 (limit: 9291)
     Memory: 291.1M
        CPU: 2month 1w 4d 19h 53min 44.491s
     CGroup: /system.slice/pm.service
             762 /home/m/dev/purple_martians/pm -sh

Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Player Color:[8]                                                  |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Server Frame:[102568]                                             |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Server Level Sequence Num:[1752]                                  |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]+--------------------------------------------------------------------------+
Jan 12 07:00:16 pmh pm[762]: log_net array lines > 1000 ... dumping to file
Jan 12 07:00:16 pmh pm[762]: logs/net/20260112-070010.942.csv saved
Jan 12 07:00:16 pmh pm[762]: log_net array lines > 1000 ... dumping to file
Jan 12 07:00:16 pmh pm[762]: logs/net/20260112-070015.94.csv saved
Jan 12 07:00:16 pmh pm[762]: [10][0][102969]+--------------------------------------------------------------------------+
Jan 12 07:00:16 pmh pm[762]: [10][0][102969]|                                                                          |
m@pmh:~/dev/purple_martians/savegame$

                                               |

m@pmh:~/dev/purple_martians/savegame$ sudo systemctl stop pm

stop all cron...

erased all and got new...

had to redo the servioe to include working dir

now how do I change permissions so php in web can see database

and how to allow downloads?

need to figure out and document, as well as all permissions needed...

96.45.1.12
is that right?
no, it should be .50
why??
reboot
same...why???
figure it 





2026-01-12 11:22:34

im doing great, i just got the pmh server all rebuilt and better notes done

also I now know better what to do about permissions

I did not have to change anything in /var/www.....

I just had to chmod o+x /home/m

this allows php to see database files and downloads alias to work



Do I really want the ':' in player...or should it be a space...it used to be a space...fixed

2026-01-12 11:38:08

commit

update on pmh





having issues with static ip

newer versions of ubuntu by default can randomize mac...




m@pmh:/etc/netplan$ nano  /etc/netplan/50-cloud-init.yaml
m@pmh:/etc/netplan$ sudo nano /etc/netplan/50-cloud-init.yaml
[sudo] password for m:
m@pmh:/etc/netplan$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever


2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff
    inet 96.45.1.12/26 metric 100 brd 96.45.1.63 scope global dynamic enp2s0
       valid_lft 84062sec preferred_lft 84062sec
    inet6 fe80::ca1f:66ff:fe4a:876d/64 scope link
       valid_lft forever preferred_lft forever
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ cat /etc/resolv.conf
# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad
search .
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ resolvectl status
Global
         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
  resolv.conf mode: stub

Link 2 (enp2s0)
    Current Scopes: DNS
         Protocols: +DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Current DNS Server: 208.67.222.222
       DNS Servers: 208.67.222.222 208.67.220.220
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ sudo cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  ethernets:
    enp2s0:
      dhcp4: true
m@pmh:/etc/netplan$



here is something I might copy to try to make this static

network:
  version: 2
  renderer: networkd
  ethernets:
    en01:
      addresses:
        [192.168.0.4/26]
      routes:
        - to: default
          via: 192.168.0.1
          metric: 100
      nameservers:
        search: [local]
        addresses:  [1.1.1.1, 192.168.0.1, 8.8.8.8, 8.8.4.4]
      dhcp6: false 
      dhcp4: false

editted:

network:
  version: 2
  ethernets:
    enp2s0:
      addresses:
        [96.45.1.12/26]
      routes:
        - to: default
          via: 96.45.1.63
          metric: 100
      nameservers:
        search: [local]
        addresses:  [8.8.8.8, 8.8.4.4]
      dhcp6: false 
      dhcp4: false
      
2026-01-12 17:11:55

I am not going to change anything...

this is here to try if it all borks later...

actually I should try to reboot the server...



These are results for ubuntu server 24 minimal how can i tell what mac address randomization is configured
On Ubuntu Server 24.04, network configuration is typically managed by
Netplan and the actual service is usually systemd-networkd.
To determine the MAC address randomization setting, you need to inspect the relevant configuration files. 
1. Check the active MAC address 
First, check the current MAC address of your network interface(s) using the ip addr command: 
bash

ip addr show

m@pmh:~$ ip addr show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group defaul                                                    t qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP gr                                                    oup default qlen 1000
    link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff
    inet 96.45.1.12/26 metric 100 brd 96.45.1.63 scope global dynamic enp2s0
       valid_lft 45571sec preferred_lft 45571sec
    inet6 fe80::ca1f:66ff:fe4a:876d/64 scope link
       valid_lft forever preferred_lft forever
m@pmh:~$




Look for the link/ether field for your interface (e.g., enp... or eth0).
If the second hexadecimal digit of the address is 2, 6, A (or a), or E (or e),
the MAC address is a locally administered address, which often indicates it has been randomized or manually set. 

link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff

2. Inspect Netplan configuration files 
Ubuntu uses Netplan to abstract network configuration. Check the contents of your Netplan configuration files in the /etc/netplan/ directory. 

List the files in the directory:

ls /etc/netplan/

m@pmh:~$ ls /etc/netplan/
50-cloud-init.yaml


View the content of your configuration file (replace 00-installer-config.yaml with your actual filename):
m@pmh:~$ sudo cat /etc/netplan/50-cloud-init.yaml
[sudo] password for m:
network:
  version: 2
  ethernets:
    enp2s0:
      dhcp4: true

Look for a macaddress or cloned-mac-address key under your interface's settings.
Netplan's configuration for MAC addresses usually uses the macaddress key to set a specific address
or might imply randomization if managed by systemd-networkd's default policies. 

3. Check systemd-networkd configuration 
Ubuntu Server generally uses systemd-networkd. You can check its configuration for specific MACAddressPolicy settings. 

    Look for .link files in /etc/systemd/network/ or /usr/lib/systemd/network/:
    bash

ls /etc/systemd/network/ /usr/lib/systemd/network/


m@pmh:~$ sudo ls /usr/lib/systemd/network/
73-usb-net-by-mac.link              80-container-vb.network  80-wifi-adhoc.network            99-default.link
80-6rd-tunnel.network               80-container-ve.network  80-wifi-ap.network.example
80-auto-link-local.network.example  80-container-vz.network  80-wifi-station.network.example
80-container-host0.network          80-vm-vt.network         89-ethernet.network.example
m@pmh:~$





View the content of relevant .link files. A common file to check is 99-default.link or a file specific to your interface name. Look for the MACAddressPolicy setting within the [Link] section:
bash

cat /usr/lib/systemd/network/99-default.link 
# (or the name of your specific file)

m@pmh:~$ cat /usr/lib/systemd/network/99-default.link
# SPDX-License-Identifier: MIT-0
#
# This config file is installed as part of systemd.
# It may be freely copied and edited (following the MIT No Attribution license).
#
# To make local modifications, one of the following methods may be used:
# 1. add a drop-in file that extends this file by creating the
#    /etc/systemd/network/99-default.link.d/ directory and creating a
#    new .conf file there.
# 2. copy this file into /etc/systemd/network or one of the other paths checked
#    by systemd-udevd and edit it there.
# This file should not be edited in place, because it'll be overwritten on upgrades.

[Match]
OriginalName=*

[Link]
NamePolicy=keep kernel database onboard slot path
AlternativeNamesPolicy=database onboard slot path
MACAddressPolicy=persistent
m@pmh:~$

The MACAddressPolicy can be set to values like persistent (the default, which uses the permanent hardware address), random, stable, or others. 

looks like it is set to persistent





2026-01-12 17:44:51

I think I need to figure more things out, like how to get a button to do something
with out reloading a page


Basic Usage
You can use the onclick attribute directly within the HTML tag to call a JavaScript function. 

HTML:

<button onclick="myFunction()">Click me</button>
<p id="demo">The date and time will appear here.</p>


JavaScript (within <script> tags or an external file):

function myFunction() {
  document.getElementById("demo").innerHTML = Date();
}

When the button is clicked, it calls the myFunction, which finds the HTML element with the ID demo and changes its content to the current date and time. 
Key Concepts

    Inline JavaScript: The script is written directly within the onclick attribute (e.g., onclick="alert('Hello!');"). While convenient for simple tasks, it's generally recommended to separate your HTML and JavaScript code for better organization and maintainability.
    Calling a Function: You specify the name of the JavaScript function to run when the button is clicked, including parentheses () to invoke it.
    Multiple Functions: You can execute multiple functions by separating them with a semicolon within the attribute (e.g., onclick="function1(); function2();" ).
    this keyword: You can pass the element itself to the function using the this keyword, allowing the JavaScript function to manipulate the specific element that was clicked.
        Example: <button onclick="changeColor(this)">Click me</button>
    Redirecting to another page: To use a button to navigate to a new URL, you can use window.location.href within the onclick handler.
        Example: <button onclick="window.location.href='https://www.example.com'">Go to Example.com</button> 

found some intererting html input types like range


what do i actually want to do:
have a page that shows the server uptime and the currently connected client

well then, I better have that data in the database

status table
uptime
every second that updates
number of connected clients
current level
how long in current level

kind of like copying what I used to have in status and remote control


looks like it gets sent every frame in remote control mode

void mwNetgame::server_send_snfo_packet(void) // send info to remote control
{
   // copy values into loc
   mPlayer.loc[0].srv_frame_num = mLoop.frame_num;
   mPlayer.loc[0].srv_total_game_moves = mGameMoves.entry_pos;
   mPlayer.loc[0].srv_level = mLevel.play_level;
   mPlayer.loc[0].srv_zlib_cmp = mNetgame.zlib_cmp;
   mPlayer.loc[0].srv_extra_packets_num = mNetgame.srv_exp_num;
   mPlayer.loc[0].srv_extra_packets_size = mNetgame.srv_exp_siz;
   mPlayer.loc[0].srv_uptime = al_get_time();
   sprintf(mPlayer.loc[0].srv_version, PM_VERSION);

   mPlayer.loc[0].srv_num_enemy = mEnemy.num_enemy;

   char src[5700];


this also happens once per frame

void mwLog::add_log_status_db_rows(void)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;

   // do not log status unless at least one client is connected
   if (mNetgame.server_num_clients == 0) return;

   char d[100];
   mMiscFnx.chr_dt(d);

   int f = mLoop.frame_num;

   char txt[1000];

   for (int p=0; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active)
      {
         int r = mPlayer.loc[p].rewind;
         float cpu  = mPlayer.loc[p].cpu;
         float sync = mPlayer.loc[p].pdsync*1000;
         float ping = mPlayer.loc[p].ping*1000;
         float difs = mPlayer.loc[p].cmp_dif_size;
         float lcor = mPlayer.loc[p].client_loc_plr_cor;
         float rcor = mPlayer.loc[p].client_rmt_plr_cor;

         float txbf = mPlayer.loc[p].tx_current_bytes_for_this_frame;
         float rxbf = mPlayer.loc[p].rx_current_bytes_for_this_frame;
         float txpf = mPlayer.loc[p].tx_current_packets_for_this_frame;
         float rxpf = mPlayer.loc[p].rx_current_packets_for_this_frame;

         // these values have no meaning for server
         if (p == 0)
         {
            sync = 0;
            ping = 0;
            difs = 0;
            lcor = 0;
            rcor = 0;
         }

         sprintf(txt, "%s,%d,%d,%d,%3.1f,%3.1f,%3.1f,%3.0f,%3.1f,%3.1f,%3.0f,%3.0f,%3.0f,%3.0f\n",
                       d, f, p, r, cpu,  sync, ping, difs, lcor, rcor, txbf, rxbf, txpf, rxpf);

         // printf("added log_status line: %d  %s\n", log_status_msg_num_lines,  txt);

I could simply put this into a database

it would get full really quick, but then I could just delete the entries

2026-01-13 04:28:19

I have some thoughts:

a web page with the lognet messages and a button to refresh


where to start...


I want to do status

a small table













To recursively remove a large file from your GitHub repository's history, the recommended method is to use the
git filter-repo tool. This process rewrites your repository's history, so it's essential to coordinate with collaborators and ensure you have a backup. 
The process involves the following high-level steps:
Prerequisites

    Install git-filter-repo: This tool is much faster and easier to use than the older git filter-branch.
    You can often install it using a package manager, for example:

sudo apt install git-filter-repo

Steps to Remove the File

    Navigate to Your Local Repository:

cd YOUR-REPOSITORY

Run git filter-repo: To remove a specific file from all branches and tags, use the --invert-paths and --path arguments,
replacing PATH-TO-YOUR-FILE with the actual path to the large file (e.g., src/data/large_file.zip).

git filter-repo --invert-paths --path PATH-TO-YOUR-FILE

If the file existed at multiple paths due to moves or renames,
you may need to run the command again for each alternative path or add an extra --path argument.
Force-Push the Changes to GitHub: Once you are satisfied with the local changes,
force-push the rewritten history to overwrite the remote repository on GitHub.
This is a destructive action that affects all branches and tags.

git push --force --mirror origin

Post-Cleanup

    Coordinate with Collaborators: Alert all collaborators that the repository history has been rewritten.
    They will need to re-clone the repository to get the new history.
    Run Garbage Collection: GitHub will handle garbage collection on the server side to expunge the data from storage,
    but for your local clone, the above process, followed by the force push, handles most of it.
    Prevent Future Issues: Add the large file's pattern to your .gitignore file to prevent it from being
    accidentally committed again.
    Consider Git LFS: If the file is a necessary binary, consider using
    Git Large File Storage (LFS) to manage it properly going forward. 

    Cannot remove files from repository above quota #52302 - GitHub
    Apr 7, 2023  This command will show you the top 10 largest files in your repository.
    Remove large files: Use git filter-branch or the BFG Repo-
    GitHub




















im going to try this on o3000

delete and get the lastest

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians
 



I think the shallow clone --depth=1 is not getting the full

m@o3000:~/dev/purple_martians$ du -sh .
126M    .


cd ~/dev
sudo rm -r purple_martians

git clone https://github.com/mweiss001/purple_martians



m@o3000:~/dev$ git clone https://github.com/mweiss001/purple_martians
Cloning into 'purple_martians'...
remote: Enumerating objects: 16817, done.
remote: Counting objects: 100% (20/20), done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 16817 (delta 0), reused 2 (delta 0), pack-reused 16797 (from 3)
Receiving objects: 100% (16817/16817), 700.42 MiB | 19.91 MiB/s, done.
Resolving deltas: 100% (12022/12022), done.
m@o3000:~/dev$ du -sh .
866M    .

now i've got it all....

sudo apt install git-filter-repo

git filter-repo --invert-paths --path pm.exe

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path pm.exe
Parsed 554 commits
New history written in 0.86 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at 9c11a137 no comment
Enumerating objects: 16338, done.
Counting objects: 100% (16338/16338), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4718/4718), done.
Writing objects: 100% (16338/16338), done.
Total 16338 (delta 11549), reused 16323 (delta 11536), pack-reused 0
Completely finished after 7.45 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
229M    .

here goes!!!

git push --force --mirror origin

git push --force --mirror https://github.com/mweiss001/purple_martians


2026-01-13 05:54:53

I did it!!!

but I just realized I have uncomitted changes on m36...duh!!

how to fix...


add pm.exe to .gitignore

try new push from m36...failed

made a local copy on desktop
removed and reclone to c:/pm
manualy copied changes from desktop version to c:\pm
committed...all looks good


now see what else I can kill in repo


back to o3000
remove and reclone

before that, save this file and commit from m36...





















im going to try this on o3000

delete and get the lastest

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians
 



I think the shallow clone --depth=1 is not getting the full

m@o3000:~/dev/purple_martians$ du -sh .
126M    .


cd ~/dev
sudo rm -r purple_martians

git clone https://github.com/mweiss001/purple_martians



m@o3000:~/dev$ git clone https://github.com/mweiss001/purple_martians
Cloning into 'purple_martians'...
remote: Enumerating objects: 16817, done.
remote: Counting objects: 100% (20/20), done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 16817 (delta 0), reused 2 (delta 0), pack-reused 16797 (from 3)
Receiving objects: 100% (16817/16817), 700.42 MiB | 19.91 MiB/s, done.
Resolving deltas: 100% (12022/12022), done.
m@o3000:~/dev$ du -sh .
866M    .

now i've got it all....

sudo apt install git-filter-repo

git filter-repo --invert-paths --path pm.exe

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path pm.exe
Parsed 554 commits
New history written in 0.86 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at 9c11a137 no comment
Enumerating objects: 16338, done.
Counting objects: 100% (16338/16338), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4718/4718), done.
Writing objects: 100% (16338/16338), done.
Total 16338 (delta 11549), reused 16323 (delta 11536), pack-reused 0
Completely finished after 7.45 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
229M    .

here goes!!!

git push --force --mirror origin

git push --force --mirror https://github.com/mweiss001/purple_martians


2026-01-13 05:54:53

I did it!!!

but I just realized I have uncomitted changes on m36...duh!!

how to fix...


add pm.exe to .gitignore

try new push from m36...failed

made a local copy on desktop
removed and reclone to c:/pm
manualy copied changes from desktop version to c:\pm
committed...all looks good


now see what else I can kill in repo


back to o3000
remove and reclone

before that, save this file and commit from m36...



git ls-files -s | awk '{print $2 " " $4}' | LC_ALL=C sort -nrk1 | head -n 10 | while read size oid file; do echo $(($(git cat-file -s $oid)/1024))KiB $file; done

does not work:
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$ git ls-files -s | awk '{print $2 " " $4}' | LC_ALL=C sort -nrk1 | head -n 10 | while read size oid file; do echo $(($(git cat-file -s $oid)/1024))KiB $file; done
fatal: Not a valid object name docs/dev
-bash: /1024: syntax error: operand expected (error token is "/1024")
m@o3000:~/dev/purple_martians$


git count-objects -vH
du -ah .git/objects | sort -rh | head -n 10


git rev-list --objects --all \
| git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' \
| sed -n 's/^blob //p' \
| sort --numeric-sort --key=2 \
| tail -n 10 \
| cut -c 1-12,41- \
| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest




fd101e2ddf1c   11MiB data/level_icons_200.bmp
fd8e5ce63e99   11MiB data/level_icons_200.bmp
abcafd2ad249   12MiB savegame/bad_exit_20220613-183034-lev303.txt
8285c9b0c4f9   14MiB pm_dump.sql
c4ce6ca6a4bd   16MiB data/level_icons_vls.bmp
41d6126b6473   27MiB snd/pm.wav
e334b2b9bdbb   28MiB scrape_cronoutput.txt
98f59065e5b2   32MiB purple_martians_7.24.0426.1_linux.tar.gz
85865d59a222   36MiB purple_martians_7.24.0426.1_windows.zip
ca70d91f2717   96MiB session_scrape_cronoutput.txt
m@o3000:~/dev/purple_martians$

ok...now I have some more things to remove...

git filter-repo --invert-paths --path session_scrape_cronoutput.txt

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path session_scrape_cronoutput.txt
Parsed 557 commits
New history written in 0.73 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at a7e90fd no comment
Enumerating objects: 16361, done.
Counting objects: 100% (16361/16361), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4453/4453), done.
Writing objects: 100% (16361/16361), done.
Total 16361 (delta 11827), reused 16312 (delta 11823), pack-reused 0
Completely finished after 4.03 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
225M

git filter-repo --invert-paths --path scrape_cronoutput.txt
m@o3000:~/dev/purple_martians$ du -sh .
225M

git filter-repo --invert-paths --path purple_martians_7.24.0426.1_linux.tar.gz
193M

git filter-repo --invert-paths --path purple_martians_7.24.0426.1_windows.zip
158M

lets stop here and test...

git push --force --mirror https://github.com/mweiss001/purple_martians


on m36 copy again to desktop and reclone...

https://github.com/mweiss001/purple_martians


2026-01-13 06:52:34

worked
160 before build
do I need to add anything to .gitignore?

the files I removed were one offs, should not re-occur

anyway this is the file:

/o
/*.o

pm.exe

/logs/*

/savegame/*.gm

/gmon.out
/pm.depend
/pm.layout

/screenshots/*

/scrape_cronoutput.txt
/scrape_status_cronoutput.txt
/session_scrape_cronoutput.txt



I have not made any more changes on m36 so no need to recommit

back to o3000 to see what else there is...

dfc07ace844a   11MiB data/level_icons_200.bmp
e71982713aba   11MiB bitmaps/level_icons.bmp
f13f83429959   11MiB bitmaps/level_icons.bmp
f61a1cafa6da   11MiB data/level_icons_200.bmp
fd101e2ddf1c   11MiB data/level_icons_200.bmp
fd8e5ce63e99   11MiB data/level_icons_200.bmp
abcafd2ad249   12MiB savegame/bad_exit_20220613-183034-lev303.txt
8285c9b0c4f9   14MiB pm_dump.sql
c4ce6ca6a4bd   16MiB data/level_icons_vls.bmp
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$

i can actually lose everything in the data dir and it will be recreated (except the folder)


git filter-repo --invert-paths --path data/level_icons_vls.bmp
152M

git filter-repo --invert-paths --path pm_dump.sql
150M

git filter-repo --invert-paths --path savegame/bad_exit_20220613-183034-lev303.txt
149M

git filter-repo --invert-paths --path data/level_icons_200.bmp
137M
 
git filter-repo --invert-paths --path data/level_icons.bmp
137M

git filter-repo --invert-paths --path bitmaps/level_icons.bmp
136M




f09d4b46ade9  4.6MiB data/level_data.pm
f103d718452d  4.6MiB data/level_data.pm
f31c666e78ea  4.6MiB data/level_data.pm
f60439b7f67b  4.6MiB data/level_data.pm
fd70cca1fd11  4.6MiB data/level_data.pm
ff11da252e4b  4.6MiB data/level_data.pm
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
dab8021dc511   10MiB scrape_status_cronoutput.txt
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$


git filter-repo --invert-paths --path scrape_status_cronoutput.txt
git filter-repo --invert-paths --path data/level_data.pm
136M


git rev-list --objects --all \
| git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' \
| sed -n 's/^blob //p' \
| sort --numeric-sort --key=2 \
| tail -n 50 \
| cut -c 1-12,41- \
| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest

fabb763dcd84  2.9MiB bitmaps/level_icons2.bmp
51537afee800  3.7MiB data/sqlite3.exe
7baf15648227  3.7MiB snd/pm.mp3
62c998491439  4.6MiB bitmaps/level_data.pm
84a1aad10801  4.6MiB bitmaps/level_data.pm
db0420ff1fdd  4.6MiB bitmaps/level_data.pm
e0cd72e970d4  4.6MiB pm_docs/20250525 troubleshooting/level_data.pm
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$


git filter-repo --invert-paths --path "pm_docs/20250525 troubleshooting/level_data.pm"
git filter-repo --invert-paths --path bitmaps/level_data.pm
git filter-repo --invert-paths --path bitmaps/level_icons2.bmp 
136M




| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest
136e061f3000  1.4MiB pm_docs/new8.txt
673c1cd2120f  1.4MiB pm_docs/new8.txt
2775bb94e188  1.4MiB bitmaps/block_tiles.bmp
d96de3481a60  1.4MiB bitmaps/tiles.bmp
ae49b7075c49  1.4MiB pm_docs/new8.txt
5ad6b1907b55  1.4MiB libnet/libnet.a
88d4fe8e1c55  1.4MiB pm_docs/new8.txt
ff21115208ec  1.4MiB web/old_versions/pm2_19991202.zip
bf675f8b984d  1.4MiB pm_docs/new8.txt
cd6badaf5fd9  1.5MiB pm_docs/new8.txt
d1686e6a6e72  1.5MiB pm_docs/new8.txt
d5897866827d  1.5MiB web/old_versions/pm5_20030622.zip
807d4d3bc89f  1.6MiB bitmaps/tiles.bmp
8a8a69c66eb5  1.6MiB bitmaps/tiles.bmp
ffc7bafc9765  1.6MiB pm_docs/new8.txt
47c70b1f4bdb  1.6MiB pm_docs/new8.txt
34a9b217d3fa  1.6MiB pm_docs/new8.txt
75fa5cdec634  1.6MiB pm_docs/new8.txt
0d6ad192218a  1.6MiB web/old_versions/pm4_20010301.zip
8365f1d7ccc3  1.7MiB pm_docs/new8.txt
09e646caad8e  1.7MiB screenshots/20180423194754.bmp
d0ca7fd66d53  1.7MiB linux_libs/liballegro_monolith.so.5.2
0da90ec88b21  1.7MiB pm_docs/new8.txt
022a9fdf4e14  1.7MiB pm_docs/new8.txt
8e9eb811034f  1.7MiB pm_docs/new8.txt
b77e8bb06463  1.7MiB pm_docs/new8.txt
5bc2bf3f310c  1.7MiB pm_docs/new8.txt
c794fc168e72  1.7MiB pm_docs/new8.txt
bc17a74fe4f4  1.7MiB pm_docs/new8.txt
c18cb595d5c7  1.7MiB pm_docs/new8.txt
0bef794ca754  1.7MiB docs/new8.txt
298398fdbd6c  1.7MiB pm_docs/new8.txt
2f3b4594b7a0  1.8MiB liballegro_monolith.so
07a98e4a5309  2.9MiB data/level_icons_100.bmp
0a09b1091cd7  2.9MiB data/level_icons_100.bmp
114370638890  2.9MiB data/level_icons_100.bmp
4136f35ad1be  2.9MiB data/level_icons_100.bmp
457af2dbbcc8  2.9MiB data/level_icons_100.bmp
52d99314596e  2.9MiB data/level_icons_100.bmp
5d085e971469  2.9MiB data/level_icons_100.bmp
b0dcb0316f80  2.9MiB data/level_icons_100.bmp
b1f448e7c9c5  2.9MiB data/level_icons_100.bmp
cd83e51a91e7  2.9MiB data/level_icons_100.bmp
d05668bfd9b1  2.9MiB data/level_icons_100.bmp
f5478c2bd9f3  2.9MiB data/level_icons_100.bmp
51537afee800  3.7MiB data/sqlite3.exe
7baf15648227  3.7MiB snd/pm.mp3
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$

git filter-repo --invert-paths --path screenshots/20180423194754.bmp 
git filter-repo --invert-paths --path data/level_icons_100.bmp
133M


I am done for now....

git push --force --mirror https://github.com/mweiss001/purple_martians

bak to m36

reclone and add data to gitignore

now 130M

recreate /data if not exists...done

2026-01-13 07:38:23
recommit from m36..done

i should remove data completely from github



how big is allegro dir?

m@o3000:~/dev$ du -hd1 .
74M     ./allegro5
133M    ./purple_martians

















now back to our regulary scheduled...


what do i actually want to do:
have a page that shows the server uptime and the currently connected client

well then, I better have that data in the database

status table
uptime
every second that updates
number of connected clients
current level
how long in current level

kind of like copying what I used to have in status and remote control


looks like it gets sent every frame in remote control mode

void mwNetgame::server_send_snfo_packet(void) // send info to remote control
{
   // copy values into loc
   mPlayer.loc[0].srv_frame_num = mLoop.frame_num;
   mPlayer.loc[0].srv_total_game_moves = mGameMoves.entry_pos;
   mPlayer.loc[0].srv_level = mLevel.play_level;
   mPlayer.loc[0].srv_zlib_cmp = mNetgame.zlib_cmp;
   mPlayer.loc[0].srv_extra_packets_num = mNetgame.srv_exp_num;
   mPlayer.loc[0].srv_extra_packets_size = mNetgame.srv_exp_siz;
   mPlayer.loc[0].srv_uptime = al_get_time();
   sprintf(mPlayer.loc[0].srv_version, PM_VERSION);

   mPlayer.loc[0].srv_num_enemy = mEnemy.num_enemy;

   char src[5700];


this also happens once per frame

void mwLog::add_log_status_db_rows(void)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;

   // do not log status unless at least one client is connected
   if (mNetgame.server_num_clients == 0) return;

   char d[100];
   mMiscFnx.chr_dt(d);

   int f = mLoop.frame_num;

   char txt[1000];

   for (int p=0; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active)
      {
         int r = mPlayer.loc[p].rewind;
         float cpu  = mPlayer.loc[p].cpu;
         float sync = mPlayer.loc[p].pdsync*1000;
         float ping = mPlayer.loc[p].ping*1000;
         float difs = mPlayer.loc[p].cmp_dif_size;
         float lcor = mPlayer.loc[p].client_loc_plr_cor;
         float rcor = mPlayer.loc[p].client_rmt_plr_cor;

         float txbf = mPlayer.loc[p].tx_current_bytes_for_this_frame;
         float rxbf = mPlayer.loc[p].rx_current_bytes_for_this_frame;
         float txpf = mPlayer.loc[p].tx_current_packets_for_this_frame;
         float rxpf = mPlayer.loc[p].rx_current_packets_for_this_frame;

         // these values have no meaning for server
         if (p == 0)
         {
            sync = 0;
            ping = 0;
            difs = 0;
            lcor = 0;
            rcor = 0;
         }

         sprintf(txt, "%s,%d,%d,%d,%3.1f,%3.1f,%3.1f,%3.0f,%3.1f,%3.1f,%3.0f,%3.0f,%3.0f,%3.0f\n",
                       d, f, p, r, cpu,  sync, ping, difs, lcor, rcor, txbf, rxbf, txpf, rxpf);

         // printf("added log_status line: %d  %s\n", log_status_msg_num_lines,  txt);

I could simply put this into a database

it would get full really quick, but then I could just delete the entries

I have some thoughts:

a web page with the lognet messages and a button to refresh


where to start...


I want to do status

a small table



server_status

clients
level
last_update
uptime

how do I do uptime?

   mPlayer.loc[0].srv_uptime = al_get_time();

   al_draw_textf(mFont.pr8, mColor.pc[13], cx,     cy, 0, "Server Remote Control ");
   al_draw_textf(mFont.pr8, mColor.pc[15], cx+180, cy, 0, "Version:%s  Uptime:%s", mPlayer.loc[0].srv_version, mMiscFnx.chrmhd(mPlayer.loc[0].srv_uptime, msg));




take these values and stick them in a table
once per second


   strcpy(sql, "CREATE TABLE IF NOT EXISTS status( \
               timestamp     TEXT PRIMARY KEY, \
               uptime        INT, \
               clients       INT, \
               level         INT, \
               level_time    INT, \
               moves         INT, \
               enemies       INT ); ");
   if (sqlite3_exec(db_sessions, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'status' \n");

get the server to do this...where?


how big should uptime be?
I am planning of just using seconds

31,536,000 sec in a year

60s * 60m * 24h * 365 = 

i can use 32bit int

called every frame in server control

void mwNetgame::server_count_clients()
{
   server_num_clients = 0;
   for (int p=1; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active) server_num_clients++;
}


2026-01-14 01:46:49

I have this getting added to the database every second

20260114-014435  20260114-014435  28459   2        1      128845      5      11
sqlite> select MAX(timestamp), * from status;
MAX(timestamp)   timestamp        uptime  clients  level  level_time  moves  enemies
---------------  ---------------  ------  -------  -----  ----------  -----  -------
20260114-014502  20260114-014502  28486   2        1      129925      13     11
sqlite>


now make a page to view it




















