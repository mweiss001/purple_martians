20251228

I am back baby!

But just for a few quick things...


See if I remeber how to work with this project

I think the first thing I will do is see if I can commit to github


open Git Gui

rescan
stage
sing off
commit
push

I have password, but what is name? mweiss001

done...

now can I open the project on m36 and recompile

a complete rebuild is 5s! suck that qt creator!

now what?

go through setting up a linux dev machine...

C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20230824.txt

after a bunch of troubleshooting, found I needed to add 'sudo apt install libpulse-dev'

made a new one:
C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20251228.txt

the server is working!!!
and it takes 7W!!

C:\pm\pm_docs\HOWTO\Remote Headless Server.txt


now what?

I want to do something about logging.

What am I logging? Why so much?

there is more...how to setup the webserver

made a guide:

C:\pm\pm_docs\HOWTO\Setup Apache on headless server.txt

I wish I had a good doc that described what logging is happening.

make one now...

LOG_NET_SESSION

what do I really want?

I want to know when a player joined and how long they played for.
I want to keep this info in a database table for display

I also want to keep demo files for all the sessions...

I have something like that already....

mNetGameSessionLog

m@o3000:~/dev/purple_martians/logs$ ll
total 17608
drwxr-xr-x  5 m m    4096 Dec 28 21:18  ./
drwxrwxrwx 17 m m    4096 Dec 28 20:13  ../
-rw-rw-r--  1 m m    5740 Dec 28 20:13 '20251228-201303-[58][o3000].txt'
-rw-rw-r--  1 m m 7917793 Dec 28 20:24 '20251228-202406-[1][o3000].txt'
-rw-rw-r--  1 m m  338773 Dec 28 20:24 '20251228-202433-[2][o3000].txt'
-rw-rw-r--  1 m m  182515 Dec 28 20:25 '20251228-202508-[1][o3000].txt'
-rw-rw-r--  1 m m 3499306 Dec 28 20:29 '20251228-202946-[2][o3000].txt'
-rw-rw-r--  1 m m  164623 Dec 28 20:29 '20251228-202959-[1][o3000].txt'
-rw-rw-r--  1 m m 3313788 Dec 28 20:34 '20251228-203420-[20][o3000].txt'
-rw-rw-r--  1 m m 1786876 Dec 28 20:45 '20251228-204501-[1][o3000].txt'
-rw-rw-r--  1 m m  142306 Dec 28 21:13 '20251228-211355-[1][o3000].txt'
-rw-rw-r--  1 m m  152580 Dec 28 21:16 '20251228-211653-[1][o3000].txt'
-rw-rw-r--  1 m m  457191 Dec 28 21:18 '20251228-211800-[1][o3000].txt'
drwxr-xr-x  2 m m   24576 Dec 28 21:18  net/
drwxr-xr-x  2 m m    4096 Dec 28 21:17  session/
drwxr-xr-x  2 m m    4096 Dec 28 21:18  status/
m@o3000:~/dev/purple_martians/logs$ cd session/
m@o3000:~/dev/purple_martians/logs/session$ ll
total 28
drwxr-xr-x 2 m m 4096 Dec 28 21:17 ./
drwxr-xr-x 5 m m 4096 Dec 28 21:18 ../
-rw-rw-r-- 1 m m  504 Dec 28 21:17 .txt
-rw-rw-r-- 1 m m  549 Dec 28 20:24 20251228-201352-192.168.1.36-59650.txt
-rw-rw-r-- 1 m m  553 Dec 28 20:34 20251228-202459-192.168.1.36-62843.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:16 20251228-211638-192.168.1.36-64444.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:17 20251228-211716-192.168.1.36-62627.txt
m@o3000:~/dev/purple_martians/logs/session$ cat 20251228-211716-192.168.1.36-62627.txt
dt_start:20251228-211716
duration:32
ip:192.168.1.36
port:62627
hostname:m36
endreason:comm_loss
cdat_rx:0
player_num:1
next_levels:0
exits_activated:0
respawns:0
shots_fired:0
enemy_hits:0
player_hits:0
self_hits:0
purple_coins:0
tx_bytes_total:1199179
tx_bytes_avg_per_sec:36349
tx_bytes_max_per_frame:3650
rx_bytes_total:768772
rx_bytes_avg_per_sec:23303
rx_bytes_max_per_frame:1695
tx_packets_total:1768
tx_packets_avg_per_sec:53
tx_packets_max_per_frame:4
rx_packets_total:6400
rx_packets_avg_per_sec:193
rx_packets_max_per_frame:14
m@o3000:~/dev/purple_martians/logs/session$

and I think I have a cron job to scrape and add these to a database...

so how do I enable, disable this...

---------------------------------------------------------
Forced Settings on headless server
---------------------------------------------------------
void mwNetgame::headless_server_setup(void)
{
   mMain.classic_mode = 0;
   mLevel.unlock_all_levels();

   // ensure that only the basic LOG_NET is active and is printing to console as well as saving to file
   mLog.clear_all_log_actions();
   mLog.set_log_type_action(LOG_NET, LOG_ACTION_PRINT | LOG_ACTION_LOG);

   // make the hidden server player color taan (6)
   mPlayer.syn[0].color = 6;

   // always have session logging on
   mLog.set_log_type_action(LOG_NET_session, LOG_ACTION_LOG);

//   // add these for troubleshooting
//   mLog.set_log_type_action(LOG_NET_join_details, LOG_ACTION_PRINT | LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stak, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stdf, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_OTH_level_done, LOG_ACTION_PRINT);

   mLog.autosave_log_on_level_done = 1;
   mLog.autosave_log_on_level_quit = 1;
   mLog.autosave_log_on_program_exit = 1;

   // make sure we are always saving games
   mGameMoves.autosave_game_on_level_done = 1;

   mGameMoves.server_send_files_to_clients = 1;

   mConfig.save_config(0);

I think I have everything I need already

I want to keep the basic logging on 'LOG_NET'
but I should have a cleanup script to erase older ones to keep from using too much disk space

the LOG_SESSIONS ones I should just insert into the database and remove

the savegames I want to have a way to download them from the webserver

look up the scrape functions

I think they are PHP



---------------------------------------------------------
Setup a cron job to scrape session logs and add to database
---------------------------------------------------------

setup a cron job to scrape logs and add to database

crontab -e

*/1 * * * * php /home/m/dev/purple_martians/session_scrape.php >> /home/m/dev/purple_martians/session_scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape             >> /home/m/dev/purple_martians/scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape_status      >> /home/m/dev/purple_martians/scrape_status_cronoutput.txt 2>&1


this is an amazing one line script to change files ending in *.txt.bak to end in *.txt
for f in *.txt.bak; do mv -- "$f" "${f%.txt.bak}.txt"; done


I want to make a new folder in docs

server

like dev setup




2025-12-28 19:16:48


What do I have so far?

The server is making session logs and saving them to disk
cron is calling php scrape and adding them to database
I sometimes get some php errors that I am trying to figure out
can I make the php script output some more useful data
fixed a bug where a bad date would kill the whole batch scrape

   // test if we can create a valid date time
   if (!DateTime::createFromFormat('Ymd-His', $var['dt_start']))
   {
      echo "Error parsing dates\n";
      foreach ($var as $x => $y) echo "$x $y\n";
      return;
   }

2025-12-28 21:30:05

OK now what?

what do I do with the data in the database


I'm looking at the sessions.php in the web page


   $srvrname = "localhost";
   $database = "session_db";
   $username = "php_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "timestamp,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";


   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM session_tb";


I should change that to:




   $srvrname = "localhost";
   $database = "pm";
   $username = "pmdb_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "dt_start,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";

   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM sessions";



CREATE TABLE sessions (
  id                INT AUTO_INCREMENT,
  filename          VARCHAR(255),
  dt_start          DATETIME,
  dt_end            DATETIME,
  duration          INT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  endreason         VARCHAR(255),
  cdat_rx           INT,
  player_num        INT,
  next_levels       INT,
  exits_activated   INT,
  respawns          INT,
  shots_fired       INT,
  enemy_hits        INT,
  player_hits       INT,
  self_hits         INT,
  purple_coins      INT,
  tx_bytes_total            INT,
  tx_bytes_avg_per_sec      INT,
  tx_bytes_max_per_frame    INT,
  rx_bytes_total            INT,
  rx_bytes_avg_per_sec      INT,
  rx_bytes_max_per_frame    INT,
  tx_packets_total          INT,
  tx_packets_avg_per_sec    INT,
  tx_packets_max_per_frame  INT,
  rx_packets_total          INT,
  rx_packets_avg_per_sec    INT,
  rx_packets_max_per_frame  INT,
  PRIMARY KEY(id)
);

where do I want to do this?

on my live server

do I have sessions?

omfg it works!!!

2025-12-28 22:01:09

well I am making some progress

fix the php scripts..done..now deploy to live server
main and player work
bandwidth crashes
all says no dats

2025-12-28 23:11:21
finished the server install notes


2025-12-29 08:07:46

ran a 2 player fakekey game on new server for 7 hours
almost 100K cdats per client

must have generated a bunch of new logs

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

# fix permissions
chmod 777 ./op
sudo ./op

# compile and install libnet
cd libnet
make clean
make lib
sudo make install

# build puple martians
cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/docs/* /var/www/html

sudo systemctl start pm

2025-12-29 15:21:28


I think I have logging documented much better and able to disable status and net




2025-12-29 17:19:23

working on

download played game from server

<a href="/bs_notes.txt" download="poooop">
    <button>Download Report</button>
</a>


pscp -r -pw zaiden c:\pm\docs\* m@192.168.1.146:tmp

On the server, copy to the final place
sudo cp -r ~/tmp/* /var/www/html




2025-12-29 18:30:09


what do I want for sessions?

I want a nicer table


For a session row, I want to be able to downaload the savegame file.

There might be multiple...


maybe I could have it take me to another page with download links





-----------------------------------------------------------------------------------------------------------------------------------------

I have a really cool thing I want to try....

Method 1: Using PHP and a Query String (Full Page Reload)
This method uses a query string in the URL to determine which content to display.
When a link is clicked, the page reloads, and the PHP script processes the request and outputs the appropriate content. 
index.php
php

<?php
// Function to sanitize and get the 'page' parameter from the URL
function get_page_content($page) {
    switch ($page) {
        case 'about':
            return 'include/about.php';
        case 'contact':
            return 'include/contact.php';
        case 'home':
        default:
            return 'include/home.php';
    }
}

// Get the page parameter, default to 'home' if not set
$page = isset($_GET['page']) ? $_GET['page'] : 'home';
$content_file = get_page_content($page);
?>

<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Content</title>
</head>
<body>

<nav>
    <!-- Links with query strings -->
    <a href="index.php?page=home">Home</a> |
    <a href="index.php?page=about">About</a> |
    <a href="index.php?page=contact">Contact</a>
</nav>

<div id="content-container">
    <?php
    // Include the content file
    if (file_exists($content_file)) {
        include($content_file);
    } else {
        echo "<p>Content not found.</p>";
    }
    ?>
</div>

</body>
</html>

Include Files (create a folder named include): 

    include/home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
    include/about.php: <h2>About Page</h2><p>This is the about us information.</p>
    include/contact.php: <h2>Contact Page</h2><p>Contact us here.</p>
    
    
    
----------------------------------------------------------------------------------------------------------------------------------------------------

somehow that last example got garbled...

try this:

make dir /test/test23/index.php

and have all three files there
home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
about.php: <h2>About Page</h2><p>This is the about us information.</p>
contact.php: <h2>Contact Page</h2><p>Contact us here.</p>

<!DOCTYPE html>
<html>
<body>

<h1>Dynamic Content Example</h1>

<!-- Navigation Links -->
<a href="index.php?page=home">Home</a> | 
<a href="index.php?page=about">About</a> | 
<a href="index.php?page=contact">Contact</a>

<div id="content-area">
    <?php
    // Check if the 'page' parameter is set in the URL
    if (isset($_GET['page'])) {
        $page = $_GET['page'];

        // Use a whitelist to prevent directory traversal vulnerabilities
        $allowed_pages = ['home', 'about', 'contact'];

        if (in_array($page, $allowed_pages)) {
            // Include the corresponding PHP file
            include($page . '.php');
        } else {
            echo "<p>Content not found.</p>";
        }
    } else {
        // Default content if no parameter is set
        include('home.php');
    }
    ?>
</div>

</body>
</html>


works!!!




---------------------------------------------------------------------------------------------------------------------------------------------------
next


test24

cannot get this to work


index.html


<!DOCTYPE html>
<html>
<head>
<script src="code.jquery.com"></script>
</head>
<body>

<h1>AJAX Dynamic Content Example</h1>

<!-- Links with a class to attach an event listener -->
<a href="#" class="nav-link" data-page="home">Home</a> | 
<a href="#" class="nav-link" data-page="about">About</a> | 
<a href="#" class="nav-link" data-page="contact">Contact</a>

<div id="content-area">
    <!-- Content will be loaded here dynamically -->
    <p>Select a link to load content.</p>
</div>

<script>
$(document).ready(function(){
    $('.nav-link').on('click', function(e){
        e.preventDefault(); // Prevent the default link behavior (page reload)
        var page = $(this).data('page'); // Get the page name from the data attribute

        // Make an AJAX request to the PHP endpoint
        $('#content-area').load('\test\test24\content.php?page=' + page);
    });
});
</script>

</body>
</html>

content.php

<?php
if (isset($_GET['page'])) {
    $page = $_GET['page'];
    $allowed_pages = ['home', 'about', 'contact'];

    if (in_array($page, $allowed_pages)) {
        // Return only the content snippet without a full HTML structure
        include($page . '.php');
    } else {
        echo "<p>Content not found.</p>";
    }
}
?>



---------------------------------------------------------------------------------------------------------------------------------------------------



anyway, i thoink i might be on to something here


I could have one main html page

load different sections

like different types of tables

like downloads links based on selected session


2025-12-29 20:12:59



2025-12-30 05:36:25

when I click on a session link in the table

I want to to dyanmically load a section that show downloads for that time range



some smaller subtasks:
- can I download from another dir


datatables
get new version?
datatable.js on old site is version 3.7.0
DataTables 2.3.6

revisited datatable and updated notes in Datatable.txt


Now I really want to figure out how to call one php script from another

I want to have one sessions page the loads different tables

i want to have a separate file that fills that section

or maybe I will do something else first:
do something with a click on the the table 

made each cell an <a href tag

now how to do something with that


make a new section that is loaded from another php page 
fill.php


2025-12-30 07:51:32


I am getting somewhere !!!

my link in the table:

echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>";
               
reloads the current page with the 'data' parameter set in the url

then I include

include('fill.php');

<?php

   // Check if the 'data' parameter is set in the URL
   if (isset($_GET['data']))
   {
      $data = $_GET['data'];
      echo "<hr>" . $data . "<hr>";
   }
   else
   {
       // Default content if no parameter is set
       echo "<hr>Default<hr>";
   }
?>

2025-12-30 07:54:44

next:

make the links only in the date column

            echo "<tr>";
            foreach($row as $col => $val)
            {
               if ($col == "dt_start") echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";
            }
            echo "</tr>";


2025-12-30 08:04:55

next:

do something in fill...


find gms to download


I think the way to do this is to have another script run in cron that adds the gm files to a database

then I oould just look that up here

table: gm_files

filename
timestamp (get from filename)
level (get from filename)

in the database make a way of knowing what sessions a gm belongs to

this is not a one to one either way:

sessions can have multiple gm's (when session is longer than one level)

gm's can have muliple sessions (when more than one client)

I could have a 3rd table to link them

session_gm_links
session_id
gm_id


what are the rules for populating this table

for each closed session (with start and end)

find gm's that date range fits into

make a link from session to gm

if I have gm's that do not match??

figure that out later

right now create these tables and test

I have the gm table done and the php import script

now how am I going to create the links?

first of all create the table


Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

mysql> DESCRIBE gm;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| filename  | varchar(255) | YES  |     | NULL    |                |
| timestamp | datetime     | YES  |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

mysql> DESCRIBE gm_sessions;
+------------+------+------+-----+---------+----------------+
| Field      | Type | Null | Key | Default | Extra          |
+------------+------+------+-----+---------+----------------+
| id         | int  | NO   | PRI | NULL    | auto_increment |
| gm_id      | int  | YES  |     | NULL    |                |
| session_id | int  | YES  |     | NULL    |                |
+------------+------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SELECT * FROM gm;
+----+------------------------------------------------+---------------------+
| id | filename                                       | timestamp           |
+----+------------------------------------------------+---------------------+
|  1 | 20251229-151621-[32]-autosave on level done.gm | 2025-12-29 15:16:21 |
+----+------------------------------------------------+---------------------+
1 row in set (0.00 sec)


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link


2025-12-30 10:04:32
-------------------------------

i could just leave this part for now

I want to work on the part where I make links to downloads

fill.php

I really wish I had the session id here

now I do


2025-12-30 11:42:28

configure appache for downloads

made an alias to map /downloads/  to /home/m/dev/purple_martians/savegame

see apache file


2025-12-30 13:30:30

now I can download from there directly

what next??

-----------------------------------------------------------------------------

do the database thing


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link

also remove dead link

that could be its own script

make a php file

iterate all sessions





lets thin about think for a minute, high level

gm's are serial, none should ever overlap

sessions are not, there can be mutiple simulatanouesly

so for a session that spans a time range...

you know what else???
I can calculate the start time of a gm!!
I have the end time and the length

is this important, do I need it?...maybe

maybe I should collect more meta data about gm's for the database
start, end,
joins
quits
max players
deaths

2025-12-30 15:00:07

I am getting confused about how to tell if a gm belongs in a session

if I captured the start also....
then if either the start or the end is in the range...

lets draw ascii art diagrams

 [...se1..]
         [...se2..................................]
   [...se2.....................]
[...se4.....................]
[...gm1...][.gm2.][...gm3...][.gm4.][...gm5...]

I think I need gm start...get it...

I have done that..
2025-12-30 16:36:07

now I get start and end in gm database

2025-12-30 16:57:45

now back to link....



for testing...
remove all links,
check for links
show orphan gm
show orphan sessions

2025-12-30 19:10:55

I think I am ready to implement on the web page

when I click on a session make the info page show much more info

2025-12-31 04:31:21

I got quite a lot done yesterday.
made 2 new tables 
gm and gm_sessions
make scripts to scrape and make links
made downloads visible
make a second section of sessions page, loaded from separate script


today I want to:

make the second section way better:
show all info about the selected session
including the list of associated gm files

the list of gm files could have more info about each


is there a way to make web faster?

could I samba the entire www folder and edit direct on windows?
try it, fool! done...

2025-12-31 07:45:24

I have the nice session description done with all data

now onto the list of gm's

done...


I think I want to create some better data..

but maybe first some debug tools

php pages that show
orphan session
orphan gm
all gm

rename fill.php to show_session.php

then make ones for these other things also


2025-12-31 08:33:48
I think I have the core functionality working:

now what?

show info for save game files?

make like a table row with info and a clickable link


should I also save duration in gm?
if I do that where will I stop?
just do that for now

first of all, make sure you don't accidentally overwrite all the work done in www

-------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
-------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

change the gm table, drop and recreate ...done
edit the scrape_gm.php file and edit the db insert .. done
deploy to server

C:\pm>pscp -pw zaiden c:\pm\scrape\* m@192.168.1.146:dev/purple_martians/scrape

they are now in the db with the new column

clean up link_gm.php and test...done

add it to the cron done

add to note in sewrver setup done

thw only issue I could see is that the links are being deleted and recreated every time


2025-12-31 10:35:40

what next?

make the link line look better somehow

could I put it in a table?

make a php script that puts a list of gm's in a table with download links
why? do I think that will look better?

If I can do that, then I can also do that for the main session table

make my own varianle to tell what set of columns are shown 

session_table_column_set



the variables passed when a page is loaded, the query string, is reset when the page is reloaded

I was using this for current session id

I think I want to try a different method

sessions?



<?php
// Start the session
session_start();

// Set session variables
$_SESSION["favcolor"] = "green";
$_SESSION["favanimal"] = "cat";
$_SESSION['count'] = 1;

echo "Session variables 'favcolor', 'favanimal', and 'count' are set.";
echo '<br><a href="page2.php">Go to Page 2</a>';
?>


<?php
// Start the session to access stored data
session_start();

// Access session data
echo "Favorite color is: " . htmlspecialchars($_SESSION["favcolor"]) . ".<br>";
echo "Favorite animal is: " . htmlspecialchars($_SESSION["favanimal"]) . ".<br>";

// Update the counter variable
if(isset($_SESSION['count'])) {
    $_SESSION['count']++;
    echo "You have visited these pages " . htmlspecialchars($_SESSION['count']) . " times in this session.";
}
?>



2025-12-31 11:41:53

I think I got something here...

in main page sessions.php

   session_start();

   // if passed as query string set the session variable
   if (isset($_GET['current_session_id'])) $_SESSION['current_session_id'] = $_GET['current_session_id'];


show_current_sessions reads the sessions varaible

// Check if the 'data' parameter is set in the URL
//if (!isset($_GET['current_session_id'])) echo "<hr>no current session set<hr>";
//else 
//{
//  $current_session_id = $_GET['current_session_id'];

if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];



when clicking on the table link to chande current session, nothing changes, still reloads main page with query

            foreach($row as $col => $val)
            {
               if ($col == "id") echo "<td><a href=\"sessions.php?current_session_id=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";

now bakc to using this for table columns
done and I have killed all the oly files!!!






now lets see if I can make all work...





$t1 = array("id", "Date", "ip" );
$t2 = array("23", "skiddo", "buddday" );
var_dump($t1);
var_dump($t2);
$t3 = array_merge($t1, $t2);
var_dump($t3);

array(3) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
}
array(3) {
  [0]=>
  string(2) "23"
  [1]=>
  string(6) "skiddo"
  [2]=>
  string(7) "buddday"
}
array(6) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
  [3]=>
  string(2) "23"
  [4]=>
  string(6) "skiddo"
  [5]=>
  string(7) "buddday"
}



$t1 = "id, Date, ip";
$t2 = "23, skiddo, buddday";
var_dump($t1);
var_dump($t2);
$t3 = $t1 . $t2;
var_dump($t3);

string(12) "id, Date, ip"
string(19) "23, skiddo, buddday"
string(31) "id, Date, ip23, skiddo, buddday"


2025-12-31 13:33:39

I finally have the session table and columns thing figured out

I think I am ready to work on the game moves table

I have a script that make a link...

2025-12-31 14:56:47
I have the table done...

just need to figure out how to filter it
- all
- orphan
- link to session

0 = all
-1 = orphan
anything else is a session id

lets call it gm filter

actually i dont need to save it, just pass it as a parameter

sessions will already have current session id

SELECT gm.id, filename, dt_start, dt_end, duration FROM gm LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id WHERE gm_sessions.session_id=8 


CREATE TEMPORARY TABLE TempFilteredResults AS
SELECT column1, column2, ...
FROM OriginalTable
WHERE condition = 'filter_value'; -- Your filtering condition


this just looks too stupid

Im going to make my own table with balckjack and hookers


<?php session_start(); ?>

   <script src="../assets/js/jquery-3.7.1.slim.min.js"></script>
   <link rel="stylesheet" href="../assets/css/datatables.min.css" />
   <script src="../assets/js/datatables.min.js"></script>

<?php

function show_gm_table($filter)
{
   $col_list = array("id",   2025-12-31 15:21:53 "Filename", "Start Time",   "End Time",             "Duration"  );
   $row_list =       "gm.id,   filename,  dt_start,        dt_end,     SEC_TO_TIME(duration)";



   if ($filter == 0) $sql = "SELECT $row_list FROM gm";

   if ($filter > 0)
   {
      $sql  = "SELECT gm.id, filename, dt_start, dt_end, duration FROM gm ";
      $sql .= "LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id ";
      $sql .= "WHERE gm_sessions.session_id=$filter";
   }

   echo "sql: $sql\n";

   echo "<script>$(document).ready( function ()
         {
            $('#myTable2').DataTable(
            {
               layout: {  topStart: { buttons: ['colvis'] }, bottomStart: 'pageLength' },
               colReorder: true,
               columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: [0, 1, 2, 3, 4] } ],
               order: [  [0, 'desc'] ]
            }  );
         } );
         </script> ";


      echo "<table id='myTable2' class='display cell-border compact' style='width:90%'>";
         echo "<thead>";
            echo "<tr>";
               foreach($col_list as $col)
                  echo "<th>$col</th>";
            echo "</tr>";
         echo "</thead align='center'>";
         echo "<tbody>";
            $res = mysqli_query($conn, $sql);
            while ($row = $res->fetch_assoc())
            {
               echo "<tr>";
               foreach($row as $col => $val)
               {
                  if ($col == "filename")
                  {
                     $filename = $val;  
                     $fullpath = "/downloads/$filename";
                     echo "<td><a href=\"$fullpath\" download=\"$filename\">$filename</a></td>";
                  }
                  else echo "<td>" . $val . "</td>";
               }
               echo "</tr>";
            }
         echo "</tbody>";
      echo "</table>";

}
?>


here is a copy before I kill it all



/*
table {
  font-family: Arial, sans-serif;
  border-collapse: collapse; /* Merges borders */
  width: 100%; /* Table takes full width */
  margin-top: 15px; /* Adds space above the table */
}

caption {
  padding: 10px;
  font-weight: bold;
  caption-side: top; /* Positions caption at the top */
}

th, td {
  border: 1px solid #ddd; /* Light border color */
  text-align: left; /* Aligns text to the left */
  padding: 12px; /* Inner spacing */
}

thead th {
  background-color: #4CAF50; /* Green background for headers */
  color: white; /* White text for headers */
}

tbody tr:nth-child(even) {
  background-color: #f2f2f2; /* Gray background for even rows */
}

tbody tr:hover {
  background-color: #ddd; /* Gray background when hovering over a row */
}


2025-12-31 16:49:20

I think I have that tabel looking good


now what?

links at the top of sessions for navigation

links by the sessions table for filters only

// Check if 'current_session_id' is set in the $_SESSION
if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];

use the gm table for all and orphan...done


2025-12-31 17:47:40

wow this is coming along great...I should do a massive backup...



I have only 5 files:

sessions.php the main one
show_sessions_table.php
show_current_session.php
show_gm_table.php

and one more
show orphaned sessions..




top menu
Sessions Saved Games Debug Server Status Back to Main Menu


2026-01-01 04:48:11

should I just dive in and start on player name?

How much data do I need?
8 char * 8bits = 64bits

can I do it in one game move?

a game move entry is 4 ints
each int is 32bits


right now the most common use is:

0 - frame
1 - type
2 - player num
3 - data

options:

option 1: use multiple game moves
on the same frame as player active have 4 more game moves:

0 - frame
1 - type (player name part 1)
2 - player num
3 - data (first 4 bytes of player name)

0 - frame
1 - type (player name part 2)
2 - player num
3 - data (last 4 bytes of player name)







option 2: refactor and use one game move

use the bits from type to encode
set active, player number and color
use the last 2 bytes for the name

00000000 00000000 00000000 00000000

I need:
3 bits for player number (0-7)
4 bits for color (0-15)

1 bit to mark that it is a make active type

then I can use the last 2 ints to get 64 bits for 8 char

I like option 2

when I process them I will just check for the one bit the tell me it is a active

00000000 10000000 00000000 00000000 type active
00000000 00000000 00000000 00000xxx player num
00000000 00000000 0000xxxx 00000000 color


      {
         if (!(mLoop.state[1] == PM_PROGRAM_STATE_DEMO_RECORD))
            if (x > current_pos) current_pos = x; // index of last used gm - keep this at the most recent one, never go back

         switch (arr[x][1])
         {
            case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;


old:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

switch (arr[x][1])
{
   case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;
   case PM_GAMEMOVE_TYPE_SHOT_CONFIG:      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_MOVE:      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;
}




void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}

















new:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
//                                                 3       2       1       0
//                                          76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    0b00000000100000000000000000000000
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

int t = arr[x][1];
if (t &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)    proc_game_move_player_active(t,      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_HIDDEN)    proc_game_move_player_hidden(        arr[x][2]            ); break;
if (t == PM_GAMEMOVE_TYPE_SHOT_CONFIG)      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_MOVE)      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;


void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}


 

add to player struct:

   char name[9];
      
now how do I change state size?


show variables from settings?




old:
Variables used for netgame state exchange

mPlayer.syn         :  2400
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112480

new:
Variables used for netgame state exchange

mPlayer.syn         :  2496
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112576

this does not add up...
96/8 = 12bytes
it should be 9
I guess the min is 4 byte chunks

1 int 
mPlayer.syn         :  2432
32/8 = 4 bytes

changed 
#define STATE_SIZE 112576

done


make a place to set it


only clients make sense to save it
every computer should save it as player 0
save it to settings so it persists..done
enforce length
done when loading from disk
do it when editting..done



when adding game move



leave the original the way it was   

#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

add this:

//                                                    3       2       1       0
//                                             76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG  0b00000000100000000000000000000000


when adding, leave the old calls the same

intercept and add in new format


void mwGameMoves::add_game_move(int frame, int type, int data1, int data2)
{
   int p = data1; // alias to improve readability
   
   if (type == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
   {
      add_game_move_player_active(frame, p, data2);
      return;
   }



void mwGameMoves::add_game_move_player_active(int frame, int p, int c)
{
   // convert to new format

   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   int data1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data1 + mPlayer.syn[p].name[i] * of;
   }
   
   int data2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data2 + mPlayer.syn[p].name[i+4] * of;
   }

   add_game_move2(frame, type, data1, data2);
   
}


next 




make soem conversion routines and test

input:
player num
color
name

output 
type
d1
d2

and back

void gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  d1 & 0b0000000000000111;      // mask all except lowest 3 bits
   c =  d1 & 0b0000111100000000) / 8; // mask and shift 8

   char n[9] = { 0 };

//   name[0] = (gm2 >> 24) & 0xFF;
//   name[1] = (gm2 >> 16) & 0xFF;
//   name[2] = (gm2 >> 8)  & 0xFF;
//   name[3] = (gm2 >> 0)  & 0xFF;
//
//   name[4] = (gm3 >> 24) & 0xFF;
//   name[5] = (gm3 >> 16) & 0xFF;
//   name[6] = (gm3 >> 8)  & 0xFF;
//   name[7] = (gm3 >> 0)  & 0xFF;

   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      n[i+0] = (gm2 >> of) & 0xFF;
      n[i+4] = (gm3 >> of) & 0xFF;
   }

   snprintf(name, 9, n);

   printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}


void val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   d1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d1 += name[i] * of;
   }

   d2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d2 += name[i+4] * of;
   }

   printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}










this is the final...


void mwMiscFnx::gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  type & 0b0000000000000111;        // mask all except lowest 3 bits
   c = (type & 0b0000111100000000) / 256; // mask and shift 8

   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);
}


void mwMiscFnx::val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 256; // shift and add color

   d1 = d2 = 0;
   for (int i=0; i<4; i++)
   {
      d1 += name[i+0] << (i*8);
      d2 += name[i+4] << (i*8);
      //printf("name[%d]:%d of:%d dl:%d\n", i, name[i], of, d1);
   }
   //printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);
}


2026-01-01 09:40:43

I have it patched into the game moves thing

now let try something fun

the died, etc messages


make a function in player to get the right name

char* mwPlayer::get_player_name(int p, char * name)
{
   snprintf(name, 9, "%s", mPlayer.syn[p].name);
   if ( (!strcmp(name, "default")) || (!strcmp(name, ""))) sprintf(name, "Player %d", p);
   return name;
}

looking good!!!
now what else?
bottom msg..done


now what about saved games?
the name persists and plays back
but the color does not? apparantly not...it used to...fixed



can I play back old demos?
it looks like only first player comes active
fix this...

make something to interate all gm's and convert to new type

use default player names 'default'

I could make my code accept either type?? maybe?? hell yes!!!!

2026-01-01 10:49:35

now what?

onto the netgame stuff

cjon will now need to send name
sjon rx name and set

lets test...


how?

I need a few computers set up again...

at least one client

is asp on he list?



server crashes when client tries to join

i don't want that to happen  :(

it dies when reading playername from packet
buffer was too small 9 char
examine packet...
how and where?


fixed some bugs and cleaned up code around packet buffer add and read strings...


netgame with playername seems to working quite well...

now what?

is there something wrong with bottom msg?
actually I think I hide it when player is in the way...
commented out for now...

what else is there to do?

overlay for demo playback?

end of level

bug when playing back demo local player name overides player 0

seems to work now?

try with older demo

I think it is saving in the cfg file

no, maybe just saving in memory


what to do?

when doing a full reset, reset all players above 0 names to default
reset local color and name

where does this happen?
make it so that name is never saved except in settings...done

I think in player clear, reset all player names to 'default'
when config is loaded it will be restored

I think I have all this fixed now.
The only time name is saved is when enter is pressed after editting.
When resetting player, set all names to 'default'
When resesting player 0, reload config to restore name

next?


add to sessions database field
while i am at it I should also add color, that should not change for the session...
then I can show the player name and color in sessions table


  player_num        INT,

added:
  player_name       VARCHAR(255),
  player_color      INT,

drop and recreate table..


alter the scrape...done

alter the code that writes logs



added to session struct:

struct client_session
{
   char player_name[9];
   int player_color;




I think I have it done...
deploy to server and test...

might as well make release too...


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------

cd ~
rm -r tmp
mkdir tmp

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

chmod 777 ./op
sudo ./op

cd libnet
make clean
make lib
sudo make install

cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/web/* /var/www/html

sudo systemctl start pm


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------


2026-01-01 22:31:35

I finally have the new values showing in the sessions table


now what should I do with them?

add them to sessions table of course

bug

now that I am storing big numbers in gm file, ill need another method for determining the length

can I clamp it?

what bit am I using now? 24

2^24 = 16.7M
/40 = 420k sec
/60 = 6990 m
/60 = 116h

do I have a max time for game?
server will reload in 1H

so if I just toss any values > 16M from my end calc that should work...

no

-rw-r--r--  1 m m   57 Jan  1 22:29 '20260101-222933-[103]-autosave on level done.gm'
m@o3000:~/dev/purple_martians/savegame$ cat 20260101-222933-\[103\]-autosave\ on\ level\ done.gm
4
0
0
0
103

1
9
0
5

1
3
0
0

1
8389888
1802398064
7602297
m@o3000:~/dev/purple_martians/savega

what if I just go back chunks of 4 at a time

the problem is how I write it to the disk
i should realy just do line of 4 char separated by commas
0,2,3,111

this sounds like a major undertaking

what if i got the last 80 char, split into array on newlines

grouped them 4 at a time

I think I am on my way to finding a better way to do that




2026-01-02 06:35:32

add player and color to sessions

get player icons for all colors
I know its a small thing but it will make things look so much better!!


use code to generate

   if (1)
   {
      // save as set of icons to disk
      for (int a=0; a<16; a++)
      {
         char fn[80];
         sprintf(fn, "bitmaps/player_icon_%02d.bmp", a );
         al_save_bitmap(fn, player_tile[a][2]);
      }
   }

done

what about transparency? right now backgroud color is black


can I also save as png?

as simple a changing the extension




why am i so against css?

it seems like the easiest sollution many times...

i can put it in the head:


<!DOCTYPE html>
<html>
<head>
    <title>My Website</title>
    <!-- Internal CSS styles -->
    <style>
        body {
            background-color: lightblue;
        }
        h1 {
            color: maroon;
        }
    </style>
</head>
<body>
    <h1>This is a heading</h1>
    <p>This is a paragraph.</p>
</body>
</html>





.icon-text-container {
  display: flex;       /* Enables Flexbox layout */
  align-items: center; /* Vertically centers the items */
  gap: 10px;           /* Adds space between the icon and text */
  /* Optional styling for visibility */
  border: 1px solid #ccc;
  padding: 10px;
  width: fit-content;
}

.icon {
  width: 24px;   /* Set desired icon size */
  height: 24px;
}

.text {
  /* Text styles */
  font-size: 1rem;
}


<div class="icon-text-container">
  <!-- Use an image, an icon font (like Font Awesome), or an SVG -->
  <img src="path/to/your/icon.png" alt="Icon" class="icon">
  <span class="text">Your Text Here</span>
</div>




flex is awesome...i want to use it for everything!!!

https://css-tricks.com/snippets/css/a-guide-to-flexbox/

make css in the head
name containers for everything
one for the page and then ones for all the elements


I am working on current session...

I have flex containers for:
entire thing
title
text block

2026-01-02 13:17:32

I have current session and session table done
not much I can do with the Datatables thing..

I guess I can style individual elements, like head

i have done head tr and tr hover...probably all I'll need


Now I want to redo this all in a dark theme....

I am loving it!!!

at the top of sessions page:


<html class="dark">







<!-- 
body {
    background-color: #000000; /* Black background */
    color: #FFFFFF; /* White body text */
}

a:link {
    color: #77d7ff; /* A light blue for unvisited links */
    text-decoration: underline; /* Always use an underline for accessibility */
}

a:visited {
    color: #b39ddb; /* A light purple/violet for visited links */
}

a:hover {
    color: #FFFFFF; /* White on hover */
}



 -->




<!-- container for player icon and player name text -->

.icon-text-container
{
   display: flex;      
   align-items: center;
   gap: 10px;          
}
.icon { width: 20px; height: 20px; }
//.text { font-size: 1rem; }


<!-- hack because sometimes hr do not work in flexbox -->
.hack-hr
{
   font-size: 1rem;
   font-weight: normal;
   line-height: 0;
   margin: 0;
}




2026-01-02 16:46:01


I have spent so much time making everything line up and look nice...

now do current session to look like session 

pick a color


I want to make a frame work to make these things easier..


Frame around the whole section

section at the top for title

other section headers possible


I think what I need to do is:

One container for all
one container for the title frame, draw only bottom border
one container inside that to make the title have padding

then for any sub sections

one container for the sub section draw only bottom border
one container inside that for padding

I want to make this common, not custion for each instance

css and php helper functions

.section-frame
.section-frame-title-frame
.section-frame-title-body

.section-frame-sub-title-frame
.section-frame-sub-title-body

2026-01-03 01:59:50

I think I am done here....
I have the common stuff done for css html and all sessions pages...

it looks great...


backup it the fuck up!!!

copy from server to local and do a commit....


--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

2026-01-03 08:12:38


buttons...


three methods:

Method 1: Style an Anchor Tag (Recommended)

This approach uses a standard hyperlink and applies CSS to give it the appearance and feel of a button.
This is best for accessibility and ensures the link still works if JavaScript is disabled. 

<a href="https://www.example.com" class="button">Go to Example</a>

The target="_blank" attribute can be added to open the link in a new tab: 
<a href="https://www.example.com" class="button" target="_blank">Open in New Tab</a>

.button {
  background-color: #4CAF50; /* Green background */
  border: none; /* Remove default border */
  color: white; /* White text */
  padding: 15px 32px; /* Some padding */
  text-align: center; /* Center the text */
  text-decoration: none; /* Remove underline */
  display: inline-block; /* Make it a block-level link */
  font-size: 16px; /* Increase font size */
  cursor: pointer; /* Add a hand cursor on hover */
  border-radius: 8px; /* Rounded corners */
}

.button:hover {
  background-color: #45a049; /* Darker green on hover */
}


Method 2: Use JavaScript with a Button Tag 

This method uses the <button> element and adds a JavaScript onclick event to perform the redirection. 

<button onclick="window.location.href='https://www.example.com'">
  Go to Example
</button>

To open the link in a new tab, use the window.open() function: 

<button onclick="window.open('https://www.example.com')">
  Open in New Tab
</button>

This method requires JavaScript to be enabled in the user's browser to function.


Method 3: Using a Form

For simple navigation where JavaScript is not an option, you can wrap a submit button in a <form> tag and specify the destination in the action attribute. 

<form action="https://www.example.com">
  <button type="submit">Go to Example</button>
</form>



I did method 1 looks good,
now I want to put the buttons in the title bar





I I think I should do this by default for all...


title frame
flex box for title frame

actual title
flex frame for buttons


2026-01-03 10:11:03

that is so fucking beautiful!!
I want to get button colors from id



2026-01-03 10:34:18

now do current session
make buttons to show hide bandwidth

2026-01-03 10:50:24

all that hard work setting up the framework paid off
it was quite easy to add this button

now make one for player section and game moves also
2026-01-03 11:27:04

done

now make gm have nice header like the rest

all done...

now what?

work on top level link row

add
sessions (this) 
debug (more table)
all gm

this is what I have now:

<table><tbody><tr>
<td style='padding:2px 8px;' > <a href="../index.html"  >Back to Main Page        </a> </td>
</tr></tbody></table><hr>

done
now implement game moves and debug??  later...


I think sessions is 100% done

what did you want to do with game moves now?

have a detailed section for them like current session, current savegame
I need a good name to call these things:
SavedGames

implement the three way button for saved game list

done




make a detailed section for them like current session, current savegame
I need a good name to call these things:
Saved Games


change the gm table list

make a download button and one to select gm

I will need a new section to show details of current gm

Current Save Game
$current_gm_id
show_current_gm.php
how to rearrange table?..done


now what?

when setting current gm, find players that are in the file...

how?

I think I should run an external PHP script that parses and adds to database
for now only do it when looking at the file

I will need another few tables:

players
(to keep track of unique players)
but how unique?

same name? (of course)
same player_num and color (probably not)
same host name?
and what will I do if there is no player name, or it is default?


I think I should start by saving as much data as I can
i don't have to make use of it all

CREATE TABLE players (
  id                INT AUTO_INCREMENT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,
  PRIMARY KEY(id)
);

I can get all fields from session table

I can only get this from a gm file:
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,


create this then alter session_scrape to enter player info also...or...
I could just get it from the table already

it will be like a smaller sub table from sessions...
only 6 columns and no uqique

I really question if I need ip host port?

if I am trying to find

I don't think I will use them for matching...
for sessions, get everything

for finding a player in a gm, i might get multiple...just deal with it..list them all

why do I even need this extra table?

mostly because once I look something up I want to save it...

-------------------

make a php script to add player to db
if exists find id
in not create and find id

---------------------------------

wait I just thought of something...
we can get all the info when sessions enters the player

then when gm goes to look it up, it should aleady exist

if there are multiple player matches when searching only for num, color and name, will it really matter?
what am i planning on doing with this info anyway?



I mostly want to be able to show seme meta data for gm files

my plan is to parse the gm file and collect info

right now all I was planning on doing was getting the three player variables

why don't we just stick with that for now?

I still want to add them to a database make a link table
gm_player



script

parse_gm.php

opens gm and looks for play moves

to gma -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780
to val -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780

Process returned 0 (0x0)   execution time : 0.098 s
Press any key to continue.



else
{

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      echo "\n$ch --$rf\n";  
   }







   $n = "--------";

   var_dump($n);

   for ($i=0; $i<4; $i++)
   {
      $tv = $g2;
      echo sprintf("0 - %032b\n", $tv);
      $of = $i*8; 
      $tm = $tv >> $of;
      echo sprintf("2 - %032b\n", $tm);
      $mk = $tm & 0xFF;
      echo sprintf("3 - %032b\n", $mk);


      $ch = chr($mk);
      echo "4 - ch:$ch\n";

      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );

//      $n[$i+0] = $ch;

   }
   var_dump($n);
   echo $n;

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      
      echo "\n$ch --$rf\n";  

      var_dump($rf);

//      if ($rf == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0x0;





//      echo sprintf("[%d] - '%d' ' '%c'  fn:%d\n", $i, $n[$i], $n[$i], $found_null);

//      if ($n[$i] == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0;
   }
   
   var_dump($n);
   echo $n;


/*
   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, "%s", n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

*/


//   echo "\n\nplayer: $p color:$c name:$n\n\n";

}
}


I have the function done:


function gma_to_val($t, $g1, $g2)
{
   echo "gma_to_val($t $g1 $g2)\n";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8


   // get the player name form the next 2 32bit ints
   $n = ""; 
   for ($i=0; $i<4; $i++)
   {
      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );
   }
   echo "\n\nplayer: $p color:$c name:$n\n\n";

   // show values
   for ($i=0; $i<8; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);

   // if zero somehwere in the data, write all zeros from then after
   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      if ( ord( $ch ) == 0)  $found_null = 1;
      if ($found_null) $n[$i] = chr(0); 
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   for ($i=0; $i<9; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


}



2026-01-04 03:18:19

now what?

I am not sure I am getting the right values from gm files


better version


function gma_to_val($t, $d1, $d2)
{
   echo "gma_to_val($t $d1 $d2)  --  ";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8

   // get the player name from the next 2 32bit ints
   
   // make sure this is declared as a string
   $n = "";
   
   // detect null and force all char after to also be null
   $found_null = 0;   

   // first 4 char from d1;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d1 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i] = $ch;
   }


   // second 4 char from d2;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d2 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i+4] = $ch;
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   //for ($i=0; $i<9; $i++)
   //   echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


   echo "player: $p color:$c name:$n\n";

}





I have another crazy idea

integrate a database into the game

- i need to make sure that windows and linux versions are still the same
- do I need a networked database like mysql? could i just use sqlite?

why?
what are the benefits:
- make the way the server writes files to disk and later gets scraped a lot simpler
- the server can just write directly to the database
- make the way to adjust the config from headless mode
- replace so much of the level stats bullshit with something much simpler

cons:
would take a lot of fucking work!!

how can i start small?

add sqlite to project and make sure it works in windows and linux
then start adding things to it

first of all, sessions



2026-01-04 04:09:13

I am going to add sqlite to my project....

first save all the work in progress and commit..

2026-01-04 07:45:17






2026-01-04 11:08:21

i have the update function working...

it only updates dt_end, duration, and endreason for now


I want to call it from more places


when I close a session, I should also set session_id to 0 in player loc
then when I am checking for open sessions, I can check there


I these in sessions

         client_sessions[p].next_levels++;
         if (p == mPlayer.syn[0].level_done_player) client_sessions[p].exits++;

if that goes away, can I save it in player?

set it in tally, then make sure it gets reset


why are all these in syn?

   int stat_respawns;
   int stat_shots_fired;
   int stat_enemy_hits;
   int stat_player_hits;
   int stat_self_hits;
   int stat_purple_coins;

   int stat_enemy_exploded;
   int stat_player_exploded;
   int stat_self_exploded;

added:
   int stat_next_levels;
   int stat_exit;


mItem.pmsgtext :250000
---------------:------
total          :384080

Variables used for netgame state exchange

mPlayer.syn         :  2624
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112704

Other Large Variables



#define STATE_SIZE 112704




I have been through the whole file: session log and done all I could
I still need to do something about tally
the sql method nevers call add log or tally or clear

what calls it outside this file?


mwGameMoves will do this when client quit: session_close(p, 2); // reason 2 - client quit

this is still good


omg should I deply to 146 and try?

I should work on the tally shit now

25 fucking variables to get from db, update, and put back...



2026-01-04 16:05:44


I think I am ready to remove all the old session stuff...


2 calls to


   void session_add_entry(const char* address, const char* hostname, int p, int active, int inactive_reason);

      session_add_entry(address, hostname, 9, 0, 1); // server full
      session_add_entry(address, hostname, p, 1, 0); // join invite     


void mwNetgame::session_add_entry(const char* address, const char* hostname, int p, int active, int endreason)
{
   session_add_sql(address, hostname, p);


changed to pass end reason also


   session_add_sql(address, hostname, p, endreason);


now replace those 2 calls with the sql version
then deal with endreason
done, I no longer use any of the old session stuff

I should still make it optional

how did I used to do that?




































I also would like a meta block for gm files
I have one already, but I want a better one
append at the start when saving
start time
end time
duration
players
player names
finished?

maybe each player section could include:
name
number
color
start frame
end frame
respawns
purple coins collected
enemies killed
other players killed
enemy hits
self hits
exits triggered

I have been think about redoing how I save gm files to disk
currently:
nothing but unordered integers, one per line

1320
0
0
0
9
1
9
0
5
1
3
0
0
1
8389888
1802398064
7602297
1
8392193
1819043193
7602287
13
5
1
4
17
5
1
0

I was thinking of making it like this:

1320
0,0,0,9
1,9,0,5
1,3,0,0
1,8389888,1802398064,7602297
1,8392193,1819043193,7602287
13,5,1,4
17,5,1,0

it should not take more disk space
I would just be swapping crlf for ,

when saved on windows the lines end with CRLF
in linux its just LF

if I make this change, what would it affect?
-only the game saves and loads to disk,
-once loaded into the array the way it is stored on disk is irrelevant
-it would make it easier to parse later



what will 

magic number to start file:
PMSAVEGAME

then the meta block up to

in the meta block

VERSION:1



TIMESTAMP_START:
TIMESTAMP_END:
MAX_FRAME:
LEVEL_NUM: 


PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:



GAME_DATA_NUM_ENTRIES:
GAME_DATA_START:

each line will be 4 commas separated ints, corresponding to an array line

0,0,0,9
1,9,0,5
1,3,0,0


most times reading the file, the header can be ignored

the header can be modified with no ill effects

if the header or magic number is missing, revert to old loading behaviour


in load:

first detect magic number:

if missing do old load


int mwGameMoves::load_gm(const char *sfname)




I redid the old method, it had a read file pattern I used from my frist days of c programming:

      int loop, ch;
      char buff[2000];

      initialize();

      char fname[256];
      sprintf(fname, "%s", al_get_fs_entry_name(FS_fname));

      FILE *filepntr = fopen(fname, "r");
      if (filepntr == NULL)
      {
         printf("Error opening file:%s\n", fname);
         return 0;
      }
      else
      {

         // first get number of entries
         loop = 0;
         ch = fgetc(filepntr);
         while((ch != '\n') && (ch != EOF))
         {
            buff[loop] = ch;
            loop++;
            ch = fgetc(filepntr);
         }
         buff[loop] = 0;
         entry_pos = atoi(buff);


         // then get all the entries
         for (int x=0; x<entry_pos; x++)
            for (int y=0; y<4; y++)
            {
               loop = 0;
               ch = fgetc(filepntr);
               while((ch != '\n') && (ch != EOF))
               {
                  buff[loop] = ch;
                  loop++;
                  ch = fgetc(filepntr);
               }
               buff[loop] = 0;
               arr[x][y] = atoi(buff);
            }
         fclose(filepntr);

ewww....

new:

      for (int x=0; x<entry_pos; x++)
         for (int y=0; y<4; y++)
            if (fgets(buffer, 100, file)) arr[x][y] = atoi(buffer);


#include <stdio.h>

int main() {
    FILE *fp;
    int id;
    char firstname[50];
    char lastname[50];
    
    // Open the file in read mode ("r")
    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }
    
    // Read data in a loop, checking the return value
    // "%d,%49[^,],%49[^\\n]\\n" format:
    // %d     -> read an integer
    // ,      -> match a literal comma
    // %49[^,] -> read up to 49 characters that are NOT commas
    // %49[^\\n] -> read up to 49 characters that are NOT newlines
    // \\n    -> consume the newline character at the end of the line
    while (fscanf(fp, "%d,%49[^,],%49[^\\n]%*c", &id, firstname, lastname) == 3) {
        printf("ID: %d, First Name: %s, Last Name: %s\n", id, firstname, lastname);
    }

    // Check if the loop terminated due to end-of-file or a reading error
    if (!feof(fp)) {
         fprintf(stderr, "Error reading data or format mismatch.\n");
    }
    
    fclose(fp); // Close the file
    return 0;
}





#include <stdio.h>
#include <string.h>

int main() {
    FILE *fp;
    char line[256]; // Buffer to hold one line
    char *token;

    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }

    // Read each line using fgets
    while (fgets(line, sizeof(line), fp)) {
        // Use strtok to parse the line using a comma as a delimiter
        token = strtok(line, ",");
        while (token != NULL) {
            // Process each token (field)
            printf("Field: %s\n", token);
            // Get the next token
            token = strtok(NULL, ",");
        }
    }

    fclose(fp);
    return 0;
}



now I want to convert to csv lines

make a funtion to convert:

I need some metadata from the header that I can use in the new file


added these to the class:

   char[256] last_loaded_gm_filename;   
   int last_loaded_gm_version;
   int last_loaded_gm_last_frame;

set them in load


I have it done

version 0 oldest
version 1 with header, data still 1 val per line
version 2 with header and data 4 vals per line

what else do I want to put in there?
start time, last frame, duration
player info


I also want to make sure I do not overwrite any values in the header
how about, read everything from header, change, write
this is probably not needed, I will rarely resave one of these

If there is a timestamp, do not overwrite

TIMESTAMP_START:
MAX_FRAME:
LEVEL_NUM: 

done




now the hard part:

PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:


I also want to make all player active things the same (new version)

I just found there might not be an active game move in a gm file...?



I was playing with the gdt thing in demorecord to iterate all demo levels

just the act of loading them triggered the resave


fixed that...

I just looked at all the ones in the demo folder and they are all ok

what is going on?


am i looking at client only ones?

I don't think so, it has player 0

maybe it just has new style ones...yes...


2026-01-05 07:13:44
I am running out of time for now:

What I really want to do is convert all to the new format: version 2, with blackjack and hookers....

I want to be sure everything will go smoothly though

then run it on all in the savegame folder

I still want to keep the old read stuff around

I should make it so that whenever one is read,
if it is the old version, convert it to the new version
with a different filename?

or rename the old to .old

then once I have them all in the new format, get back to searching for players sessions within the gm



2026-01-05 12:02:15

do this one task...

make it so that loading gm will save in new format

do a few till you are sure it is working

copy an old one from demo


I think I got it....
should I just run it and let it overwrite

2026-01-05 12:54:46

done..

now all levels should be new format...

make it so that any old ones loaded will get redone...

done...
all demos are now version 2
anytime version 1 or earlier is loaded, it will be resaved as v2


2026-01-05 13:25:08

now back to looking for players in gm's

while testing, patch it in load

this might be more complicated than I thought

I could have many players and even overlapping ones
a thorough method would be by player
player 0 


wait, how about find all player_actives


I really want to be able to dowlod from server again...why is it broken?

I think I need to fix the gm scrape to work with sqlite

remove the old sessions_scrape from cron...












SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172255' AND dt_start<'20260104-174355')  OR    (dt_end  >'20260104-172255' AND dt_end  <'20260104-174355');

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172519' AND dt_start<'20260104-174358')  OR    (dt_end  >'20260104-172519' AND dt_end  <'20260104-174358');


Session id:3   -   start:20260104-181242   -   end:20260104-185051   -


SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181242' AND dt_start<'20260104-185051')  OR    (dt_end  >'20260104-181242' AND dt_end  <'20260104-185051')
Session id:4   -   start:20260104-181249   -   end:20260104-185052   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181249' AND dt_start<'20260104-185052')  OR    (dt_end  >'20260104-181249' AND dt_end  <'20260104-185052')
Session id:5   -   start:20260104-185146   -   end:20260104-185147   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-185146' AND dt_start<'20260104-185147')  OR    (dt_end  >'20260104-185146' AND dt_end  <'20260104-185147')
Session id:6   -   start:20260105-072136   -   end:20260105-072146   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-072136' AND dt_start<'20260105-072146')  OR    (dt_end  >'20260105-072136' AND dt_end  <'20260105-072146')
Session id:7   -   start:20260105-103756   -   end:20260105-104026   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103756' AND dt_start<'20260105-104026')  OR    (dt_end  >'20260105-103756' AND dt_end  <'20260105-104026')
Session id:8   -   start:20260105-103806   -   end:20260105-104015   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103806' AND dt_start<'20260105-104015')  OR    (dt_end  >'20260105-103806' AND dt_end  <'20260105-104015')
Session id:9   -   start:20260105-104042   -   end:20260105-104105   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104042' AND dt_start<'20260105-104105')  OR    (dt_end  >'20260105-104042' AND dt_end  <'20260105-104105')
Session id:10   -   start:20260105-104048   -   end:20260105-104103   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104048' AND dt_start<'20260105-104103')  OR    (dt_end  >'20260105-104048' AND dt_end  <'20260105-104103')
Session id:11   -   start:20260105-111037   -   end:20260105-111738   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111037' AND dt_start<'20260105-111738')  OR    (dt_end  >'20260105-111037' AND dt_end  <'20260105-111738')
Session id:12   -   start:20260105-111135   -   end:20260105-111418   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111135' AND dt_start<'20260105-111418')  OR    (dt_end  >'20260105-111135' AND dt_end  <'20260105-111418')  m@o3000:~/dev/purple_martians/scrape$

SELECT * FROM myTable WHERE myColumn BETWEEN '2023-01-01' AND '2023-02-01';



delete all on server and start again...

get all php from web


2026-01-05 15:22:40
done


-----------------------------
pm still segfault when client joins, but only when run as service
---------------------------------




Session log scrape: 20260105-221501

Session id:1   -   start:20260105-151441   -   end:   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'')  OR    (dt_end  >'20260105-151441' AND dt_end  <'')
Session log scrape: 20260105-221601

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221701

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221801

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221901

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-222001

I only have 2 sessions

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')  m@o3000:~/dev/purple_martians/scrape$
                                                               2026-01-05 15:15:27

sqlite> select * from gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite> select * from gm;


20260105-151541

2026-01-05 15:15:27
2026-01-05 15:15:41
20260105-151508


there it is!!!

save gm in a better date format

      // convert the datetimes to something mysql likes
//      $dt_end   = $dt_end->  format('Y-m-d H:i:s');
  //    $dt_start = $dt_start->format('Y-m-d H:i:s');


      // convert the datetimes to something sqlite likes
      $dt_end   = $dt_end->  format('Ymd His');
      $dt_start = $dt_start->format('Ymd His');



sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite>



1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite> SELECT * FROM gm_sessions;
sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite>

forgot the goddamn dash...

now it all works!!!


I can make gm's and see them soon on server...



2026-01-06 12:44:54


I was having some big ideas:


On the topic of parsing gm files and getting player info,
I was planning on embedding this in the header.

I am rethinking that...

Maybe I could just keep it all in the database.

CREATE TABLE player

could be linked to gm and session

how would all these foreign keys work?

session starts and is assigned UUID
player is created and linked to same UUID

or...

whenever a game is started:
player is created with UUID

nah...


lets just do the 

3 tables:
session
gm
player


all are linked, but how?

1 session to 1 player
1 session to many gm

1 gm to many players
1 gm to many sessions

1 session to 1 pleyer


how about each instance of purplemartians has its own UUID?
when the program is first run and the config file is created from scratch
create a UUID, save it in the config and never change it

Then when a client joins he will send the UUID

The server will create a pleyer with that UUID, and other info.
later if that UUID instance changed other stuff about them that can be updated


this is getting complicated, maybe overly complicated...
what will I gain from doing this
is there a simpler way?


I want to link players to save game files
player names are already embedded in the save game files

to start with I could make a table with just those three things:

name
color
number

whenever I read a gm file...or enter it in the gm table
make sure it has a unique id...already done

then look for players in the file and add them if they do not exist and link them to 

I think I can do this without any UUID's for now

also I want to do this in the game, not in a scrape script



2026-01-06 13:12:43

what to do to make this happen?

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id             INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'gm' Created Successfully\n");


I already have this: (duh)

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               ip                VARCHAR(255), \
               port              INT,  \
               hostname          VARCHAR(255),  \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");


remove the shit about ip, port, hostanme...leave that in sessions (which will have a 1 to 1 link with players)


do it!!!

OK this is what I have...

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");

next: remove any scrape and link things that I have in cron in the server, I am going to do this all in the game...

next, where am I going to do the in the game?

how about when reading or saving demo file?

eventually it will be when saving only, but for testing do it when reading...


void mwGameMoves::find_player_info()
{
   printf("find_player_info()\n");
   // looks in the loaded gm file and find all player active and inactive moves

   int am_count = 0;
   int im_count = 0;

//   int par[10][10] = { 0 };


   // first count active and inactive game moves
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG) am_count++;
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE) im_count++;
   }
   printf("player active/inactive moves: %d %d\n", am_count, im_count);





//      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)


}




the first thing I want to do is:

make sure there is an entry for this in gm

how can I tell if it is unique?
I don't really want to rely on filename...





I thought about it some more:

when creating generate a UUID and stick it in the header


when saving, does UUID already exist?


have a gm class or struct in my game


UUID is a member
same as filenname etc..


when loading, stick it in there and set stuff from file

when saving...


i have so many different thing I want to keep track of related to the game_moves array


have methods to:
clear
start



I already have that as game moves array class

just make that work:


have a flag to tell the status of the current array:

int status;
0 - clear
1 - game in progress
2 - client data only
3 - loaded from demo file


right now I have:
entry_pos
- indicates where next gm entry will go
- is also the size of the gm array
- used in demo mode to mark last entry

current_pos
used only when playing back in demo mode


I want to have more data:
level number
UUID

make some functions like

start new file
erases all
sets level
sets status
generates UUID

when loading from file the UUID

remind me again why I need UUID at all...

what am i trying to do here?


why can't i just use regular autoinrementing

I want to assign an ID to the gm file at creation that will never change...
I will enter it in the database, using that as the primary key
if the database gets lost later I will always have that id (if that happens...???)
what will I do with it?

link it to a session (which will also have a UUID)
this will need a separate table

link it to players







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values

instead of UUID just use auto


can I just fake it and use my own pseudo UUID



I am getting bogged down here....why is this so hard?



I think I want UUID so I can assign something at creation that will never change
why do I want that?
so I can detect duplicates?
so I persistantly link to other things?

so I can add them to a database table with proper links preserved
so I can update filepath location if it changes

I think I am just going to use a random 32 or 64 bit number

32bit 50% chance of collision after        77,000
64bit 50% chance of collision after 5,100,000,000

and even if I had a collision, what would that effect?



uint64_t generate_random_u64(void) {
    // Combine two 32-bit random numbers (assuming RAND_MAX is at least 32767)
    // The cast to uint64_t is crucial to ensure correct shifting
    uint64_t r1 = rand();
    uint64_t r2 = rand();

    // Shift the first random number to the upper 32 bits and combine with the second
    // This provides a full 64 bits of potential randomness
    return (r1 << 32) | r2;
}

int main(void) {
    // Seed the random number generator once using the current time
    // For better seeding, one could use a mix of time and other factors
    srand(time(NULL));

    uint64_t random_int = generate_random_u64();
    printf("Random 64-bit integer: %llu\n", random_int);

    return 0;



I'm going with this...







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values




added to class


   uint64_t HEADER_muid;
   int      HEADER_version;
   char*    HEADER_create_timestamp;
   char*    HEADER_modify_timestamp;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;



now implement this in save:

   fprintf(filepntr, "%s", "PMSAVEGAME\n");

   fprintf(filepntr,       "VERSION:%d\n",              HEADER_version);
   fprintf(filepntr,       "CREATE_TIMESTAMP:%s\n",     HEADER_create_timestamp);
   fprintf(filepntr,       "MODIFY_TIMESTAMP:%s\n",     mMiscFnx.get_timestamp());
   fprintf(filepntr,       "LEVEL:%d\n",                HEADER_level);
   fprintf(filepntr,       "LAST_FRAME:%d\n",           HEADER_last_frame);
   fprintf(filepntr,       "GAMEMOVE_NUM_ENTRIES:%d\n", HEADER_num_entries);
   fprintf(filepntr, "%s", "GAMEMOVE_DATA_START:\n");


now load:

first of all bump version....


save in version 3 load in 2




2026-01-07 04:09:08

when reading,
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000


if level not set, find it and set it



before loading, call initialize
in initialize set all header values to 0's
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000



2026-01-07 04:46:29

   // header variables
   string   HEADER_create_timestamp;
   string   HEADER_modify_timestamp;
   uint64_t HEADER_muid;
   int      HEADER_version;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;


void mwGameMoves::initialize(void)
{
   memset(arr, 0, sizeof arr);
   entry_pos = 0;
   current_pos = 0;

   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;

   sprintf(last_loaded_gm_filename, "%s", "");

}


I think I want to change how I get stuff from header...

this is what I have now:

   void header_key_find_int(char* line, const char* key, int &val);
   void header_key_find_string(char* line, const char* key, string &val);

and I need to extend it to work with uint_64  


what do I want to do:

pass it a line (as string)

it will look for keys and set varaiable

if it finds the end it will return 0;

bool parse_header_line(string line);


2026-01-07 06:48:47

I think I have it done

load level works for old and new versions

saves as version 3


make some tests when saving about missing header values..done


now I need to implement the status...

status clear ..done

   // 2 - demo loaded

   // 1 - level started


make a function for this:

sets status
creates muid
sets created_timesatmp
sets level

void new_level


void mwGameMoves::new_level()
{
   initialize();   
   HEADER_create_timestamp = mMiscFnx.get_timestamp();
   HEADER_muid = mMiscFnx.generate_random_u64();
   HEADER_level = mLevel.play_level;
   status = 1;   
}



where to call it?


int mwLoop::load_and_setup_level(int level, int type)
{
   if (!mLevel.load_level(level, 0, 0)) return 0;
   else
   {
      if (type != 4) mGameMoves.new_level(); // do not reset game moves in demo mode


now in save, do different thing based on status...
done....


I think I might actually be getting somewhere....


should I enter it in the database at this point?

what does my table look like?


   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               id             INTEGER PRIMARY KEY, \
               filename       VARCHAR(255), \
               dt_start       DATETIME, \
               dt_end         DATETIME, \
               duration       INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");


I was using start and end to figure out what session it might belong to...
I can still keep that


I should add all the other stuff


I'll need a function is the game to iterate all the gm's 
- check that they are in the database
- make sure the filepath is up to date



I think it will be driven by the game

at the core it will have a function to do one gm


2026-01-07 18:24:07


   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;


I am going to start over with the table....

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               muid           INTEGER PRIMARY KEY, \
               filename       TEXT, \
               dt_start       TEXT, \
               dt_end         TEXT, \
               duration       INT,  \
               level          INT,  \               
               num_entries    INT ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");




now a fucntion to add to the database

void add_gm_to_db(const char* file)
{
   // first load_gm, this will check the data
   
   // check if muid already exists
   
   if yes update values
   in no insert values
}



2026-01-08 03:23:04

why do I feel like I am getting bogged down?

is is because my plan is not fully formed?

just pick on small task

take timestamp and last frame and trun it into start, end, and duration

where can I test this...

load





do something about check for old gma right now it is called on everysave
options:
-call only on version 0
- inline check with every row written 
done.. did inline
I should just leave this forever

removed old method, saving here


void mwGameMoves::convert_active_gamemoves()
{
   // coverts all old style gm to new
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] & PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG)
      {
         int t  = arr[x][1];
         int d1 = arr[x][2];
         int d2 = arr[x][3];

         int p, c;
         char name[16];

         mMiscFnx.gma_to_val(t, d1, d2, p, c, name);

         printf("found new gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, t, d1, d2);

      }
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
      {

         int p = arr[x][2];
         int c = arr[x][3];

         int type, d1, d2;
         char name[16];
         sprintf(name, "Player %d", p);

         mMiscFnx.val_to_gma(type, d1, d2, p, c, name);

         printf("found old gma -- p:%d c:%d -- new: name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);

         arr[x][1] = type;
         arr[x][2] = d1;
         arr[x][3] = d2;
      }
   }
}
*/





2026-01-08 03:57:36

fixed some bugs, now I am actually saving and loading all header values


what if I replaced my 64 bit muid with something else...

options:


10 char string [A-Z] 
10^26 = 1.0 e26
2^64 = 1.8 e19

94274532147610
52544629916126
105437152168571
62015032799880
89777701388341
126989298070705
15 digits?

108821586384139
100759932765462
24167781002446
132229158166728
24730421704635
31181462578973
'GLWITOJHHGWSWRIO'
'VBQDBOWGANYPRZKQ'
'XANMHOPTNCLVIZUA'
'YDWNQAPQXVSVPJML'
'GMOMXLGGAPWYCQUQ'
'CPUHSVSJDHNVNUCZ'

16^26 = 2 e31


do it, replace uint64 with char[16]


done...


this is some date manip from sessions

#include <iomanip>

   // create at tm struct from start date
   struct tm timestart = {0};
   std::stringstream ss(dt_start);
   ss >> std::get_time(&timestart, "%Y%m%d-%H%M%S");
   if (ss.fail()) printf("Error parsing time\n");
   time_t st = mktime(&timestart);

   char ts[20];
   strftime(ts, sizeof(ts), "%Y%m%d-%H%M%S", &timestart);

   // create a tm struct from now
   time_t now = time(NULL);
   struct tm *timenow;
   timenow = localtime(&now);
   char dt_end[20];
   strftime(dt_end, sizeof(dt_end), "%Y%m%d-%H%M%S", timenow);

   int duration = difftime(now, st);









I have some bugs...

muid??

Loading gm: 'C:\pm\lv2'
----'YGSHQVDDEDPLKMFD'
Last frame not set from header, setting to:3793
Level number not set from header, setting to:2
HEADER_create_timestamp was not set. Setting to '20260101-000000'
HEADER_muid was not set. Setting to ''
Loaded old version of file: C:\pm\lv2  --  resaving as new version
Resave triggered, resaving:C:\pm\lv2
Filename            :C:\pm\lv2
MUID                :
VERSION             :0
CREATE_TIMESTAMP    :20260101-000000
MODIFY_TIMESTAMP    :
LEVEL               :2
LAST_FRAME          :3793
GAMEMOVE_NUM_ENTRIES:523

Saving gm:C:\pm\lv2
HEADER_muid was not set. Setting to ''

C:\pm>



string mwMiscFnx::generate_muid()
{

does not work (only works the first time)
//   string tmp;
//   for (int i=0; i<16; i++)
//   {
//     std::random_device seed;
//     std::mt19937 gen{seed()}; // seed the generator
//     std::uniform_int_distribution<> dist{65, 90}; // set min and max
//     tmp[i] = dist(gen);
//   }
////   tmp[16] = 0;
//   return tmp;



works
   char t[17];
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     t[i] = dist(gen);
   }
   t[16] = 0;
   string tmp(t);
   return tmp;


works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp += (char)dist(gen);
   }
   return tmp;

works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp.push_back((char)dist(gen));
   }
   return tmp;





ok now i think it is working


i can call gdt to iterate all levels...


i want to time it:


load only:
gdt took 0.283832 seconds to process 96 files
insert:
gdt took 1.495548 seconds to process 96 files
update:
gdt took 0.621905 seconds to process 96 files




2026-01-08 07:12:53

now what?

make update update the filenames

what is the point, just erase and get them all again

i could make update just overwrite everything...

not sure what that would gain me...

when am i planning on doing this?

- when I load a gm
- when I save a gm
that will take care of any new ones


what else do i want to do?

I need to link them to sessions

when adding to db,

check if we are in server mode

then look for active sessions

i will have the row id in player struct

then make a link

old table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");

new table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_muid           TEXT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");


2026-01-08 07:22:52

fist of all:
modify table..done
call from save...done

check if server

      if (mNetgame.ima_server)
      {
         for (int p=1; p<8; p++)
            if (mPlayer.loc[p].session_id)
            {
               sprintf(sql, "INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('%s', %d)", HEADER_muid.c_str(), mPlayer.loc[p].session_id);
               printf("sql:%s\n", sql);
               mSql.execute_sql(sql);
            }
      }

now to test....

I should really do a backup...


2026-01-08 07:32:13

got to go...


















































































































 




































































































































































































































































































































































































               
               
               




























