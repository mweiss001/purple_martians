20251228

I am back baby!

But just for a few quick things...


See if I remeber how to work with this project

I think the first thing I will do is see if I can commit to github


open Git Gui

rescan
stage
sing off
commit
push

I have password, but what is name? mweiss001

done...

now can I open the project on m36 and recompile

a complete rebuild is 5s! suck that qt creator!

now what?

go through setting up a linux dev machine...

C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20230824.txt

after a bunch of troubleshooting, found I needed to add 'sudo apt install libpulse-dev'

made a new one:
C:\pm\pm_docs\dev setup\linux\ubuntu_dev_setup_20251228.txt

the server is working!!!
and it takes 7W!!

C:\pm\pm_docs\HOWTO\Remote Headless Server.txt


now what?

I want to do something about logging.

What am I logging? Why so much?

there is more...how to setup the webserver

made a guide:

C:\pm\pm_docs\HOWTO\Setup Apache on headless server.txt

I wish I had a good doc that described what logging is happening.

make one now...

LOG_NET_SESSION

what do I really want?

I want to know when a player joined and how long they played for.
I want to keep this info in a database table for display

I also want to keep demo files for all the sessions...

I have something like that already....

mNetGameSessionLog

m@o3000:~/dev/purple_martians/logs$ ll
total 17608
drwxr-xr-x  5 m m    4096 Dec 28 21:18  ./
drwxrwxrwx 17 m m    4096 Dec 28 20:13  ../
-rw-rw-r--  1 m m    5740 Dec 28 20:13 '20251228-201303-[58][o3000].txt'
-rw-rw-r--  1 m m 7917793 Dec 28 20:24 '20251228-202406-[1][o3000].txt'
-rw-rw-r--  1 m m  338773 Dec 28 20:24 '20251228-202433-[2][o3000].txt'
-rw-rw-r--  1 m m  182515 Dec 28 20:25 '20251228-202508-[1][o3000].txt'
-rw-rw-r--  1 m m 3499306 Dec 28 20:29 '20251228-202946-[2][o3000].txt'
-rw-rw-r--  1 m m  164623 Dec 28 20:29 '20251228-202959-[1][o3000].txt'
-rw-rw-r--  1 m m 3313788 Dec 28 20:34 '20251228-203420-[20][o3000].txt'
-rw-rw-r--  1 m m 1786876 Dec 28 20:45 '20251228-204501-[1][o3000].txt'
-rw-rw-r--  1 m m  142306 Dec 28 21:13 '20251228-211355-[1][o3000].txt'
-rw-rw-r--  1 m m  152580 Dec 28 21:16 '20251228-211653-[1][o3000].txt'
-rw-rw-r--  1 m m  457191 Dec 28 21:18 '20251228-211800-[1][o3000].txt'
drwxr-xr-x  2 m m   24576 Dec 28 21:18  net/
drwxr-xr-x  2 m m    4096 Dec 28 21:17  session/
drwxr-xr-x  2 m m    4096 Dec 28 21:18  status/
m@o3000:~/dev/purple_martians/logs$ cd session/
m@o3000:~/dev/purple_martians/logs/session$ ll
total 28
drwxr-xr-x 2 m m 4096 Dec 28 21:17 ./
drwxr-xr-x 5 m m 4096 Dec 28 21:18 ../
-rw-rw-r-- 1 m m  504 Dec 28 21:17 .txt
-rw-rw-r-- 1 m m  549 Dec 28 20:24 20251228-201352-192.168.1.36-59650.txt
-rw-rw-r-- 1 m m  553 Dec 28 20:34 20251228-202459-192.168.1.36-62843.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:16 20251228-211638-192.168.1.36-64444.txt
-rw-rw-r-- 1 m m  538 Dec 28 21:17 20251228-211716-192.168.1.36-62627.txt
m@o3000:~/dev/purple_martians/logs/session$ cat 20251228-211716-192.168.1.36-62627.txt
dt_start:20251228-211716
duration:32
ip:192.168.1.36
port:62627
hostname:m36
endreason:comm_loss
cdat_rx:0
player_num:1
next_levels:0
exits_activated:0
respawns:0
shots_fired:0
enemy_hits:0
player_hits:0
self_hits:0
purple_coins:0
tx_bytes_total:1199179
tx_bytes_avg_per_sec:36349
tx_bytes_max_per_frame:3650
rx_bytes_total:768772
rx_bytes_avg_per_sec:23303
rx_bytes_max_per_frame:1695
tx_packets_total:1768
tx_packets_avg_per_sec:53
tx_packets_max_per_frame:4
rx_packets_total:6400
rx_packets_avg_per_sec:193
rx_packets_max_per_frame:14
m@o3000:~/dev/purple_martians/logs/session$

and I think I have a cron job to scrape and add these to a database...

so how do I enable, disable this...

---------------------------------------------------------
Forced Settings on headless server
---------------------------------------------------------
void mwNetgame::headless_server_setup(void)
{
   mMain.classic_mode = 0;
   mLevel.unlock_all_levels();

   // ensure that only the basic LOG_NET is active and is printing to console as well as saving to file
   mLog.clear_all_log_actions();
   mLog.set_log_type_action(LOG_NET, LOG_ACTION_PRINT | LOG_ACTION_LOG);

   // make the hidden server player color taan (6)
   mPlayer.syn[0].color = 6;

   // always have session logging on
   mLog.set_log_type_action(LOG_NET_session, LOG_ACTION_LOG);

//   // add these for troubleshooting
//   mLog.set_log_type_action(LOG_NET_join_details, LOG_ACTION_PRINT | LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stak, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_NET_stdf, LOG_ACTION_LOG);
//   mLog.set_log_type_action(LOG_OTH_level_done, LOG_ACTION_PRINT);

   mLog.autosave_log_on_level_done = 1;
   mLog.autosave_log_on_level_quit = 1;
   mLog.autosave_log_on_program_exit = 1;

   // make sure we are always saving games
   mGameMoves.autosave_game_on_level_done = 1;

   mGameMoves.server_send_files_to_clients = 1;

   mConfig.save_config(0);

I think I have everything I need already

I want to keep the basic logging on 'LOG_NET'
but I should have a cleanup script to erase older ones to keep from using too much disk space

the LOG_SESSIONS ones I should just insert into the database and remove

the savegames I want to have a way to download them from the webserver

look up the scrape functions

I think they are PHP



---------------------------------------------------------
Setup a cron job to scrape session logs and add to database
---------------------------------------------------------

setup a cron job to scrape logs and add to database

crontab -e

*/1 * * * * php /home/m/dev/purple_martians/session_scrape.php >> /home/m/dev/purple_martians/session_scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape             >> /home/m/dev/purple_martians/scrape_cronoutput.txt 2>&1
*/1 * * * *     /home/m/dev/purple_martians/scrape_status      >> /home/m/dev/purple_martians/scrape_status_cronoutput.txt 2>&1


this is an amazing one line script to change files ending in *.txt.bak to end in *.txt
for f in *.txt.bak; do mv -- "$f" "${f%.txt.bak}.txt"; done


I want to make a new folder in docs

server

like dev setup




2025-12-28 19:16:48


What do I have so far?

The server is making session logs and saving them to disk
cron is calling php scrape and adding them to database
I sometimes get some php errors that I am trying to figure out
can I make the php script output some more useful data
fixed a bug where a bad date would kill the whole batch scrape

   // test if we can create a valid date time
   if (!DateTime::createFromFormat('Ymd-His', $var['dt_start']))
   {
      echo "Error parsing dates\n";
      foreach ($var as $x => $y) echo "$x $y\n";
      return;
   }

2025-12-28 21:30:05

OK now what?

what do I do with the data in the database


I'm looking at the sessions.php in the web page


   $srvrname = "localhost";
   $database = "session_db";
   $username = "php_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "timestamp,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";


   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM session_tb";


I should change that to:




   $srvrname = "localhost";
   $database = "pm";
   $username = "pmdb_ro";
   $password = "readonly";

   $col_list = array("Start Time", "IP address", "port", "hostname", "Session End Reason", "duration",            "cdat");
   $row_list =      "dt_start,     ip,           port,   hostname,   endreason,            SEC_TO_TIME(duration), cdat_rx";

   $conn = mysqli_connect($srvrname, $username, $password, $database);

   $sql = "SELECT $row_list FROM sessions";



CREATE TABLE sessions (
  id                INT AUTO_INCREMENT,
  filename          VARCHAR(255),
  dt_start          DATETIME,
  dt_end            DATETIME,
  duration          INT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  endreason         VARCHAR(255),
  cdat_rx           INT,
  player_num        INT,
  next_levels       INT,
  exits_activated   INT,
  respawns          INT,
  shots_fired       INT,
  enemy_hits        INT,
  player_hits       INT,
  self_hits         INT,
  purple_coins      INT,
  tx_bytes_total            INT,
  tx_bytes_avg_per_sec      INT,
  tx_bytes_max_per_frame    INT,
  rx_bytes_total            INT,
  rx_bytes_avg_per_sec      INT,
  rx_bytes_max_per_frame    INT,
  tx_packets_total          INT,
  tx_packets_avg_per_sec    INT,
  tx_packets_max_per_frame  INT,
  rx_packets_total          INT,
  rx_packets_avg_per_sec    INT,
  rx_packets_max_per_frame  INT,
  PRIMARY KEY(id)
);

where do I want to do this?

on my live server

do I have sessions?

omfg it works!!!

2025-12-28 22:01:09

well I am making some progress

fix the php scripts..done..now deploy to live server
main and player work
bandwidth crashes
all says no dats

2025-12-28 23:11:21
finished the server install notes


2025-12-29 08:07:46

ran a 2 player fakekey game on new server for 7 hours
almost 100K cdats per client

must have generated a bunch of new logs

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

# fix permissions
chmod 777 ./op
sudo ./op

# compile and install libnet
cd libnet
make clean
make lib
sudo make install

# build puple martians
cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/docs/* /var/www/html

sudo systemctl start pm

2025-12-29 15:21:28


I think I have logging documented much better and able to disable status and net




2025-12-29 17:19:23

working on

download played game from server

<a href="/bs_notes.txt" download="poooop">
    <button>Download Report</button>
</a>


pscp -r -pw zaiden c:\pm\docs\* m@192.168.1.146:tmp

On the server, copy to the final place
sudo cp -r ~/tmp/* /var/www/html




2025-12-29 18:30:09


what do I want for sessions?

I want a nicer table


For a session row, I want to be able to downaload the savegame file.

There might be multiple...


maybe I could have it take me to another page with download links





-----------------------------------------------------------------------------------------------------------------------------------------

I have a really cool thing I want to try....

Method 1: Using PHP and a Query String (Full Page Reload)
This method uses a query string in the URL to determine which content to display.
When a link is clicked, the page reloads, and the PHP script processes the request and outputs the appropriate content. 
index.php
php

<?php
// Function to sanitize and get the 'page' parameter from the URL
function get_page_content($page) {
    switch ($page) {
        case 'about':
            return 'include/about.php';
        case 'contact':
            return 'include/contact.php';
        case 'home':
        default:
            return 'include/home.php';
    }
}

// Get the page parameter, default to 'home' if not set
$page = isset($_GET['page']) ? $_GET['page'] : 'home';
$content_file = get_page_content($page);
?>

<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Content</title>
</head>
<body>

<nav>
    <!-- Links with query strings -->
    <a href="index.php?page=home">Home</a> |
    <a href="index.php?page=about">About</a> |
    <a href="index.php?page=contact">Contact</a>
</nav>

<div id="content-container">
    <?php
    // Include the content file
    if (file_exists($content_file)) {
        include($content_file);
    } else {
        echo "<p>Content not found.</p>";
    }
    ?>
</div>

</body>
</html>

Include Files (create a folder named include): 

    include/home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
    include/about.php: <h2>About Page</h2><p>This is the about us information.</p>
    include/contact.php: <h2>Contact Page</h2><p>Contact us here.</p>
    
    
    
----------------------------------------------------------------------------------------------------------------------------------------------------

somehow that last example got garbled...

try this:

make dir /test/test23/index.php

and have all three files there
home.php: <h2>Home Page</h2><p>Welcome to the home page!</p>
about.php: <h2>About Page</h2><p>This is the about us information.</p>
contact.php: <h2>Contact Page</h2><p>Contact us here.</p>

<!DOCTYPE html>
<html>
<body>

<h1>Dynamic Content Example</h1>

<!-- Navigation Links -->
<a href="index.php?page=home">Home</a> | 
<a href="index.php?page=about">About</a> | 
<a href="index.php?page=contact">Contact</a>

<div id="content-area">
    <?php
    // Check if the 'page' parameter is set in the URL
    if (isset($_GET['page'])) {
        $page = $_GET['page'];

        // Use a whitelist to prevent directory traversal vulnerabilities
        $allowed_pages = ['home', 'about', 'contact'];

        if (in_array($page, $allowed_pages)) {
            // Include the corresponding PHP file
            include($page . '.php');
        } else {
            echo "<p>Content not found.</p>";
        }
    } else {
        // Default content if no parameter is set
        include('home.php');
    }
    ?>
</div>

</body>
</html>


works!!!




---------------------------------------------------------------------------------------------------------------------------------------------------
next


test24

cannot get this to work


index.html


<!DOCTYPE html>
<html>
<head>
<script src="code.jquery.com"></script>
</head>
<body>

<h1>AJAX Dynamic Content Example</h1>

<!-- Links with a class to attach an event listener -->
<a href="#" class="nav-link" data-page="home">Home</a> | 
<a href="#" class="nav-link" data-page="about">About</a> | 
<a href="#" class="nav-link" data-page="contact">Contact</a>

<div id="content-area">
    <!-- Content will be loaded here dynamically -->
    <p>Select a link to load content.</p>
</div>

<script>
$(document).ready(function(){
    $('.nav-link').on('click', function(e){
        e.preventDefault(); // Prevent the default link behavior (page reload)
        var page = $(this).data('page'); // Get the page name from the data attribute

        // Make an AJAX request to the PHP endpoint
        $('#content-area').load('\test\test24\content.php?page=' + page);
    });
});
</script>

</body>
</html>

content.php

<?php
if (isset($_GET['page'])) {
    $page = $_GET['page'];
    $allowed_pages = ['home', 'about', 'contact'];

    if (in_array($page, $allowed_pages)) {
        // Return only the content snippet without a full HTML structure
        include($page . '.php');
    } else {
        echo "<p>Content not found.</p>";
    }
}
?>



---------------------------------------------------------------------------------------------------------------------------------------------------



anyway, i thoink i might be on to something here


I could have one main html page

load different sections

like different types of tables

like downloads links based on selected session


2025-12-29 20:12:59



2025-12-30 05:36:25

when I click on a session link in the table

I want to to dyanmically load a section that show downloads for that time range



some smaller subtasks:
- can I download from another dir


datatables
get new version?
datatable.js on old site is version 3.7.0
DataTables 2.3.6

revisited datatable and updated notes in Datatable.txt


Now I really want to figure out how to call one php script from another

I want to have one sessions page the loads different tables

i want to have a separate file that fills that section

or maybe I will do something else first:
do something with a click on the the table 

made each cell an <a href tag

now how to do something with that


make a new section that is loaded from another php page 
fill.php


2025-12-30 07:51:32


I am getting somewhere !!!

my link in the table:

echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>";
               
reloads the current page with the 'data' parameter set in the url

then I include

include('fill.php');

<?php

   // Check if the 'data' parameter is set in the URL
   if (isset($_GET['data']))
   {
      $data = $_GET['data'];
      echo "<hr>" . $data . "<hr>";
   }
   else
   {
       // Default content if no parameter is set
       echo "<hr>Default<hr>";
   }
?>

2025-12-30 07:54:44

next:

make the links only in the date column

            echo "<tr>";
            foreach($row as $col => $val)
            {
               if ($col == "dt_start") echo "<td><a href=\"sessions.php?data=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";
            }
            echo "</tr>";


2025-12-30 08:04:55

next:

do something in fill...


find gms to download


I think the way to do this is to have another script run in cron that adds the gm files to a database

then I oould just look that up here

table: gm_files

filename
timestamp (get from filename)
level (get from filename)

in the database make a way of knowing what sessions a gm belongs to

this is not a one to one either way:

sessions can have multiple gm's (when session is longer than one level)

gm's can have muliple sessions (when more than one client)

I could have a 3rd table to link them

session_gm_links
session_id
gm_id


what are the rules for populating this table

for each closed session (with start and end)

find gm's that date range fits into

make a link from session to gm

if I have gm's that do not match??

figure that out later

right now create these tables and test

I have the gm table done and the php import script

now how am I going to create the links?

first of all create the table


Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

mysql> DESCRIBE gm;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | int          | NO   | PRI | NULL    | auto_increment |
| filename  | varchar(255) | YES  |     | NULL    |                |
| timestamp | datetime     | YES  |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

mysql> DESCRIBE gm_sessions;
+------------+------+------+-----+---------+----------------+
| Field      | Type | Null | Key | Default | Extra          |
+------------+------+------+-----+---------+----------------+
| id         | int  | NO   | PRI | NULL    | auto_increment |
| gm_id      | int  | YES  |     | NULL    |                |
| session_id | int  | YES  |     | NULL    |                |
+------------+------+------+-----+---------+----------------+
3 rows in set (0.00 sec)

mysql> SELECT * FROM gm;
+----+------------------------------------------------+---------------------+
| id | filename                                       | timestamp           |
+----+------------------------------------------------+---------------------+
|  1 | 20251229-151621-[32]-autosave on level done.gm | 2025-12-29 15:16:21 |
+----+------------------------------------------------+---------------------+
1 row in set (0.00 sec)


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link


2025-12-30 10:04:32
-------------------------------

i could just leave this part for now

I want to work on the part where I make links to downloads

fill.php

I really wish I had the session id here

now I do


2025-12-30 11:42:28

configure appache for downloads

made an alias to map /downloads/  to /home/m/dev/purple_martians/savegame

see apache file


2025-12-30 13:30:30

now I can download from there directly

what next??

-----------------------------------------------------------------------------

do the database thing


Where am I going to create the links? php?

what is the high level algorithm

iterate sessions
each session will have a start and end date

for each session
iterate all the rows in gm

if datetime is between start and end create link

also remove dead link

that could be its own script

make a php file

iterate all sessions





lets thin about think for a minute, high level

gm's are serial, none should ever overlap

sessions are not, there can be mutiple simulatanouesly

so for a session that spans a time range...

you know what else???
I can calculate the start time of a gm!!
I have the end time and the length

is this important, do I need it?...maybe

maybe I should collect more meta data about gm's for the database
start, end,
joins
quits
max players
deaths

2025-12-30 15:00:07

I am getting confused about how to tell if a gm belongs in a session

if I captured the start also....
then if either the start or the end is in the range...

lets draw ascii art diagrams

 [...se1..]
         [...se2..................................]
   [...se2.....................]
[...se4.....................]
[...gm1...][.gm2.][...gm3...][.gm4.][...gm5...]

I think I need gm start...get it...

I have done that..
2025-12-30 16:36:07

now I get start and end in gm database

2025-12-30 16:57:45

now back to link....



for testing...
remove all links,
check for links
show orphan gm
show orphan sessions

2025-12-30 19:10:55

I think I am ready to implement on the web page

when I click on a session make the info page show much more info

2025-12-31 04:31:21

I got quite a lot done yesterday.
made 2 new tables 
gm and gm_sessions
make scripts to scrape and make links
made downloads visible
make a second section of sessions page, loaded from separate script


today I want to:

make the second section way better:
show all info about the selected session
including the list of associated gm files

the list of gm files could have more info about each


is there a way to make web faster?

could I samba the entire www folder and edit direct on windows?
try it, fool! done...

2025-12-31 07:45:24

I have the nice session description done with all data

now onto the list of gm's

done...


I think I want to create some better data..

but maybe first some debug tools

php pages that show
orphan session
orphan gm
all gm

rename fill.php to show_session.php

then make ones for these other things also


2025-12-31 08:33:48
I think I have the core functionality working:

now what?

show info for save game files?

make like a table row with info and a clickable link


should I also save duration in gm?
if I do that where will I stop?
just do that for now

first of all, make sure you don't accidentally overwrite all the work done in www

-------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
-------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

change the gm table, drop and recreate ...done
edit the scrape_gm.php file and edit the db insert .. done
deploy to server

C:\pm>pscp -pw zaiden c:\pm\scrape\* m@192.168.1.146:dev/purple_martians/scrape

they are now in the db with the new column

clean up link_gm.php and test...done

add it to the cron done

add to note in sewrver setup done

thw only issue I could see is that the links are being deleted and recreated every time


2025-12-31 10:35:40

what next?

make the link line look better somehow

could I put it in a table?

make a php script that puts a list of gm's in a table with download links
why? do I think that will look better?

If I can do that, then I can also do that for the main session table

make my own varianle to tell what set of columns are shown 

session_table_column_set



the variables passed when a page is loaded, the query string, is reset when the page is reloaded

I was using this for current session id

I think I want to try a different method

sessions?



<?php
// Start the session
session_start();

// Set session variables
$_SESSION["favcolor"] = "green";
$_SESSION["favanimal"] = "cat";
$_SESSION['count'] = 1;

echo "Session variables 'favcolor', 'favanimal', and 'count' are set.";
echo '<br><a href="page2.php">Go to Page 2</a>';
?>


<?php
// Start the session to access stored data
session_start();

// Access session data
echo "Favorite color is: " . htmlspecialchars($_SESSION["favcolor"]) . ".<br>";
echo "Favorite animal is: " . htmlspecialchars($_SESSION["favanimal"]) . ".<br>";

// Update the counter variable
if(isset($_SESSION['count'])) {
    $_SESSION['count']++;
    echo "You have visited these pages " . htmlspecialchars($_SESSION['count']) . " times in this session.";
}
?>



2025-12-31 11:41:53

I think I got something here...

in main page sessions.php

   session_start();

   // if passed as query string set the session variable
   if (isset($_GET['current_session_id'])) $_SESSION['current_session_id'] = $_GET['current_session_id'];


show_current_sessions reads the sessions varaible

// Check if the 'data' parameter is set in the URL
//if (!isset($_GET['current_session_id'])) echo "<hr>no current session set<hr>";
//else 
//{
//  $current_session_id = $_GET['current_session_id'];

if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];



when clicking on the table link to chande current session, nothing changes, still reloads main page with query

            foreach($row as $col => $val)
            {
               if ($col == "id") echo "<td><a href=\"sessions.php?current_session_id=" . $val . "\">" . $val . "</a></td>"; 
               else echo "<td>" . $val . "</td>";

now bakc to using this for table columns
done and I have killed all the oly files!!!






now lets see if I can make all work...





$t1 = array("id", "Date", "ip" );
$t2 = array("23", "skiddo", "buddday" );
var_dump($t1);
var_dump($t2);
$t3 = array_merge($t1, $t2);
var_dump($t3);

array(3) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
}
array(3) {
  [0]=>
  string(2) "23"
  [1]=>
  string(6) "skiddo"
  [2]=>
  string(7) "buddday"
}
array(6) {
  [0]=>
  string(2) "id"
  [1]=>
  string(4) "Date"
  [2]=>
  string(2) "ip"
  [3]=>
  string(2) "23"
  [4]=>
  string(6) "skiddo"
  [5]=>
  string(7) "buddday"
}



$t1 = "id, Date, ip";
$t2 = "23, skiddo, buddday";
var_dump($t1);
var_dump($t2);
$t3 = $t1 . $t2;
var_dump($t3);

string(12) "id, Date, ip"
string(19) "23, skiddo, buddday"
string(31) "id, Date, ip23, skiddo, buddday"


2025-12-31 13:33:39

I finally have the session table and columns thing figured out

I think I am ready to work on the game moves table

I have a script that make a link...

2025-12-31 14:56:47
I have the table done...

just need to figure out how to filter it
- all
- orphan
- link to session

0 = all
-1 = orphan
anything else is a session id

lets call it gm filter

actually i dont need to save it, just pass it as a parameter

sessions will already have current session id

SELECT gm.id, filename, dt_start, dt_end, duration FROM gm LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id WHERE gm_sessions.session_id=8 


CREATE TEMPORARY TABLE TempFilteredResults AS
SELECT column1, column2, ...
FROM OriginalTable
WHERE condition = 'filter_value'; -- Your filtering condition


this just looks too stupid

Im going to make my own table with balckjack and hookers


<?php session_start(); ?>

   <script src="../assets/js/jquery-3.7.1.slim.min.js"></script>
   <link rel="stylesheet" href="../assets/css/datatables.min.css" />
   <script src="../assets/js/datatables.min.js"></script>

<?php

function show_gm_table($filter)
{
   $col_list = array("id",   2025-12-31 15:21:53 "Filename", "Start Time",   "End Time",             "Duration"  );
   $row_list =       "gm.id,   filename,  dt_start,        dt_end,     SEC_TO_TIME(duration)";



   if ($filter == 0) $sql = "SELECT $row_list FROM gm";

   if ($filter > 0)
   {
      $sql  = "SELECT gm.id, filename, dt_start, dt_end, duration FROM gm ";
      $sql .= "LEFT JOIN gm_sessions ON gm.id = gm_sessions.gm_id ";
      $sql .= "WHERE gm_sessions.session_id=$filter";
   }

   echo "sql: $sql\n";

   echo "<script>$(document).ready( function ()
         {
            $('#myTable2').DataTable(
            {
               layout: {  topStart: { buttons: ['colvis'] }, bottomStart: 'pageLength' },
               colReorder: true,
               columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: [0, 1, 2, 3, 4] } ],
               order: [  [0, 'desc'] ]
            }  );
         } );
         </script> ";


      echo "<table id='myTable2' class='display cell-border compact' style='width:90%'>";
         echo "<thead>";
            echo "<tr>";
               foreach($col_list as $col)
                  echo "<th>$col</th>";
            echo "</tr>";
         echo "</thead align='center'>";
         echo "<tbody>";
            $res = mysqli_query($conn, $sql);
            while ($row = $res->fetch_assoc())
            {
               echo "<tr>";
               foreach($row as $col => $val)
               {
                  if ($col == "filename")
                  {
                     $filename = $val;  
                     $fullpath = "/downloads/$filename";
                     echo "<td><a href=\"$fullpath\" download=\"$filename\">$filename</a></td>";
                  }
                  else echo "<td>" . $val . "</td>";
               }
               echo "</tr>";
            }
         echo "</tbody>";
      echo "</table>";

}
?>


here is a copy before I kill it all



/*
table {
  font-family: Arial, sans-serif;
  border-collapse: collapse; /* Merges borders */
  width: 100%; /* Table takes full width */
  margin-top: 15px; /* Adds space above the table */
}

caption {
  padding: 10px;
  font-weight: bold;
  caption-side: top; /* Positions caption at the top */
}

th, td {
  border: 1px solid #ddd; /* Light border color */
  text-align: left; /* Aligns text to the left */
  padding: 12px; /* Inner spacing */
}

thead th {
  background-color: #4CAF50; /* Green background for headers */
  color: white; /* White text for headers */
}

tbody tr:nth-child(even) {
  background-color: #f2f2f2; /* Gray background for even rows */
}

tbody tr:hover {
  background-color: #ddd; /* Gray background when hovering over a row */
}


2025-12-31 16:49:20

I think I have that tabel looking good


now what?

links at the top of sessions for navigation

links by the sessions table for filters only

// Check if 'current_session_id' is set in the $_SESSION
if(!isset($_SESSION['current_session_id'])) echo "<hr>no current session set<hr>";
else 
{
   $current_session_id = $_SESSION['current_session_id'];

use the gm table for all and orphan...done


2025-12-31 17:47:40

wow this is coming along great...I should do a massive backup...



I have only 5 files:

sessions.php the main one
show_sessions_table.php
show_current_session.php
show_gm_table.php

and one more
show orphaned sessions..




top menu
Sessions Saved Games Debug Server Status Back to Main Menu


2026-01-01 04:48:11

should I just dive in and start on player name?

How much data do I need?
8 char * 8bits = 64bits

can I do it in one game move?

a game move entry is 4 ints
each int is 32bits


right now the most common use is:

0 - frame
1 - type
2 - player num
3 - data

options:

option 1: use multiple game moves
on the same frame as player active have 4 more game moves:

0 - frame
1 - type (player name part 1)
2 - player num
3 - data (first 4 bytes of player name)

0 - frame
1 - type (player name part 2)
2 - player num
3 - data (last 4 bytes of player name)







option 2: refactor and use one game move

use the bits from type to encode
set active, player number and color
use the last 2 bytes for the name

00000000 00000000 00000000 00000000

I need:
3 bits for player number (0-7)
4 bits for color (0-15)

1 bit to mark that it is a make active type

then I can use the last 2 ints to get 64 bits for 8 char

I like option 2

when I process them I will just check for the one bit the tell me it is a active

00000000 10000000 00000000 00000000 type active
00000000 00000000 00000000 00000xxx player num
00000000 00000000 0000xxxx 00000000 color


      {
         if (!(mLoop.state[1] == PM_PROGRAM_STATE_DEMO_RECORD))
            if (x > current_pos) current_pos = x; // index of last used gm - keep this at the most recent one, never go back

         switch (arr[x][1])
         {
            case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
            case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;


old:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

switch (arr[x][1])
{
   case PM_GAMEMOVE_TYPE_PLAYER_ACTIVE:    proc_game_move_player_active(        arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_INACTIVE:  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_HIDDEN:    proc_game_move_player_hidden(        arr[x][2]            ); break;
   case PM_GAMEMOVE_TYPE_SHOT_CONFIG:      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
   case PM_GAMEMOVE_TYPE_PLAYER_MOVE:      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;
}




void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}

















new:
-----------------------------------------------------------------------------
#define PM_GAMEMOVE_TYPE_LEVEL_START      0
//                                                 3       2       1       0
//                                          76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    0b00000000100000000000000000000000
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

int t = arr[x][1];
if (t &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)    proc_game_move_player_active(t,      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)  proc_game_move_player_inactive(      arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_HIDDEN)    proc_game_move_player_hidden(        arr[x][2]            ); break;
if (t == PM_GAMEMOVE_TYPE_SHOT_CONFIG)      proc_game_move_shot_config(          arr[x][2], arr[x][3] ); break;
if (t == PM_GAMEMOVE_TYPE_PLAYER_MOVE)      mPlayer.set_controls_from_comp_move( arr[x][2], arr[x][3] ); break;


void mwGameMoves::proc_game_move_player_active(int p, int color)
{
   mPlayer.syn[p].color = color;

   // player was inactive before and just now changes to active
   if (mPlayer.syn[p].active == 0)
   {
      mItem.set_player_start_pos(p);
      mPlayer.syn[p].active = 1;
      mPlayer.loc[p].join_frame = mLoop.frame_num;

      if ((mNetgame.ima_server) || (mNetgame.ima_client))
         if (p != mPlayer.active_local_player) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_NETGAME_REMOTE;

      // if player 0 is file play all added players will be too
      if (mPlayer.syn[0].control_method == PM_PLAYER_CONTROL_METHOD_DEMO_MODE) mPlayer.syn[p].control_method = PM_PLAYER_CONTROL_METHOD_DEMO_MODE;

      if (mLoop.frame_num > 1) // don't show notifications if player was made active at the start of the level
      {
         mScreen.add_player_text_overlay(p, 1);
         mGameEvent.add(6, 0, 0, p, 0, 0, 0);
         if (!mLoop.ff_state)
         {
            mLog.add_headerf(LOG_NET, -1, 0, "Player:%d became ACTIVE!                                ", p);
            mLog.add_log_net_db_row(LOG_NET, 0, p, "Player:%d became ACTIVE!", p);
         }
      }
   }
}


 

add to player struct:

   char name[9];
      
now how do I change state size?


show variables from settings?




old:
Variables used for netgame state exchange

mPlayer.syn         :  2400
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112480

new:
Variables used for netgame state exchange

mPlayer.syn         :  2496
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112576

this does not add up...
96/8 = 12bytes
it should be 9
I guess the min is 4 byte chunks

1 int 
mPlayer.syn         :  2432
32/8 = 4 bytes

changed 
#define STATE_SIZE 112576

done


make a place to set it


only clients make sense to save it
every computer should save it as player 0
save it to settings so it persists..done
enforce length
done when loading from disk
do it when editting..done



when adding game move



leave the original the way it was   

#define PM_GAMEMOVE_TYPE_LEVEL_START      0
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE    1
#define PM_GAMEMOVE_TYPE_PLAYER_INACTIVE  2
#define PM_GAMEMOVE_TYPE_PLAYER_HIDDEN    3
#define PM_GAMEMOVE_TYPE_PLAYER_MOVE      5
#define PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK   8
#define PM_GAMEMOVE_TYPE_SHOT_CONFIG      9

add this:

//                                                    3       2       1       0
//                                             76543210765432107654321076543210
#define PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG  0b00000000100000000000000000000000


when adding, leave the old calls the same

intercept and add in new format


void mwGameMoves::add_game_move(int frame, int type, int data1, int data2)
{
   int p = data1; // alias to improve readability
   
   if (type == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
   {
      add_game_move_player_active(frame, p, data2);
      return;
   }



void mwGameMoves::add_game_move_player_active(int frame, int p, int c)
{
   // convert to new format

   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   int data1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data1 + mPlayer.syn[p].name[i] * of;
   }
   
   int data2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      data2 + mPlayer.syn[p].name[i+4] * of;
   }

   add_game_move2(frame, type, data1, data2);
   
}


next 




make soem conversion routines and test

input:
player num
color
name

output 
type
d1
d2

and back

void gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  d1 & 0b0000000000000111;      // mask all except lowest 3 bits
   c =  d1 & 0b0000111100000000) / 8; // mask and shift 8

   char n[9] = { 0 };

//   name[0] = (gm2 >> 24) & 0xFF;
//   name[1] = (gm2 >> 16) & 0xFF;
//   name[2] = (gm2 >> 8)  & 0xFF;
//   name[3] = (gm2 >> 0)  & 0xFF;
//
//   name[4] = (gm3 >> 24) & 0xFF;
//   name[5] = (gm3 >> 16) & 0xFF;
//   name[6] = (gm3 >> 8)  & 0xFF;
//   name[7] = (gm3 >> 0)  & 0xFF;

   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      n[i+0] = (gm2 >> of) & 0xFF;
      n[i+4] = (gm3 >> of) & 0xFF;
   }

   snprintf(name, 9, n);

   printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}


void val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   int type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 8; // shift and add color

   d1 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d1 += name[i] * of;
   }

   d2 = 0;
   for (int i=0; i<4; i++)
   {
      int of = (3-i) * 8;
      d2 += name[i+4] * of;
   }

   printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

}










this is the final...


void mwMiscFnx::gma_to_val(int type, int d1, int d2, int &p, int &c, char * name)
{
   // get the player number and color from the bitfield
   p =  type & 0b0000000000000111;        // mask all except lowest 3 bits
   c = (type & 0b0000111100000000) / 256; // mask and shift 8

   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);
}


void mwMiscFnx::val_to_gma(int &type, int &d1, int &d2, int p, int c, char * name)
{
   type = PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG; // start with flag
   type    += p;     // add player number
   type    += c * 256; // shift and add color

   d1 = d2 = 0;
   for (int i=0; i<4; i++)
   {
      d1 += name[i+0] << (i*8);
      d2 += name[i+4] << (i*8);
      //printf("name[%d]:%d of:%d dl:%d\n", i, name[i], of, d1);
   }
   //printf("to gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);
}


2026-01-01 09:40:43

I have it patched into the game moves thing

now let try something fun

the died, etc messages


make a function in player to get the right name

char* mwPlayer::get_player_name(int p, char * name)
{
   snprintf(name, 9, "%s", mPlayer.syn[p].name);
   if ( (!strcmp(name, "default")) || (!strcmp(name, ""))) sprintf(name, "Player %d", p);
   return name;
}

looking good!!!
now what else?
bottom msg..done


now what about saved games?
the name persists and plays back
but the color does not? apparantly not...it used to...fixed



can I play back old demos?
it looks like only first player comes active
fix this...

make something to interate all gm's and convert to new type

use default player names 'default'

I could make my code accept either type?? maybe?? hell yes!!!!

2026-01-01 10:49:35

now what?

onto the netgame stuff

cjon will now need to send name
sjon rx name and set

lets test...


how?

I need a few computers set up again...

at least one client

is asp on he list?



server crashes when client tries to join

i don't want that to happen  :(

it dies when reading playername from packet
buffer was too small 9 char
examine packet...
how and where?


fixed some bugs and cleaned up code around packet buffer add and read strings...


netgame with playername seems to working quite well...

now what?

is there something wrong with bottom msg?
actually I think I hide it when player is in the way...
commented out for now...

what else is there to do?

overlay for demo playback?

end of level

bug when playing back demo local player name overides player 0

seems to work now?

try with older demo

I think it is saving in the cfg file

no, maybe just saving in memory


what to do?

when doing a full reset, reset all players above 0 names to default
reset local color and name

where does this happen?
make it so that name is never saved except in settings...done

I think in player clear, reset all player names to 'default'
when config is loaded it will be restored

I think I have all this fixed now.
The only time name is saved is when enter is pressed after editting.
When resetting player, set all names to 'default'
When resesting player 0, reload config to restore name

next?


add to sessions database field
while i am at it I should also add color, that should not change for the session...
then I can show the player name and color in sessions table


  player_num        INT,

added:
  player_name       VARCHAR(255),
  player_color      INT,

drop and recreate table..


alter the scrape...done

alter the code that writes logs



added to session struct:

struct client_session
{
   char player_name[9];
   int player_color;




I think I have it done...
deploy to server and test...

might as well make release too...


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------

cd ~
rm -r tmp
mkdir tmp

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians

chmod 777 ./op
sudo ./op

cd libnet
make clean
make lib
sudo make install

cd ~/dev/purple_martians
./lin_build_all

sudo cp -r ~/dev/purple_martians/web/* /var/www/html

sudo systemctl start pm


-----------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------


2026-01-01 22:31:35

I finally have the new values showing in the sessions table


now what should I do with them?

add them to sessions table of course

bug

now that I am storing big numbers in gm file, ill need another method for determining the length

can I clamp it?

what bit am I using now? 24

2^24 = 16.7M
/40 = 420k sec
/60 = 6990 m
/60 = 116h

do I have a max time for game?
server will reload in 1H

so if I just toss any values > 16M from my end calc that should work...

no

-rw-r--r--  1 m m   57 Jan  1 22:29 '20260101-222933-[103]-autosave on level done.gm'
m@o3000:~/dev/purple_martians/savegame$ cat 20260101-222933-\[103\]-autosave\ on\ level\ done.gm
4
0
0
0
103

1
9
0
5

1
3
0
0

1
8389888
1802398064
7602297
m@o3000:~/dev/purple_martians/savega

what if I just go back chunks of 4 at a time

the problem is how I write it to the disk
i should realy just do line of 4 char separated by commas
0,2,3,111

this sounds like a major undertaking

what if i got the last 80 char, split into array on newlines

grouped them 4 at a time

I think I am on my way to finding a better way to do that




2026-01-02 06:35:32

add player and color to sessions

get player icons for all colors
I know its a small thing but it will make things look so much better!!


use code to generate

   if (1)
   {
      // save as set of icons to disk
      for (int a=0; a<16; a++)
      {
         char fn[80];
         sprintf(fn, "bitmaps/player_icon_%02d.bmp", a );
         al_save_bitmap(fn, player_tile[a][2]);
      }
   }

done

what about transparency? right now backgroud color is black


can I also save as png?

as simple a changing the extension




why am i so against css?

it seems like the easiest sollution many times...

i can put it in the head:


<!DOCTYPE html>
<html>
<head>
    <title>My Website</title>
    <!-- Internal CSS styles -->
    <style>
        body {
            background-color: lightblue;
        }
        h1 {
            color: maroon;
        }
    </style>
</head>
<body>
    <h1>This is a heading</h1>
    <p>This is a paragraph.</p>
</body>
</html>





.icon-text-container {
  display: flex;       /* Enables Flexbox layout */
  align-items: center; /* Vertically centers the items */
  gap: 10px;           /* Adds space between the icon and text */
  /* Optional styling for visibility */
  border: 1px solid #ccc;
  padding: 10px;
  width: fit-content;
}

.icon {
  width: 24px;   /* Set desired icon size */
  height: 24px;
}

.text {
  /* Text styles */
  font-size: 1rem;
}


<div class="icon-text-container">
  <!-- Use an image, an icon font (like Font Awesome), or an SVG -->
  <img src="path/to/your/icon.png" alt="Icon" class="icon">
  <span class="text">Your Text Here</span>
</div>




flex is awesome...i want to use it for everything!!!

https://css-tricks.com/snippets/css/a-guide-to-flexbox/

make css in the head
name containers for everything
one for the page and then ones for all the elements


I am working on current session...

I have flex containers for:
entire thing
title
text block

2026-01-02 13:17:32

I have current session and session table done
not much I can do with the Datatables thing..

I guess I can style individual elements, like head

i have done head tr and tr hover...probably all I'll need


Now I want to redo this all in a dark theme....

I am loving it!!!

at the top of sessions page:


<html class="dark">







<!-- 
body {
    background-color: #000000; /* Black background */
    color: #FFFFFF; /* White body text */
}

a:link {
    color: #77d7ff; /* A light blue for unvisited links */
    text-decoration: underline; /* Always use an underline for accessibility */
}

a:visited {
    color: #b39ddb; /* A light purple/violet for visited links */
}

a:hover {
    color: #FFFFFF; /* White on hover */
}



 -->




<!-- container for player icon and player name text -->

.icon-text-container
{
   display: flex;      
   align-items: center;
   gap: 10px;          
}
.icon { width: 20px; height: 20px; }
//.text { font-size: 1rem; }


<!-- hack because sometimes hr do not work in flexbox -->
.hack-hr
{
   font-size: 1rem;
   font-weight: normal;
   line-height: 0;
   margin: 0;
}




2026-01-02 16:46:01


I have spent so much time making everything line up and look nice...

now do current session to look like session 

pick a color


I want to make a frame work to make these things easier..


Frame around the whole section

section at the top for title

other section headers possible


I think what I need to do is:

One container for all
one container for the title frame, draw only bottom border
one container inside that to make the title have padding

then for any sub sections

one container for the sub section draw only bottom border
one container inside that for padding

I want to make this common, not custion for each instance

css and php helper functions

.section-frame
.section-frame-title-frame
.section-frame-title-body

.section-frame-sub-title-frame
.section-frame-sub-title-body

2026-01-03 01:59:50

I think I am done here....
I have the common stuff done for css html and all sessions pages...

it looks great...


backup it the fuck up!!!

copy from server to local and do a commit....


--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------
make sure that changes you make there get back to the dev machine
--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

save all files in windows

On the server, copy to tmp folder
sudo cp -r /var/www/html/* ~/tmp

From the a windows machine, copy from tmp location to project:
pscp -r -pw zaiden m@192.168.1.146:tmp/* c:\pm\web 

--------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------

2026-01-03 08:12:38


buttons...


three methods:

Method 1: Style an Anchor Tag (Recommended)

This approach uses a standard hyperlink and applies CSS to give it the appearance and feel of a button.
This is best for accessibility and ensures the link still works if JavaScript is disabled. 

<a href="https://www.example.com" class="button">Go to Example</a>

The target="_blank" attribute can be added to open the link in a new tab: 
<a href="https://www.example.com" class="button" target="_blank">Open in New Tab</a>

.button {
  background-color: #4CAF50; /* Green background */
  border: none; /* Remove default border */
  color: white; /* White text */
  padding: 15px 32px; /* Some padding */
  text-align: center; /* Center the text */
  text-decoration: none; /* Remove underline */
  display: inline-block; /* Make it a block-level link */
  font-size: 16px; /* Increase font size */
  cursor: pointer; /* Add a hand cursor on hover */
  border-radius: 8px; /* Rounded corners */
}

.button:hover {
  background-color: #45a049; /* Darker green on hover */
}


Method 2: Use JavaScript with a Button Tag 

This method uses the <button> element and adds a JavaScript onclick event to perform the redirection. 

<button onclick="window.location.href='https://www.example.com'">
  Go to Example
</button>

To open the link in a new tab, use the window.open() function: 

<button onclick="window.open('https://www.example.com')">
  Open in New Tab
</button>

This method requires JavaScript to be enabled in the user's browser to function.


Method 3: Using a Form

For simple navigation where JavaScript is not an option, you can wrap a submit button in a <form> tag and specify the destination in the action attribute. 

<form action="https://www.example.com">
  <button type="submit">Go to Example</button>
</form>



I did method 1 looks good,
now I want to put the buttons in the title bar





I I think I should do this by default for all...


title frame
flex box for title frame

actual title
flex frame for buttons


2026-01-03 10:11:03

that is so fucking beautiful!!
I want to get button colors from id



2026-01-03 10:34:18

now do current session
make buttons to show hide bandwidth

2026-01-03 10:50:24

all that hard work setting up the framework paid off
it was quite easy to add this button

now make one for player section and game moves also
2026-01-03 11:27:04

done

now make gm have nice header like the rest

all done...

now what?

work on top level link row

add
sessions (this) 
debug (more table)
all gm

this is what I have now:

<table><tbody><tr>
<td style='padding:2px 8px;' > <a href="../index.html"  >Back to Main Page        </a> </td>
</tr></tbody></table><hr>

done
now implement game moves and debug??  later...


I think sessions is 100% done

what did you want to do with game moves now?

have a detailed section for them like current session, current savegame
I need a good name to call these things:
SavedGames

implement the three way button for saved game list

done




make a detailed section for them like current session, current savegame
I need a good name to call these things:
Saved Games


change the gm table list

make a download button and one to select gm

I will need a new section to show details of current gm

Current Save Game
$current_gm_id
show_current_gm.php
how to rearrange table?..done


now what?

when setting current gm, find players that are in the file...

how?

I think I should run an external PHP script that parses and adds to database
for now only do it when looking at the file

I will need another few tables:

players
(to keep track of unique players)
but how unique?

same name? (of course)
same player_num and color (probably not)
same host name?
and what will I do if there is no player name, or it is default?


I think I should start by saving as much data as I can
i don't have to make use of it all

CREATE TABLE players (
  id                INT AUTO_INCREMENT,
  ip                VARCHAR(255),
  port              INT,
  hostname          VARCHAR(255),
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,
  PRIMARY KEY(id)
);

I can get all fields from session table

I can only get this from a gm file:
  player_num        INT,
  player_name       VARCHAR(255),
  player_color      INT,


create this then alter session_scrape to enter player info also...or...
I could just get it from the table already

it will be like a smaller sub table from sessions...
only 6 columns and no uqique

I really question if I need ip host port?

if I am trying to find

I don't think I will use them for matching...
for sessions, get everything

for finding a player in a gm, i might get multiple...just deal with it..list them all

why do I even need this extra table?

mostly because once I look something up I want to save it...

-------------------

make a php script to add player to db
if exists find id
in not create and find id

---------------------------------

wait I just thought of something...
we can get all the info when sessions enters the player

then when gm goes to look it up, it should aleady exist

if there are multiple player matches when searching only for num, color and name, will it really matter?
what am i planning on doing with this info anyway?



I mostly want to be able to show seme meta data for gm files

my plan is to parse the gm file and collect info

right now all I was planning on doing was getting the three player variables

why don't we just stick with that for now?

I still want to add them to a database make a link table
gm_player



script

parse_gm.php

opens gm and looks for play moves

to gma -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780
to val -- p:5 c:12 name:purple23 type:8391685 d1:1886549360 d2:858940780

Process returned 0 (0x0)   execution time : 0.098 s
Press any key to continue.



else
{

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      echo "\n$ch --$rf\n";  
   }







   $n = "--------";

   var_dump($n);

   for ($i=0; $i<4; $i++)
   {
      $tv = $g2;
      echo sprintf("0 - %032b\n", $tv);
      $of = $i*8; 
      $tm = $tv >> $of;
      echo sprintf("2 - %032b\n", $tm);
      $mk = $tm & 0xFF;
      echo sprintf("3 - %032b\n", $mk);


      $ch = chr($mk);
      echo "4 - ch:$ch\n";

      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );

//      $n[$i+0] = $ch;

   }
   var_dump($n);
   echo $n;

   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      $rf = ord($ch);   
      
      echo "\n$ch --$rf\n";  

      var_dump($rf);

//      if ($rf == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0x0;





//      echo sprintf("[%d] - '%d' ' '%c'  fn:%d\n", $i, $n[$i], $n[$i], $found_null);

//      if ($n[$i] == 0) $found_null = 1;
//      if ($found_null) $n[$i] = 0;
   }
   
   var_dump($n);
   echo $n;


/*
   char n[9] = { 0 };
   for (int i=0; i<4; i++)
   {
      n[i+0] = (d1 >> (i*8)) & 0xFF;
      n[i+4] = (d2 >> (i*8)) & 0xFF;
   }
   snprintf(name, 9, "%s", n);
   //printf("to val -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, n, type, d1, d2);

*/


//   echo "\n\nplayer: $p color:$c name:$n\n\n";

}
}


I have the function done:


function gma_to_val($t, $g1, $g2)
{
   echo "gma_to_val($t $g1 $g2)\n";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8


   // get the player name form the next 2 32bit ints
   $n = ""; 
   for ($i=0; $i<4; $i++)
   {
      $n[$i+0] = chr( ($g1 >> ($i*8)) & 0xFF );
      $n[$i+4] = chr( ($g2 >> ($i*8)) & 0xFF );
   }
   echo "\n\nplayer: $p color:$c name:$n\n\n";

   // show values
   for ($i=0; $i<8; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);

   // if zero somehwere in the data, write all zeros from then after
   $found_null = 0;
   for ($i=0; $i<8; $i++)
   {
      $ch = $n[$i];
      if ( ord( $ch ) == 0)  $found_null = 1;
      if ($found_null) $n[$i] = chr(0); 
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   for ($i=0; $i<9; $i++)
      echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


}



2026-01-04 03:18:19

now what?

I am not sure I am getting the right values from gm files


better version


function gma_to_val($t, $d1, $d2)
{
   echo "gma_to_val($t $d1 $d2)  --  ";

   // get the player number and color from the bitfield
   $p =  $t & 0b0000000000000111;        // mask all except lowest 3 bits
   $c = ($t & 0b0000111100000000) / 256; // mask and shift 8

   // get the player name from the next 2 32bit ints
   
   // make sure this is declared as a string
   $n = "";
   
   // detect null and force all char after to also be null
   $found_null = 0;   

   // first 4 char from d1;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d1 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i] = $ch;
   }


   // second 4 char from d2;
   for ($i=0; $i<4; $i++)
   {
      // shift byte into place and mask
      $ch = chr( ($d2 >> ($i*8)) & 0xFF ); 

      // detect null
      if (ord($ch) == 0) $found_null = 1;

      // force to null
      if ($found_null) $ch = chr(0);

      // save in array
      $n[$i+4] = $ch;
   }

   // make sure 9th char is zero
   $n[8] = chr(0); 

   // show values
   //for ($i=0; $i<9; $i++)
   //   echo sprintf("[%d] - '%d' '%s' \n", $i, ord($n[$i]), $n[$i]);


   echo "player: $p color:$c name:$n\n";

}





I have another crazy idea

integrate a database into the game

- i need to make sure that windows and linux versions are still the same
- do I need a networked database like mysql? could i just use sqlite?

why?
what are the benefits:
- make the way the server writes files to disk and later gets scraped a lot simpler
- the server can just write directly to the database
- make the way to adjust the config from headless mode
- replace so much of the level stats bullshit with something much simpler

cons:
would take a lot of fucking work!!

how can i start small?

add sqlite to project and make sure it works in windows and linux
then start adding things to it

first of all, sessions



2026-01-04 04:09:13

I am going to add sqlite to my project....

first save all the work in progress and commit..

2026-01-04 07:45:17






2026-01-04 11:08:21

i have the update function working...

it only updates dt_end, duration, and endreason for now


I want to call it from more places


when I close a session, I should also set session_id to 0 in player loc
then when I am checking for open sessions, I can check there


I these in sessions

         client_sessions[p].next_levels++;
         if (p == mPlayer.syn[0].level_done_player) client_sessions[p].exits++;

if that goes away, can I save it in player?

set it in tally, then make sure it gets reset


why are all these in syn?

   int stat_respawns;
   int stat_shots_fired;
   int stat_enemy_hits;
   int stat_player_hits;
   int stat_self_hits;
   int stat_purple_coins;

   int stat_enemy_exploded;
   int stat_player_exploded;
   int stat_self_exploded;

added:
   int stat_next_levels;
   int stat_exit;


mItem.pmsgtext :250000
---------------:------
total          :384080

Variables used for netgame state exchange

mPlayer.syn         :  2624
mEnemy.Ei           : 12800
mEnemy.Ef           :  6400
mItem.item          : 32000
mItem.itemf         :  8000
mLift.cur           :  4480
mLevel.l            : 40000
mShot.p             :  1200
mShot.e             :  1200
mTriggerEvent.event :  4000
--------------------:------
total               :112704

Other Large Variables



#define STATE_SIZE 112704




I have been through the whole file: session log and done all I could
I still need to do something about tally
the sql method nevers call add log or tally or clear

what calls it outside this file?


mwGameMoves will do this when client quit: session_close(p, 2); // reason 2 - client quit

this is still good


omg should I deply to 146 and try?

I should work on the tally shit now

25 fucking variables to get from db, update, and put back...



2026-01-04 16:05:44


I think I am ready to remove all the old session stuff...


2 calls to


   void session_add_entry(const char* address, const char* hostname, int p, int active, int inactive_reason);

      session_add_entry(address, hostname, 9, 0, 1); // server full
      session_add_entry(address, hostname, p, 1, 0); // join invite     


void mwNetgame::session_add_entry(const char* address, const char* hostname, int p, int active, int endreason)
{
   session_add_sql(address, hostname, p);


changed to pass end reason also


   session_add_sql(address, hostname, p, endreason);


now replace those 2 calls with the sql version
then deal with endreason
done, I no longer use any of the old session stuff

I should still make it optional

how did I used to do that?




































I also would like a meta block for gm files
I have one already, but I want a better one
append at the start when saving
start time
end time
duration
players
player names
finished?

maybe each player section could include:
name
number
color
start frame
end frame
respawns
purple coins collected
enemies killed
other players killed
enemy hits
self hits
exits triggered

I have been think about redoing how I save gm files to disk
currently:
nothing but unordered integers, one per line

1320
0
0
0
9
1
9
0
5
1
3
0
0
1
8389888
1802398064
7602297
1
8392193
1819043193
7602287
13
5
1
4
17
5
1
0

I was thinking of making it like this:

1320
0,0,0,9
1,9,0,5
1,3,0,0
1,8389888,1802398064,7602297
1,8392193,1819043193,7602287
13,5,1,4
17,5,1,0

it should not take more disk space
I would just be swapping crlf for ,

when saved on windows the lines end with CRLF
in linux its just LF

if I make this change, what would it affect?
-only the game saves and loads to disk,
-once loaded into the array the way it is stored on disk is irrelevant
-it would make it easier to parse later



what will 

magic number to start file:
PMSAVEGAME

then the meta block up to

in the meta block

VERSION:1



TIMESTAMP_START:
TIMESTAMP_END:
MAX_FRAME:
LEVEL_NUM: 


PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:



GAME_DATA_NUM_ENTRIES:
GAME_DATA_START:

each line will be 4 commas separated ints, corresponding to an array line

0,0,0,9
1,9,0,5
1,3,0,0


most times reading the file, the header can be ignored

the header can be modified with no ill effects

if the header or magic number is missing, revert to old loading behaviour


in load:

first detect magic number:

if missing do old load


int mwGameMoves::load_gm(const char *sfname)




I redid the old method, it had a read file pattern I used from my frist days of c programming:

      int loop, ch;
      char buff[2000];

      initialize();

      char fname[256];
      sprintf(fname, "%s", al_get_fs_entry_name(FS_fname));

      FILE *filepntr = fopen(fname, "r");
      if (filepntr == NULL)
      {
         printf("Error opening file:%s\n", fname);
         return 0;
      }
      else
      {

         // first get number of entries
         loop = 0;
         ch = fgetc(filepntr);
         while((ch != '\n') && (ch != EOF))
         {
            buff[loop] = ch;
            loop++;
            ch = fgetc(filepntr);
         }
         buff[loop] = 0;
         entry_pos = atoi(buff);


         // then get all the entries
         for (int x=0; x<entry_pos; x++)
            for (int y=0; y<4; y++)
            {
               loop = 0;
               ch = fgetc(filepntr);
               while((ch != '\n') && (ch != EOF))
               {
                  buff[loop] = ch;
                  loop++;
                  ch = fgetc(filepntr);
               }
               buff[loop] = 0;
               arr[x][y] = atoi(buff);
            }
         fclose(filepntr);

ewww....

new:

      for (int x=0; x<entry_pos; x++)
         for (int y=0; y<4; y++)
            if (fgets(buffer, 100, file)) arr[x][y] = atoi(buffer);


#include <stdio.h>

int main() {
    FILE *fp;
    int id;
    char firstname[50];
    char lastname[50];
    
    // Open the file in read mode ("r")
    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }
    
    // Read data in a loop, checking the return value
    // "%d,%49[^,],%49[^\\n]\\n" format:
    // %d     -> read an integer
    // ,      -> match a literal comma
    // %49[^,] -> read up to 49 characters that are NOT commas
    // %49[^\\n] -> read up to 49 characters that are NOT newlines
    // \\n    -> consume the newline character at the end of the line
    while (fscanf(fp, "%d,%49[^,],%49[^\\n]%*c", &id, firstname, lastname) == 3) {
        printf("ID: %d, First Name: %s, Last Name: %s\n", id, firstname, lastname);
    }

    // Check if the loop terminated due to end-of-file or a reading error
    if (!feof(fp)) {
         fprintf(stderr, "Error reading data or format mismatch.\n");
    }
    
    fclose(fp); // Close the file
    return 0;
}





#include <stdio.h>
#include <string.h>

int main() {
    FILE *fp;
    char line[256]; // Buffer to hold one line
    char *token;

    fp = fopen("data.csv", "r");
    if (fp == NULL) {
        perror("Error opening file");
        return 1;
    }

    // Read each line using fgets
    while (fgets(line, sizeof(line), fp)) {
        // Use strtok to parse the line using a comma as a delimiter
        token = strtok(line, ",");
        while (token != NULL) {
            // Process each token (field)
            printf("Field: %s\n", token);
            // Get the next token
            token = strtok(NULL, ",");
        }
    }

    fclose(fp);
    return 0;
}



now I want to convert to csv lines

make a funtion to convert:

I need some metadata from the header that I can use in the new file


added these to the class:

   char[256] last_loaded_gm_filename;   
   int last_loaded_gm_version;
   int last_loaded_gm_last_frame;

set them in load


I have it done

version 0 oldest
version 1 with header, data still 1 val per line
version 2 with header and data 4 vals per line

what else do I want to put in there?
start time, last frame, duration
player info


I also want to make sure I do not overwrite any values in the header
how about, read everything from header, change, write
this is probably not needed, I will rarely resave one of these

If there is a timestamp, do not overwrite

TIMESTAMP_START:
MAX_FRAME:
LEVEL_NUM: 

done




now the hard part:

PLAYER_INFO_START:
PLAYER_NUMBER:
PLAYE_COLOR:
PLAYER_NAME:
FRAME_START:
FRAME_END:
DEATHS:
PURPLE_COINS:
PLAYER_INFO_END:


I also want to make all player active things the same (new version)

I just found there might not be an active game move in a gm file...?



I was playing with the gdt thing in demorecord to iterate all demo levels

just the act of loading them triggered the resave


fixed that...

I just looked at all the ones in the demo folder and they are all ok

what is going on?


am i looking at client only ones?

I don't think so, it has player 0

maybe it just has new style ones...yes...


2026-01-05 07:13:44
I am running out of time for now:

What I really want to do is convert all to the new format: version 2, with blackjack and hookers....

I want to be sure everything will go smoothly though

then run it on all in the savegame folder

I still want to keep the old read stuff around

I should make it so that whenever one is read,
if it is the old version, convert it to the new version
with a different filename?

or rename the old to .old

then once I have them all in the new format, get back to searching for players sessions within the gm



2026-01-05 12:02:15

do this one task...

make it so that loading gm will save in new format

do a few till you are sure it is working

copy an old one from demo


I think I got it....
should I just run it and let it overwrite

2026-01-05 12:54:46

done..

now all levels should be new format...

make it so that any old ones loaded will get redone...

done...
all demos are now version 2
anytime version 1 or earlier is loaded, it will be resaved as v2


2026-01-05 13:25:08

now back to looking for players in gm's

while testing, patch it in load

this might be more complicated than I thought

I could have many players and even overlapping ones
a thorough method would be by player
player 0 


wait, how about find all player_actives


I really want to be able to dowlod from server again...why is it broken?

I think I need to fix the gm scrape to work with sqlite

remove the old sessions_scrape from cron...












SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172255' AND dt_start<'20260104-174355')  OR    (dt_end  >'20260104-172255' AND dt_end  <'20260104-174355');

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-172519' AND dt_start<'20260104-174358')  OR    (dt_end  >'20260104-172519' AND dt_end  <'20260104-174358');


Session id:3   -   start:20260104-181242   -   end:20260104-185051   -


SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181242' AND dt_start<'20260104-185051')  OR    (dt_end  >'20260104-181242' AND dt_end  <'20260104-185051')
Session id:4   -   start:20260104-181249   -   end:20260104-185052   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-181249' AND dt_start<'20260104-185052')  OR    (dt_end  >'20260104-181249' AND dt_end  <'20260104-185052')
Session id:5   -   start:20260104-185146   -   end:20260104-185147   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260104-185146' AND dt_start<'20260104-185147')  OR    (dt_end  >'20260104-185146' AND dt_end  <'20260104-185147')
Session id:6   -   start:20260105-072136   -   end:20260105-072146   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-072136' AND dt_start<'20260105-072146')  OR    (dt_end  >'20260105-072136' AND dt_end  <'20260105-072146')
Session id:7   -   start:20260105-103756   -   end:20260105-104026   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103756' AND dt_start<'20260105-104026')  OR    (dt_end  >'20260105-103756' AND dt_end  <'20260105-104026')
Session id:8   -   start:20260105-103806   -   end:20260105-104015   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-103806' AND dt_start<'20260105-104015')  OR    (dt_end  >'20260105-103806' AND dt_end  <'20260105-104015')
Session id:9   -   start:20260105-104042   -   end:20260105-104105   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104042' AND dt_start<'20260105-104105')  OR    (dt_end  >'20260105-104042' AND dt_end  <'20260105-104105')
Session id:10   -   start:20260105-104048   -   end:20260105-104103   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-104048' AND dt_start<'20260105-104103')  OR    (dt_end  >'20260105-104048' AND dt_end  <'20260105-104103')
Session id:11   -   start:20260105-111037   -   end:20260105-111738   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111037' AND dt_start<'20260105-111738')  OR    (dt_end  >'20260105-111037' AND dt_end  <'20260105-111738')
Session id:12   -   start:20260105-111135   -   end:20260105-111418   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-111135' AND dt_start<'20260105-111418')  OR    (dt_end  >'20260105-111135' AND dt_end  <'20260105-111418')  m@o3000:~/dev/purple_martians/scrape$

SELECT * FROM myTable WHERE myColumn BETWEEN '2023-01-01' AND '2023-02-01';



delete all on server and start again...

get all php from web


2026-01-05 15:22:40
done


-----------------------------
pm still segfault when client joins, but only when run as service
---------------------------------




Session log scrape: 20260105-221501

Session id:1   -   start:20260105-151441   -   end:   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'')  OR    (dt_end  >'20260105-151441' AND dt_end  <'')
Session log scrape: 20260105-221601

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221701

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221801

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-221901

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')
Session log scrape: 20260105-222001

I only have 2 sessions

Session id:1   -   start:20260105-151441   -   end:20260105-151538   -
SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151441' AND dt_start<'20260105-151538')  OR    (dt_end  >'20260105-151441' AND dt_end  <'20260105-151538')
Session id:2   -   start:20260105-151508   -   end:20260105-151540   -

SELECT id, filename, dt_start, dt_end FROM gm WHERE (dt_start>'20260105-151508' AND dt_start<'20260105-151540')  OR    (dt_end  >'20260105-151508' AND dt_end  <'20260105-151540')  m@o3000:~/dev/purple_martians/scrape$
                                                               2026-01-05 15:15:27

sqlite> select * from gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite> select * from gm;


20260105-151541

2026-01-05 15:15:27
2026-01-05 15:15:41
20260105-151508


there it is!!!

save gm in a better date format

      // convert the datetimes to something mysql likes
//      $dt_end   = $dt_end->  format('Y-m-d H:i:s');
  //    $dt_start = $dt_start->format('Y-m-d H:i:s');


      // convert the datetimes to something sqlite likes
      $dt_end   = $dt_end->  format('Ymd His');
      $dt_start = $dt_start->format('Ymd His');



sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|2026-01-05 15:15:27|2026-01-05 15:15:41|14
sqlite>



1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite> SELECT * FROM gm_sessions;
sqlite> SELECT * FROM gm;
1|20260105-151541-[80]-autosave on level done.gm|20260105 151527|20260105 151541|14
sqlite>

forgot the goddamn dash...

now it all works!!!


I can make gm's and see them soon on server...



2026-01-06 12:44:54


I was having some big ideas:


On the topic of parsing gm files and getting player info,
I was planning on embedding this in the header.

I am rethinking that...

Maybe I could just keep it all in the database.

CREATE TABLE player

could be linked to gm and session

how would all these foreign keys work?

session starts and is assigned UUID
player is created and linked to same UUID

or...

whenever a game is started:
player is created with UUID

nah...


lets just do the 

3 tables:
session
gm
player


all are linked, but how?

1 session to 1 player
1 session to many gm

1 gm to many players
1 gm to many sessions

1 session to 1 pleyer


how about each instance of purplemartians has its own UUID?
when the program is first run and the config file is created from scratch
create a UUID, save it in the config and never change it

Then when a client joins he will send the UUID

The server will create a pleyer with that UUID, and other info.
later if that UUID instance changed other stuff about them that can be updated


this is getting complicated, maybe overly complicated...
what will I gain from doing this
is there a simpler way?


I want to link players to save game files
player names are already embedded in the save game files

to start with I could make a table with just those three things:

name
color
number

whenever I read a gm file...or enter it in the gm table
make sure it has a unique id...already done

then look for players in the file and add them if they do not exist and link them to 

I think I can do this without any UUID's for now

also I want to do this in the game, not in a scrape script



2026-01-06 13:12:43

what to do to make this happen?

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id             INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'gm' Created Successfully\n");


I already have this: (duh)

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               ip                VARCHAR(255), \
               port              INT,  \
               hostname          VARCHAR(255),  \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");


remove the shit about ip, port, hostanme...leave that in sessions (which will have a 1 to 1 link with players)


do it!!!

OK this is what I have...

   strcpy(sql, "CREATE TABLE IF NOT EXISTS players( \
               id                INTEGER PRIMARY KEY, \
               player_num        INT, \
               player_name       VARCHAR(255), \
               player_color      INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'players' \n");
   else printf("Table 'players' Created Successfully\n");

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_players( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               player_id         INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_players' \n");
   else printf("Table 'gm_players' Created Successfully\n");

next: remove any scrape and link things that I have in cron in the server, I am going to do this all in the game...

next, where am I going to do the in the game?

how about when reading or saving demo file?

eventually it will be when saving only, but for testing do it when reading...


void mwGameMoves::find_player_info()
{
   printf("find_player_info()\n");
   // looks in the loaded gm file and find all player active and inactive moves

   int am_count = 0;
   int im_count = 0;

//   int par[10][10] = { 0 };


   // first count active and inactive game moves
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] &  PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG) am_count++;
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE) im_count++;
   }
   printf("player active/inactive moves: %d %d\n", am_count, im_count);





//      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_INACTIVE)


}




the first thing I want to do is:

make sure there is an entry for this in gm

how can I tell if it is unique?
I don't really want to rely on filename...





I thought about it some more:

when creating generate a UUID and stick it in the header


when saving, does UUID already exist?


have a gm class or struct in my game


UUID is a member
same as filenname etc..


when loading, stick it in there and set stuff from file

when saving...


i have so many different thing I want to keep track of related to the game_moves array


have methods to:
clear
start



I already have that as game moves array class

just make that work:


have a flag to tell the status of the current array:

int status;
0 - clear
1 - game in progress
2 - client data only
3 - loaded from demo file


right now I have:
entry_pos
- indicates where next gm entry will go
- is also the size of the gm array
- used in demo mode to mark last entry

current_pos
used only when playing back in demo mode


I want to have more data:
level number
UUID

make some functions like

start new file
erases all
sets level
sets status
generates UUID

when loading from file the UUID

remind me again why I need UUID at all...

what am i trying to do here?


why can't i just use regular autoinrementing

I want to assign an ID to the gm file at creation that will never change...
I will enter it in the database, using that as the primary key
if the database gets lost later I will always have that id (if that happens...???)
what will I do with it?

link it to a session (which will also have a UUID)
this will need a separate table

link it to players







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values

instead of UUID just use auto


can I just fake it and use my own pseudo UUID



I am getting bogged down here....why is this so hard?



I think I want UUID so I can assign something at creation that will never change
why do I want that?
so I can detect duplicates?
so I persistantly link to other things?

so I can add them to a database table with proper links preserved
so I can update filepath location if it changes

I think I am just going to use a random 32 or 64 bit number

32bit 50% chance of collision after        77,000
64bit 50% chance of collision after 5,100,000,000

and even if I had a collision, what would that effect?



uint64_t generate_random_u64(void) {
    // Combine two 32-bit random numbers (assuming RAND_MAX is at least 32767)
    // The cast to uint64_t is crucial to ensure correct shifting
    uint64_t r1 = rand();
    uint64_t r2 = rand();

    // Shift the first random number to the upper 32 bits and combine with the second
    // This provides a full 64 bits of potential randomness
    return (r1 << 32) | r2;
}

int main(void) {
    // Seed the random number generator once using the current time
    // For better seeding, one could use a mix of time and other factors
    srand(time(NULL));

    uint64_t random_int = generate_random_u64();
    printf("Random 64-bit integer: %llu\n", random_int);

    return 0;



I'm going with this...







step 1 make sure all gm's have in their header:
UUID
CREATION_TIMESTAMP
MOFIDIFED_TIMESTAMP
LEVEL
LAST_FRAME
NUM_ENTRIES
NUM_PLAYERS

step 2 make sure all new ones do also
when saving just write these values




added to class


   uint64_t HEADER_muid;
   int      HEADER_version;
   char*    HEADER_create_timestamp;
   char*    HEADER_modify_timestamp;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;



now implement this in save:

   fprintf(filepntr, "%s", "PMSAVEGAME\n");

   fprintf(filepntr,       "VERSION:%d\n",              HEADER_version);
   fprintf(filepntr,       "CREATE_TIMESTAMP:%s\n",     HEADER_create_timestamp);
   fprintf(filepntr,       "MODIFY_TIMESTAMP:%s\n",     mMiscFnx.get_timestamp());
   fprintf(filepntr,       "LEVEL:%d\n",                HEADER_level);
   fprintf(filepntr,       "LAST_FRAME:%d\n",           HEADER_last_frame);
   fprintf(filepntr,       "GAMEMOVE_NUM_ENTRIES:%d\n", HEADER_num_entries);
   fprintf(filepntr, "%s", "GAMEMOVE_DATA_START:\n");


now load:

first of all bump version....


save in version 3 load in 2




2026-01-07 04:09:08

when reading,
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000


if level not set, find it and set it



before loading, call initialize
in initialize set all header values to 0's
if muid == 0 (not set) make one up
if createdate not set, use 20260101-000000



2026-01-07 04:46:29

   // header variables
   string   HEADER_create_timestamp;
   string   HEADER_modify_timestamp;
   uint64_t HEADER_muid;
   int      HEADER_version;
   int      HEADER_level;
   int      HEADER_last_frame;
   int      HEADER_num_entries;


void mwGameMoves::initialize(void)
{
   memset(arr, 0, sizeof arr);
   entry_pos = 0;
   current_pos = 0;

   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;

   sprintf(last_loaded_gm_filename, "%s", "");

}


I think I want to change how I get stuff from header...

this is what I have now:

   void header_key_find_int(char* line, const char* key, int &val);
   void header_key_find_string(char* line, const char* key, string &val);

and I need to extend it to work with uint_64  


what do I want to do:

pass it a line (as string)

it will look for keys and set varaiable

if it finds the end it will return 0;

bool parse_header_line(string line);


2026-01-07 06:48:47

I think I have it done

load level works for old and new versions

saves as version 3


make some tests when saving about missing header values..done


now I need to implement the status...

status clear ..done

   // 2 - demo loaded

   // 1 - level started


make a function for this:

sets status
creates muid
sets created_timesatmp
sets level

void new_level


void mwGameMoves::new_level()
{
   initialize();   
   HEADER_create_timestamp = mMiscFnx.get_timestamp();
   HEADER_muid = mMiscFnx.generate_random_u64();
   HEADER_level = mLevel.play_level;
   status = 1;   
}



where to call it?


int mwLoop::load_and_setup_level(int level, int type)
{
   if (!mLevel.load_level(level, 0, 0)) return 0;
   else
   {
      if (type != 4) mGameMoves.new_level(); // do not reset game moves in demo mode


now in save, do different thing based on status...
done....


I think I might actually be getting somewhere....


should I enter it in the database at this point?

what does my table look like?


   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               id             INTEGER PRIMARY KEY, \
               filename       VARCHAR(255), \
               dt_start       DATETIME, \
               dt_end         DATETIME, \
               duration       INT ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");


I was using start and end to figure out what session it might belong to...
I can still keep that


I should add all the other stuff


I'll need a function is the game to iterate all the gm's 
- check that they are in the database
- make sure the filepath is up to date



I think it will be driven by the game

at the core it will have a function to do one gm


2026-01-07 18:24:07


   HEADER_muid = 0;
   HEADER_version = 0;
   HEADER_create_timestamp.clear();
   HEADER_modify_timestamp.clear();
   HEADER_level = 0;
   HEADER_last_frame = 0;
   HEADER_num_entries = 0;


I am going to start over with the table....

   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               muid           INTEGER PRIMARY KEY, \
               filename       TEXT, \
               dt_start       TEXT, \
               dt_end         TEXT, \
               duration       INT,  \
               level          INT,  \               
               num_entries    INT ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm' \n");
   else printf("Table 'gm' Created Successfully\n");




now a fucntion to add to the database

void add_gm_to_db(const char* file)
{
   // first load_gm, this will check the data
   
   // check if muid already exists
   
   if yes update values
   in no insert values
}



2026-01-08 03:23:04

why do I feel like I am getting bogged down?

is is because my plan is not fully formed?

just pick on small task

take timestamp and last frame and trun it into start, end, and duration

where can I test this...

load





do something about check for old gma right now it is called on everysave
options:
-call only on version 0
- inline check with every row written 
done.. did inline
I should just leave this forever

removed old method, saving here


void mwGameMoves::convert_active_gamemoves()
{
   // coverts all old style gm to new
   for (int x=0; x<entry_pos; x++)
   {
      if (mGameMoves.arr[x][1] & PM_GAMEMOVE_TYPE_PLAYER_ACTIVE_FLAG)
      {
         int t  = arr[x][1];
         int d1 = arr[x][2];
         int d2 = arr[x][3];

         int p, c;
         char name[16];

         mMiscFnx.gma_to_val(t, d1, d2, p, c, name);

         printf("found new gma -- p:%d c:%d name:%s type:%d d1:%d d2:%d \n", p, c, name, t, d1, d2);

      }
      if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
      {

         int p = arr[x][2];
         int c = arr[x][3];

         int type, d1, d2;
         char name[16];
         sprintf(name, "Player %d", p);

         mMiscFnx.val_to_gma(type, d1, d2, p, c, name);

         printf("found old gma -- p:%d c:%d -- new: name:%s type:%d d1:%d d2:%d \n", p, c, name, type, d1, d2);

         arr[x][1] = type;
         arr[x][2] = d1;
         arr[x][3] = d2;
      }
   }
}
*/





2026-01-08 03:57:36

fixed some bugs, now I am actually saving and loading all header values


what if I replaced my 64 bit muid with something else...

options:


10 char string [A-Z] 
10^26 = 1.0 e26
2^64 = 1.8 e19

94274532147610
52544629916126
105437152168571
62015032799880
89777701388341
126989298070705
15 digits?

108821586384139
100759932765462
24167781002446
132229158166728
24730421704635
31181462578973
'GLWITOJHHGWSWRIO'
'VBQDBOWGANYPRZKQ'
'XANMHOPTNCLVIZUA'
'YDWNQAPQXVSVPJML'
'GMOMXLGGAPWYCQUQ'
'CPUHSVSJDHNVNUCZ'

16^26 = 2 e31


do it, replace uint64 with char[16]


done...


this is some date manip from sessions

#include <iomanip>

   // create at tm struct from start date
   struct tm timestart = {0};
   std::stringstream ss(dt_start);
   ss >> std::get_time(&timestart, "%Y%m%d-%H%M%S");
   if (ss.fail()) printf("Error parsing time\n");
   time_t st = mktime(&timestart);

   char ts[20];
   strftime(ts, sizeof(ts), "%Y%m%d-%H%M%S", &timestart);

   // create a tm struct from now
   time_t now = time(NULL);
   struct tm *timenow;
   timenow = localtime(&now);
   char dt_end[20];
   strftime(dt_end, sizeof(dt_end), "%Y%m%d-%H%M%S", timenow);

   int duration = difftime(now, st);









I have some bugs...

muid??

Loading gm: 'C:\pm\lv2'
----'YGSHQVDDEDPLKMFD'
Last frame not set from header, setting to:3793
Level number not set from header, setting to:2
HEADER_create_timestamp was not set. Setting to '20260101-000000'
HEADER_muid was not set. Setting to ''
Loaded old version of file: C:\pm\lv2  --  resaving as new version
Resave triggered, resaving:C:\pm\lv2
Filename            :C:\pm\lv2
MUID                :
VERSION             :0
CREATE_TIMESTAMP    :20260101-000000
MODIFY_TIMESTAMP    :
LEVEL               :2
LAST_FRAME          :3793
GAMEMOVE_NUM_ENTRIES:523

Saving gm:C:\pm\lv2
HEADER_muid was not set. Setting to ''

C:\pm>



string mwMiscFnx::generate_muid()
{

does not work (only works the first time)
//   string tmp;
//   for (int i=0; i<16; i++)
//   {
//     std::random_device seed;
//     std::mt19937 gen{seed()}; // seed the generator
//     std::uniform_int_distribution<> dist{65, 90}; // set min and max
//     tmp[i] = dist(gen);
//   }
////   tmp[16] = 0;
//   return tmp;



works
   char t[17];
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     t[i] = dist(gen);
   }
   t[16] = 0;
   string tmp(t);
   return tmp;


works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp += (char)dist(gen);
   }
   return tmp;

works
   string tmp;
   for (int i=0; i<16; i++)
   {
     std::random_device seed;
     std::mt19937 gen{seed()}; // seed the generator
     std::uniform_int_distribution<> dist{65, 90}; // set min and max
     tmp.push_back((char)dist(gen));
   }
   return tmp;





ok now i think it is working


i can call gdt to iterate all levels...


i want to time it:


load only:
gdt took 0.283832 seconds to process 96 files
insert:
gdt took 1.495548 seconds to process 96 files
update:
gdt took 0.621905 seconds to process 96 files




2026-01-08 07:12:53

now what?

make update update the filenames

what is the point, just erase and get them all again

i could make update just overwrite everything...

not sure what that would gain me...

when am i planning on doing this?

- when I load a gm
- when I save a gm
that will take care of any new ones


what else do i want to do?

I need to link them to sessions

when adding to db,

check if we are in server mode

then look for active sessions

i will have the row id in player struct

then make a link

old table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_id             INT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");

new table:
   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm_sessions( \
               id                INTEGER PRIMARY KEY, \
               gm_muid           TEXT, \
               session_id        INT  ); ");
   if (sqlite3_exec(db, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'gm_sessions' \n");
   else printf("Table 'gm_sessions' Created Successfully\n");


2026-01-08 07:22:52

fist of all:
modify table..done
call from save...done

check if server

      if (mNetgame.ima_server)
      {
         for (int p=1; p<8; p++)
            if (mPlayer.loc[p].session_id)
            {
               sprintf(sql, "INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('%s', %d)", HEADER_muid.c_str(), mPlayer.loc[p].session_id);
               printf("sql:%s\n", sql);
               mSql.execute_sql(sql);
            }
      }

now to test....

I should really do a backup...


2026-01-08 07:32:13

got to go...


testing...I should see if everything compiles on linux
compiles clean, no warnings


./pm 


server tries to save game twice

dte:'20260108-180304'
dur:21
muid: 'GDFQAYGTSLZXNIRV' does not exist  --  inserting
sql:INSERT INTO gm ( muid, filename, dt_start, dt_end, duration, level, num_entries )                              VALUES( 'GDFQAYGTSLZXNIRV', '',     '20260108-180243',     '20260108-180304',   21,       80,    108)
sql:INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('GDFQAYGTSLZXNIRV', 1)
Error: near "NULL": syntax error
INSERT INTO gm_sessions ( NULL, gm_muid, session_id ) VALUES('GDFQAYGTSLZXNIRV', 1)
update sid:1  s:20260108-180228 e:20260108-180307 d:39


.mode column
SELECT * from gm;
SELECT * from gm_sessions;
SELECT id, dt_start, player_name FROM sessions;


2026-01-08 18:17:00
I did it!!!

test on windows

erase database

start server

on client join, play level and level done

client quits, server quits

1 gm
1 session
1 gm_session linking them!!!!

sqlite> SELECT * from gm;
muid              filename  dt_start         dt_end           duration  level  num_entries
----------------  --------  ---------------  ---------------  --------  -----  -----------
RACTOQKRHFYPWEJA            20260108-181608  20260108-181622  14        80     84

sqlite> SELECT * from gm_sessions;
id  gm_muid           session_id
--  ----------------  ----------
1   RACTOQKRHFYPWEJA  1

sqlite> SELECT id, dt_start, player_name FROM sessions;
id  dt_start         player_name
--  ---------------  -----------
1   20260108-181556  Forest
sqlite>



2 clients

sqlite> SELECT * from gm;
muid              filename  dt_start         dt_end           duration  level  num_entries
----------------  --------  ---------------  ---------------  --------  -----  -----------
RACTOQKRHFYPWEJA            20260108-181608  20260108-181622  14        80     84
ACGKQEKIYXFFWRJS            20260108-182110  20260108-182120  10        80     30

sqlite> SELECT * from gm_sessions;
id  gm_muid           session_id
--  ----------------  ----------
1   RACTOQKRHFYPWEJA  1
2   ACGKQEKIYXFFWRJS  2
3   ACGKQEKIYXFFWRJS  3

sqlite> SELECT id, dt_start, player_name FROM sessions;
id  dt_start         player_name
--  ---------------  -----------
1   20260108-181556  Forest
2   20260108-182049  Forest
3   20260108-182059  jenny!
sqlite>


this works so well, can I make it work with the webpage?

-- first a bit of house keeping:

clean up the database creation stuff..


not to get side tracked, but I think I have a better understanding now:
sessions are like players, they have a lot of player info

gm's are linked to sessions that were active when the gm was recorded

I should do more than link when saving gm
when gm is started I should link all active sessions then
if more sessions start they should link to current gm
when gm is saved

- link to active sessions when level starts
- link to active sessions when level ends (either by quitting or completing)
- if a session starts, link it to current gm

also when linking, check if link already exists first



2026-01-08 19:38:50

testing good on linux, just noticed I am not setting filename!

fixed...


running into issues on how I save the filepath

save the filename name only
it gets saved in savegame/

on server savegame is mapped to webroot/downloads ...




2026-01-08 21:35:27

I have got it working!!!!

but when I try to play the demo I just downloaded I get an crash when loading
actually, its when load calls add to db...

remind me again, why am I adding gm to db when loading?

commented it out and it plays fine....


go to bed....its really coming along well....


2026-01-08 21:39:55


2026-01-09 05:22:43

backed up, deployed to server and tested...looking good



2026-01-09 05:34:24

now that all this is working...

do I need a separate players table?

I think my plan was so that I could show what players were in a gm file

after implementing all my other stuff, i think there is another way

sessions has player info, it is what I should use
sessions is alrewady linked to gms

fix show current gm and list linked sessions..done

now show list of linked sessions (players) on show current gm

   $sql  = "SELECT sessions.id, dt_start, dt_end, duration, player_name, player_num FROM sessions ";
   $sql .= "LEFT JOIN gm_sessions ON sessions.id = session_id ";
   $sql .= "WHERE gm_muid='$current_gm_muid'";


actually a lot of the sessions info does not really apply to gm

name
number
color
host

2026-01-09 07:29:42

looking good!!!

so what can I say?
I do not need any scrape
I do not need to write any files (except gm)

session and gm's are working great
no need for separate 'players'

still to do:

no need for filename in sessions
all sqlite columns to be int or text
list of players to be table


journalctl -u <service-name>


2026-01-10 02:35:53


I am going to add logging to the database


trying to troubleshoot why headless server crashes and I am getting nothing with regular logging

can't get it to print to console or journalctl

tried adding these lines to 

sudo nano /etc/systemd/system/pm.service

StandardOutput=journal+console
StandardError=journal+console


# pm.service

[Unit]
Description= Purple Martians server
Documentation= purplemartians.org

[Service]
Type= simple
User= m
ExecStart= /home/m/dev/purple_martians/pm -sh
StandardOutput=journal+console
StandardError=journal+console

[Install]
WantedBy= multi-user.target

sudo systemctl daemon-reload
sudo systemctl enable pm
sudo systemctl start pm






2026-01-10 02:50:52


this is what I used to have

CREATE TABLE logs
(
  id              INT AUTO_INCREMENT,
  msg_type        INT,
  sub_type        INT,
  created         DATETIME(3),
  agt             DOUBLE,
  frame_num       INT,
  player          INT,
  client          INT,
  message         TEXT,
  PRIMARY KEY (id)
);




// actually adds to char array
// called both by server directly and when server rx's clog
void mwLog::add_log_net_db_row2(int type, int sub_type, double agt, int f, int p, int client, const char* msg)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;


   char txt[1000];
   sprintf(txt, "%d,%d,%s,%f,%d,%d,%d,%s\n", type, sub_type, d, agt, f, p, client, msg);
//         printf("%s", txt);





should I make a separate database?

maybe sessions and logs

i don;t want to lose stuff in sessions


2026-01-10 03:10:48

now I have 
   sprintf(filename, "%s", "data/sessions.db");
   sprintf(filename, "%s", "data/logs.db");

   sqlite3 *db;
   sqlite3 *db_logs;


   strcpy(sql, "CREATE TABLE IF NOT EXISTS logs( \
               id              INTEGER PRIMARY KEY, \
               msg_type        INT, \
               sub_type        INT, \
               created         TEXT, \
               agt             REAL, \
               frame_num       INT, \
               player          INT, \
               client          INT, \
               message         TEXT ); ");
   if (sqlite3_exec(db_logs, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'logs' \n");


SELECT * FROM logs;

SELECT created, message FROM logs;


now add some stuff to it...


when I enble LOG_NET_CSV

10,0,2026-01-10 03:14:46.645,46.808684,0,0,0,LEVEL 1 STARTED
10,0,2026-01-10 03:14:48.766,48.930611,85,0,0,Player:0 became INACTIVE!
10,0,2026-01-10 03:14:48.879,49.043502,85,0,0,Shutting down the server network


this is a very small subset of all the logs
pretty much just LOG_NET


I think I want to hook in where the main logging takes place...

do it fool!!

2026-01-10 08:08:48

got message in db, now try on server...


2026-01-10 09:22:07


curiouser and curiouser....

no databse shit is getting saved either when running as service

I can see it in top
running with user m 100%cpu

and as soon as I tried to connect it dies

when I run from shell like ./pm -sh
runing as user m 13%cpu

when client connects 17%cpu


could it just be that the database won't open?
it is a path thing?
what is the difference

YES!!!!!

it was a dir thing....

[Unit]
Description=Purple Martians server
Documentation=purplemartians.org

[Service]
Type=simple
User=m
ExecStart=/home/m/dev/purple_martians/pm -sh
WorkingDirectory=/home/m/dev/purple_martians

[Install]
WantedBy=multi-user.target

update the docs.

run sql through my custom exe functions in mwSql that will check if database is not open...done



I am itching to try CLion....

do it...


2026-01-10 13:32:57

its working


I think I can lose any savegame files in the project that are not demo or TAS

do it fool...done





in netgame when a level is done and everyone returns to overworld,
why do they all come back at different places?
was it where they were before they were sucked into the last level played?
I think it was...
should I leave it like that or force everyone to come back at the level they just played?

is it something about the last gate touched?

mPlayer.syn[0].overworld_last_touched_gate
it is saved in config also

in 
void mwItem::set_player_start_pos(int p)

   // in overworld level, player starts at the last gate they touched
   if (mLevel.play_level == 1)
   {
      for (int i=0; i<500; i++)
         if ((item[i][0] == 18) && (item[i][6] == mPlayer.syn[p].overworld_last_touched_gate)) item_to_get_start_from = i;
   }

its a little complicated:
item[i][6] is the level number of the gate
the player stores that, the last level number
then all 500 items are searched until a gate with that level number is located

this seems overly complex, why would I not just store the item index of the gate?
will it change? do I sort the items? sure i do in level editor...otherwise I can
be pretty certain they will persist...



void mwItem::proc_gate_collision(int p, int i)
{
   mPlayer.syn[p].marked_gate = i;
   set_gate_level_icon_position(i);
   int lev = item[i][6];

   if (mPlayer.syn[p].overworld_last_touched_gate != lev)
   {
      mPlayer.syn[p].overworld_last_touched_gate = lev;
      if (p == 0) mConfig.save_config(PM_CFG_SAVE_OVERWORLD_GATE_LAST_TOUCHED); // clients do not save to config
   }

when a gate is touched, store the level number of the gate in the player struct
(but only locally)


this is all mentions of the variable

I think it would be safe to just store the index of the item

look up item sort..not an issue


anyway to do what I want it to do:

I would have the server set it for all clients when a level is done
or when a level is started...better

where can I hook into that? up pressed on gate...

   // if UP pressed, enter gate (client can never locally enter gate)
   if ((mPlayer.syn[p].up) && (status > 0) && (!mNetgame.ima_client) )
   {
     
      // server to set last touched gate for all clients
      if (mNetgame.ima_server)
      {
         for (int pp=1; pp<8; pp++)
            if (mPlayer.syn[pp].active)
            {
               mPlayer.syn[pp].overworld_last_touched_gate = lev;
            }
         }
      }
      
I think that should do it...

bitmaps cannot be manipulated on a machine with no display
like headless server...find another way

put them in the icons
100 bmp 3M
200 bmp 9M
200 png 200k
400 bmp 36M
400 png 700k

I'm going to try the 200's


2026-01-11 08:51:38


I am going to test sessions, but first do a full backup...


get the session stuff from server

am I going to leave the level_icons in the assets/icons...yes







start one player on level 80
then have other players join and quit a few times while first player stays...


I have sessions for each time the player joined

I have muliple players listed in the cell on save game for current session
they all look the same, I should make the pop up show the session id

same with on current game

I think this is working like it supposed to...

make those changes to also show session id so we know they are a different player



I just played lev 80 with 15 unique players and sessions

one thing I noticed, when you come back you still have the same amount of health as you used to!!!

I should try what happens if you join out if order...
you get a different player number is all...

i did a gm with 25 sessions!!!!


three things to do:

remove filename from current session section..done

start new client game with full health and a good link to last gate touched..done

where can i do that so it won't get overwritten...
actually nothing overwrites it....
where can I save a global last gate_activated?
for use when a client joins and I want to send them to the last gate someone used
I am thinking if a client joins when everyone is on the overworld
where should I send them?
default is good

I fixed both where server sets up new client.
As soon as server finds and empty player slot, i do a full init now
and also set last overworld gate level to currently playing level




level icons are not copied. changed so they are commited...done

first time returning to overworld, clients did not all go back to first gate
2nd time they did


i did this on the server and thought it would work

      // server to set last touched gate for all clients
      if (mNetgame.ima_server)
      {
         for (int pp=1; pp<8; pp++)
            if (mPlayer.syn[pp].active)
            {
               mPlayer.syn[pp].overworld_last_touched_gate = lev;
            }
      }

it could be that the server is resetting it, but...i have looked and can't see how or where?


the only place a gate can be entered is here and only a server can do it...

loading and saving to config only happen for player 0, the local player

does it simply get erased and then try to load from level 0 and fail?

when it starts from the start block, that means it was unable to find the specified level...

I should just print what it actually looks for...

maybe I should initialize it...
you would think that when a new client joins they should start from where??

added code to see when it fails and what the value is





jenny start go to level 80

then when others join they do not have set from server because they werent there when someone enetred the gate!!!

I think I get it now, new joining players need to have that set....
to whatever level they are in now....unless its overworld...what then??..do nothing


no, actually i think of you join while in overworld you should go to the last touched gate of any player...
or maybe the last gate that was activated


also when a client quits and rejoins the same happens

set devset to also do:
speedy transitions
IJKL C

updating sessions every 1s messed with the tallies...revert and test again do it fool!!

2026-01-11 17:08:09

getting git 2.52.0 cause clion says my version 2.16.2 is unsupported...done


made player name show above player optional with settings...


2026-01-12 07:33:09

I am planning on redoing the main pm server that has been running for a few years
what should I keep?

with the newer seesions stuff, I would just keep all the gm's and session database
but the old one is different...

is there anything worth keeping?

the oldest looks like it is from 20240714

backed up sessions table and gm file to x
see mysql file for details


2026-01-12 07:34:33
I can now deply new to pmh


do it fool!

     Active: active (running) since Fri 2025-10-31 18:00:30 MDT; 2 months 11 days ago
   Main PID: 762 (pm)
      Tasks: 2 (limit: 9291)
     Memory: 291.1M
        CPU: 2month 1w 4d 19h 53min 44.491s
     CGroup: /system.slice/pm.service
             762 /home/m/dev/purple_martians/pm -sh

Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Player Color:[8]                                                  |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Server Frame:[102568]                                             |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]|        Server Level Sequence Num:[1752]                                  |
Jan 12 07:00:16 pmh pm[762]: [10][0][102568]+--------------------------------------------------------------------------+
Jan 12 07:00:16 pmh pm[762]: log_net array lines > 1000 ... dumping to file
Jan 12 07:00:16 pmh pm[762]: logs/net/20260112-070010.942.csv saved
Jan 12 07:00:16 pmh pm[762]: log_net array lines > 1000 ... dumping to file
Jan 12 07:00:16 pmh pm[762]: logs/net/20260112-070015.94.csv saved
Jan 12 07:00:16 pmh pm[762]: [10][0][102969]+--------------------------------------------------------------------------+
Jan 12 07:00:16 pmh pm[762]: [10][0][102969]|                                                                          |
m@pmh:~/dev/purple_martians/savegame$

                                               |

m@pmh:~/dev/purple_martians/savegame$ sudo systemctl stop pm

stop all cron...

erased all and got new...

had to redo the servioe to include working dir

now how do I change permissions so php in web can see database

and how to allow downloads?

need to figure out and document, as well as all permissions needed...

96.45.1.12
is that right?
no, it should be .50
why??
reboot
same...why???
figure it 





2026-01-12 11:22:34

im doing great, i just got the pmh server all rebuilt and better notes done

also I now know better what to do about permissions

I did not have to change anything in /var/www.....

I just had to chmod o+x /home/m

this allows php to see database files and downloads alias to work



Do I really want the ':' in player...or should it be a space...it used to be a space...fixed

2026-01-12 11:38:08

commit

update on pmh





having issues with static ip

newer versions of ubuntu by default can randomize mac...




m@pmh:/etc/netplan$ nano  /etc/netplan/50-cloud-init.yaml
m@pmh:/etc/netplan$ sudo nano /etc/netplan/50-cloud-init.yaml
[sudo] password for m:
m@pmh:/etc/netplan$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever


2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff
    inet 96.45.1.12/26 metric 100 brd 96.45.1.63 scope global dynamic enp2s0
       valid_lft 84062sec preferred_lft 84062sec
    inet6 fe80::ca1f:66ff:fe4a:876d/64 scope link
       valid_lft forever preferred_lft forever
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ cat /etc/resolv.conf
# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
# Do not edit.
#
# This file might be symlinked as /etc/resolv.conf. If you're looking at
# /etc/resolv.conf and seeing this text, you have followed the symlink.
#
# This is a dynamic resolv.conf file for connecting local clients to the
# internal DNS stub resolver of systemd-resolved. This file lists all
# configured search domains.
#
# Run "resolvectl status" to see details about the uplink DNS servers
# currently in use.
#
# Third party programs should typically not access this file directly, but only
# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
# different way, replace this symlink by a static file or a different symlink.
#
# See man:systemd-resolved.service(8) for details about the supported modes of
# operation for /etc/resolv.conf.

nameserver 127.0.0.53
options edns0 trust-ad
search .
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ resolvectl status
Global
         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
  resolv.conf mode: stub

Link 2 (enp2s0)
    Current Scopes: DNS
         Protocols: +DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Current DNS Server: 208.67.222.222
       DNS Servers: 208.67.222.222 208.67.220.220
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$
m@pmh:/etc/netplan$ sudo cat /etc/netplan/50-cloud-init.yaml
network:
  version: 2
  ethernets:
    enp2s0:
      dhcp4: true
m@pmh:/etc/netplan$



here is something I might copy to try to make this static

network:
  version: 2
  renderer: networkd
  ethernets:
    en01:
      addresses:
        [192.168.0.4/26]
      routes:
        - to: default
          via: 192.168.0.1
          metric: 100
      nameservers:
        search: [local]
        addresses:  [1.1.1.1, 192.168.0.1, 8.8.8.8, 8.8.4.4]
      dhcp6: false 
      dhcp4: false

editted:

network:
  version: 2
  ethernets:
    enp2s0:
      addresses:
        [96.45.1.12/26]
      routes:
        - to: default
          via: 96.45.1.63
          metric: 100
      nameservers:
        search: [local]
        addresses:  [8.8.8.8, 8.8.4.4]
      dhcp6: false 
      dhcp4: false
      
2026-01-12 17:11:55

I am not going to change anything...

this is here to try if it all borks later...

actually I should try to reboot the server...



These are results for ubuntu server 24 minimal how can i tell what mac address randomization is configured
On Ubuntu Server 24.04, network configuration is typically managed by
Netplan and the actual service is usually systemd-networkd.
To determine the MAC address randomization setting, you need to inspect the relevant configuration files. 
1. Check the active MAC address 
First, check the current MAC address of your network interface(s) using the ip addr command: 
bash

ip addr show

m@pmh:~$ ip addr show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group defaul                                                    t qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP gr                                                    oup default qlen 1000
    link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff
    inet 96.45.1.12/26 metric 100 brd 96.45.1.63 scope global dynamic enp2s0
       valid_lft 45571sec preferred_lft 45571sec
    inet6 fe80::ca1f:66ff:fe4a:876d/64 scope link
       valid_lft forever preferred_lft forever
m@pmh:~$




Look for the link/ether field for your interface (e.g., enp... or eth0).
If the second hexadecimal digit of the address is 2, 6, A (or a), or E (or e),
the MAC address is a locally administered address, which often indicates it has been randomized or manually set. 

link/ether c8:1f:66:4a:87:6d brd ff:ff:ff:ff:ff:ff

2. Inspect Netplan configuration files 
Ubuntu uses Netplan to abstract network configuration. Check the contents of your Netplan configuration files in the /etc/netplan/ directory. 

List the files in the directory:

ls /etc/netplan/

m@pmh:~$ ls /etc/netplan/
50-cloud-init.yaml


View the content of your configuration file (replace 00-installer-config.yaml with your actual filename):
m@pmh:~$ sudo cat /etc/netplan/50-cloud-init.yaml
[sudo] password for m:
network:
  version: 2
  ethernets:
    enp2s0:
      dhcp4: true

Look for a macaddress or cloned-mac-address key under your interface's settings.
Netplan's configuration for MAC addresses usually uses the macaddress key to set a specific address
or might imply randomization if managed by systemd-networkd's default policies. 

3. Check systemd-networkd configuration 
Ubuntu Server generally uses systemd-networkd. You can check its configuration for specific MACAddressPolicy settings. 

    Look for .link files in /etc/systemd/network/ or /usr/lib/systemd/network/:
    bash

ls /etc/systemd/network/ /usr/lib/systemd/network/


m@pmh:~$ sudo ls /usr/lib/systemd/network/
73-usb-net-by-mac.link              80-container-vb.network  80-wifi-adhoc.network            99-default.link
80-6rd-tunnel.network               80-container-ve.network  80-wifi-ap.network.example
80-auto-link-local.network.example  80-container-vz.network  80-wifi-station.network.example
80-container-host0.network          80-vm-vt.network         89-ethernet.network.example
m@pmh:~$





View the content of relevant .link files. A common file to check is 99-default.link or a file specific to your interface name. Look for the MACAddressPolicy setting within the [Link] section:
bash

cat /usr/lib/systemd/network/99-default.link 
# (or the name of your specific file)

m@pmh:~$ cat /usr/lib/systemd/network/99-default.link
# SPDX-License-Identifier: MIT-0
#
# This config file is installed as part of systemd.
# It may be freely copied and edited (following the MIT No Attribution license).
#
# To make local modifications, one of the following methods may be used:
# 1. add a drop-in file that extends this file by creating the
#    /etc/systemd/network/99-default.link.d/ directory and creating a
#    new .conf file there.
# 2. copy this file into /etc/systemd/network or one of the other paths checked
#    by systemd-udevd and edit it there.
# This file should not be edited in place, because it'll be overwritten on upgrades.

[Match]
OriginalName=*

[Link]
NamePolicy=keep kernel database onboard slot path
AlternativeNamesPolicy=database onboard slot path
MACAddressPolicy=persistent
m@pmh:~$

The MACAddressPolicy can be set to values like persistent (the default, which uses the permanent hardware address), random, stable, or others. 

looks like it is set to persistent





2026-01-12 17:44:51

I think I need to figure more things out, like how to get a button to do something
with out reloading a page


Basic Usage
You can use the onclick attribute directly within the HTML tag to call a JavaScript function. 

HTML:

<button onclick="myFunction()">Click me</button>
<p id="demo">The date and time will appear here.</p>


JavaScript (within <script> tags or an external file):

function myFunction() {
  document.getElementById("demo").innerHTML = Date();
}

When the button is clicked, it calls the myFunction, which finds the HTML element with the ID demo and changes its content to the current date and time. 
Key Concepts

    Inline JavaScript: The script is written directly within the onclick attribute (e.g., onclick="alert('Hello!');"). While convenient for simple tasks, it's generally recommended to separate your HTML and JavaScript code for better organization and maintainability.
    Calling a Function: You specify the name of the JavaScript function to run when the button is clicked, including parentheses () to invoke it.
    Multiple Functions: You can execute multiple functions by separating them with a semicolon within the attribute (e.g., onclick="function1(); function2();" ).
    this keyword: You can pass the element itself to the function using the this keyword, allowing the JavaScript function to manipulate the specific element that was clicked.
        Example: <button onclick="changeColor(this)">Click me</button>
    Redirecting to another page: To use a button to navigate to a new URL, you can use window.location.href within the onclick handler.
        Example: <button onclick="window.location.href='https://www.example.com'">Go to Example.com</button> 

found some intererting html input types like range


what do i actually want to do:
have a page that shows the server uptime and the currently connected client

well then, I better have that data in the database

status table
uptime
every second that updates
number of connected clients
current level
how long in current level

kind of like copying what I used to have in status and remote control


looks like it gets sent every frame in remote control mode

void mwNetgame::server_send_snfo_packet(void) // send info to remote control
{
   // copy values into loc
   mPlayer.loc[0].srv_frame_num = mLoop.frame_num;
   mPlayer.loc[0].srv_total_game_moves = mGameMoves.entry_pos;
   mPlayer.loc[0].srv_level = mLevel.play_level;
   mPlayer.loc[0].srv_zlib_cmp = mNetgame.zlib_cmp;
   mPlayer.loc[0].srv_extra_packets_num = mNetgame.srv_exp_num;
   mPlayer.loc[0].srv_extra_packets_size = mNetgame.srv_exp_siz;
   mPlayer.loc[0].srv_uptime = al_get_time();
   sprintf(mPlayer.loc[0].srv_version, PM_VERSION);

   mPlayer.loc[0].srv_num_enemy = mEnemy.num_enemy;

   char src[5700];


this also happens once per frame

void mwLog::add_log_status_db_rows(void)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;

   // do not log status unless at least one client is connected
   if (mNetgame.server_num_clients == 0) return;

   char d[100];
   mMiscFnx.chr_dt(d);

   int f = mLoop.frame_num;

   char txt[1000];

   for (int p=0; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active)
      {
         int r = mPlayer.loc[p].rewind;
         float cpu  = mPlayer.loc[p].cpu;
         float sync = mPlayer.loc[p].pdsync*1000;
         float ping = mPlayer.loc[p].ping*1000;
         float difs = mPlayer.loc[p].cmp_dif_size;
         float lcor = mPlayer.loc[p].client_loc_plr_cor;
         float rcor = mPlayer.loc[p].client_rmt_plr_cor;

         float txbf = mPlayer.loc[p].tx_current_bytes_for_this_frame;
         float rxbf = mPlayer.loc[p].rx_current_bytes_for_this_frame;
         float txpf = mPlayer.loc[p].tx_current_packets_for_this_frame;
         float rxpf = mPlayer.loc[p].rx_current_packets_for_this_frame;

         // these values have no meaning for server
         if (p == 0)
         {
            sync = 0;
            ping = 0;
            difs = 0;
            lcor = 0;
            rcor = 0;
         }

         sprintf(txt, "%s,%d,%d,%d,%3.1f,%3.1f,%3.1f,%3.0f,%3.1f,%3.1f,%3.0f,%3.0f,%3.0f,%3.0f\n",
                       d, f, p, r, cpu,  sync, ping, difs, lcor, rcor, txbf, rxbf, txpf, rxpf);

         // printf("added log_status line: %d  %s\n", log_status_msg_num_lines,  txt);

I could simply put this into a database

it would get full really quick, but then I could just delete the entries

2026-01-13 04:28:19

I have some thoughts:

a web page with the lognet messages and a button to refresh


where to start...


I want to do status

a small table













To recursively remove a large file from your GitHub repository's history, the recommended method is to use the
git filter-repo tool. This process rewrites your repository's history, so it's essential to coordinate with collaborators and ensure you have a backup. 
The process involves the following high-level steps:
Prerequisites

    Install git-filter-repo: This tool is much faster and easier to use than the older git filter-branch.
    You can often install it using a package manager, for example:

sudo apt install git-filter-repo

Steps to Remove the File

    Navigate to Your Local Repository:

cd YOUR-REPOSITORY

Run git filter-repo: To remove a specific file from all branches and tags, use the --invert-paths and --path arguments,
replacing PATH-TO-YOUR-FILE with the actual path to the large file (e.g., src/data/large_file.zip).

git filter-repo --invert-paths --path PATH-TO-YOUR-FILE

If the file existed at multiple paths due to moves or renames,
you may need to run the command again for each alternative path or add an extra --path argument.
Force-Push the Changes to GitHub: Once you are satisfied with the local changes,
force-push the rewritten history to overwrite the remote repository on GitHub.
This is a destructive action that affects all branches and tags.

git push --force --mirror origin

Post-Cleanup

    Coordinate with Collaborators: Alert all collaborators that the repository history has been rewritten.
    They will need to re-clone the repository to get the new history.
    Run Garbage Collection: GitHub will handle garbage collection on the server side to expunge the data from storage,
    but for your local clone, the above process, followed by the force push, handles most of it.
    Prevent Future Issues: Add the large file's pattern to your .gitignore file to prevent it from being
    accidentally committed again.
    Consider Git LFS: If the file is a necessary binary, consider using
    Git Large File Storage (LFS) to manage it properly going forward. 

    Cannot remove files from repository above quota #52302 - GitHub
    Apr 7, 2023  This command will show you the top 10 largest files in your repository.
    Remove large files: Use git filter-branch or the BFG Repo-
    GitHub




















im going to try this on o3000

delete and get the lastest

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians
 



I think the shallow clone --depth=1 is not getting the full

m@o3000:~/dev/purple_martians$ du -sh .
126M    .


cd ~/dev
sudo rm -r purple_martians

git clone https://github.com/mweiss001/purple_martians



m@o3000:~/dev$ git clone https://github.com/mweiss001/purple_martians
Cloning into 'purple_martians'...
remote: Enumerating objects: 16817, done.
remote: Counting objects: 100% (20/20), done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 16817 (delta 0), reused 2 (delta 0), pack-reused 16797 (from 3)
Receiving objects: 100% (16817/16817), 700.42 MiB | 19.91 MiB/s, done.
Resolving deltas: 100% (12022/12022), done.
m@o3000:~/dev$ du -sh .
866M    .

now i've got it all....

sudo apt install git-filter-repo

git filter-repo --invert-paths --path pm.exe

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path pm.exe
Parsed 554 commits
New history written in 0.86 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at 9c11a137 no comment
Enumerating objects: 16338, done.
Counting objects: 100% (16338/16338), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4718/4718), done.
Writing objects: 100% (16338/16338), done.
Total 16338 (delta 11549), reused 16323 (delta 11536), pack-reused 0
Completely finished after 7.45 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
229M    .

here goes!!!

git push --force --mirror origin

git push --force --mirror https://github.com/mweiss001/purple_martians


2026-01-13 05:54:53

I did it!!!

but I just realized I have uncomitted changes on m36...duh!!

how to fix...


add pm.exe to .gitignore

try new push from m36...failed

made a local copy on desktop
removed and reclone to c:/pm
manualy copied changes from desktop version to c:\pm
committed...all looks good


now see what else I can kill in repo


back to o3000
remove and reclone

before that, save this file and commit from m36...





















im going to try this on o3000

delete and get the lastest

sudo systemctl stop pm
cd ~/dev
rm -r purple_martians

git clone --depth=1 https://github.com/mweiss001/purple_martians
cd purple_martians
 



I think the shallow clone --depth=1 is not getting the full

m@o3000:~/dev/purple_martians$ du -sh .
126M    .


cd ~/dev
sudo rm -r purple_martians

git clone https://github.com/mweiss001/purple_martians



m@o3000:~/dev$ git clone https://github.com/mweiss001/purple_martians
Cloning into 'purple_martians'...
remote: Enumerating objects: 16817, done.
remote: Counting objects: 100% (20/20), done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 16817 (delta 0), reused 2 (delta 0), pack-reused 16797 (from 3)
Receiving objects: 100% (16817/16817), 700.42 MiB | 19.91 MiB/s, done.
Resolving deltas: 100% (12022/12022), done.
m@o3000:~/dev$ du -sh .
866M    .

now i've got it all....

sudo apt install git-filter-repo

git filter-repo --invert-paths --path pm.exe

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path pm.exe
Parsed 554 commits
New history written in 0.86 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at 9c11a137 no comment
Enumerating objects: 16338, done.
Counting objects: 100% (16338/16338), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4718/4718), done.
Writing objects: 100% (16338/16338), done.
Total 16338 (delta 11549), reused 16323 (delta 11536), pack-reused 0
Completely finished after 7.45 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
229M    .

here goes!!!

git push --force --mirror origin

git push --force --mirror https://github.com/mweiss001/purple_martians


2026-01-13 05:54:53

I did it!!!

but I just realized I have uncomitted changes on m36...duh!!

how to fix...


add pm.exe to .gitignore

try new push from m36...failed

made a local copy on desktop
removed and reclone to c:/pm
manualy copied changes from desktop version to c:\pm
committed...all looks good


now see what else I can kill in repo


back to o3000
remove and reclone

before that, save this file and commit from m36...



git ls-files -s | awk '{print $2 " " $4}' | LC_ALL=C sort -nrk1 | head -n 10 | while read size oid file; do echo $(($(git cat-file -s $oid)/1024))KiB $file; done

does not work:
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$
m@o3000:~/dev/purple_martians$ git ls-files -s | awk '{print $2 " " $4}' | LC_ALL=C sort -nrk1 | head -n 10 | while read size oid file; do echo $(($(git cat-file -s $oid)/1024))KiB $file; done
fatal: Not a valid object name docs/dev
-bash: /1024: syntax error: operand expected (error token is "/1024")
m@o3000:~/dev/purple_martians$


git count-objects -vH
du -ah .git/objects | sort -rh | head -n 10


git rev-list --objects --all \
| git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' \
| sed -n 's/^blob //p' \
| sort --numeric-sort --key=2 \
| tail -n 10 \
| cut -c 1-12,41- \
| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest




fd101e2ddf1c   11MiB data/level_icons_200.bmp
fd8e5ce63e99   11MiB data/level_icons_200.bmp
abcafd2ad249   12MiB savegame/bad_exit_20220613-183034-lev303.txt
8285c9b0c4f9   14MiB pm_dump.sql
c4ce6ca6a4bd   16MiB data/level_icons_vls.bmp
41d6126b6473   27MiB snd/pm.wav
e334b2b9bdbb   28MiB scrape_cronoutput.txt
98f59065e5b2   32MiB purple_martians_7.24.0426.1_linux.tar.gz
85865d59a222   36MiB purple_martians_7.24.0426.1_windows.zip
ca70d91f2717   96MiB session_scrape_cronoutput.txt
m@o3000:~/dev/purple_martians$

ok...now I have some more things to remove...

git filter-repo --invert-paths --path session_scrape_cronoutput.txt

m@o3000:~/dev/purple_martians$ git filter-repo --invert-paths --path session_scrape_cronoutput.txt
Parsed 557 commits
New history written in 0.73 seconds; now repacking/cleaning...
Repacking your repo and cleaning out old unneeded objects
HEAD is now at a7e90fd no comment
Enumerating objects: 16361, done.
Counting objects: 100% (16361/16361), done.
Delta compression using up to 4 threads
Compressing objects: 100% (4453/4453), done.
Writing objects: 100% (16361/16361), done.
Total 16361 (delta 11827), reused 16312 (delta 11823), pack-reused 0
Completely finished after 4.03 seconds.
m@o3000:~/dev/purple_martians$ du -sh .
225M

git filter-repo --invert-paths --path scrape_cronoutput.txt
m@o3000:~/dev/purple_martians$ du -sh .
225M

git filter-repo --invert-paths --path purple_martians_7.24.0426.1_linux.tar.gz
193M

git filter-repo --invert-paths --path purple_martians_7.24.0426.1_windows.zip
158M

lets stop here and test...

git push --force --mirror https://github.com/mweiss001/purple_martians


on m36 copy again to desktop and reclone...

https://github.com/mweiss001/purple_martians


2026-01-13 06:52:34

worked
160 before build
do I need to add anything to .gitignore?

the files I removed were one offs, should not re-occur

anyway this is the file:

/o
/*.o

pm.exe

/logs/*

/savegame/*.gm

/gmon.out
/pm.depend
/pm.layout

/screenshots/*

/scrape_cronoutput.txt
/scrape_status_cronoutput.txt
/session_scrape_cronoutput.txt



I have not made any more changes on m36 so no need to recommit

back to o3000 to see what else there is...

dfc07ace844a   11MiB data/level_icons_200.bmp
e71982713aba   11MiB bitmaps/level_icons.bmp
f13f83429959   11MiB bitmaps/level_icons.bmp
f61a1cafa6da   11MiB data/level_icons_200.bmp
fd101e2ddf1c   11MiB data/level_icons_200.bmp
fd8e5ce63e99   11MiB data/level_icons_200.bmp
abcafd2ad249   12MiB savegame/bad_exit_20220613-183034-lev303.txt
8285c9b0c4f9   14MiB pm_dump.sql
c4ce6ca6a4bd   16MiB data/level_icons_vls.bmp
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$

i can actually lose everything in the data dir and it will be recreated (except the folder)


git filter-repo --invert-paths --path data/level_icons_vls.bmp
152M

git filter-repo --invert-paths --path pm_dump.sql
150M

git filter-repo --invert-paths --path savegame/bad_exit_20220613-183034-lev303.txt
149M

git filter-repo --invert-paths --path data/level_icons_200.bmp
137M
 
git filter-repo --invert-paths --path data/level_icons.bmp
137M

git filter-repo --invert-paths --path bitmaps/level_icons.bmp
136M




f09d4b46ade9  4.6MiB data/level_data.pm
f103d718452d  4.6MiB data/level_data.pm
f31c666e78ea  4.6MiB data/level_data.pm
f60439b7f67b  4.6MiB data/level_data.pm
fd70cca1fd11  4.6MiB data/level_data.pm
ff11da252e4b  4.6MiB data/level_data.pm
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
dab8021dc511   10MiB scrape_status_cronoutput.txt
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$


git filter-repo --invert-paths --path scrape_status_cronoutput.txt
git filter-repo --invert-paths --path data/level_data.pm
136M


git rev-list --objects --all \
| git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' \
| sed -n 's/^blob //p' \
| sort --numeric-sort --key=2 \
| tail -n 50 \
| cut -c 1-12,41- \
| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest

fabb763dcd84  2.9MiB bitmaps/level_icons2.bmp
51537afee800  3.7MiB data/sqlite3.exe
7baf15648227  3.7MiB snd/pm.mp3
62c998491439  4.6MiB bitmaps/level_data.pm
84a1aad10801  4.6MiB bitmaps/level_data.pm
db0420ff1fdd  4.6MiB bitmaps/level_data.pm
e0cd72e970d4  4.6MiB pm_docs/20250525 troubleshooting/level_data.pm
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$


git filter-repo --invert-paths --path "pm_docs/20250525 troubleshooting/level_data.pm"
git filter-repo --invert-paths --path bitmaps/level_data.pm
git filter-repo --invert-paths --path bitmaps/level_icons2.bmp 
136M




| $(command -v gnumfmt || echo numfmt) --field=2 --to=iec-i --suffix=B --padding=7 --round=nearest
136e061f3000  1.4MiB pm_docs/new8.txt
673c1cd2120f  1.4MiB pm_docs/new8.txt
2775bb94e188  1.4MiB bitmaps/block_tiles.bmp
d96de3481a60  1.4MiB bitmaps/tiles.bmp
ae49b7075c49  1.4MiB pm_docs/new8.txt
5ad6b1907b55  1.4MiB libnet/libnet.a
88d4fe8e1c55  1.4MiB pm_docs/new8.txt
ff21115208ec  1.4MiB web/old_versions/pm2_19991202.zip
bf675f8b984d  1.4MiB pm_docs/new8.txt
cd6badaf5fd9  1.5MiB pm_docs/new8.txt
d1686e6a6e72  1.5MiB pm_docs/new8.txt
d5897866827d  1.5MiB web/old_versions/pm5_20030622.zip
807d4d3bc89f  1.6MiB bitmaps/tiles.bmp
8a8a69c66eb5  1.6MiB bitmaps/tiles.bmp
ffc7bafc9765  1.6MiB pm_docs/new8.txt
47c70b1f4bdb  1.6MiB pm_docs/new8.txt
34a9b217d3fa  1.6MiB pm_docs/new8.txt
75fa5cdec634  1.6MiB pm_docs/new8.txt
0d6ad192218a  1.6MiB web/old_versions/pm4_20010301.zip
8365f1d7ccc3  1.7MiB pm_docs/new8.txt
09e646caad8e  1.7MiB screenshots/20180423194754.bmp
d0ca7fd66d53  1.7MiB linux_libs/liballegro_monolith.so.5.2
0da90ec88b21  1.7MiB pm_docs/new8.txt
022a9fdf4e14  1.7MiB pm_docs/new8.txt
8e9eb811034f  1.7MiB pm_docs/new8.txt
b77e8bb06463  1.7MiB pm_docs/new8.txt
5bc2bf3f310c  1.7MiB pm_docs/new8.txt
c794fc168e72  1.7MiB pm_docs/new8.txt
bc17a74fe4f4  1.7MiB pm_docs/new8.txt
c18cb595d5c7  1.7MiB pm_docs/new8.txt
0bef794ca754  1.7MiB docs/new8.txt
298398fdbd6c  1.7MiB pm_docs/new8.txt
2f3b4594b7a0  1.8MiB liballegro_monolith.so
07a98e4a5309  2.9MiB data/level_icons_100.bmp
0a09b1091cd7  2.9MiB data/level_icons_100.bmp
114370638890  2.9MiB data/level_icons_100.bmp
4136f35ad1be  2.9MiB data/level_icons_100.bmp
457af2dbbcc8  2.9MiB data/level_icons_100.bmp
52d99314596e  2.9MiB data/level_icons_100.bmp
5d085e971469  2.9MiB data/level_icons_100.bmp
b0dcb0316f80  2.9MiB data/level_icons_100.bmp
b1f448e7c9c5  2.9MiB data/level_icons_100.bmp
cd83e51a91e7  2.9MiB data/level_icons_100.bmp
d05668bfd9b1  2.9MiB data/level_icons_100.bmp
f5478c2bd9f3  2.9MiB data/level_icons_100.bmp
51537afee800  3.7MiB data/sqlite3.exe
7baf15648227  3.7MiB snd/pm.mp3
1c0861029c7f  6.1MiB web/old_versions/pm6_20180311.zip
912ac26944c6  9.0MiB src/sqlite3.c
41d6126b6473   27MiB snd/pm.wav
m@o3000:~/dev/purple_martians$

git filter-repo --invert-paths --path screenshots/20180423194754.bmp 
git filter-repo --invert-paths --path data/level_icons_100.bmp
133M


I am done for now....

git push --force --mirror https://github.com/mweiss001/purple_martians

bak to m36

reclone and add data to gitignore

now 130M

recreate /data if not exists...done

2026-01-13 07:38:23
recommit from m36..done

i should remove data completely from github



how big is allegro dir?

m@o3000:~/dev$ du -hd1 .
74M     ./allegro5
133M    ./purple_martians

















now back to our regulary scheduled...


what do i actually want to do:
have a page that shows the server uptime and the currently connected client

well then, I better have that data in the database

status table
uptime
every second that updates
number of connected clients
current level
how long in current level

kind of like copying what I used to have in status and remote control


looks like it gets sent every frame in remote control mode

void mwNetgame::server_send_snfo_packet(void) // send info to remote control
{
   // copy values into loc
   mPlayer.loc[0].srv_frame_num = mLoop.frame_num;
   mPlayer.loc[0].srv_total_game_moves = mGameMoves.entry_pos;
   mPlayer.loc[0].srv_level = mLevel.play_level;
   mPlayer.loc[0].srv_zlib_cmp = mNetgame.zlib_cmp;
   mPlayer.loc[0].srv_extra_packets_num = mNetgame.srv_exp_num;
   mPlayer.loc[0].srv_extra_packets_size = mNetgame.srv_exp_siz;
   mPlayer.loc[0].srv_uptime = al_get_time();
   sprintf(mPlayer.loc[0].srv_version, PM_VERSION);

   mPlayer.loc[0].srv_num_enemy = mEnemy.num_enemy;

   char src[5700];


this also happens once per frame

void mwLog::add_log_status_db_rows(void)
{
   if (!mLog.log_types[LOG_NET_CSV].action) return;

   // do not log status unless at least one client is connected
   if (mNetgame.server_num_clients == 0) return;

   char d[100];
   mMiscFnx.chr_dt(d);

   int f = mLoop.frame_num;

   char txt[1000];

   for (int p=0; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active)
      {
         int r = mPlayer.loc[p].rewind;
         float cpu  = mPlayer.loc[p].cpu;
         float sync = mPlayer.loc[p].pdsync*1000;
         float ping = mPlayer.loc[p].ping*1000;
         float difs = mPlayer.loc[p].cmp_dif_size;
         float lcor = mPlayer.loc[p].client_loc_plr_cor;
         float rcor = mPlayer.loc[p].client_rmt_plr_cor;

         float txbf = mPlayer.loc[p].tx_current_bytes_for_this_frame;
         float rxbf = mPlayer.loc[p].rx_current_bytes_for_this_frame;
         float txpf = mPlayer.loc[p].tx_current_packets_for_this_frame;
         float rxpf = mPlayer.loc[p].rx_current_packets_for_this_frame;

         // these values have no meaning for server
         if (p == 0)
         {
            sync = 0;
            ping = 0;
            difs = 0;
            lcor = 0;
            rcor = 0;
         }

         sprintf(txt, "%s,%d,%d,%d,%3.1f,%3.1f,%3.1f,%3.0f,%3.1f,%3.1f,%3.0f,%3.0f,%3.0f,%3.0f\n",
                       d, f, p, r, cpu,  sync, ping, difs, lcor, rcor, txbf, rxbf, txpf, rxpf);

         // printf("added log_status line: %d  %s\n", log_status_msg_num_lines,  txt);

I could simply put this into a database

it would get full really quick, but then I could just delete the entries

I have some thoughts:

a web page with the lognet messages and a button to refresh


where to start...


I want to do status

a small table



server_status

clients
level
last_update
uptime

how do I do uptime?

   mPlayer.loc[0].srv_uptime = al_get_time();

   al_draw_textf(mFont.pr8, mColor.pc[13], cx,     cy, 0, "Server Remote Control ");
   al_draw_textf(mFont.pr8, mColor.pc[15], cx+180, cy, 0, "Version:%s  Uptime:%s", mPlayer.loc[0].srv_version, mMiscFnx.chrmhd(mPlayer.loc[0].srv_uptime, msg));




take these values and stick them in a table
once per second


   strcpy(sql, "CREATE TABLE IF NOT EXISTS status( \
               timestamp     TEXT PRIMARY KEY, \
               uptime        INT, \
               clients       INT, \
               level         INT, \
               level_time    INT, \
               moves         INT, \
               enemies       INT ); ");
   if (sqlite3_exec(db_sessions, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'status' \n");

get the server to do this...where?


how big should uptime be?
I am planning of just using seconds

31,536,000 sec in a year

60s * 60m * 24h * 365 = 

i can use 32bit int

called every frame in server control

void mwNetgame::server_count_clients()
{
   server_num_clients = 0;
   for (int p=1; p<NUM_PLAYERS; p++)
      if (mPlayer.syn[p].active) server_num_clients++;
}


2026-01-14 01:46:49

I have this getting added to the database every second

20260114-014435  20260114-014435  28459   2        1      128845      5      11
sqlite> select MAX(timestamp), * from status;
MAX(timestamp)   timestamp        uptime  clients  level  level_time  moves  enemies
---------------  ---------------  ------  -------  -----  ----------  -----  -------
20260114-014502  20260114-014502  28486   2        1      129925      13     11
sqlite>


now make a page to view it


done

2026-01-14 03:19:47

I have that done...now what?

you can manually refresh with F5 or I have a refresh button

to do:
auto update?
clean up table, do I need to keep old entries?


I could get status.php to delete, but there is not guarantee the page is running...
where else? in the server? when running delete all?
I might leave it with no entries...

what if I just left it and did not remove?

I could have stats on uptime

what if I kept track of server sessions?

kind of like client sessions, but I would track different things.


2026-01-14 03:34:46
show icon for current level..done

I could have a section for the current level:
just a few things:
level num
icon
level time
enemies
moves

then I could have a section for the current clients and show them
and make some css for this intead of borrowing from ...

2026-01-14 04:49:58

all done... status page looks good...

now what?

could I show load, disk space?

looked into linux load things and I don't think they would be useful

I can use my own 'cpu' which refers to the amount of time the game loop spends
processing vs waiting...

mRollingAverage[0].avg

added cpu to table..
               cpu           INT, \



2026-01-14 05:29:04

commit and deploy to o3000

this is awseome!

1% usage with no clients
6 with 1
12 with 2
19 with 3
21 with 3+ rc
33 level 16 with 4 clients and rc and fakekey 

deploy to pmh and compare...

should I also do server version?...yes

2026-01-14 06:00:37

done, committed and deployed to pmh and all clients
18% level 16 with 4 clients and rc and fakekey 

now what?

How to control the server from web page.

I am thinking of making a table that the server reads periodically.
What would it look like?

maybe one step further and store some settings in the database..

When the web page changes them, the server will update values and the web pages can read them

will this be a major rewrite of my entire settings things?
or can I just use it for a few things I want to control remotely?

let say for now, just the player shot things


first I will need to echo those values to the database somewhere so that the cuurent values can be displayed
then i will need to monitor the database periodically for changes

I could have a form on the web that submits the values

for now just do something similar to rc

tx snfo fn:[1530] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1531] size:[411] ratio:[7.61] [1 packets needed]
tx snfo fn:[1532] size:[410] ratio:[7.59] [1 packets needed]
tx snfo fn:[1533] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1534] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1535] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1536] size:[411] ratio:[7.61] [1 packets needed]
tx snfo fn:[1537] size:[411] ratio:[7.61] [1 packets needed]
tx snfo fn:[1538] size:[411] ratio:[7.61] [1 packets needed]
tx snfo fn:[1539] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1540] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1541] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1542] size:[411] ratio:[7.61] [1 packets needed]
tx snfo fn:[1543] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1544] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1545] size:[412] ratio:[7.63] [1 packets needed]
tx snfo fn:[1546] size:[412] ratio:[7.63] [1 packets needed]

does rc take up a client slot??
it does not appear to...



   strcpy(sql, "CREATE TABLE IF NOT EXISTS control( \
               id            INTEGER PRIMARY KEY, \
               field         TEXT, \
               value         INT ); ");
   if (sqlite3_exec(db_sessions, sql, NULL, 0, NULL) != SQLITE_OK) printf("Error Creating Table 'status' \n");

now get the web page to set something


make 2 buttons

pvp damage on and off

get them to call a php script that inserts a record



2026-01-14 06:49:16

first I need to commit, then redeploy to o3000 so I have the latest version and the table created...

removed /data before commit
i am not creating the dir soon enough
i fixed it another way, moved initialization of db out of constructor and called it later


I have been thinking about this remote control thing

I can send from web to server to control,
but I will need a method from server to web to tell what value actually are.

-option 1
do what you did before and send values with status table updates

-option 2
go full out and move config to database


I was thinking about consolidating the settings and config thing anyway, it seems like it is getting out of hand
Currently I have:
-the regular ini config stuff
-settings.pm
 - log types
 - overlay grid
 - mBottomMessage.fiter_event
 
and now I am thinking of putting some things in the database?

The good thing about the ini file is that it is human readable and editable

once I moved the log file stuff to the settings.pm I lost the ability to change
it via ini file...

I would ideally like the convenience of having it all in the database
but with some easy way of manually editing it..

And maybe not all in the same database file.
If I have to delete one to start over I don't want to delete everything.


There is also a lot of stuff in level_data

      fwrite(data,           sizeof(data),          1, fp);
      fwrite(area_locks,     sizeof(area_locks),    1, fp);
      fwrite(area_array,     sizeof(area_array),    1, fp);
      fwrite(play_data,      sizeof(play_data),     1, fp);
      fwrite(&play_data_num, sizeof(play_data_num), 1, fp);


struct level_data
{
   char level_name[200];

   int status;
   int status_color;
   char status_text[16];

   int min_respawns;
   int max_purple_coins_collected;
   int tot_purple_coins;
   int min_enemies_left;
   int min_enemies_left_par;
   int max_enemies_killed;

   int times_played;
   int times_beat;
   int times_quit;

   int time_par;
   int time_best;
   int time_best_all_coins;
   int time_worst;
   int time_average;
   int time_total;
};


struct level_play_data
{
   int level;
   double start_timestamp;
   int timer;
   int completed;
   int number_players;
   int enemies_killed;
   int enemies_left_alive_at_exit;
   int player_respawns;
   int purple_coins_collected;
};

   struct level_data data[100];
   struct level_play_data play_data[100000];
   int play_data_num;
   int area_locks[16];
   int area_array[100][2];


2026-01-14 22:58:24

anyways enough thinking about all that, what am I going to do?

List the control I want on the web page:
- pvp shots (bool)
- pvs shots (bool)
- shot damage (signed int)

- select level
- reload current level
- force fakekey

- adjust logging

that is not enough that I want to do a major rewrite

implement the simple thing I was doing anyway


I am at the point where I want to make a button that inserts into controls table
but how am I going to get the initial value of the control?

what if I rethink the table...

control_name TEXT
value INT

"pvp_shots" 1

the server will:
-read from ini file at start and set values in memory
-set those values in the database table

- check every second if those values in the database table have changed
 the ony way this would happen is if the web changed them
- if they have changed do the change and save 


-------------

I have decided to do it the hard way...

---------------

maybe not...


make the unique id the key of the value

value for each key

also another feild to indicate if changed


control_name TEXT
value INT
changed INT (0) not changed (1) changed by web (2) changed by server

"pvp_shots" 1 0


web will read and display
if changed, will set new values and 1 for web changed

server will periodicallly check for changes from web
if none, it will make sure the values in the db are what is currently in memory

database
- read values from db
- is set from web flagged?
- if yes process the change
- if no make sure value in db matches memory




--------------

i want to learn how to use vectors...
why am i needlessly suffering?

I learned integer arrays back in the apple II days, (maybe even PET)
and they are great, but I think vectors might be even better


I am going to create an sql helper fuction that returns a vector list of results

// returns 0 on success
// 1 = now rows
// 2 = error
int mwSql::execute_sql_and_return_first_row_as_vector_int(const char *sql, sqlite3 *db, std::vector<int> &ret)
{
   if (db == nullptr)
   {
      printf("Error! Database not open.\n%s\n", sql);
      return 2;
   }

   sqlite3_stmt* stmt;
   int rc = sqlite3_prepare_v2(db, sql, -1, &stmt, nullptr);
   if (rc != SQLITE_OK)
   {
      printf("Failed to prepare statement: %s\n", sqlite3_errmsg(db));
      return 2;
   }

   rc = sqlite3_step(stmt);
   if (rc == SQLITE_DONE)
   {
      printf("No rows found. \n%s\n", sql);
      return 1;
   }

   if (rc == SQLITE_ROW)
   {
      int column_count = sqlite3_column_count(stmt);
      for (int i=0; i<column_count; i++)
         ret.push_back(sqlite3_column_int(stmt, i));
   }

   return 0;

}


   char sql[1024];
   sprintf(sql, "SELECT uptime, level, moves FROM status WHERE uptime=%d", 17);

   std::vector<int> v;

   int ret = mSql.execute_sql_and_return_first_row_as_vector_int(sql, mSql.db_sessions, v);
   if (ret == 0)
   {
      int v_size = (int) v.size();
      printf("%s\nfound %d results\n", sql, v_size);
      for (int i=0; i<v_size; i++)
      {
         printf("v[%d]:%d\n", i, v[i]);
      }
   }
   if (ret == 1) printf("no results : %s\n", sql);
   if (ret == 2) printf("error: %s\n", sql);




2026-01-15 01:19:46

this is coming along....



I'm going to switch gears


I want to work on the sessions visual table view

how do I imagine it?

a horizontal time line (is there any other?)

gm's will be is a single row (they do not over lap in time)
there will be gaps (because I do not save gm's for overworld)

sessions will be on the same timeline

what time range?

to start with: previuos hour
other options might be:
last day
last 5 gm's

I will need variables indicating the time range
start
end
duration

then I will need variables for each element I plan to draw

start
end
duration
name
color

where will all this live?

in a php file

sessions_timeline

or just timeline


show_timeline.php

show_timeline()

shown above seesion table for now..

now what?

get times

how am I coing to save them...php datetime?

$date = new DateTime("now");
echo "\nSession log scrape: " . $date->format('Ymd-His') . "\n";


   // echo "Add to db: filename: " . $var['filename'] . "\n";

   // test if we can create a valid DateTime
   if (!DateTime::createFromFormat('Ymd-His', $var['dt_start']))
   {
      echo "Error parsing dates\n";
      foreach ($var as $x => $y) echo "$x $y\n";
      return;
   }

   // convert the datetime to something mysql likes
   $date2 = DateTime::createFromFormat('Ymd-His', $var['dt_start']);
   $var['dt_start'] =  $date2->format('Y-m-d H:i:s');


   // calculate and set dt_end
   $dur = $var['duration'];
   $date3 = $date2->add(DateInterval::createFromDateString("$dur seconds"));
   $var['dt_end'] =  $date3->format('Y-m-d H:i:s');

   // show the values in the array
   //foreach ($var as $x => $y) echo "$x $y\n";


   // first check if filename is exists in db
   $fn = $var['filename'];





$date = new DateTime("now", new DateTimeZone('America/Edmonton'));
echo "\nDATE now:" . $date->format('Ymd-His') . "\n";

$timezones = DateTimeZone::listIdentifiers();
echo "<h1>List of Supported Timezones</h1>";
echo "<pre>";
print_r($timezones);
echo "</pre>";



Ok I now have 2 datetimes (and a duration of 86400s)

$date = new DateTime("now", new DateTimeZone('America/Edmonton'));
echo "\nDATE now:" . $date->format('Ymd-His') . "\n";
$date2 = $date->sub(DateInterval::createFromDateString("86400 seconds"));
echo "\nDATE then:" . $date2->format('Ymd-His') . "\n";

DATE now:20260115-015813
DATE then:20260114-015813


now what?


find gm's in that range..


actually, before I even start:
make range 2h
generate some gm's


now do sql

SELECT 

SELECT column_name(s)
FROM table_name
WHERE column_name [NOT] BETWEEN value1 AND value2;


   strcpy(sql, "CREATE TABLE IF NOT EXISTS gm( \
               muid           TEXT PRIMARY KEY, \
               filename       TEXT, \
               dt_start       TEXT, \
               dt_end         TEXT, \
               duration       INT,  \
               level          INT,  \
               num_entries    INT ); ");
   execute_sql(sql, db_sessions);


SELECT dt_start, dt_end, duration FROM gm WHERE dt_start BETWEEN '$date' AND '$date2';


I should put them in a php array


each one with start, end, and other stuff...id?
$gms = array();


OK i got that,now what?

convert all these into offset of seconds

dt_start will be zero and all others will be distance from that

I already have start in datetime format, need to convert gm ones


now when I make these things I need to make the spaces in between as well


assumptions:
gm's are ordered by date
gm's do not overlap


I am going to iterate all gms and make spacers


1 - find the first gm start, if less than 0 clamp to 0
if more than zero, insert a spacer from 0 to its start

is the end of the gm past the entire range?
if yes then clamp to end and done
int not, then end is new working pos


find next gm start

insert space from working pos to start
find end, is end past last pos



first make some nice names


for the entire range

DateTimes: DT1 DT2 
text  DT1_t DT2_t
int seconds DT1_s DT2_s 


Timeline

DT1 (start): 20260115-030527  :  0
DT2 (end)  : 20260115-040527  :  3600
id:RSXBWZWQSLXJNDVQ - 3475 - 3482 - 7
id:CJFTUIWAIJYTKNHD - 3495 - 3508 - 13
id:NNNJHWLDBVPBQSWN - 3516 - 3539 - 23



spacer           - 0 - 809 - 809 - 
RSXBWZWQSLXJNDVQ - 809 - 816 - 7 - 
spacer           - 816 - 829 - 13 - 
CJFTUIWAIJYTKNHD - 829 - 842 - 13 - 
spacer           - 842 - 850 - 8 - 
NNNJHWLDBVPBQSWN - 850 - 873 - 23 - 
spacer           - 873 - 3600 - 2727 - 


I am getting closer...now what?

when I make these tables what do I need?
section sizes is all









   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:0;    border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:200;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:800;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";

   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:200;  border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:600;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:200;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";

   echo "<div id=\"current_session\" style=\" display:flex  \"  >";
      echo "<div style=\" flex:400;  border: 1px solid #00FF00;  \"  ></div>";
      echo "<div style=\" flex:600;  border: 1px solid #FF0000;  \"  >session</div>";
      echo "<div style=\" flex:0;  border: 1px solid #00FF00;  \"  ></div>";
   echo "</div>";








chart.js
am I going to the dark side?
why do I not like javascript?





<script
src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js">
</script>




<canvas id="myChart" style="width:100%;max-width:700px"></canvas>







echo <<<TEXT

<!DOCTYPE html>
<html class="dark">

<head>

<link rel="stylesheet" href="./sessions.css">
<script src="../assets/js/jquery-3.7.1.slim.min.js"></script>
<link rel="stylesheet" href="../assets/css/datatables.min.css" />
<script src="../assets/js/datatables.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>



</head>

<body>
TEXT;


























<canvas id="myChart" style="width:100%;max-width:700px"></canvas>

<script> 

var xValues = ["Italy", "France", "Spain", "USA", "Argentina"];
var yValues = [55, 49, 44, 24, 15];
var barColors = ["red", "green","blue","orange","brown"];

new Chart("myChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {...}
});


</script> 


</body></html>







I am starting to learn javascript...

from a very basic starting place..


make a folder called scripts
in that will live your javascript files *.js

make one called main.js



on the page you want to use it in enter this just before the closing </head>

<script async src="scripts/main.js"></script>



in the script


// Store a reference to the <h1> in a variable
const myHeading = document.querySelector("h1");
// Update the text content of the <h1>
myHeading.textContent = "Hello world!";





const myImage = document.querySelector("img");

myImage.addEventListener("click", () => {
  const mySrc = myImage.getAttribute("src");
  if (mySrc === "images/firefox-icon.png") {
    myImage.setAttribute("src", "images/firefox2.png");
  } else {
    myImage.setAttribute("src", "images/firefox-icon.png");
  }
});



In this code, you stored a reference to your <img> element in the myImage variable.
Then you assigned it a click event handler function.
Every time the <img> is clicked, the function does the following:

    Retrieves the value of the image's src attribute.
    Uses a conditional (if...else structure) to check if the src value is equal to the path of the original image:
        If it is, the code changes the src value to the path of the second image,
        forcing the other image to be loaded inside the <img> element.
        If it isn't (meaning the image has already been changed), the src value swaps back to the original image path.










2026-01-15 06:51:41


running out of time...

I would like to make the chart.js work for my chart

I would like to make the buttons do things...

get the existing chart to show on the other page..


the term gantt chart is what I want
timeline horizonatal axis





<!DOCTYPE html>
<html>
<head>
    <title>Chart.js Gantt Example</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <!-- Include a date adapter, e.g., date-fns -->
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
</head>
<body>
    <div style="width: 800px;">
        <canvas id="ganttChart"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('ganttChart').getContext('2d');

        // Sample data: each data point is an array [start_date, end_date]
        const tasksData = {
            labels: ['Task 1', 'Task 2', 'Task 3'],
            datasets: [{
                label: 'Project Schedule',
                data: [
                    ['2025-01-15', '2025-02-10'], // Task 1 duration
                    ['2025-02-01', '2025-03-15'], // Task 2 duration
                    ['2025-03-10', '2025-04-01']  // Task 3 duration
                ],
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        const config = {
            type: 'bar', // Use bar chart
            data: tasksData,
            options: {
                indexAxis: 'y', // Makes the bar chart horizontal
                scales: {
                    x: {
                        type: 'time', // X-axis is a time scale
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        },
                        min: '2025-01-01', // Set a fixed start date for the scale
                        max: '2025-04-15'  // Set a fixed end date for the scale
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tasks'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Basic Gantt Chart Example'
                    }
                }
            }
        };

        const ganttChart = new Chart(ctx, config);
    </script>
</body>
</html>




looks like i need to install  date-fns

To install the package, run:

npm install date-fns --save
# or
yarn add date-fns


I am asuming this is on the server...

m@o3000:/var/www/html/sessions$ sudo apt install nodejs
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libcares2 libnode109 node-acorn node-busboy node-cjs-module-lexer node-undici node-xtend nodejs-doc
Suggested packages:
  npm
The following NEW packages will be installed:
  libcares2 libnode109 node-acorn node-busboy node-cjs-module-lexer node-undici node-xtend nodejs nodejs-doc
0 upgraded, 9 newly installed, 0 to remove and 69 not upgraded.
Need to get 16.1 MB of archives.
After this operation, 70.4 MB of additional disk space will be used.
Do you want to continue? [Y/n] y

m@o3000:/var/www/html/sessions$ node -v
v18.19.1

sudo apt install npm
 
npm install date-fns --save


import { differenceInDays } from 'date-fns';

const startDate = new Date(2023, 6, 15);
const endDate = new Date(2023, 6, 22);

// Calculate the number of full days between the two dates
const daysDifference = differenceInDays(endDate, startDate);
console.log(daysDifference); // Output: 7

import { format, formatDistance, formatRelative, subDays } from 'date-fns'




----------------------------------------------------------------------------------------------------------

    <!-- 1. A canvas element for the chart -->
    <div style="width: 700px;">
        <canvas id="myChart"></canvas>
    </div>

    <!-- 2. Include the Chart.js library from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 3. JavaScript code to create the chart -->
    <script>


var xValues = ["Italy", "France", "Spain", "USA", "Argentina"];
var yValues = [55, 49, 44, 24, 15];
var barColors = ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'];


//var barColors = ["red", "green","blue","orange","brown"];

        // Get the canvas element
        const ctx = document.getElementById('myChart');


const data = {
    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    datasets: [
        {
            label: 'Dataset 1',
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: 'rgba(255, 99, 132, 0.5)',
            stack: 'stackGroup1' // Datasets with the same stack key will be stacked
        },
        {
            label: 'Dataset 2',
            data: [28, 48, 40, 19, 86, 27, 90],
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            stack: 'stackGroup1'
        },
        {
            label: 'Dataset 3', // This dataset will form a separate stack if you change the stack key
            data: [10, 20, 30, 40, 50, 60, 70],
            backgroundColor: 'rgba(75, 192, 192, 0.5)',
            stack: 'stackGroup2'
        }
    ]
};

const stackedBarChart = new Chart(ctx, {
    type: 'bar',
    data: data,
    options: {
        scales: {
            x: {
                stacked: true // Enable stacking on the x-axis
            },
            y: {
                stacked: true // Enable stacking on the y-axis
            }
        }
    }
});






















































there is a really cool example here:

https://codesandbox.io/p/sandbox/chartjs-timeline-gantt-iwsbbu


there are lots of parts of it I do not understand

there appear to be 4 files:

'index.tsx'

.tsx file is a TypeScript file that contains JSX (JavaScript XML) syntax.
It is primarily used in the development of React applications to write components
that combine the type safety of TypeScript with the HTML-like markup of JSX. 

import React from 'react';
import { createRoot } from 'react-dom/client';

import { App } from './App';

const rootElement = document.getElementById('root');
createRoot(rootElement).render(<App />);



'package.json'
{
  "main": "index.tsx",
  "dependencies": {
    "chart.js": "3.8.0",
    "chartjs-adapter-date-fns": "2.0.0",
    "chartjs-plugin-datalabels": "2.0.0",
    "date-fns": "2.28.0",
    "react": "18.0.0",
    "react-chartjs-2": "4.2.0",
    "react-dom": "18.0.0",
    "react-scripts": "5.0.0"
  },
  "devDependencies": {
    "@types/faker": "5.5.3",
    "@types/react": "18.0.0",
    "@types/react-dom": "18.0.0",
    "typescript": "4.5.4"
  }
}


'TestData.ts'

class Event {
  EventName: string;
  EventSource: string;
  Start: Date;
  End: Date;
}

const simulateDate = (value: number) => {
  var t = new Date();
  t.setSeconds(t.getSeconds() + value);
  return t;
};

const testData: Event[] = [
  {
    Start: simulateDate(0),
    End: simulateDate(10),
    EventName: "LOADING",
    EventSource: "Group1"
  },
  {
    Start: simulateDate(10),
    End: simulateDate(16),
    EventName: "PROCESS",
    EventSource: "Group1"
  },
  {
    Start: simulateDate(12),
    End: simulateDate(16),
    EventName: "TIMEOUT",
    EventSource: "Group1"
  },
  {
    Start: simulateDate(16),
    End: simulateDate(28),
    EventName: "UNLOADING",
    EventSource: "Group1"
  },
  {
    Start: simulateDate(0),
    End: simulateDate(20),
    EventName: "AUTO",
    EventSource: "Group2"
  },
  {
    Start: simulateDate(20),
    End: simulateDate(24),
    EventName: "MANUAL",
    EventSource: "Group2"
  },
  {
    Start: simulateDate(22),
    End: simulateDate(28),
    EventName: "AUTO",
    EventSource: "Group2"
  },
  {
    Start: simulateDate(0),
    End: simulateDate(10),
    EventName: "EMS",
    EventSource: "Group3"
  },
  {
    Start: simulateDate(5),
    End: simulateDate(15),
    EventName: "SAFETY",
    EventSource: "Group3"
  },
  {
    Start: simulateDate(9),
    End: simulateDate(20),
    EventName: "OVERRIDE",
    EventSource: "Group3"
  },
  {
    Start: simulateDate(10),
    End: simulateDate(20),
    EventName: "TEST",
    EventSource: "Group3"
  }
];

export default testData;

'App.tsx'

200 lines...
















































/*



        // Instantiate a new Chart
        new Chart(ctx, {
            type: 'bar', // Chart type (e.g., 'bar', 'line', 'pie')
            data: {
                labels: barColors,
//                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3], // Your data points
                    borderWidth: 1
                }]



            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
  */ 


















































 
 

 















































<!DOCTYPE html>
<html>
<head>
    <title>Chart.js Gantt Example</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <!-- Include a date adapter, e.g., date-fns -->
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://cdn.jsdelivr.net"></script>
</head>
<body>
    <div style="width: 800px;">
        <canvas id="ganttChart"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('ganttChart').getContext('2d');

        // Sample data: each data point is an array [start_date, end_date]
        const tasksData = {
            labels: ['Task 1', 'Task 2', 'Task 3'],
            datasets: [{
                label: 'Project Schedule',
                data: [
                    ['2025-01-15', '2025-02-10'], // Task 1 duration
                    ['2025-02-01', '2025-03-15'], // Task 2 duration
                    ['2025-03-10', '2025-04-01']  // Task 3 duration
                ],
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        const config = {
            type: 'bar', // Use bar chart
            data: tasksData,
            options: {
                indexAxis: 'y', // Makes the bar chart horizontal
                scales: {
                    x: {
                        type: 'time', // X-axis is a time scale
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        },
                        min: '2025-01-01', // Set a fixed start date for the scale
                        max: '2025-04-15'  // Set a fixed end date for the scale
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tasks'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: {
                        display: true,
                        text: 'Basic Gantt Chart Example'
                    }
                }
            }
        };

        const ganttChart = new Chart(ctx, config);
    </script>
</body>
</html>












































2026-01-16 06:06:32

I am getting confused here...having trouble making anything work...

Going back until I can get something working...


this works:

'test4.html'

<!DOCTYPE html>
<html>
<head>
   <title>Example</title>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>
<body>

   <h1>Test 4</h1>

   <div style="width: 700px;"><canvas id="myChart"></canvas></div>
      
   <script>

      const ctx = document.getElementById('myChart');

      // Instantiate a new Chart
      new Chart(ctx, {
         type: 'bar', // Chart type (e.g., 'bar', 'line', 'pie')
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3], // Your data points
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

   </script> 

</body>
</html>





do not break it!!!

copy to test5 and try something else...

I think this line is causing me issues...

   <script src="https://cdn.jsdelivr.net"></script>


do I need a package.json file and how do I use that?

yes

where does it live?



this is all so complex

I want simpler

an add on library for php that interacts with  chart.js

bbsnly/chartjs-php

install with composer

composer require bbsnly/chartjs-php


Open your terminal and run the following commands to update your package list and install the required packages, including php-cli (PHP Command Line Interface), unzip, curl, git, and php-mbstring: 
bash

sudo apt update && sudo apt upgrade -y
sudo apt install curl php-cli php-mbstring git unzip -y

Step 2: Download and install Composer globally 
Next, use curl to download the Composer installer script and then run a PHP command to install it system-wide in the /usr/local/bin directory, making it available as a global command: 
bash

curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer

This command automatically fetches the latest stable version of Composer. 
Step 3: Verify the installation
After the installation is complete, verify that it was successful by running the composer command in your terminal. You should see output displaying the Composer version and available commands: 
bash

composer

these are the lines I actually used
----------------------------------------
sudo apt install curl php-cli php-mbstring git unzip -y
curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/local/bin --filename=composer
composer
composer require bbsnly/chartjs-php
----------------------------------------

2026-01-16 07:15:52

now lets take it for a test drive:







    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>








    <!-- The PHP script will output the canvas and chart initialization here -->

    <?php include 'data.php'; ?>

    <!-- A fallback canvas if PHP fails or for basic setup -->
    <canvas id="myBarChart" width="400" height="200"></canvas>

    <script>
        // If data.php outputs JS, it runs automatically.
        // If you use toJson() from PHP, you'd fetch it here with JavaScript (fetch API)
        // and then create the chart in JS.
    </script>







2026-01-17 00:48:52
I have a simple example in test45 working
It simply shows how a php index file can contain another php file
It seems very simple, but for some reason last night I was having trouble getting even that to work...

'index.php'

<?php

echo <<<TEXT

<!DOCTYPE html>
<html>
<head>
    <title>inserting PHP code into html</title>
</head>
<body>
   <h2>Natural rr numbers</h2>
TEXT;

include 'data.php'

?>

</body>
</html>

'data.php'

<?php
  $i = 1;
  echo "the first 10 natural numbers are:";
  for($i = 1; $i <= 10; $i++) { 
    echo $i;
  }
?>

bbsnly/chartjs-php









2026-01-17 08:09:37

why am I storing DATETIMES in sqlite as YYYYMMDD-HHMMSS?
that is not a valid ISO8601 format

The delimiter bewtween date and time cannot be anything but T

removing the hyphen and colons is acceptable, but the most recommended is:
YYYY-MM-DDTHH:MM:SS



I don't know if I want to change things now...

The main issue I have is I can't select from sqlite as unixepoch

where do I use it?

sessions and gm both have start and end

I think I want to fix it:




 
2026-01-17 11:23:57

I got google charts to work! I have live gm data!!!


now I need to figure out range controls

- figure out range controls

ChartRangeFilter





later when I integrate this into the sessions page,
It will be just a graphical representation of the table data.
clicking on a session or gm will have the same effect as doing so from the tables..



got it in the page


now get it to use some session values



2026-01-18 02:39:47

wow, yesterday i was getting frustrated.
this web design stuff is new to me
so many thuigs to learn, many dead ends
much uncertanty about the right way of doing things

today, I want to get the timeline graph in place and working

- first task:
how can i call it, in a function, how do I see variables

all the other things on the sessions page, I call a php script and they fill in their section

this one, I just have a div tag and the script fills it

the script runs in the header

it calls this php function to get the json

what if I put the div and the php fucntion all in the same file and just included that


at the bare minimum I need to get 2 date ranged to the 





2026-01-18 03:23:07

I can read current session id in 'get_timeline_data'

I can use it to set start and end

so that only current session is shown in timeline


how to make this better?


what if all this were one file?


show_timeline

and it had everything:

the setup, the data extraction and the div..

then I could just call a function to spit out the div

and maybe a nice frame...


the data extraction whould be just a function in that page

lets try to do this in small pieces

first, cann I figure out how to call the data extarction like a function instead of a file






































/*
        function drawDashboard() {
            // Use fetch API to get data from the PHP script
            fetch('get_timeline_data.php')
                .then(response => response.json())
                .then(jsonData => {
                    var container = document.getElementById('chart_div');
                    var chart = new google.visualization.Timeline(container);
                    var data = new google.visualization.DataTable(jsonData);
                    var options = {
                        timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' },
                        hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
                    };
                    chart.draw(data, options);
                   
                    
                    google.visualization.events.addListener(
                        chart,
                        'select',
                        function() {
                            var row = chart.getSelection()[0].row;
                            alert('You selected ' + "\n" + data.getValue(row, 0) + "\n" + data.getValue(row, 1));
                        }
                    );
                })
                .catch(error => console.error('Error fetching data:', error));
*/



        function drawDashboard() {
            // Use fetch API to get data from the PHP script

           $tld = getTimelineData();

            var jsonData = JSON.parse("<?php echo $tld; ?>");




/*
<?php
$php_string = "Hello, world!";
$php_array = array("apple", "banana", "cherry");
?>

<script>
    // For a simple string
    var js_string = "<?php echo addslashes($php_string); ?>";
    console.log(js_string); // Output: Hello, world!

    // For an array or object, use JSON.parse
    var js_array = JSON.parse('<?php echo json_encode($php_array); ?>');
    console.log(js_array); // Output: ["apple", "banana", "cherry"]
</script>




            fetch('get_timeline_data.php')
                .then(response => response.json())
                .then(jsonData => {

*/

                    var container = document.getElementById('chart_div');
                    var chart = new google.visualization.Timeline(container);
                    var data = new google.visualization.DataTable(jsonData);
                    var options = {
                        timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' },
                        hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
                    };
                    chart.draw(data, options);
                   
 /*                   
                    google.visualization.events.addListener(
                        chart,
                        'select',
                        function() {
                            var row = chart.getSelection()[0].row;
                            alert('You selected ' + "\n" + data.getValue(row, 0) + "\n" + data.getValue(row, 1));
                        }
                    );
 
 */
 
 
 
 
 //               })
      //          .catch(error => console.error('Error fetching data:', error));



it says its valid JSON

{"cols":[{"id":"RowLabel","label":"RowLabel","type":"string"},{"id":"BarLabel","label":"BarLabel","type":"string"},{"id":"Start","label":"Start Date","type":"datetime"},{"id":"End","label":"End Date","type":"datetime"}],"rows":[{"c":[{"v":"gm"},{"v":"HVEUDAHSEENKQCSG"},{"v":"Date( 1768655122000 )"},{"v":"Date( 1768655128000 )"}]},{"c":[{"v":"gm"},{"v":"DFHVLXFZVFJOMKII"},{"v":"Date( 1768664218000 )"},{"v":"Date( 1768664222000 )"}]},{"c":[{"v":"gm"},{"v":"URMLLZPQRTTZPPFN"},{"v":"Date( 1768667793000 )"},{"v":"Date( 1768668307000 )"}]},{"c":[{"v":"Forest"},{"v":"Forest"},{"v":"Date( 1768655118000 )"},{"v":"Date( 1768655132000 )"}]},{"c":[{"v":"Forest"},{"v":"Forest"},{"v":"Date( 1768664212000 )"},{"v":"Date( 1768664225000 )"}]},{"c":[{"v":"Forest"},{"v":"Forest"},{"v":"Date( 1768667688000 )"},{"v":"Date( 1768668309000 )"}]}]}

yet nothing draws



I was returing from the function like this:

      $dataTable['rows'][] = ['c' => $temp];
   }
   return json_encode($dataTable);
}

then doing this:
      <?php  $tld = getTimelineData();  ?> 
     var jsonData = "<?php echo $tld; ?>";


to fix it I now do this:

return as php array:

      $dataTable['rows'][] = ['c' => $temp];
   }
   return $dataTable;
}
    <?php  $tld = getTimelineData(); ?> 
    var jsonData = JSON.parse('<?php echo json_encode($tld); ?>');


in one line:

    var jsonData = JSON.parse('<?php echo json_encode(getTimelineData()); ?>');




OK that is really coming along


now I want to move it to its own file...if I can



// convert sql date to java format
function getJDate($d)
{

   $dt = date('U', strtotime($d)) * 1000; 
   $st = "Date( $dt )";
   return $st;
}

function getTimelineData()
{

   $dataTable = [
       'cols' => [
           ['id' => 'RowLabel', 'label' => 'RowLabel',   'type' => 'string'],
           ['id' => 'BarLabel', 'label' => 'BarLabel',   'type' => 'string'],
           ['id' => 'Start',    'label' => 'Start Date', 'type' => 'datetime'],
           ['id' => 'End',      'label' => 'End Date',   'type' => 'datetime']
       ],
       'rows' => []
   ];

   // get game moves
   $sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm";
   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $muid        = $row['muid'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

       $temp = [
          ['v' => 'gm'],
          ['v' => $muid],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }

   // get sessions
   $sql = "SELECT id, dt_start, dt_end, player_name FROM sessions";
   //echo $sql;

   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $id       = $row['id'];
      $name     = $row['player_name'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

      $temp = [
          ['v' => $name],
          ['v' => $name],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }
   return $dataTable;
}


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

   google.charts.load('current', {'packages':['timeline']});

   // Set a callback to run when the Google Visualization API is loaded.
   google.charts.setOnLoadCallback(drawDashboard);

   function drawDashboard()
   {
      var jsonData = JSON.parse('<?php echo json_encode(getTimelineData()); ?>');

      var container = document.getElementById('chart_div');
      var chart = new google.visualization.Timeline(container);
      var data = new google.visualization.DataTable(jsonData);
      var options =
      {
         timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' },
         hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
      };
      chart.draw(data, options);
   }

</script>






it does not work when it is in its own file....


<?php

session_start();


// database setup
$db_filepath = "/home/m/dev/purple_martians/data/sessions.db";
if (!file_exists($db_filepath))
{
   echo "Database file: $filename not found.";
   return;
}
$db = new PDO("sqlite:/home/m/dev/purple_martians/data/sessions.db");


// convert sql date to java format
function getJDate($d)
{

   $dt = date('U', strtotime($d)) * 1000; 
   $st = "Date( $dt )";
   return $st;
}

function getTimelineData()
{

   $dataTable = [
       'cols' => [
           ['id' => 'RowLabel', 'label' => 'RowLabel',   'type' => 'string'],
           ['id' => 'BarLabel', 'label' => 'BarLabel',   'type' => 'string'],
           ['id' => 'Start',    'label' => 'Start Date', 'type' => 'datetime'],
           ['id' => 'End',      'label' => 'End Date',   'type' => 'datetime']
       ],
       'rows' => []
   ];

   // get game moves
   $sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm";
   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $muid        = $row['muid'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

       $temp = [
          ['v' => 'gm'],
          ['v' => $muid],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }

   // get sessions
   $sql = "SELECT id, dt_start, dt_end, player_name FROM sessions";
   //echo $sql;

   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $id       = $row['id'];
      $name     = $row['player_name'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

      $temp = [
          ['v' => $name],
          ['v' => $name],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }
   return $dataTable;
}

?>


<!DOCTYPE html>
<html class="dark">

<head>


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

   google.charts.load('current', {'packages':['timeline']});

   // Set a callback to run when the Google Visualization API is loaded.
   google.charts.setOnLoadCallback(drawDashboard);

   function drawDashboard()
   {
      var jsonData = JSON.parse('<?php echo json_encode(getTimelineData()); ?>');

      var container = document.getElementById('chart_div');
      var chart = new google.visualization.Timeline(container);
      var data = new google.visualization.DataTable(jsonData);
      var options =
      {
         timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' },
         hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
      };
      chart.draw(data, options);
   }

</script>

</head>

<body>


   <div id=\"chart_div\">HERE I AM!</div>



</body></html>

I wonder if I could just make a function to load everything in the head and another to just show the div?

yes...

what I have now:

<?php

session_start();


// convert sql date to java format
function getJDate($d)
{

   $dt = date('U', strtotime($d)) * 1000; 
   $st = "Date( $dt )";
   return $st;
}

function getTimelineData()
{
   $dataTable = [
       'cols' => [
           ['id' => 'RowLabel', 'label' => 'RowLabel',   'type' => 'string'],
           ['id' => 'BarLabel', 'label' => 'BarLabel',   'type' => 'string'],
           ['id' => 'Start',    'label' => 'Start Date', 'type' => 'datetime'],
           ['id' => 'End',      'label' => 'End Date',   'type' => 'datetime']
       ],
       'rows' => []
   ];

   // get gm
   $sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm";
   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $muid        = $row['muid'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

       $temp = [
          ['v' => 'gm'],
          ['v' => $muid],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }

   // get sessions
   $sql = "SELECT id, dt_start, dt_end, player_name FROM sessions";
   //echo $sql;

   $res = $GLOBALS['db']->query($sql);
   while ($row = $res->fetch(PDO::FETCH_ASSOC))
   {
      $id       = $row['id'];
      $name     = $row['player_name'];
      $st = getJDate($row['dt_start']);
      $en = getJDate($row['dt_end']);

      $temp = [
          ['v' => $name],
          ['v' => $name],
          ['v' => $st],
          ['v' => $en]
      ];
      $dataTable['rows'][] = ['c' => $temp];
   }
   return $dataTable;
}


function setup_timeline()
{
?>
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
      var jsonData = JSON.parse('<?php echo json_encode(getTimelineData()); ?>');
      google.charts.load('current', {'packages':['timeline']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawDashboard);

      function drawDashboard()
      {
         var container = document.getElementById('chart_div');
         var chart = new google.visualization.Timeline(container);
         var data = new google.visualization.DataTable(jsonData);
         var options =
         {
            timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' },
            hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
         };
         chart.draw(data, options);
      }
   </script>
<?php
}


function show_timeline()
{
   $but = "class=\"button\" id=\"current_gm_button\""; 

   echo "<div id=\"current_gm\"  class=\"div-section-container\">";
      echo "<div id=\"current_gm\"  class=\"div-section-title-section-frame\">";
         echo "<div id=\"current_gm\"  class=\"divSectionTitleSectionContainer\">";
            echo "<div id=\"current_gm\"  class=\"div-section-title-frame\">Sessions Timeline</div>";

            echo "<div id=\"current_gm\"  class=\"div-section-title-frame-buttons-frame\">";

            echo "</div>";

         echo "</div>";
      echo "</div>";
      echo "<div id=\"current_session\"  class=\"div-section-sub-section-pretext\">";
         echo "<div id=\"chart_div\"></div>";
      echo "</div>";
   echo "</div>";
}

?>



I think I am going to move out a bunch of test htmp and php...done



now...

where do I want to control the range for the timeline

I put back in where I just get it from the current session

I think I want some buttons in the title bar to control stuff

RANGE: ALL CURRENT SESSION DAY MONTH HOUR

i want to have prev and next buttons as well

I don't think I can force timeline range, so I might need to do fake timeline entried to get what I want

where will I keep all these varaibles?

in sessions, just like all the others...

timeline_range_mode
timeline_range_start
timeline_range_end

mode:
0 - all
1 - current session
2 - current gm
3 - hour
4 - day
5 - week

any more than that and I would never be able to see anything





array(2) {
  ["cols"]=>
  array(4) {
    [0]=>
    array(3) {
      ["id"]=>
      string(8) "RowLabel"
      ["label"]=>
      string(8) "RowLabel"
      ["type"]=>
      string(6) "string"
    }
    [1]=>
    array(3) {
      ["id"]=>
      string(8) "BarLabel"
      ["label"]=>
      string(8) "BarLabel"
      ["type"]=>
      string(6) "string"
    }
    [2]=>
    array(3) {
      ["id"]=>
      string(5) "Start"
      ["label"]=>
      string(10) "Start Date"
      ["type"]=>
      string(8) "datetime"
    }
    [3]=>
    array(3) {
      ["id"]=>
      string(3) "End"
      ["label"]=>
      string(8) "End Date"
      ["type"]=>
      string(8) "datetime"
    }
  }
  ["rows"]=>
  array(6) {
    [0]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(2) "gm"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(16) "HVEUDAHSEENKQCSG"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768655122000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768655128000 )"
        }
      }
    }
    [1]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(2) "gm"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(16) "DFHVLXFZVFJOMKII"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768664218000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768664222000 )"
        }
      }
    }
    [2]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(2) "gm"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(16) "URMLLZPQRTTZPPFN"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768667793000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768668307000 )"
        }
      }
    }
    [3]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768655118000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768655132000 )"
        }
      }
    }
    [4]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768664212000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768664225000 )"
        }
      }
    }
    [5]=>
    array(1) {
      ["c"]=>
      array(4) {
        [0]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [1]=>
        array(1) {
          ["v"]=>
          string(6) "Forest"
        }
        [2]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768667688000 )"
        }
        [3]=>
        array(1) {
          ["v"]=>
          string(21) "Date( 1768668309000 )"
        }
      }
    }
  }
}
{"cols":[{"id":"RowLabel","label":"RowLabel","type":"string"},{"id":"BarLabel","label":"BarLabel","type":"string"},{"id":"Start","label":"Start Date","type":"datetime"},{"id":"End","label":"End Date","type":"datetime"}],"rows":[{"c":[{"v":"gm"},{"v":"HVEUDAHSEENKQCSG"},{"v":"Date( 1768655122000 )"},{"v":"Date( 1768655128000 )"}]},{"c":[{"v":"gm"},{"v":"DFHVLXFZVFJOMKII"},{"v":"Date( 1768664218000 )"},{"v":"Date( 1768664222000 )"}]},{"c":[{"v":"gm"},{"v":"URMLLZPQR








some other charting options....

apache echarts


https://codepen.io/luke-fnm/pen/NWYOBjE



https://codepen.io/joanneccwang/pen/XWMjzGJ





SELECT
    t1.column_a,
    t2.column_b,
    LEAST(t1.column_a, t2.column_b) AS min_value_across_columns
FROM
    Table1 t1
JOIN
    Table2 t2 ON t1.id = t2.id; -- Join condition to link corresponding rows



SELECT MIN(t.column_name) AS min_value
FROM (
    SELECT column_name FROM table1
    UNION ALL
    SELECT column_name FROM table2
) AS t;


2026-01-18 09:09:05


I have the range selection buttons and the range display buttons all working

next:

- process clicks to set current session / gm
- why does it take so much vertiacl space underneath?
- style colors, tooltips, etc




// Source - https://stackoverflow.com/a
// Posted by WhiteHat
// Retrieved 2026-01-18, License - CC BY-SA 3.0

        var paddingHeight = 40;
        var rowHeight = data.getNumberOfRows() * 50;
        var chartHeight = rowHeight + paddingHeight;

        var options = {
            titlePosition: 'none',
            width: 1400,

            height: chartHeight,
            chartArea: {
              height: rowHeight,
            },

            legend: { position: 'top', maxLines: 3 },
            bar: { groupWidth: '50%' },
            isStacked: true,
            hAxis: {
                title: 'Business Hours (excluding weekends & holidays)'
            },
            colors: ['#0066ff', '#33cc33', '#ffcc00', '#ff0000'],
            annotations: {
                alwaysOutside: true,
                textStyle: {
                    color: '#000000'
                }
            }
        }







         var container = document.getElementById('chart_div');
         var chart = new google.visualization.Timeline(container);
//         var data = new google.visualization.DataTable(jsonData);





    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn({ type: 'string', id: 'Role' });
    dataTable.addColumn({ type: 'string', id: 'Name' });
    dataTable.addColumn({ type: 'date', id: 'Start' });
    dataTable.addColumn({ type: 'date', id: 'End' });
    dataTable.addRows([
      [ 'President', 'George Washington', new Date(1789, 3, 30), new Date(1797, 2, 4) ],
      [ 'President', 'John Adams', new Date(1797, 2, 4), new Date(1801, 2, 4) ],
      [ 'President', 'Thomas Jefferson', new Date(1801, 2, 4), new Date(1809, 2, 4) ]]);


        var paddingHeight = 20;
        var rowHeight = dataTable.getNumberOfRows() * 50;
        var chartHeight = rowHeight + paddingHeight;

         var options =
         {


            hAxis: { textPosition: 'in', slantedText: true }, // can sometimes help, or use maxAlternation for label spacing.

            height: chartHeight,
            chartArea: {
              height: rowHeight,
            },


      timeline: { groupByRowLabel: false }




// works
            //timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' }
//            hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
//           height: 30,  



//    The hAxis controls labels along the bottom (time). Adjust textPosition and slantedText.
//             hAxis: { textPosition: 'out', slantedText: true } // can sometimes help, or use maxAlternation for label spacing.



// these do nothing
//            chartArea: { top: 0, bottom: 0, left: 0, right: 0, height: '30%' },
//            chartArea: { top: 0, bottom: 0, left: 50, right: 0 },
//            height: '50%'
//           forceIFrame: true
//           margins: 50 
//         padding: 50 


         };
         chart.draw(dataTable, options);

      }
           
      // Add event listener to redraw the chart on window resize
      window.addEventListener('resize', drawChart, false);
      


goddman buggy piece of shit google timeline, i fucking hate it so much


I have this unavoidable gap at the bottom.....

try a minimal example to see it it is reproducible...

<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['timeline']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var container = document.getElementById('timeline');
        var chart = new google.visualization.Timeline(container);
        var dataTable = new google.visualization.DataTable();

        dataTable.addColumn({ type: 'string', id: 'President' });
        dataTable.addColumn({ type: 'date', id: 'Start' });
        dataTable.addColumn({ type: 'date', id: 'End' });
        dataTable.addRows([
          [ 'Washington', new Date(1789, 3, 30), new Date(1797, 2, 4) ],
          [ 'Adams',      new Date(1797, 2, 4),  new Date(1801, 2, 4) ],
          [ 'Jefferson',  new Date(1801, 2, 4),  new Date(1809, 2, 4) ]]);

        chart.draw(dataTable);
      }
    </script>
  </head>
  <body>
    <div id="timeline" style="height: 180px; border: 2px solid #ff0000"  ></div>
  </body>
</html>


does not happen here....








   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">
      var jsonData = JSON.parse('<?php echo json_encode(getTimelineData()); ?>');
      google.charts.load('current', {'packages':['timeline']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

      function drawChart()
      {
         var container = document.getElementById('chart_div');
         var chart = new google.visualization.Timeline(container);
//         var data = new google.visualization.DataTable(jsonData);





    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn({ type: 'string', id: 'Role' });
    dataTable.addColumn({ type: 'string', id: 'Name' });
    dataTable.addColumn({ type: 'date', id: 'Start' });
    dataTable.addColumn({ type: 'date', id: 'End' });
    dataTable.addRows([
      [ 'President', 'George Washington', new Date(1789, 3, 30), new Date(1797, 2, 4) ],
      [ 'President', 'John Adams', new Date(1797, 2, 4), new Date(1801, 2, 4) ],
      [ 'President', 'Thomas Jefferson', new Date(1801, 2, 4), new Date(1809, 2, 4) ]]);


        var paddingHeight = 20;
        var rowHeight = dataTable.getNumberOfRows() * 50;
        var chartHeight = rowHeight + paddingHeight;

         var options =
         {


            hAxis: { textPosition: 'in', slantedText: true }, // can sometimes help, or use maxAlternation for label spacing.

            height: chartHeight,
            chartArea: {
              height: rowHeight,
            },


      timeline: { groupByRowLabel: false }




// works
            //timeline: { tooltipDateFormat: 'yyyyMMdd-hh:mm:ss' }
//            hAxis: { format: 'yyyyMMdd-hh:mm:ss'  }
//           height: 30,  



//    The hAxis controls labels along the bottom (time). Adjust textPosition and slantedText.
//             hAxis: { textPosition: 'out', slantedText: true } // can sometimes help, or use maxAlternation for label spacing.



// these do nothing
//            chartArea: { top: 0, bottom: 0, left: 0, right: 0, height: '30%' },
//            chartArea: { top: 0, bottom: 0, left: 50, right: 0 },
//            height: '50%'
//           forceIFrame: true
//           margins: 50 
//         padding: 50 


         };
         chart.draw(dataTable, options);

      }
           
      // Add event listener to redraw the chart on window resize
      window.addEventListener('resize', drawChart, false);
      
   </script>






it does the same


what I have found is there is not auto height, you need to specify it


I will count the number of rows and do it that way

but then I have to count the number that are in the same column...


I could check the data just before drawing...

the number of unique rows would tell me that


getDistinctValues(columnIndex)




it looks like each row is 41 pixels high which measures 14mm on my monitor

the bottom axis area is 16mm high

these values work well

    dataTable.addColumn({ type: 'date', id: 'End' });
    dataTable.addRows([

      [ 'President', 'George Washington', new Date(1789, 3, 30), new Date(1797, 2, 4) ],
      [ 'President', 'John Adams', new Date(1797, 2, 4), new Date(1801, 2, 4) ],
      [ 'President', 'Thomas Jefferson', new Date(1801, 2, 4), new Date(1809, 2, 4) ]]);

      for (let i = 0; i < 40; i++) {  dataTable.addRows([ [ 'President', 'John Adams', new Date(1797, 2, 4), new Date(1801, 2, 4) ] ]) };


    const myArray = dataTable.getDistinctValues(0);
    console.log("Hello");
    for (let i = 0; i < myArray.length; i++) { console.log(myArray[i]); }
    var paddingHeight = 50;
    var rowHeight = dataTable.getNumberOfRows() * 41;
    var chartHeight = rowHeight + paddingHeight;
    console.log(chartHeight);
    var options =
    {
       timeline: { groupByRowLabel: false },
       height: chartHeight,
       chartArea: { height: rowHeight }


ok go implement this...

I put it all back...


now do the colors and padding



colors...

I want to specify them myself...

can I store more data in the table than is used? absoluletly

color for one
id
level num

lets start with color

I think I want to use all the columns

fill it from database with php

modify before sending to chart

it does not look like there is any option to do that...colors cannot be set like that








2026-01-18 13:02:16
some other charting options....

apache echarts

https://codepen.io/luke-fnm/pen/NWYOBjE


make this work:


I now have a task...

make this simple example work for my use case



first of all, data structure

I learned from the last one, the bare minimum is name, start, end

I also want id or muid, color, level num if aplicable, player name

what do echarts data structure look like and how do I get data into it?



each data point will have:

color
name
id


sessions will have:
id
start
end
player_name
player_color

gm will have
muid
start
end
level_num


They will have a common data structure
DATETIME start
DATETIME end
int type (0 for session, 1 for player)

(session only)
int id
int player_color
string player_name

(gm only)
string muid
int level_num



DATETIME start
DATETIME end
int type (0 for session, 1 for player)

(session only)
int id
int player_color
string player_name

(gm only)
string muid
int level_num

2 x datetime
2 x string
4 x int

all gm will be in the same row
players with the same name will be in the same row (unless they overlap)


so all my data points will not know what row they are in until they are added





// Initialize the chart and show loading animation
var myChart = echarts.init(document.getElementById('main'));
myChart.showLoading(); // Enable loading effect

// Fetch data asynchronously (using the Fetch API for modern JavaScript)
fetch('data.json')
    .then(response => response.json())
    .then(data => {
        myChart.hideLoading(); // Hide loading effect

        // Update the chart options with the fetched data
        myChart.setOption({
            xAxis: {
                data: data.categories // Assuming data.json has a 'categories' field
            },
            series: [{
                // Update the series data
                data: data.values // Assuming data.json has a 'values' field
            }]
        });
    })
    .catch(error => {
        myChart.hideLoading();
        console.error('Error fetching data:', error);
    });





I think I want to do this... call an external script that loads the data


2026-01-18 14:58:37

where do I start?

you need to do this on the server
moved to server...

add this async load code..

done...
I now am getting data from my database with php, formatting it as JSON and sending it to js


{
  "cols": [
    {
      "id": "RowLabel",
      "label": "RowLabel",
      "type": "string"
    },
    {
      "id": "BarLabel",
      "label": "BarLabel",
      "type": "string"
    },
    {
      "id": "Start",
      "label": "Start Date",
      "type": "datetime"
    },
    {
      "id": "End",
      "label": "End Date",
      "type": "datetime"
    }
  ],
  "rows": [
    {
      "c": [
        {
          "v": "gm"
        },
        {
          "v": "HVEUDAHSEENKQCSG"
        },
        {
          "v": "Date( 1768655122000 )"
        },
        {
          "v": "Date( 1768655128000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "gm"
        },
        {
          "v": "DFHVLXFZVFJOMKII"
        },
        {
          "v": "Date( 1768664218000 )"
        },
        {
          "v": "Date( 1768664222000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "gm"
        },
        {
          "v": "URMLLZPQRTTZPPFN"
        },
        {
          "v": "Date( 1768667793000 )"
        },
        {
          "v": "Date( 1768668307000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "gm"
        },
        {
          "v": "DWDQUAEULXVOCPHS"
        },
        {
          "v": "Date( 1768737900000 )"
        },
        {
          "v": "Date( 1768737906000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "Forest"
        },
        {
          "v": "Forest"
        },
        {
          "v": "Date( 1768655118000 )"
        },
        {
          "v": "Date( 1768655132000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "Forest"
        },
        {
          "v": "Forest"
        },
        {
          "v": "Date( 1768664212000 )"
        },
        {
          "v": "Date( 1768664225000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "Forest"
        },
        {
          "v": "Forest"
        },
        {
          "v": "Date( 1768667688000 )"
        },
        {
          "v": "Date( 1768668309000 )"
        }
      ]
    },
    {
      "c": [
        {
          "v": "jenny!"
        },
        {
          "v": "jenny!"
        },
        {
          "v": "Date( 1768737848000 )"
        },
        {
          "v": "Date( 1768737907000 )"
                      1655647200000
        }
      ]
    }
  ]
}

now what format??




it looks like the current format is:

string name
value: 3 ints

var data = [
  {
      "name": "Valve 1",
      "value": [
          1655647200000,
          1657980000000,
          0
      ]
  },



what don't I see if I can add more?


this is how it is stored now:

[
  {
    "name": "Valve 1",
    "value": [
      1655647200000,
      1657980000000,
      0
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1657980000000,
      1659448800000,
      2
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1675980000000,
      1680448800000,
      2
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1659448800000,
      1660526144467,
      0
    ]
  },
  {
    "name": "Valve 2",
    "value": [
      1655647200000,
      1660526144467,
      1
    ]
  }
]










[
  {
    "name": "Valve 1",
    "value": [
      1655647200000,
      1657980000000,
      0
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1657980000000,
      1659448800000,
      2
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1675980000000,
      1680448800000,
      2
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1659448800000,
      1660526144467,
      0
    ]
  },
  {
    "name": "Valve 2",
    "value": [
      1655647200000,
      1660526144467,
      1
    ]
  }
]



why don't I just send all data straight from data.php? no fancy names or keys

type
DATETIME start
DATETIME end
muid
lev
id
pc
pn




DATETIME start
DATETIME end
int type (0 for session, 1 for player)

(session only)
int id
int player_color
string player_name

(gm only)
string muid
int level_num

2 x datetime
2 x string


[
  [
    0,
    "Date( 1768655122000 )",
    "Date( 1768655128000 )",
    "HVEUDAHSEENKQCSG",
    80,
    0,
    0,
    ""
  ],
  [
    0,
    "Date( 1768664218000 )",
    "Date( 1768664222000 )",
    "DFHVLXFZVFJOMKII",
    80,
    0,
    0,
    ""
  ],
  [
    0,
    "Date( 1768667793000 )",
    "Date( 1768668307000 )",
    "URMLLZPQRTTZPPFN",
    80,
    0,
    0,
    ""
  ],
  [
    0,
    "Date( 1768737900000 )",
    "Date( 1768737906000 )",
    "DWDQUAEULXVOCPHS",
    80,
    0,
    0,
    ""
  ],
  [
    1,
    "Date( 1768655118000 )",
    "Date( 1768655132000 )",
    "",
    1,
    9,
    "Forest"
  ],
  [
    1,
    "Date( 1768664212000 )",
    "Date( 1768664225000 )",
    "",
    2,
    9,
    "Forest"
  ],
  [
    1,
    "Date( 1768667688000 )",
    "Date( 1768668309000 )",
    "",
    3,
    9,
    "Forest"
  ],
  [
    1,
    "Date( 1768737848000 )",
    "Date( 1768737907000 )",
    "",
    4,
    7,
    "jenny!"
  ]
]


I now have the data in the js


this is how to define date using series...

option = {
  xAxis: {
    type: 'category',
    data: ['Matcha Latte', 'Milk Tea', 'Cheese Cocoa', 'Walnut Brownie']
  },
  yAxis: {},
  series: [
    {
      type: 'bar',
      name: '2015',
      data: [89.3, 92.1, 94.4, 85.4]
    },
    {
      type: 'bar',
      name: '2016',
      data: [95.8, 89.4, 91.2, 76.9]
    },
    {
      type: 'bar',
      name: '2017',
      data: [97.7, 83.1, 92.5, 78.1]
    }
  ]
};



the rows are called categories


I should check the data when I am inserting it

I could make sure that 0 is always for all gm's

sessions will initiallly all be asigned 1

at some point before sending the data to the chart I will need to
put all sessions in their own row, except if their names match, then they can share

I might need to revist this later...if the time range is long, then number of rows for sessions
will only ever keep growing

for now, lets just give each one its own row

i think will realign thet data from the php

make st, en, type

make gm first and all 0

then sessions to get unique auto incrementing numbers

do it fool!!!


[
  [
    "Date( 1768655122000 )",
    "Date( 1768655128000 )",
    0,
    "HVEUDAHSEENKQCSG",
    80,
    0,
    0,
    ""
  ],
  [
    "Date( 1768664218000 )",
    "Date( 1768664222000 )",
    0,
    "DFHVLXFZVFJOMKII",
    80,
    0,
    0,
    ""
  ],
  [
    "Date( 1768667793000 )",
    "Date( 1768668307000 )",
    0,
    "URMLLZPQRTTZPPFN",
    80,
    0,
    0,
    ""
  ],
  [
    "Date( 1768737900000 )",
    "Date( 1768737906000 )",
    0,
    "DWDQUAEULXVOCPHS",
    80,
    0,
    0,
    ""
  ],
  [
    "Date( 1768655118000 )",
    "Date( 1768655132000 )",
    1,
    "",
    1,
    9,
    "Forest"
  ],
  [
    "Date( 1768664212000 )",
    "Date( 1768664225000 )",
    2,
    "",
    2,
    9,
    "Forest"
  ],
  [
    "Date( 1768667688000 )",
    "Date( 1768668309000 )",
    3,
    "",
    3,
    9,
    "Forest"
  ],
  [
    "Date( 1768737848000 )",
    "Date( 1768737907000 )",
    4,
    "",
    4,
    7,
    "jenny!"
  ]
]




I am having trouble getting the data in the right format

I'm not even sure what the right format is....

I know what the existing data defined in code looks like:

var data = [
  {
      "name": "Valve 1",
      "value": [
          1655647200000,
          1657980000000,
          0
      ]
  },
  {
      "name": "Valve 3",
      "value": [
          1657980000000,
          1659448800000,
          2
      ]
  },
  {
      "name": "Valve 3",
      "value": [
          1675980000000,
          1680448800000,
          2
      ]
  },

and when I var_dump data, this is what I get:

[
  {
    "name": "Valve 1",
    "value": [
      1655647200000,
      1657980000000,
      0
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1657980000000,
      1659448800000,
      2
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1675980000000,
      1680448800000,
      2
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1659448800000,
      1660526144467,
      0
    ]
  },
  {
    "name": "Valve 2",
    "value": [
      1655647200000,
      1660526144467,
      1
    ]
  }
]



all I need to do is copy that...

what do I have?   exact....

[
  {
    "name": "Valve 1",
    "value": [
      1768655122000,
      1768655128000,
      0,
      "HVEUDAHSEENKQCSG",
      80,
      0,
      0,
      ""
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768664218000,
      1768664222000,
      0,
      "DFHVLXFZVFJOMKII",
      80,
      0,
      0,
      ""
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768667793000,
      1768668307000,
      0,
      "URMLLZPQRTTZPPFN",
      80,
      0,
      0,
      ""
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768737900000,
      1768737906000,
      0,
      "DWDQUAEULXVOCPHS",
      80,
      0,
      0,
      ""
    ]
  }
]




2026-01-19 04:50:20


I have done some more checking, I am stumped:

the data format is identical

I have buttons to
- load either array into the chart
- fetch array 2
- show both arrays




[
  {
    "name": "Valve 1",
    "value": [
      1655647200000,
      1657980000000,
      0
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1657980000000,
      1659448800000,
      2
    ]
  },
  {
    "name": "Valve 3",
    "value": [
      1675980000000,
      1680448800000,
      2
    ]
  },
  {
    "name": "Valve 4",
    "value": [
      1675980000000,
      1680448800000,
      3
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1659448800000,
      1660526144467,
      0
    ]
  },
  {
    "name": "Valve 2",
    "value": [
      1655647200000,
      1660526144467,
      3
    ]
  }
]



[
  {
    "name": "Valve 1",
    "value": [
      1768655122000,
      1768655128000,
      0
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768664218000,
      1768664222000,
      1
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768667793000,
      1768668307000,
      2
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768737900000,
      1768737906000,
      3
    ]
  }
]


1768655122000
604800000

1768050322000


could it be that my data is just too skinny?

      1768655122000,
      1768655128000,
6s

      1768664218000,
      1768664222000,
4s

      1768667793000,
      1768668307000,
8:34

      1768737900000,
      1768737906000,
6s



yes!!!

what am I going to do about it?

force a minimun width

sounds good


should I get some new data?
yes,

genarate a few from a few seconds long to 60s

then I need to figure out:
- range
- why does only/not detect from index 1

you could test this with fake data...

before I blow away the old data...nevermind I already have a copy

new data:

20260119 6:46 AM
5s
13s
34s

START:
1768805214000

END:
1768805288000



[
  {
    "name": "Valve 1",
    "value": [
      1768805214000,
      1768805219000,
      0
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768805232000,
      1768805245000,
      1
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768805254000,
      1768805288000,
      2
    ]
  }
]


It fucking works perfectly!!!!

probably because the data it not too skinny

next...
- get range from data properly
- get data from post, not static







I think I am getting somewhere,

My options definition is only read once...i need to do somthing different when reloading!!


make a base one, then a reload one








range
-----------------------------------------------------------------------------------------------------------
// Example for the first x-axis
const xAxisModel = myChart.getModel().getComponent('xAxis', 0);
if (xAxisModel && xAxisModel.axis && xAxisModel.axis.scale) {
    const xAxisExtent = xAxisModel.axis.scale.getExtent();
    console.log("Full x-axis range (extent):", xAxisExtent[0], xAxisExtent[1]);
}

this is a non canon way of getting range, but it suffers fron the same problem as

		xAxis:
       {
           min: 'dataMin', // Or a specific number/function
           max: 'dataMax'  // Or a specific number/function
       }


the end works fine, but the start always chooses this value

      1768805214000,
      1768805219000, <-------------

      1768805232000,
      1768805245000,

      1768805254000,
      1768805288000,

-----------------------------------------------------------------------------------------------------------

I think im going to try to do it manually from the data


what does the data look like again?

[
  {
    "name": "Valve 1",
    "value": [
      1768805214000,
      1768805219000,
      0
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768805232000,
      1768805245000,
      1
    ]
  },
  {
    "name": "Valve 1",
    "value": [
      1768805254000,
      1768805288000,
      2
    ]
  }
]

I need to iterate and find min value[0] and max value[1]

I think I might have realize the problem here
most charts have a single variable for x, but I have 2

step one

I have a reliable method to get the range


what next?

take a snapshot and then work on live data

also add the sessions and all data values




<?php
header('Content-Type: application/json');

// convert sql date to java format
function getJDate($d)
{
   $dt = date('U', strtotime($d)) * 1000; 
   $st = "$dt";
   return $dt;
}

// database setup
$db_filepath = "/home/m/dev/purple_martians/data/sessions.db";
if (!file_exists($db_filepath))
{
   echo "Database file: $filename not found.";
   return;
}
$db = new PDO("sqlite:/home/m/dev/purple_martians/data/sessions.db");

$data = array();

// get game moves
$sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm ";
$res = $db->query($sql);

$ty = 0; // all gm's will have type 0

while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $muid   =          $row['muid'];
   $lv     =          $row['level'];
//   $data[] = [ 'name' => 'Valve 1', 'value' => [$st, $en, $ty, $muid, $lv, 0, 0, '' ] ] ;

   $name = "Valve $ty";

   $data[] = [ 'name' => 'Valve 1', 'value' => [$st, $en, $ty ] ] ;

   $ty++; // unique row

}





/*

$dataTable = [
    'cols' => [
        ['id' => 'RowLabel', 'label' => 'RowLabel',   'type' => 'string'],
        ['id' => 'BarLabel', 'label' => 'BarLabel',   'type' => 'string'],
        ['id' => 'Start',    'label' => 'Start Date', 'type' => 'datetime'],
        ['id' => 'End',      'label' => 'End Date',   'type' => 'datetime']
    ],
    'rows' => []
];

*/


/*
// get sessions
$sql = "SELECT id, dt_start, dt_end, player_name, player_color FROM sessions";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $id     =          $row['id'];
   $pc     =          $row['player_color'];
   $pn     =          $row['player_name'];

   $ty++; // each seesion to have unique row

   $data[] = [ $st, $en, $ty, '', $id, $pc, $pn ] ;
}
*/


//   var_dump($data);

   echo json_encode($data);

?>



2026-01-19 18:54:59


<?php
header('Content-Type: application/json');

// convert sql date to java format
function getJDate($d)
{
   $dt = date('U', strtotime($d)) * 1000; 
   $st = "$dt";
   return $dt;
}

// database setup
$db_filepath = "/home/m/dev/purple_martians/data/sessions.db";
if (!file_exists($db_filepath))
{
   echo "Database file: $filename not found.";
   return;
}
$db = new PDO("sqlite:/home/m/dev/purple_martians/data/sessions.db");

$data = array();

// get game moves
$sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm ";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $muid   =          $row['muid'];
   $lv     =          $row['level'];
   $ty = 0; // all gm's will have type 0
   $data[] = [ 'value' => [$st, $en, $ty, $muid, $lv, 0, 0, '' ] ] ;
}

// get sessions
$sql = "SELECT id, dt_start, dt_end, player_name, player_color FROM sessions";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $id     =          $row['id'];
   $pc     =          $row['player_color'];
   $pn     =          $row['player_name'];
   $ty++; // each session to have unique row
   $data[] = [ 'value' => [ $st, $en, $ty, '', $id, $pc, $pn ] ] ;
}
   echo json_encode($data);
?>

I think this is final...for now



2026-01-19 19:10:47

now in js

do the appropriate number of rows

how?

manip the data in js to find unique

I think I should set name in php

for gm it will be muid

or do it in js

should I set somethings in data, or just do it all in js??

2026-01-20 06:03:15

got a bunch more common funtions working

I want to add a few columns to the data:
common to all
- color
- name of element
- name of column

for sessions:
color: player color
name of element and name of row will both be player_name

for gm:
name of row will all be the same
name of element will be muid
color will all be the same

I think it would be easy to do this in data


$data = array();

// get game moves
$sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm ";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $ty     =          0;                // all gm's will have type 0
   $cl     =          15;               // color
   $rn     =          'gm'              // row name
   $en     =          $row['muid'];     // element name
   $lv     =          $row['level'];
   $data[] = [ 'value' => [$st, $en, $ty, $cl, $rn, $en, $lv ] ] ;
}

// get sessions
$sql = "SELECT id, dt_start, dt_end, player_name, player_color FROM sessions";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $ty++;                                    // each session to have unique row
   $cl     =          $row['player_color'];  // color
   $rn     =          $row['player_name'];   // row name
   $en     =          $row['player_name'];   // element name
   $id     =          $row['id'];
   $data[] = [ 'value' => [$st, $en, $ty, $cl, $rn, $en, $id ] ] ;
}
   echo json_encode($data);
?>




#bf6ce8 
#8820ac
#3c7fff
#e01c48
#ff00e8
#ffbf7f
#ff7f00
#7f00ff
#01ff7f
#ff0000
#01ff00
#0000ff
#01ffff
#ffff00
#ffffff

const playerColors = [
   "#bf6ce8", 
   "#8820ac",
   "#3c7fff",
   "#e01c48",
   "#ff00e8",
   "#ffbf7f",
   "#ff7f00",
   "#7f00ff",
   "#01ff7f",
   '#ff0000",
   '#01ff00",
   "#0000ff",
   "#01ffff",
   '#ffff00",
   '#ffffff",
]





I am now at the point that my old datasets do not work anymore

get some new ones,

save the one you have now and generate a new one


[
  {
    "value": [
      1768849044000,
      1768849051000,
      0,
      0,
      "gm",
      "EOBUDITDIJQASENJ",
      80
    ]
  },
  {
    "value": [
      1768849056000,
      1768849062000,
      0,
      0,
      "gm",
      "KBMSXEJDVEPMYRHK",
      80
    ]
  },
  {
    "value": [
      1768849067000,
      1768849072000,
      0,
      0,
      "gm",
      "KWIVQARUGPIGERNM",
      80
    ]
  },
  {
    "value": [
      1768849038000,
      1768849077000,
      1,
      9,
      "Forest",
      "Forest",
      1
    ]
  }
]

DELETE FROM gm;
DELETE FROM gm_sessions;
DELETE FROM sessions;


make a new one:


[
  {
    "value": [
      1768891496000,
      1768891502000,
      0,
      0,
      "gm",
      "SRZQFLTUNHZAXGQZ",
      80
    ]
  },
  {
    "value": [
      1768891537000,
      1768891547000,
      0,
      0,
      "gm",
      "WQBKMFETVCKZBKBT",
      80
    ]
  },
  {
    "value": [
      1768891555000,
      1768891577000,
      0,
      0,
      "gm",
      "QNLHHDEKXEMQGHBK",
      80
    ]
  },
  {
    "value": [
      1768891489000,
      1768891579000,
      1,
      9,
      "Forest",
      "Forest",
      1
    ]
  },
  {
    "value": [
      1768891530000,
      1768891558000,
      2,
      7,
      "jenny!",
      "jenny!",
      2
    ]
  },
  {
    "value": [
      1768891566000,
      1768891577000,
      3,
      7,
      "jenny!",
      "jenny!",
      3
    ]
  }
]



DELETE FROM gm;
DELETE FROM gm_sessions;
DELETE FROM sessions;



[
  {
    "value": [
      1768891742000,
      1768891751000,
      0,
      0,
      "gm",
      "ZSQNNSBKMRXRZBDK",
      80
    ]
  },
  {
    "value": [
      1768891762000,
      1768891787000,
      0,
      0,
      "gm",
      "TGTDDQKWRXDCSKVY",
      80
    ]
  },
  {
    "value": [
      1768891805000,
      1768891827000,
      0,
      0,
      "gm",
      "TBAUSROTBOCSSVEL",
      37
    ]
  },
  {
    "value": [
      1768891724000,
      1768891730000,
      1,
      9,
      "Forest",
      "Forest",
      1
    ]
  },
  {
    "value": [
      1768891736000,
      1768891792000,
      2,
      9,
      "Forest",
      "Forest",
      2
    ]
  },
  {
    "value": [
      1768891757000,
      1768891765000,
      3,
      7,
      "jenny!",
      "jenny!",
      3
    ]
  },
  {
    "value": [
      1768891768000,
      1768891835000,
      4,
      7,
      "jenny!",
      "jenny!",
      4
    ]
  },
  {
    "value": [
      1768891777000,
      1768891831000,
      5,
      4,
      "Zaiden",
      "Zaiden",
      5
    ]
  },
  {
    "value": [
      1768891796000,
      1768891839000,
      6,
      9,
      "Forest",
      "Forest",
      6
    ]
  }
]




2026-01-20 06:53:25

now I have 3 awesome sets of data!!
colors are working!!


now I want to set the element name


i think I just need to add name to the start of the array


  {
    "name": "Valve 1",
    "value": [
      1768805214000,


It works on mouse over, but no label on rect....idc yet


2026-01-20 07:24:25

got to go...

trying to figure out how to add 'name' to start of each row in array....


what would you call this?

it looks like an array of objects


const initialArr = [{ a: 1 }, { b: 2 }];

initialArr.forEach(obj => {
  obj.isActive = true; // Using dot notation
  obj['newKey'] = 'newValue'; // Using bracket notation for dynamic keys
});

console.log(initialArr);
// Output: [ { a: 1, isActive: true, newKey: 'newValue' }, { b: 2, isActive: true, newKey: 'newValue' } ]



this is it!!!

const newArr = data.map(obj =>
{
  return { name: obj.value[4], ...obj  };
});


data = newArr;

even more concise:

data = data.map(obj =>
{
  return { name: obj.value[4], ...obj  };
});



// modify the array, add key-value 'name' and name from value 4
data = data.map(obj => { return { name: obj.value[4], ...obj  }; });




I need a function to iterate the data and build cetegories

rules:

all type 0 belong in category 0

as I read others, if they exist add to existing category, if not, create new one


can i do this in place, or should I make my own temp structure

I need name and catindex

I think I should make my own



array of catId and name

kind of like the one I have already, only with explicit numbers

I could use index for that

this is it!!!

// iterate data and setup categories
function setCategories(dat)
{
   // clear the category array
   catArr.length = 0;

   // iterate the data array
   for (let i = 0; i < dat.length; i++)
   {
      // get name
      var name = dat[i].value[4];

      // check if name already exists in catArr and get index if it does
      var catIndex = catArr.indexOf(name);
      
      // does not exist, create it and get index     
      if (catIndex === -1) catIndex = catArr.push(name) - 1;

      // set category index in data  
      dat[i].value[2] = catIndex;
   }

   maxCat = catArr.length-1; 
}


next big thing....



draw bars in other order 



//            var start = api.coord([timeSpan[0], maxCat - catIndex]);
//            var end = api.coord([timeSpan[1], maxCat -catIndex]);

            var start = api.coord([timeSpan[0], catIndex]);
            var end = api.coord([timeSpan[1], catIndex]);

tooltip to show date time

what did I have to do to get date-fns?


2026-01-21 02:36:45


I am having trouble getting date-fns working


line 3 of script.js:
import { format } from './date-fns';

I keep getting this errors:
Uncaught SyntaxError: import declarations may only appear at top level of a module

tried 

this in index.html:
<script src="./script.js", type="module" ></script>

old:
<script src="./script.js" ></script>


Loading module from http://192.168.1.146/teste/date-fns was blocked because of a disallowed MIME type (text/html). index.html


Loading module from date-fns was blocked because of a disallowed MIME type (text/html)



import data from "./data.json" with { type: "json" };


import data from "./data.json" with { type: text/html };


finally figured out a solution:
import format from './node_modules/date-fns/format.js';




verify you are storing to db in utc....

you are not....

sqlite> select * from gm;
ZSQNNSBKMRXRZBDK|20260120-064911-[80]-autosave on level done.gm|20260120-064902|20260120-064911|9|80|46
TGTDDQKWRXDCSKVY|20260120-064948-[80]-autosave on level done.gm|20260120-064922|20260120-064947|25|80|67
TBAUSROTBOCSSVEL|20260120-065027-[37]-autosave on level done.gm|20260120-065005|20260120-065027|22|37|75

you should be...

so i need to fix all that first

the proper way of handling datetimes is to store in UTC...
then only when displaying, convert to local timezone

the other things i used in the webpage worked, but now in js and date-fns, by default display in local tz and that coversion makes them off

i need to do this, because I want this to work anywhere in any timezone


start in the c++ code


2026-01-21 03:51:19

actualy it has been a long time since I did a backup....

copy all web stuff back and do a push first...done


this is how I used to do it:

   // get timestamp
   struct tm *timenow;
   time_t now = time(nullptr);
   timenow = localtime(&now);
   char ts[20];
   strftime(ts, sizeof(ts), "%Y%m%d-%H%M%S", timenow);


  just replace 
  timenow = localtime(&now);

   with 
   timenow = gm(&now);


   // get timestamp
   struct tm *timenow;
   time_t now = time(nullptr);
   timenow = gm(&now);
   char ts[20];
   strftime(ts, sizeof(ts), "%Y%m%d-%H%M%S", timenow);



while I am at it, i think earlier I want to use a more strict ISO 8601 date:

not %Y%m%d-%H%M%S 

but %Y-%m-%dT%H:%M:%S

do it fool!!

make a function to do it...

I thinK I have sessions done...test it locally..

2026-01-21 04:40:18

1|20260121-113902|||192.168.1.155|55977|e6430|open||1|Forest|9||||||||||||||||||||
1|20260121-113902|20260121-113943|1831183|192.168.1.155|55977|e6430|client_quit|0|1|Forest|9|0|0|0|0|0|0|0|0|637261|0|3704|178586|0|214|1689|0|3|1725|0|3

looks like it is working....

except it is not using 8601

1|20260121-113902|20260121-113943|1831183|192.168.1.155|55977|e6430|client_quit|0|1|Forest|9|0|0|0|0|0|0|0|0|637261|0|3704|178586|0|214|1689|0|3|1725|0|3
2|20260121-114640|2026-01-21T11:46:45|1831605|192.168.1.155|55978|e6430|client_quit|31|1|Forest|9|0|0|0|4|0|0|0|0|91669|0|3707|25464|0|214|224|0|3|258|0|3
3|2026-01-21T11:48:22|2026-01-21T11:48:25|-25197|192.168.1.155|64947|e6430|client_quit|24|1|Forest|9|0|0|0|3|0|0|0|0|51615|0|3691|13260|0|276|116|0|3|138|0|4


finally got that...but now duration is negative??

3|2026-01-21T11:48:22|
  2026-01-21T11:48:25|-25197|
  
  should be 3 seconds

duration calc
st:2026-01-21T11:54:03
dt:2026-01-21T11:54:05
duration:-25198

7 hours = 25200

fixed...

now do that with gm also

not filename...just db entry

the header?

should I just make all three the same?

at least header and db must be the same...

HSSUHQBBAOYITALB|20260121-054533-[80]-autosave on level done.gm|2026-01-21T12:45:28|20251231-000004|4|80|12
MDTQPWWWQARHYKQR|20260121-054536-[81]-autosave on level done.gm|2026-01-21T12:45:34|20251231-000000|0|81|5


muid              filename                                        dt_start             dt_end               duration  level  num_entries
----------------  ----------------------------------------------  -------------------  -------------------  --------  -----  -----------
HSSUHQBBAOYITALB  20260121-054533-[80]-autosave on level done.gm  2026-01-21T12:45:28  20251231-000004      4         80     12
MDTQPWWWQARHYKQR  20260121-054536-[81]-autosave on level done.gm  2026-01-21T12:45:34  20251231-000000      0         81     5
KRAKFMOMJQVFLDPB  20260121-055844-[80]-autosave on level done.gm  2026-01-21T12:58:37  2026-01-21T12:58:43  6         80     24
LMIBCLBPGTZKJFWG  20260121-055848-[81]-autosave on level done.gm  2026-01-21T12:58:44  2026-01-21T12:58:47  3         81     18
sqlite>

this looks good, 

PMSAVEGAME
MUID:LMIBCLBPGTZKJFWG
VERSION:3
CREATE_TIMESTAMP:2026-01-21T12:58:44
MODIFY_TIMESTAMP:2026-01-21T12:58:48
LEVEL:81
LAST_FRAME:157
GAMEMOVE_NUM_ENTRIES:18
GAMEMOVE_DATA_START:
0,0,0,81
1,9,0,5
1,8389376,1627415917,7629941
1,8390913,1701998406,29811
34,5,1,2
53,5,1,18
57,5,1,16
63,5,1,0
69,5,1,2
76,5,1,18
78,5,1,16
83,5,1,0
102,2,1,90
154,2,0,92
154,2,1,92
155,2,0,92
156,2,0,92
157,2,0,92


2026-01-21 06:02:33

ok I think I am done here....

commit and push

deploy to server and fix bugs....

sessions table uses datatables 
- first of all there is a bug where all does not work...fixed
time shows as UTC with T in the middle
   
fixed...

//   $row_list_basic =       "id,   player_color, player_name,   dt_start,             duration,  ip,   hostname,   endreason,            cdat_rx";
   $row_list_basic =       "id,   player_color, player_name,   STRFTIME('%Y-%m-%d %H:%M:%S', dt_start, 'localtime') AS dt_start,   duration,  ip,   hostname,   endreason,            cdat_rx";

next current session

even thought adding specific columns after * is not supposed to work, it does....
   $res = $GLOBALS['db']->query("SELECT *, STRFTIME('%Y-%m-%d %H:%M:%S', dt_start, 'localtime') AS dts, STRFTIME('%Y-%m-%d %H:%M:%S', dt_end, 'localtime') AS dte FROM sessions WHERE id=$current_session_id");

next gm list

next current gm


2026-01-21 06:43:22

that is all done...now back to teste


now my time show as the local tz....


2026-01-21 06:55:21


gtg for now....


2026-01-21 17:31:15

tooltip show name, duration, icon





            show: true,
            position: 'top',
            // Define custom styles for different parts of the label
            rich: {
                // Default style for the text (optional)
                normal: {
                    color: '#333',
                    fontSize: 12,
                    // Preserve whitespace and line breaks
                    whiteSpace: 'pre', // Key for preserving spaces/newlines
                    padding: [0, 0, 5, 0], // Padding below text
                },
                // Style for a specific part (e.g., for emphasis)
                highlight: {
                    color: 'red',
                    fontWeight: 'bold',
                    whiteSpace: 'pre', // Also apply here if needed
                }
            },
            // Use a formatter to combine text and apply rich styles
            formatter: (params) => {
                return '{normal|Fruit: ' + params.name + '}\n{highlight|Count: ' + params.value + '}';
            }
        }
    }]
};

   
   
   
   
  
  
  




option = {
  series: [
    {
      type: 'scatter',
      symbolSize: 1,
      data: [
        {
          value: [0, 0],
          label: {
            show: true,
            formatter: [
              'Plain text',
              '{textBorder|textBorderColor + textBorderWidth}',
              '{textShadow|textShadowColor + textShadowBlur + textShadowOffsetX + textShadowOffsetY}',
              '{bg|backgroundColor + borderRadius + padding}',
              '{border|borderColor + borderWidth + borderRadius + padding}',
              '{shadow|shadowColor + shadowBlur + shadowOffsetX + shadowOffsetY}'
            ].join('\n'),
            backgroundColor: '#eee',
            borderColor: '#333',
            borderWidth: 2,
            borderRadius: 5,
            padding: 10,
            color: '#000',
            fontSize: 14,
            shadowBlur: 3,
            shadowColor: '#888',
            shadowOffsetX: 0,
            shadowOffsetY: 3,
            lineHeight: 30,
            rich: {
              textBorder: {
                fontSize: 20,
                textBorderColor: '#000',
                textBorderWidth: 3,
                color: '#fff'
              },
              textShadow: {
                fontSize: 16,
                textShadowBlur: 5,
                textShadowColor: '#000',
                textShadowOffsetX: 3,
                textShadowOffsetY: 3,
                color: '#fff'
              },
              bg: {
                backgroundColor: '#339911',
                color: '#fff',
                borderRadius: 15,
                padding: 5
              },
              border: {
                color: '#000',
                borderColor: '#449911',
                borderWidth: 1,
                borderRadius: 3,
                padding: 5
              },
              shadow: {
                backgroundColor: '#992233',
                padding: 5,
                color: '#fff',
                shadowBlur: 5,
                shadowColor: '#336699',
                shadowOffsetX: 6,
                shadowOffsetY: 6
              }
            }
          }
        }
      ]
    }
  ],
  xAxis: {
    show: false,
    min: -1,
    max: 1
  },
  yAxis: {
    show: false,
    min: -1,
    max: 1
  }
};







            // Define custom styles for different parts of the label
            rich: {
                // Default style for the text (optional)
                normal: {
                    color: '#333',
                    fontSize: 12,
                    // Preserve whitespace and line breaks
                    whiteSpace: 'pre', // Key for preserving spaces/newlines
    //                padding: [0, 0, 5, 0], // Padding below text
                },
                // Style for a specific part (e.g., for emphasis)
                highlight: {
                    color: 'red',
                    fontWeight: 'bold',
                    whiteSpace: 'pre', // Also apply here if needed
                }
            },


/*


  // Styles for the whole text block are defined here:
  color: 'blue',
  fontSize: 15,
  fontFamily: 'Arial',

  borderWidth: 20,
  backgroundColor: '#000000',
  padding: [3, 10, 10, 5],
  lineHeight: 50,

  // Styles for text fragments are defined here:
  rich: {
    a: {
      color: 'red',
      backgroundColor: '#FF0000',
      lineHeight: 10
    },

    b: {
      color: 'green',
      backgroundColor: '#0000FF',
      lineHeight: 20
    },
  },

*/



2026-01-22 04:35:37

I spent way too much time trying to get rich text working for tooltip!!




option = {
    // ... other options
    tooltip: {
        trigger: 'axis',
        axisPointer: { // Style the axis pointer line and shadow
            type: 'cross',
            lineStyle: { color: '#555', type: 'dashed' }
        },
        formatter: function (params) {
            // Custom HTML content with series colors
            let tooltipContent = `<b>${params[0].name}</b><br/>`;
            params.forEach(p => {
                tooltipContent += `<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${p.color};"></span>`;
                tooltipContent += `${p.seriesName}: ${p.value}<br/>`;
            });
            return tooltipContent;
        },
        backgroundColor: 'rgba(245, 245, 245, 0.8)', // Light background
        borderColor: '#aaa',
        padding: 10, // Add some padding
        textStyle: {
            color: '#333', // Dark text
            fontSize: 14
        }
    },
    // ... series and other config
};




2026-01-22 05:03:26

I got it!!!


        var jc = "</span><br>"; // join char
        var s1 = '<span style="white-space:pre">';

        var txt = s1 + 'Name:' + name + jc;
        txt += s1 + 'Start : ' + fst + jc;
        txt += s1 + 'End   : ' + fet + jc;
        txt += s1 + 'Duration   : ' + fDur + jc;



2026-01-22 05:56:02

I now have the text formatting for the tooltip done..

now see if I can get an icon...



tooltip: {
    trigger: 'item',
    // It may be necessary to add extra CSS to handle pointer events if your tooltip has interactive elements
    extraCssText: 'pointer-events: auto;', 
    formatter: function (params) {
        const name = params.name;
        const value = params.value;
        
        // Define the image URL (consider security/protocol if using external URLs)
        const imageUrl = 'https://example.com/images/my-icon.png';

        // Return the custom HTML string including the image tag
        return '<img src="' + imageUrl + '" style="width: 15px; height: 15px; vertical-align: middle;"> ' + name + ': ' + value;
    }
}

2026-01-22 06:40:56

I now have a nice icon and name for my tooltips

what next?

get some more data to test with:

do a backup...

this takes a lot of stuff from date-fns


could I do with less??


date fns folder has
5326 files 20M (38M on disk)

dont commit that...

2026-01-22 07:11:35

I now have it all comitted and some new test data

its looking good!!!

how far am I from patching it into the rest?

- figure out how to use less of date-fns
- figure out how to 




2026-01-22 21:42:05

I use php to read database then pass to js, can js read database?

AI Overview
JavaScript cannot directly read databases due to security restrictions and the
nature of client-side execution [1, 2]. The model you describedusing PHP on the
server-side to fetch data from the database and then passing that data to JavaScript
is the standard, secure, and correct approach [1, 2]. 

Here's a breakdown of why this approach works and is necessary:

    Security: Databases contain sensitive information and require specific credentials
    for access. Direct access from client-side JavaScript would expose these
    credentials to anyone using the website, creating a major security vulnerability [1, 2].
    
    Environment: PHP runs on the server, where it has secure access to the database. 
    JavaScript primarily runs in the user's web browser, which is isolated from the
    server's backend infrastructure for safety [1, 2].
    
    Your Method (The correct way): You use PHP to perform the secure database
    operations. PHP then formats the data (commonly as JSON) and sends it to the
    browser. JavaScript running in the browser can then interpret and use this data to
    dynamically update the webpage [1, 2]. 

In summary, you are already using the appropriate and secure method for handling database data with JavaScript.




next...

can I create html with js, just like I do now with php...yes

why?


this all stems from wanting to not have to refresh the whole page everytime I change a variable

I'm trying to visualize the overall structure...


- page in html with place holders for each section

- js keeps all variables and handles drawing and updating and user input




I am thinking of trying vue...

react - meta
angular - google
vue open-source community

that says it all...

What am I trying to do here?

It is a huge rabbit hole to go down to do this...


2026-01-23 01:12:30


spent some time customizing the charts

took quite a while to figure out axisPointer

change toolTip to uyse 24H time to match axis and pointers..done

it does not look like I can use css with echarts...

so figure out what looks good


2026-01-24 05:05:46

make funtions to convert color formats...
I have playerColors array in format:

const playerColors = [
   "#888888", 
   "#bf6ce8", 
   "#8820ac",
   "#3c7fff",
   "#e01c48",
   "#ff00e8",

I want to generate:

var playerColorsHSL = [
   [280, 73, 67],
   [0, 73, 67],
   
   
or should I just do it once then make it static?

yes do that...

const playerColors = [
   "#888888", 
   "#bf6ce8", 
   "#8820ac",
   "#3c7fff",
   "#e01c48",
   "#ff00e8",
   "#ffbf7f",
   "#ff7f00",
   "#7f00ff",
   "#01ff7f",
   "#ff0000",
   "#01ff00",
   "#0000ff",
   "#01ffff",
   "#ffff00",
   "#ffffff",
]

const playerColorsHSL = [
  [   0, 0, 53],
  [ 280,   73,   67 ],
  [ 285,   69,   40 ],
  [ 219,  100,   62 ],
  [ 347,   78,   49 ],
  [ 305,  100,   50 ],
  [  30,  100,   75 ],
  [  30,  100,   50 ],
  [ 270,  100,   50 ],
  [ 150,  100,   50 ],
  [   0,  100,   50 ],
  [ 120,  100,   50 ],
  [ 240,  100,   50 ],
  [ 180,  100,   50 ],
  [  60,  100,   50 ],
  [   0,    0,  100 ]
]



function test()
{
   
//   playerColorsHSL.length = 0;
   
   /*
   // iterate the data array
   for (let i = 0; i < 16; i++)
   {
      console.log(playerColors[i]);

      var h = hexToRgbVal(playerColors[i]);
   
      
      console.log(h);
//      console.log(h[0], h[1], h[2]);

      var hsl = rgbToHsl(h[0], h[1], h[2]);

      var line = [hsl[0], hsl[1], hsl[2]];
       
      playerColorsHSL.push(line);

      console.log(hsl);
  
   }
*/
   
   console.log(playerColorsHSL);
   
   
   
   
   
   
}





// takes #XXXXXX and returns rgb(xxx, xxx, xxx)
function hexToRgbText(hex)
{
   let alpha = false,

   h = hex.slice(hex.startsWith('#') ? 1 : 0);

   if (h.length === 3) h = [...h].map(x => x + x).join('');
   else if (h.length === 8) alpha = true;
   h = parseInt(h, 16);
   return(
      'rgb' +
      (alpha ? 'a' : '') +
      '(' +
      (h >>> (alpha ? 24 : 16)) +
      ', ' +
      ((h & (alpha ? 0x00ff0000 : 0x00ff00)) >>> (alpha ? 16 : 8)) +
      ', ' +
      ((h & (alpha ? 0x0000ff00 : 0x0000ff)) >>> (alpha ? 8 : 0)) +
      (alpha ? `, ${h & 0x000000ff}` : '') +
      ')'
   );
}


// takes #XXXXXX and returns xxx, xxx, xxx
function hexToRgbVal(hex)
{
   var h = hex.slice(hex.startsWith('#') ? 1 : 0);
   if (h.length === 3) h = [...h].map(x => x + x).join('');
   h = parseInt(h, 16);

   let r = h >>> 16;
   let g = ((h & 0x00ff00) >>> 8);
   let b = ((h & 0x0000ff) >>> 0);

   var rgb = [r, g, b];
   return rgb;

}




function rgbToHsl(r, g, b) {
  r /= 255; g /= 255; b /= 255;
  let max = Math.max(r, g, b), min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;

  if (max === min) {
    h = s = 0; // achromatic
  } else {
    let d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
      case g: h = (b - r) / d + 2; break;
      case b: h = (r - g) / d + 4; break;
    }
    h /= 6;
  }
  return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
}



removed all this code....



2026-01-24 05:22:18

now what?

do something with this
function to return hsl(



2026-01-24 06:15:18

that is working great, but I cannot seem to get linear gradients to work on both x and y axis at the same time:

I have 2 different methods, but they both do the same thing...

either x or y, but if I do both I get x only

               style:
               {
                  fill:
//                  {

            new echarts.graphic.LinearGradient(0, 0, 1, 1, [{
                offset: 0,
                color: 'rgb(255, 158, 68)' // Color at the top (offset 0)
            }, {
                offset: 1,
                color: 'rgb(255, 70, 131)' // Color at the bottom (offset 1)
            }])

/*
                     
                     type: 'linear',
                     x: 0, y: 0, x2: 0, y2: 1,
                     colorStops:
                     [

                        { offset: 0.0, color: getHSL(api.value(3), 0.3) },
                        { offset: 0.5, color: getHSL(api.value(3), 1.0) },
                        { offset: 1.0, color: getHSL(api.value(3), 0.3) }

                    ]


*/



  //                }



2026-01-24 06:46:11

figure out draw overlay on bar

series: [{
    type: 'custom',
    renderItem: function (params, api) {
        // Get coordinates for data point
        var categoryIndex = api.value(0);
        var start = api.coord([categoryIndex, 0]);
        var end = api.coord([categoryIndex, api.value(1)]);
        var width = api.size([0, 1])[0] * 0.6; // Bar width

        return {
            type: 'group',
            children: [{
                type: 'rect',
                shape: {
                    x: start[0] - width / 2,
                    y: start[1],
                    width: width,
                    height: end[1] - start[1]
                },
                style: api.style()
            }, {
                type: 'text',
                style: {
                    text: 'Label', // Text content
                    x: start[0], // Center horizontally
                    y: start[1] + 10, // Offset vertically
                    fill: '#000',
                    textAlign: 'center',
                    textVerticalAlign: 'top'
                }
            }]
        };
    },
    data: [[10, 20], [20, 30]] // Example data
}]




2026-01-24 08:53:02

I think I am ready for the range buttons

Just like the old one..

display start and end

current session
last hour
last day
all

do a drop down control..done



pass to data to control select


pass what?

?range=all
?range=last_time@min=60
?range=last_session

// show the range (just did it on the axis...)




Enter ".help" for usage hints.
sqlite> .mode column
sqlite> select * from gm;
muid              filename                                        dt_start             dt_end               duration  level  num_entries
----------------  ----------------------------------------------  -------------------  -------------------  --------  -----  -----------
MIAGCXYHSZZRMJWX  20260122-070451-[80]-autosave on level done.gm  2026-01-22T14:04:01  2026-01-22T14:04:33  32        80     88
XSDXTBRIVFBWRHOL  20260122-070542-[37]-autosave on level done.gm  2026-01-22T14:05:04  2026-01-22T14:05:27  23        37     77
DZLGYVRDJDONWCJM  20260122-081415-[37]-autosave on level done.gm  2026-01-22T14:14:15  2026-01-22T14:14:51  36        37     180
RXKJBZVTYYEDXYFO  20260122-213637-[37]-autosave on level done.gm  2026-01-23T04:35:57  2026-01-23T04:36:22  25        37     119
IJHSMIYSYVEUWASB  20260124-052510-[37]-autosave on level done.gm  2026-01-24T12:24:32  2026-01-24T12:24:54  22        37     100
sqlite>



m@o3000:/var/www/html/teste$
m@o3000:/var/www/html/teste$
m@o3000:/var/www/html/teste$
m@o3000:/var/www/html/teste$ php data.php range=min min=500


range=min    min=500

sql_where: WHERE dt_start BETWEEN '2026-01-24T09:07:49' AND '2026-01-24T17:27:49'

m@o3000:/var/www/html/teste$





range=min    min=60

sql_where: WHERE dt_start BETWEEN '2026-01-24T16:31:40' AND '2026-01-24T17:31:40'

m@o3000:/var/www/html/teste$


sqlite> select * from gm;
muid              filename                                        dt_start             dt_end               duration  level  num_entries
----------------  ----------------------------------------------  -------------------  -------------------  --------  -----  -----------
MIAGCXYHSZZRMJWX  20260122-070451-[80]-autosave on level done.gm  2026-01-22T14:04:01  2026-01-22T14:04:33  32        80     88
XSDXTBRIVFBWRHOL  20260122-070542-[37]-autosave on level done.gm  2026-01-22T14:05:04  2026-01-22T14:05:27  23        37     77
DZLGYVRDJDONWCJM  20260122-081415-[37]-autosave on level done.gm  2026-01-22T14:14:15  2026-01-22T14:14:51  36        37     180
RXKJBZVTYYEDXYFO  20260122-213637-[37]-autosave on level done.gm  2026-01-23T04:35:57  2026-01-23T04:36:22  25        37     119
IJHSMIYSYVEUWASB  20260124-052510-[37]-autosave on level done.gm  2026-01-24T12:24:32  2026-01-24T12:24:54  22        37     100
SKHZMXRWLIRSFCVK  20260124-103127-[37]-autosave on level done.gm  2026-01-24T17:30:46  2026-01-24T17:31:11  25        37     133
sqlite>


2026-01-24T16:31:40

2026-01-24T17:31:40



2026-01-24T17:30:46  2026-01-24T17:31:11



2026-01-24 11:30:16


when reloading, always read range and send


fetch is top level and it calls


2026-01-24 12:26:48

I think I have eneough features ready that I want to put this in the main page..

but first...

can I reduce date-fns?

import format             from './node_modules/date-fns/format.js';
import intervalToDuration from './node_modules/date-fns/intervalToDuration.js';
import differenceInDays   from './node_modules/date-fns/differenceInDays.js';


<script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script> 96k


do a commit....


2026-01-24 12:59:32

show_timeline.php is 230 lines

how to replace with echarts?




start by adding this to sessions.php

<script src="https://fastly.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script>


then remove g stuff


then make a div for chart and range selector...done



show_timeline.php is gone


all the html is in sessions.php



<script src="./script.js", type="module" ></script>

</head>

<body>

<?php

echo "<div class=\"div-sessions-page\">";

$but = "class=\"button\" id=\"links_button\"";
   echo "<div class=\"div-sessions-page-links\">";
   echo "<a href=\"../index.html\" $but >Back to Main Page</a>";
   echo "<a href=\"sessions.php\"  $but >Sessions</a>";
   echo "<a href=\"status.php\"  $but >Status</a>";
   echo "</div>";

   $but = "class=\"button\" id=\"timeline_button\""; 

   echo "<div id=\"timeline\"  class=\"div-section-container\">";
      echo "<div id=\"timeline\"  class=\"div-section-title-section-frame\">";
         echo "<div id=\"timeline\"  class=\"divSectionTitleSectionContainer\">";
            echo "<div id=\"timeline\"  class=\"div-section-title-frame\">Sessions Timeline</div>";
            echo "<div id=\"timeline\"  class=\"div-section-title-frame-buttons-frame\">";

/*               echo "<a href=\"#\" $but >Start:$tl_start</a>";
               echo "<a href=\"#\" $but >End:$tl_end</a>";
*/
               echo '<label for="range-select">Range:</label>';
               echo '<select name="range" id="range-select">';
                   echo '<option value="0">All</option>';
                   echo '<option value="1">Last Hour</option>';
                   echo '<option value="2">Last Day</option>';
                   echo '<option value="3">Most Recent Session</option>';
               echo '</select>';


            echo "</div>";
         echo "</div>";
      echo "</div>";
         echo '<div id="chart-container" style="height:600px"></div>';
     echo "</div>";
   echo "</div>";





I need this version of dateFns:

<script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/cdn.min.js"></script>


or Datatables gets a weird error:

Uncaught TypeError: $(...).ready is not a function
    <anonymous> http://192.168.1.146/sessions/sessions.php?tl_mode=0:32
sessions.php:32:1637


2026-01-24 14:35:27


now what?

make the clicks do something

how to pass data from js to php


I want to share the session id

php keeps it in _SESSION

in order to actually make the php update I should just reload the page.



function reloadPageWithQueryString(paramName, paramValue) {
    // Construct the new URL with a query string
    var newUrl = window.location.pathname + '?' + encodeURIComponent(paramName) + '=' + encodeURIComponent(paramValue);
    
    // Reload the page with the new URL
    window.location.href = newUrl;
}

// Example usage:
reloadPageWithQueryString('theme', 'dark'); 
// This will reload the page as: http://example.com/current/page?theme=dark


2026-01-24 15:50:30

finally made a favicon

I want a download button on the gm item

If I could make the tooltip stationary instead on moving with mouse

style the button


2026-01-24 18:22:15

why is it so hard to highlight the current session?

I think I will make my own column in the table for that

8

I have that working


2026-01-25 04:29:16

I want to work on getting most of the functionality in the js file

why?
less page reload when I click on something
global variables can live in the js sessions instead of being synced to php

I could even make the main page static instead of php


I think I will move in that diretion


my goal:

index will be html instead of php

script.js will be the main js file maybe rename to main.js
if it gets too large I could split the js into muliple files
global (session) variables will all be in main.js

php files will be used to do the database functions
I will have a handfull of small self contained php files that
take args from query string and return json




2026-01-25 04:51:12

bite the bullet and start...

create sessions.html..done
add timeline...done

add session table...

datatables requires an already well formatted html table

should I do that in php like I currently do, or in js?

have js fill the section with the php script

just leave a div where you want to table to be in html

      <div id="sessions"  class="div-section-sub-section-table">

then in js, get this id and fill with php


I have js loading from php


how do I make the clicks on the table update current session?

I am getting close...

this is what I did:

in the td tag

                     echo "<td current_session_id=$id ><div class=\"icon-text-container\">";


in js:

   const cells = document.querySelectorAll('#sessions_table1 td');
   console.log(cells);   
   cells.forEach(cell => {
               console.log(cell);   
      cell.addEventListener('click', function() {
            // Get the URL from the data-url attribute
            const id = this.getAttribute('current_session_id');
            if (id) {
                console.log(id);   

            }
        });
    });

the problem is...I need to wait until the table is loaded to do this...

figured it out...

before I go much further I want to implement the current session section
maybe it will just be a header for now, but I want it so I can implement current session variables

when I am done, I will never reload the page

2026-01-25 06:58:15

copy the html to index

now when current session changes, update the title


it works, both table clicks and timeline clicks set current session id

but only timeline clicks update highlight
table clicks clear all highlights

figured it out, it was number to string comparision
now... why can I sometimes select 2 things in timeline??
do I need a full reload??
could not figure that out...


next:
make current session option with timeline

I think we could even replace most recent??

data.php


rename to fetch_data_timeline.php

change query string

range [all | last | session]
val   [minutes | session_id]

fix show current session

it is fixed, now I should reload if in that mode..done

looking good!!!

now finish current session
- show title like it was
- option to have minimal, like title only or more details

should I get php to fill it?
I have the title filling nicely

now do the body and the buttons
body done


buttons...


do a drop down like the other

title_only
minimal
player
bandwidth


make a variable to hold this:
var currentSessionView;
set from list and save

I am very happy with current session
I might go as far as to say it is done...

now I should finish sessions table

put the buttons back

session view
default
player
bandwidth
all

sessions table looks great, even without any datatables

I should figure out how to put it back....


sessions_table1

      echo "<script>$(document).ready( function ()
      {
         $('#myTable').DataTable(
         {
            layout: {  topStart: { buttons: ['colvis'] }, bottomStart: 'pageLength' },
            colReorder: true,
            columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: $cla } ],
            order: [  [0, 'desc'] ]
         }  );
      } );
      </script> ";



need to figure out how to wait to load it...done

triangle sort icons are messed up so I changed from this:

<script src="../assets/js/datatables.min.js"></script>
<link rel="stylesheet" href="../assets/css/datatables.min.css" />

to cdn like this:

<link rel="stylesheet" href="https://cdn.datatables.net/2.3.6/css/dataTables.dataTables.css" />
<script src="https://cdn.datatables.net/2.3.6/js/dataTables.js"></script>

in the process I lost the 'buttons' extension

DataTables warning: table id=myTable2 - Unknown feature: buttons

      new DataTable("#myTable2",
      {
         //layout: {  topStart: { buttons: ['colvis'] }, bottomStart: 'pageLength' },
         layout: {  bottomStart: 'pageLength' },
         colReorder: true,
         columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: '_all' } ],
         order: [  [0, 'desc'] ]
      }  );

it was a nice dropdown to hide show columns...i don't care enough to try to fix it now...


this is the entirety of the setup:


<link rel="stylesheet" href="https://cdn.datatables.net/2.3.6/css/dataTables.dataTables.css" />
<script src="https://cdn.datatables.net/2.3.6/js/dataTables.js"></script>

      new DataTable("#myTable",
      {
         colReorder: true,
         columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: '_all' } ],
         order: [  [0, 'desc'] ]
      }  );


2026-01-25 12:10:29

now what?

show id in current session title..done
option in sessions to hide to just title
rename to sessions table
done


now what?

back to timeline, or work on gm_table and current_gm

the second...get everything in the new js file

2026-01-25 12:22:14

put the html frame in for gm table

2026-01-25 12:48:40

save game files is working...

should I now do current? yes...


click on gm list to set currentGmMuid

var currentGmMuid;


2026-01-25 13:29:29
OK i have the bare bones working...now make it good


if current saved game not set or found


in js keep recent curren muid

in js startup, load all from sessions storage at startup
done

implement the click on gm in timeline to set current gm...done

now working my way back up to save game
title and button

like I discovered in current gm, I can do more in the php file
like the title and everything

this is the html for current gm...

   <div id="current_gm_js_target"></div>

try that with gm list...

   <div id="gm_table_js_target"></div>


2026-01-25 14:09:35

looks good, now implement the drop down...this time it will be in php and js
id="gm_table_view_select"
now create a variable and save it
var gmTableView;


gm table is done

fill_gm_table.php
fill_current_gm.php

now onto current_session
 it is currently 2 files\

I plan to combine them

fill_current_session.php

   <div id="current_session_js_target"></div>



   <div id="current_session"  class="div-section-container">
      <div id="current_session"  class="div-section-title-section-frame">
         <div id="current_session"  class="divSectionTitleSectionContainer">
            <div id="current_session_title_name"  class="div-section-title-frame"></div>
            <div id="current_session"  class="div-section-title-frame-buttons-frame">
               <label>View:</label>
               <select name="range" id="current_session_view_select">
                   <option value="0">Title Only</option>
                   <option value="1">Minimal</option>
                   <option value="2">Player</option>
                   <option value="3">Bandwidth</option>
               </select>
            </div>
         </div>
      </div>
         <div id="current_session_body">
      </div>
   </div>


I have current session done...

i can get rid of:

show_current_gm.php
show_current_session.php
show_current_session_body.php
show_current_session_title.php
show_gm_table.php


2026-01-25 15:24:25

now go through 
fill_sessions_table.php and make it like the rest...




   <div id="sessions"  class="div-section-container">
      <div id="sessions"  class="div-section-title-section-frame">
         <div id="sessions"  class="divSectionTitleSectionContainer">
            <div id="sessions"  class="div-section-title-frame">Sessions Table</div>
            <div id="sessions"  class="div-section-title-frame-buttons-frame">
               <label>View:</label>
               <select name="range" id="sessions_view_select">
                   <option value="0">Title Only</option>
                   <option value="1">Default</option>
                   <option value="2">Player</option>
                   <option value="3">Bandwidth</option>
                   <option value="4">All</option>
               </select>
            </div>
         </div>
      </div>
      <div id="sessions"  class="div-section-sub-section-table">
         <div id="sessions_table1"></div>
      </div>
   </div>



   <div id="sessions_table_js_target"></div>





old:

async function fetchDataSessionsTable()
{
   var url = 'fill_sessions_table.php?view=' + sessionsTableView;
   try
   {
      const response = await fetch(url);
      if (!response.ok) { throw new Error(`HTTP error! Status: ${response.status}`); }
      var html = await response.text();
      document.getElementById("sessions_table1").innerHTML = html;

      // setup on click listeners
      const rows = document.querySelectorAll('#sessions_table1 tr');
      rows.forEach(row => {
         row.addEventListener('click', function() {
            const id = this.getAttribute('current_session_id');
            if (id) setCurrentSession(Number(id));
         });
      });

      new DataTable("#myTable",
      {
         colReorder: true,
         columnDefs: [ {  className: 'dt-head-center dt-body-center', targets: '_all' } ],
         order: [  [0, 'desc'] ]
      }  );


   } catch (error)
   {
      console.error("Fetch error:", error.message); // Handles network errors or the error thrown above
   }
}



2026-01-25 15:35:07

done...
now all that is left is timeline

timeline is different, the script fetch_data_timeline.php, only returns a json data array obejct that I plug into echarts...
I am leaving it as is...

now what?


there are things left to do on timeline...important things...

- fix the highlight stuff

- figure out why multiple things can be selected
check the array with a test button

- make the status page use js and update it every second

how?

make a static html page


2026-01-25 16:55:12

I think it is time for a backup....done

now what?


when the page is initially loaded it looks bad

current session is not set
view says title only, but that is not what is set

Fetch error: HTTP error! Status: 500 script.js:688:15
    fetchDataSessionsTable http://192.168.1.146/sessions/script.js:688


then current session, then current gm
what should I do if current session id is not set?
when I try to load the page
if I cannot read from session variables, call php script to get the data
did that for all the variables



2026-01-25 18:20:21

hook in a test button to see if more than one item has 8

it appears that only 1 is active, but the chart shows more...


trace what happens when clicked..



does fetch data also call a reload



function setCurrentSession(id)
{
   currentSessionId = id;
   sessionStorage.setItem("currentSessionId", JSON.stringify(currentSessionId));
   fetchDataCurrentSession();
   fetchDataGmTable();

   // reload timeline if range is set to current session 
   if (timelineRange === 3) fetchDataTimeline();
   else
   {
      // iterate the array and set current selection
      for (let i = 0; i < data.length; i++)
      {
         data[i].value[8] = 0; // unset
         if (data[i].value[2] && (data[i].value[6] === currentSessionId)) data[i].value[8] = 1;
      }
      myChart.setOption( { series: [ { data: data } ]}, false);
   }
}

fetch data calla reload chart which then iterates and does the check...


2026-01-26 04:04:48

what do I want to fix about the timeline chart?
- tooltip gets in the way of clicking
- i would like to do a nice outline for highlight
- show number of items in the toolbar..done
- adjustable height
- show only sessions, or sessions and gm??



2026-01-26 05:43:15
figured out variables in css and relative colors

tooltip back to top, works well

did some padding and rounded corners and hr to separate bottom text

 
now i want to make the level icon bigger and have 2 lines of text to the right
level number and download link
orig:

            var lev = params.data.value[6];
            var l2 = String(lev).padStart(3, '0');
            icon = `/assets/icons/lev${l2}.png`;

            var filename = params.data.value[7];
            var fullpath = "/downloads/" + filename;
            var lnk = `<div style="text-align: center"><a href="${fullpath}" download="${filename}">Download</a></div>`;

            name = '<img src="' + icon + '" style="width: 50px; height: 50px; vertical-align: middle;">';
            name += '<span style="white-space:pre"> ';
            name += `Level:${lev}`; // level number
            name += '</span><br>';
            name += lnk + "<hr>";


flexbox to the rescue!!!

            var lev = params.data.value[6];
            var l2 = String(lev).padStart(3, '0');
            icon = `/assets/icons/lev${l2}.png`;

            var filename = params.data.value[7];
            var fullpath = "/downloads/" + filename;
            var lnk = `<a href="${fullpath}" download="${filename}">Download</a>`;

            name = '<div style="display: flex; gap: 10px">';
            name += '<img src="' + icon + '" style="width: 100px; height: 100px; vertical-align: middle;">';
            name += '<div style="display: flex; flex-direction:column; justify-content:space-evenly">';
            name += `Level:${lev}` + lnk + '</div></div><hr>';


2026-01-26 07:13:17

this is looking well...

what did I do vs what I wanted to get done?

- tooltip gets in the way of clicking..done
- i would like to do a nice outline for highlight
- show number of items in the toolbar..done
- adjustable height
- show only sessions, or sessions and gm??

anyway, it looks great...I should commit...

done gtg

2026-01-26 07:19:54


- make all capable of hiding to titlebar
- current saved game to show info on title bar

- sessions timeline to have different sizes

//         <div id="chart-container" style="height:400px">


what if I split timeline to have sessions and savegames??



2026-01-27 04:43:29

make every section have a +/- in the top right corner...start with current gm

instead of that I make a color change...it was simple

echo "<label for=\"colorPicker\">Color:</label>";
echo "<input type=\"color\" id=\"color-picker\" name=\"colorPicker\" value\"#ff0000\">";

      const colorPicker = document.querySelector("#color-picker");
      colorPicker.addEventListener("input", () =>
      {
          document.documentElement.style.setProperty("--current_gm-color", colorPicker.value);
      });



another method with just a slider for hue

echo '<input type="range" id="hue-slider" min="0" max="360" value="0">';

const hueSlider = document.querySelector("#hue-slider");
hueSlider.addEventListener("input", () =>
{
  document.documentElement.style.setProperty("--current_gm-color", `hsl(${hueSlider.value}, 100%, 50%)`);
});



now:
save the values in js session and load on start
improve variable names for sections

to start with:
var sectionCurrentGmMinimized;
var sectionCurrentGmView;
var sectionCurrentGmHue;


save in sessions

I think I want a separate value for minimized


      document.documentElement.style.setProperty("--current_gm-color", `hsl(${sectionCurrentGmHue}, 100%, 50%)`);
      const hueSlider = document.querySelector("#hue-slider");
      hueSlider.value = sectionCurrentGmHue;
      hueSlider.addEventListener("input", () =>
      {
         sectionCurrentGmHue = hueSlider.value;
         document.documentElement.style.setProperty("--current_gm-color", `hsl(${sectionCurrentGmHue}, 100%, 50%)`);
         sessionStorage.setItem("sectionCurrentGmHue", JSON.stringify(sectionCurrentGmHue));
      });


2026-01-27 06:36:47

I am going through html tags....
the only time I want to set id is for js to manipulate, use class instead
I have been using id too much

now in current_gm the only things that have id are the buttons...

now implement the button
I will need to pass that to the php file


2026-01-27 07:06:10

I have the minimized button working great


now I want to work my way up the sections and:
- implement minimize button
- implement color slider
- rename variables
- change id's to classes in css


there seems to be a lost of code duplication here
I will have 5 sections
is there a way to simplify this with classes?

all will have 3 variables, view, min, color


what if I go much further...
each class will draw its own frame and title section


i want to start with a class, then an array of instances


class mtControls
{
   var minimized
   var view;
   var hue;

   constructor(m, v, h)
   {
      minimized = m;
      view = v;
      hue = h;
   }










  // Instance field
  myField = "foo";
  // Instance method
  myMethod() {
    // myMethod body
  }
  // Static field
  static myStaticField = "bar";
  // Static method
  static myStaticMethod() {
    // myStaticMethod body
  }
  // Static block
  static {
    // Static initialization code
  }
  // Fields, methods, static fields, and static methods all have
  // "private" forms
  #myPrivateField = "bar";
}


when I save to session storage, I should use a name I declare in the class
and I should save all variable at once

I should make the save anbd load part of the class

I should make the checks part of the class


2026-01-28 04:59:54

I have a good part of the class working now

lets try it out on the next section up sgl

now can I put the id names in the class also?


sgt-hue
sgt-min


// this never finds the name
//      document.getElementById(sgt.min_button_id).addEventListener("click", function()

// this works fine
      const minButton = document.querySelector(sgt.min_button_id);
      minButton.addEventListener("click", function()
one of them needs the #


2026-01-28 05:58:25

next, can I create the html in js


I will need a place to put it....

create a div for that...


            echo '<div id="sgt-cont"></div>';



<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .myDivClass {
            color: blue;
            border: 1px solid black;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Dynamic Element Creation Example</h1>
    <div id="container">
        <!-- New element will be added here -->
    </div>

    <script>
        // 1. Create the element
        const newDiv = document.createElement('div');

        // 2. Configure properties
        newDiv.textContent = 'This div was created dynamically using JavaScript.'; // Set text content
        newDiv.classList.add('myDivClass'); // Add a class
        // You can also set other attributes like id or styles
        // newDiv.setAttribute('id', 'newId');
        // newDiv.style.backgroundColor = 'lightgray';

        // 3. Append to the DOM
        const container = document.getElementById('container');
        container.appendChild(newDiv); // Add the new div to the container div
    </script>
</body>
</html>


I have this done!!!


   const newDiv = document.createElement('button');
   newDiv.textContent = '+';
   newDiv.setAttribute('id', sgt.min_button_id);

   const newDiv2 = document.createElement('input');
   newDiv2.setAttribute('id', sgt.hue_slider_id);
   newDiv2.setAttribute('type', 'range');
   newDiv2.setAttribute('min', '0');
   newDiv2.setAttribute('max', '360');
   newDiv2.style.width = '60px';

   const container = document.getElementById('sgt-cont');

   container.appendChild(newDiv2); // Add the new div to the container div
   container.appendChild(newDiv); // Add the new div to the container div




      document.documentElement.style.setProperty("--gm_table-color", `hsl(${sgt.hue}, 100%, 50%)`);

      const hueSlider = document.getElementById(sgt.hue_slider_id);
      hueSlider.value = sgt.hue;
      hueSlider.addEventListener("input", () =>
      {
         sgt.setHue(hueSlider.value);
         document.documentElement.style.setProperty("--gm_table-color", `hsl(${sgt.hue}, 100%, 50%)`);
      });


      document.getElementById(sgt.min_button_id).addEventListener("click", function()
      {
         sgt.toggleMinimized();
         fetchDataGmTable();         
      });


now can I somehow put it in the class...


add to class variables:
container name
css color_var


this is working well, now do I need external names for elements?

can I generate them internally? yes:


this is coming nicely...

see if it works in 2 places...yes...this is a great start!!

now I want to do the view button also

2026-01-28 07:10:44

2026-01-28 18:39:22

the view select has been added
now do current session..done

I now have three sections done, 2 with view

I could do sessions table, or I could figure out the css

do sessions table, it is kind of fresh in your mind how to do it...

I have it done, but there is a bug to fix....

2026-01-28 19:31:21

2026-01-29 04:57:47
fixed the bug

now do the last one...timeline...
2026-01-29 05:44:53done

now how do I hide it with the min button?

generate this html in js

   <div id="timeline"  class="div-section-container">
      <div id="timeline"  class="div-section-title-section-frame">
         <div id="timeline"  class="divSectionTitleSectionContainer">
            <div id="timeline"  class="div-section-title-frame">Sessions Timeline</div>
            <div id="timeline"  class="div-section-title-frame-buttons-frame">

               <a href="#" class="button" id="num_items"></a>
               <a href="#" class="button" id="range-start"></a>
               <a href="#" class="button" id="range-end"></a>

               <div id="stl-cont"></div>

            </div>
         </div>
      </div>
      <div id="chart-container" style="height: 400px"></div>
   </div>


where? in the fetch function



now my html file is very clean...28 lines

<!DOCTYPE html>
<html class="dark">
   <head>
      <title>Purple Martians - Sessions</title>
      <link rel="stylesheet" href="./sessions.css">
      <script src="./script.js", type="module" ></script>
      <script src="../assets/js/jquery-3.7.1.slim.min.js"></script>
      <script src="https://fastly.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/cdn.min.js"></script>
      <link rel="stylesheet" href="https://cdn.datatables.net/2.3.6/css/dataTables.dataTables.css" />
      <script src="https://cdn.datatables.net/2.3.6/js/dataTables.js"></script>
   </head>
   <body>
      <div class="div-sessions-page">
         <div class="div-sessions-page-links">
            <a href="../index.html" class="button" id="links_button" >Back to Main Page</a>
            <a href="sessions.html"  class="button" id="links_button" >Sessions</a>
            <a href="status.php"    class="button" id="links_button" >Status</a>
         </div>
         <!-- <div> <button id="testButton1">Test 1</button> <button id="testButton2">Test 2</button> </div> -->
         <div id="timeline_js_target"></div>
         <div id="sessions_table_js_target"></div>
         <div id="current_session_js_target"></div>
         <div id="gm_table_js_target"></div>
         <div id="current_gm_js_target"></div>
      </div>
   </body>
</html>

I do all the dom and chart creation in the fetch...


in my class, 

I do a constructor, a load and a create....

called at three different places

I want to simplify...

to start with, call load from the contructor....done


now what I have is all five obejcts are instantiate and are global, but create is not run until fetch


what if I moved the instantiation and the create to fetch?..done for all

implement height slider for timeline
2026-01-29 07:02:12 done...cool!!

now make a variable to save this..done

2026-01-29 07:21:20

gtg for now, make a method to set to zero when min, but not overwrite height

2026-01-29 07:54:57..done

this is all looking great!!

I want to go through the css and not use id unless I need js to use it, use class everywhere


how can I do colors??

what if I make the class's based on the name a dyanmically set them





what are good names?

stl
sst
scs
sgt
scg

timeline
session_table
current_session
gm_table
current_gm

then I add 
      this.cont_id        = this.name    + '-cont';
      this.min_button_id  = this.cont_id + '-min';
      this.hue_slider_id  = this.cont_id + '-hue';
      this.view_select_id = this.cont_id + '-view';

I have custom color variables

  --timeline-color         : hsl(255, 100%, 50%);    
  --sessions_table-color   : hsl(180, 100%, 50%);    
  --current_session-color  : hsl(0, 100%, 50%);    
  --gm_table-color         : hsl(60,  100%, 50%);    
  --current_gm-color       : hsl(360, 100%, 50%);    


I should have matching color classes also

tmln
sstb
crss
gmtb
crgm

pick 5 names you can live with:

timeline
sessions_table
current_session
gm_table
current_gm

make everything match these.

start with color variables:

  --timeline-color         : hsl(255, 100%, 50%);    
  --sessions_table-color   : hsl(180, 100%, 50%);    
  --current_session-color  : hsl(0, 100%, 50%);    
  --gm_table-color         : hsl(60,  100%, 50%);    
  --current_gm-color       : hsl(360, 100%, 50%);    

done

now the class instance names in js
      this.css_color_var = '--' + this.name + '-color';
   var timeline = new mtControls('timeline', fetchDataTimeline      , '--timeline-color',        0, 0, 255);

now the container names in html

those are already good:

         <div id="timeline_js_target"></div>
         <div id="sessions_table_js_target"></div>
         <div id="current_session_js_target"></div>
         <div id="gm_table_js_target"></div>
         <div id="current_gm_js_target"></div>

had to manually change all the -cont ones
rename all the fetch functions...no


rename all the css classes

like this:

/* colors for timeline section */
.timeline, .timeline_button
{
   --col: var(--timeline-color); 
   color           : oklch(from var(--col) .95 .05 h);
   border-color    : var(--col);
   background-color: oklch(from var(--col) 0.1 0.1 h);

}
.timeline_button:hover  { border-color: oklch(from var(--timeline-color) calc(l + 0.15) c h); }


      this.class_button = this.name + '_button';

/* colors for timeline section */
.timeline, .timeline_button
{
   --col: var(--timeline-color); 
   color           : oklch(from var(--col) .95 .05 h);
   border-color    : var(--col);
   background-color: oklch(from var(--col) 0.1 0.1 h);

}
.timeline_button:hover  { border-color: oklch(from var(--timeline-color) calc(l + 0.15) c h); }


2026-01-30 03:52:38

I can dynamically create styles in js


      // create a <style> element
      const style = document.createElement('style');
      style.type = 'text/css';

      style.innerHTML = `.${this.class_button}
      {
         --col: var(${this.css_color_var}); 
         color           : oklch(from var(--col) .95 .05 h);
         border-color    : var(--col);
         background-color: oklch(from var(--col) 0.1 0.1 h);
      } `;

      style.innerHTML += `.${this.class_button}:hover  { border-color: oklch(from var(${this.css_color_var}) calc(l + 0.15) c h); }`;

      // append the style element to the document's <head>
      document.head.appendChild(style);

2026-01-30 04:08:53

now I do not need button and buttom hover in css for each of the 5 sections


2026-01-30 04:13:36

continuing on with converting id's to class in my css...
timeline done
sessions_table done
current_session done
all done...
2026-01-30 04:59:29

now back to making the common controls look good
to start with do they belong in a flex container?
added flex to existing container...now they look great

now what?

hid the color control slider for now

rename the fetch funtions?  why not? should be easy...

   // load initial
   fetchDataTimeline();
   fetchDataSessionsTable();
   fetchDataCurrentSession();
   fetchDataGmTable();
   fetchDataCurrentGm();

use the official names


timeline
sessions_table
current_session
gm_table
current_gm

fetchData_timeline();
done...
now how about the php files.. they are good already


2026-01-30 06:06:19

now what?

the highlight in echarts
the body text in echarts sessions

bug fixes



























dump the wip for custom render so I can remove it from actual sources

   series:
   [
      {
         type: "custom",
         encode: { x: [0,1], y: 0, },
         renderItem: (params, api) =>
         {              
            const isSelected = api.value(8);

            var timeSpan = [api.value(0), api.value(1)];
            var catIndex = api.value(2);

            var start = api.coord([timeSpan[0], catIndex]);
            var end   = api.coord([timeSpan[1], catIndex]);
            var size  = api.size([0,1]);

            // relative height of the bars  
            var height = size[1] * 0.8;

            // calculate width
            var width = end[0] - start[0];

            // enforce min width by adjusting x2
            var minWidth = 5;
            if (width < minWidth) end[0] = start[0] + minWidth;

            var name1 = api.value(6); // player name
            if (api.value(2) == 0) name1 = `Level:${api.value(6)}`; // level number for type = session

                 
            // actual timespan in seconds 
//            var ts = (api.value(1) - api.value(0)) / 1000;
//                 console.log("catIndex:%d - seconds:%d  width: ", catIndex, ts, width);
//                 console.log("start   :", start);
//                 console.log("end     :", end);
//                 console.log("width   :", width);



            // create rect and clip to chart area 
            var rect = echarts.graphic.clipRectByRect
            (
               { x: start[0], y: start[1] - height / 2, width: end[0] - start[0], height: height},
               { x: params.coordSys.x, y: params.coordSys.y, width: params.coordSys.width, height: params.coordSys.height},
            )
            if (rect !== undefined) rect.r = 8; // rounded corners



/*

myChart.setOption({
    // ... other options
    series: [{
        type: 'custom',
        renderItem: function (params, api) {
            // Use api.coord() to get pixel coordinates from data values
            var coord = api.coord([api.value(0), api.value(1)]);
            return {
                type: 'circle', // ZRender graphic element type
                shape: {
                    cx: coord[0],
                    cy: coord[1],
                    r: 10
                },
                style: {
                    fill: 'red'
                }
            };
        },
        data: [[10, 20], [30, 40]] // Sample data
    }]
});

*/


            return {
               type: 'group',
               children:
               [

/*
                  {
                     type: 'circle',
                     shape:
                     {
                        cx: start[0], 
                        cy: start[1],
                        r: 30,

                     },
                     style:
                     {
                        fill: '#FF0000',
                     }
                  },

*/


/*
  
// not working

                  {
                     type: 'heart',
                     shape:
                     {
                        cx: start[0], 
                        cy: start[1],
                        width: 100,
                        height: 100,

                     },
                     style:
                     {
                        fill: '#FF0000',
                     }
                  },

*/


/*

                  {
                     type: 'rect',
                     shape:
                     {
                        x: start[0]-20, 
                        y: start[1],
                        width: 50,
                        height: 50,

                     },
                     style:
                     {

      stroke: '#5470c6', // Frame color
      fill: 'none',      // No fill inside
      lineWidth: 2       // Border thickness


                     }
                  },

*/

/*
option = {
  graphic: [{
    type: 'rect',
    left: 'center',
    top: 'center',
    shape: {
      width: 200,
      height: 100
    },
    style: {
      stroke: '#5470c6', // Frame color
      fill: 'none',      // No fill inside
      lineWidth: 2       // Border thickness
    }
  }]
};

*/
/*

                  {
                     type: 'ellipse',
                     shape:
                     {
                        cx: start[0], 
                        cy: start[1],
                        rx: 100,
                        ry: 50,

                     },
                     style:
                     {
                        fill: '#FF0000',
                     }
                  },


*/

                 
                  {
                     type: 'rect',
                     transition: ["shape"],
                     shape: rect,
                     style:
                     {

                        fill:
                        {
                           type: 'linear',
                           x: 0, y: 0, x2: 0, y2: 1,
                           colorStops:
                           [
                              { offset: 0.0, color: getHSL(api.value(3), 0.2) },
                              { offset: 1.0, color: getHSL(api.value(3), 1.0) }
                          ]
                        },
                     },
                  },


                  // highlight selected  
                  {
                     type: 'rect',
                     shape: rect,
                     style: isSelected ?
                     {
                        stroke: '#ff0000',
//                        stroke: getHSLC(api.value(3), 1.0, 180),

                        fill: 'none', 
                        lineWidth: 3  
                     } : { fill: 'none' },
                  },

                  




/*

                  
                  {
                     type: 'rect',
                     transition: ["shape"],
                     shape: rect,
                     style:
                     {
                        fill: isSelected ?


                        // selected style
                        {
                           type: 'linear',
                           x: 0, y: 0, x2: 0, y2: 1,
                           colorStops:
                           [
                              { offset: 0.0, color: getHSL(api.value(3), 1.0) },
                              { offset: 0.5, color: getHSLC(api.value(3), 1.0, 180) },
                              { offset: 1.0, color: getHSL(api.value(3), 1.0) }
                          ]
                        }

                        :

                        // not selected style
                        {
                           type: 'linear',
                           x: 0, y: 0, x2: 0, y2: 1,
                           colorStops:
                           [
                              { offset: 0.0, color: getHSL(api.value(3), 0.2) },
                              { offset: 1.0, color: getHSL(api.value(3), 1.0) }
                          ]
                        },
                     },

*/


/*                                      
                     select:  // Highlight style when selected
                     {         
                        style:
                        {
//                           fill: '#be123c', // Example: Red color
                           focus: 'self', 

                           stroke: '#0000ff',
                           lineWidth: 4,

                           //borderColor: '#FF0000',        
                           //borderWidth: 4, 
                           //focus: 'self', 


                           //shadowBlur: 10,
                           //shadowColor: 'rgba(0, 0, 0, 0.5)'


                        }
                     },


                     emphasis: // Optional: Hover style
                     { 
                        style:
                        {
//                           fill: '#4338ca', // Example: Blue color
                           stroke: '#ffffff',
                           lineWidth: 2,

                           focus: 'self', 
                        }
                     },

*/
/*                     

    emphasis: {
        focus: 'series', // Highlights the current series and blurs others
        itemStyle: {
            shadowBlur: 10,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
    },

*/
                     
                     
                     
                     
                     
                     
                     
                     
//                  },




                  {
                     type: 'text',
                     style:
                     {
                          text: name1,
                          x: start[0]+8, 
                          y: (start[1]-height/2) + 8,
                          fill: '#FFFFFF',
                          textAlign: 'left',
                          textVerticalAlign: 'top',
                          width: width, 
                          overflow: 'truncate', 

                      }
                  }
               ]
            };
         },
      }
   ],




2026-01-30 07:28:16

I finally figured out how to do a nice border!!!

gtg

2026-01-31 03:37:30

weekend!! I have some time

- fix the durations

- can I use single file date-fns?

- label the timeline height slider

- minimize text to show plus or minus

- pop up config window with:
- color controls on off


I am still not happy with zoom filter mode weakfilter
if the end position of a session of off the right hand side the bar is not drawn at all
this is not what I want and its pretty inportant...

I need the session bar to be visible...

compare the other options...


none, does what I want, never hides session spans
empty, weird, freezes position of start, if end off screen
filter, hides if end off screen
weakfilter..same

the default is filter...

I need none, but how to fix glitches...

2. Clear Canvas with setOption
Residual images are often caused by the canvas not being cleared properly between rerenders.

    Solution: In setOption, try setting the notMerge parameter to true (e.g., myChart.setOption(option, true))
 to ensure the entire chart is redrawn


enable test buttons and see what fixes it...

reload and resize do nothing


    myChart.setOption(newOption, { replaceMerge: ['series'] });: This will replace the entire series array in the existing options with the series array from newOption. Existing series that are not in newOption will be removed.
    This is useful for scenarios where the number or structure of components (like xAxis, yAxis, or series) changes dynamically, preventing unwanted previous components from persisting. 

For more details on these options and the ECharts API, refer to the official Apache ECharts documentation. 

    How to update series data correctly in Nuxt eCharts module?
    Jan 14, 2025  I suspect this happens because options are merged by default which results in series remaining unchanged, if they are not specifie...
    Stack Overflow
    ECharts refresh on data change - Stack Overflow
    Dec 1, 2016  * 3 Answers. Sorted by: You have to call chartInstance. setOption() again with your new data. I give you a small example: // eChar...
    Stack Overflow
    ngx-echarts - NPM
    Nov 24, 2025  Table_title: Directive Table_content: header: | Input | Type | Description | row: | Input: [merge] | Type: object | Description: U...
    NPM

it says I should sort my data by x axis....

try that...












- do i need to reload the entire chart when I click on something?
probably not, it resets the zoom
only do that if in current session mode on timeline
done
- fix loading error when seesion values are reset bu waiting until they are...done
- highlight current saved game also..done
- hide category label on y axis and make chart margins use that space...done
- lose the axis labels reclaim space, axis pointer label in the middle of zoom bar...done
- figure out the weird glitches on gm when resizing with datazoom
used filter mode; weakfilter to fix, used to be none, but that caused weird artifacts with gm's
done
- setup mouse wheel zoom!!- done







console.log(echarts.version); 

5.3.3

old:
      <script src="https://fastly.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>

new:
      <script src="https://cdn.jsdelivr.net/npm/echarts@6.0.0/dist/echarts.min.js"></script>

no diff...


it does not happen when I use filtermode:filter


could it be my fake width adjust of data??
does it happen with sessions also or just gm? both

what will fix it? 


this alone works perfectly

      {
         type: 'inside', // Zooming by mouse wheel/pinch on the chart area
         filterMode: "none",
         start: 0,      // Initial zoom start percentage
         end: 100       // Initial zoom end percentage
      },





I am ready to give up:
list what you have tried:
updated to echarts 6.0.0 from 5.3.3
tried canvas and svg render
sorted data before putting into chart

decribe the problem:
echarts dataZoom slider
when panning with the slider extra elements are added on the chart
when dragging with the slider, you can see some element do not move
when I mouse over them, they are valid points, they are just not in the correct positions
it happens with both session and gm elements

I have tried tuning off realtime..no change

when I have filterMode: 'filter' it works fine!!

      {
         type: 'slider',
//         filterMode: "none",
         realtime: false, 
         showDataShadow: 'auto', 
         start: 0,      
         end: 100       
      },

I need filterMode: 'none' to show bars that have the end point past the right hand side of the chart

when I use dataZoom inside with the mouse scroll I have no issues at all....

      {
         type: 'inside', // Zooming by mouse wheel/pinch on the chart area
         filterMode: "none",
         start: 0,      // Initial zoom start percentage
         end: 100       // Initial zoom end percentage
      },




2026-01-31 10:03:05

I have been wasting a lot of time on this...

I think I want to drop it and move on...

or I could make a MRE and ask for help

I have an mre...

codepen...










I have been working on a custom echart. x axis is timeline and each category element has 2 x values, start and end.

The issue I seem to be having is when I try to use the dataZoom slider, I get weird corruption.
Some elements move, some are stationary.

Working MRE on codepen:

https://codepen.io/Michael-Weiss-the-styleful/pen/Ggqxjav


If I set filterMode: filter I do not have the issue.
But when I do that, any element that has its second x position past the right hand side of the chart disappears.
So I have to use filterMode: none


It does the same thing in dataZoom 'slider' and 'inside'

I have tried:
updating to the latest echart version 6.0.0
render: canvas and svg
sorted data by x category
animation: false,
realtime: false, 


Maybe I do not have my data in the proper format.

Each element has:
2 'x' values, start and end
a category
and other misc data

I can't find much information on setting up this type of chart....

So my question is: What am I doing wrong? Can anyone point me in the right direction?


  dataZoom: [
    {
      type: "slider",
      filterMode: "none"
      //filterMode: "filter",
    }
  ]


2026-01-31 12:28:58


that took 2.5 hours....
moving on...

could I just do all of this manually?

if i never get this resolved, how will I work around it?

I could just live with fact that i will not get proper spans






I think I want to use dataset:
not sure why....



    dataset: {
        dimensions: ['product', '2015', '2016', '2017'],
        source: [
            {product: 'Matcha Latte', '2015': 43.3, '2016': 85.8, '2017': 93.7},
            {product: 'Milk Tea', '2015': 83.1, '2016': 73.4, '2017': 55.1},
            {product: 'Cheese Cocoa', '2015': 86.4, '2016': 65.2, '2017': 82.5},
            {product: 'Walnut Brownie', '2015': 72.4, '2016': 53.9, '2017': 39.1}
        ]
    },





// get game moves
$sql = "SELECT gm.muid, dt_start, dt_end, level, duration, filename FROM gm $sql_where";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $ty     =          0;                // all gm's will have type 0
   $cl     =          0;                // color
   $rn     =          'gm';             // row name
   $nm     =          $row['muid'];     // element name
   $lv     =          $row['level'];    // level number 
   $fn     =          $row['filename']; // filename

   $data[] = [ 'value' => [$st, $en, $ty, $cl, $rn, $nm, $lv, $fn, 0 ] ] ;

}

// get sessions
$sql = "SELECT id, dt_start, dt_end, player_name, player_color, hostname FROM sessions $sql_where";
$res = $db->query($sql);
while ($row = $res->fetch(PDO::FETCH_ASSOC))
{
   $st     = getJDate($row['dt_start']);
   $en     = getJDate($row['dt_end']);
   $ty++;                                    // each session to have unique row
   $cl     =          $row['player_color'];  // color
   $rn     =          $row['player_name'];   // row name
   $nm     =          $row['player_name'];   // element name
   $id     =          $row['id'];            // session id
   $hn     =          $row['hostname'];      // hostname
   $data[] = [ 'value' => [$st, $en, $ty, $cl, $rn, $nm, $id, $hn, 0 ] ] ;
}
   echo json_encode($data);
?>




i think I will rearrange...

this is how it will go into the dataset

0 element_name ('gm' or player name)
1 start
2 end
3 ty (row id, for grouping)
4 color
5 (player_name)
6 (id, muid)
7 (hostname, filename)
8 mark selected

this is complicated? or am I tired?

why am I doing this?

option = {
    dataset: {
        source: [
            ['Task Name', 'StartTime', 'EndTime', 'Value'],
            ['Task 1', '2025-01-31 10:00', '2025-01-31 12:00', 50],
            ['Task 2', '2025-01-31 13:00', '2025-01-31 14:30', 75],
            ['Task 3', '2025-01-31 15:00', '2025-01-31 16:00', 30]
        ]
    },
    // ... rest of the options
};


just describe what you already have: no reordering

0 start
1 end
2 ty
3 color
4 row name
5 element name
6 lev_num or session_id
7 hostname, filename
8 mark selected

    dataset: {
        dimensions: ['product', '2015', '2016', '2017'],
        source: [
            {product: 'Matcha Latte', '2015': 43.3, '2016': 85.8, '2017': 93.7},






2026-01-31 13:16:24

back to imagine if I have to figure it out myself...

can I filter the data manually?

after I zoom I want to record and display the chart view start and end

the other ones I display come from the entire dataset range

these ones will come from the current view

now what will I do with these?


manually find any data points outside the range and hide them

make a new variable 9 for hiding...

I think I've got it working:

document how you did it:


I made an extra variable for each element called 'hide'
if set the element will not render


            if (api.value(9)) return null; 
            else
            {

            return {
               type: 'group',
               children:
               [


I listen for range changes like this:

   myChart.on('datazoom', function (params)
   {
      var option = myChart.getOption();

      var min = option.dataZoom[0].startValue;
      var max = option.dataZoom[0].endValue;

      // hide data elements that are outside the range

      // iterate the array
      for (let i = 0; i < data.length; i++)
      {
         if (((data[i].value[0] < min) && (data[i].value[1] < min)) || ((data[i].value[0] > max) && (data[i].value[1] > max))) data[i].value[9] = 1;
         else data[i].value[9] = 0;
      }
      reloadChart();  
   });



2026-01-31 16:05:26

moving on to do some more things

- fix the durations ..done

- can I use single file date-fns?

- label the timeline height slider ...done

- pop up config window with:
- color controls on off done
- minimize text to show plus or minus...done

2026-01-31 22:19:32

wow that took a long time, but now I have a rudimentary pop up dialog with color-slider enable and width

other things to add to config:
- min width of timeline element in pixels

2026-01-31 23:33:55

I better do a commit..done

2026-02-01 05:50:36


fix durations....
do something so durations sort nicely in sessions table
added another column for raw seconds so it will sort nicely...done

where do I use them

timeline tooltips
sessions table column
current session
gm list
current gm
all the ones for gm should never go above 1 hour
the ones I will work on first are in php in sessions table and current session..done





i am thinking of a nice display in the title of timeline
data  start  end  duration items
view 

and a drop box for each to select ranges

I am going to work on this

variables:

var tlDataStart;
var tlDataEnd;
var tlDataDuration;
var tlDataItems;

var tlViewStart;
var tlViewEnd;
var tlViewDuration;
var tlViewItems;

places in the title bar to show them
quick and dirty for now, make a nice frame later...
it is looking good, i did not need any global variables
I am thinking of making duration have an optional fixed width so it lines up better
it already is padded to 16 char?? I must be ignoring whitespace...leave it for now

Now I want labels at the start Data Range and View Ranges
then I want select for each...maybe...


i want to make this take up less space
I want a border around each item, but when they are buttons the borders are doubled
what if I tried a table....

old:

               <div class="timeline-range-cont">
                  <div class="timeline-range-row">
                     <label class="button timeline_button">Data Range:</label>
                     <button class="button timeline_button" id="data-range-start"></button>
                     <button class="button timeline_button" id="data-range-end"></button>
                     <button class="button timeline_button" id="data-duration"></button>
                     <button class="button timeline_button" id="data-item-count"></button>
                  </div>

                  <div class="timeline-range-row">
                     <label class="button timeline_button">View Range:</label>
                     <button class="button timeline_button" id="view-range-start"></button>
                     <button class="button timeline_button" id="view-range-end"></button>
                     <button class="button timeline_button" id="view-duration"></button>
                     <button class="button timeline_button" id="view-item-count"></button>
                  </div>
               </div>


               <div class="timeline-range-cont">
               <table>
               <tr> 
                     <td>Data Range:</td>
                     <td id="data-range-start"></td>
                     <td id="data-range-end"></td>
                     <td id="data-duration"></td>
                     <td id="data-item-count"></td>
               </tr> 

               <tr> 
                     <td>View Range:</td>
                     <td id="view-range-start"></td>
                     <td id="view-range-end"></td>
                     <td id="view-duration"></td>
                     <td id="view-item-count"></td>
               </tr> 
               

               </table>
               </div>


2026-02-01 08:43:46

the table is awesome, it was the right tool for the job
I want the settings button to be in the same row as the page links, but at the extreme right..done

Now make the settings dialog look nicer..done

2026-02-01 10:32:42

next, drop down for data range in timeline

and maybe one for view range also


the easiest would be to rename it to data range


OK, modify class to allow for different name in front of view..done

also modify call to make view option has 2 values, one short on for display and one for mouseover (optional)
this seems like a waste of time...abort...


separate the data range from mts, make it its own thing and put it by the data range label


   timeline.view_select_array = ['All', 'Last Hour', 'Last Day', 'Current Session'];


global

var timelineDataRangeOption;




Got that roughed in...

2026-02-01 12:02:08
Now I have a big task....

make my vartiable names consistant

I will go with camelCase

avoid dashes '-' they are often a keyword

start at the top of script.js

check often to see if you broke stuff...




old names

timeline
sessions_table
current_session
gm_table
current_gm

new names for sections

timeline
sessionsTable
currentSession
gmTable
currentGm



old:
      fetchData_timeline();
      fetchData_sessions_table();
      fetchData_current_session();
      fetchData_gm_table();
      fetchData_current_gm();


new:
      fetchDataTimeline();
      fetchDataSessionsTable();
      fetchDataCurrentSession();
      fetchDataGmTable();
      fetchDataCurrentGm();


done...

mts name are all done


         <!-- <div> <button id="testButton1">Test 1</button> <button id="testButton2">Test 2</button> </div> -->
         <div id="timeline_js_target"></div>
         <div id="sessionsTable_js_target"></div>
         <div id="currentSession_js_target"></div>
         <div id="gmTable_js_target"></div>
         <div id="currentGm_js_target"></div>
      </div>

done



I want to do mts cont

currentGmControlsContainer
              echo '<div id="currentGm-cont"></div>';
done...

now working through variables in mts

done...

now the css...


newButton.classList.add("min-button", this.buttonClass);
min-button

2026-02-01 17:04:23

I have been through all the main sections in css

still more in css to do...



2026-02-02 02:15:30
mostly done, finishing css
2026-02-02 02:54:02 css done

next...

variables in php
I think I will make an exception where the variable name is identical to the db column name

variables in php are done...

should I do filenames? yes...

I can't think of anything else...



2026-02-02 04:15:13

now what was I doing before?

anything else to add to settings?

data range and view range

If the timeline title gets bigger, make sure that title text is still centered..done


can control vertical size by adjusting:

table font size
make the select control also follow same...
remove border from select control

I can make it work with full 1 rem font, barely noticeable
one thing that has been bothering me...when minimized to title, I have a double line on the bottom...fixed!!

now what?

add more options to data range
1 week
1 month

when data range start is in the middle of an item, the item will not be added...
then entire item (d1 and d2) need to be within the range
should I relax this requirement? yes...


this is what I have now:

   $sqlWhere = " WHERE dt_start BETWEEN '$dt_start' AND '$dt_end'";  

tests to exclude:
if the element end is before the range start
if the element start is after the range end

test to include:

if the element end is after the range start
if the element start is before the range end

$sqlWhere = " WHERE (dt_start < '$dt_end') AND (dt_end > '$dt_start')";  
did this on both range and current selection
now if any element overlaps the range it will be added

2026-02-02 05:29:56
implement view range....
the control in place, now what to do with it??
made it work...

now I need to save these 2 values in session storage
I have a recusion problem...
when datazoom changes I call reload chart to hide things
maybe I should make that separate....
all i needed to do was only call getViewRange when dataZoom changes
now I am back to artifacts...

this seems to work well...

   // listen for dataZoom changes
   myChart.on('datazoom', function (params)
   {
      getViewRange();
      myChart.setOption(
      {
         series: [ { data: data } ]
      },
      false );
   });


2026-02-02 07:08:49
working well...i should commit....


what now?

am I happy with how sessions works?

I just played a game and it did not play back nicely

player michael joined part way and finished, that is not how it played back

2026-02-03 03:13:47

fix settings:

title to start with

rounded section frames by 2px looks nicer..done
I need to remove the top and bottom border of the range selector secctions..done

made new section <div class="divSessionsPageTopRowLeft"> and put test button div there
test buttons dynamically create with their own function, enable and disabled with one line

made settings dyanically created in js also and resused frame and title from other sections



add to settings:

font size of range controls


length of range control line:
84 col
Start: 2026-01-22 07:01:22 End: 2026-02-03 04:02:07 Duration: 11 21:00:45 Items: 35


55 col
2026-01-22 07:01:22 2026-02-03 04:02:07 11 21:00:45 35

47 col
20260122 070122 20260203 040207 11 21:00:45 35

first set var in css



2026-02-03 06:25:48



I have a nasty bug I have been chasing for about an hour now...


clear session, load page, timeline renders properly
reload page timeline blank

the only thing that brings it back is selecting a new session from session table
then everything works properly until I reload the page again...

why????


in both case the data loads in fetch...


this is what happens in sessions table click

               setCurrentSession(id);
               fetchDataCurrentSession();
               fetchDataGmTable();
               fetchDataTimeline();



setup a test button with fetchDataTimeline(); that always fixes it

I think it is being called too soon...but why? what has not loaded yet...


document.addEventListener('DOMContentLoaded', (event) =>
{
   readVariablesFromSessionStorage();

   setTimeout(checkLoaded, 100); // Check again in 100ms
//   checkLoaded();
   setupSettingsDialog();
   setupTestButtons();
});


this fixed it for now, but I really need to figure out why and fix it better....

I know blocking wait is highly discouraged, maybe I could setup my own async promise wait thing...

but what am I waiting for?

the only thing I do before that is readVariables...




function initialSetup()
{
   readVariablesFromSessionStorage();
   
//   setTimeout(checkLoaded, 100); // wait 100ms
 
   checkLoaded();

   setupSettingsDialog();
   setupTestButtons();
   
}




// -----------------------------------------------
// ---   setup once the page has loaded   ---
// -----------------------------------------------
document.addEventListener('DOMContentLoaded', (event) =>
{
   setTimeout(initialSetup, 100); // wait 100ms

//   initialSetup();  


});

did some testing....

the 100ms delay has to be between 

readVariablesFromSessionStorage();

and 

   checkLoaded();


// Function to check a condition periodically and return a Promise
function waitUntil(condition) {
    return new Promise((resolve) => {
        const interval = setInterval(() => {
            if (condition()) {
                clearInterval(interval);
                resolve();
            }
        }, 50); // Check every 50 milliseconds
    });
}

// Example usage:
let myVariable;

// Simulate an asynchronous operation setting the variable after a delay
setTimeout(() => {
    myVariable = "Desired Value";
    console.log("Variable has been set by async operation");
}, 2000); // Sets the variable after 2 seconds

// An async function that waits for the variable to be set
async function useVariableWhenReady() {
    console.log("Waiting for variable to be set...");
    await waitUntil(() => myVariable !== undefined);
    console.log(`Variable is set: ${myVariable}`);
    // Your code that needs the variable can go here
}

useVariableWhenReady();



2026-02-04 04:31:15


what am I waiting for?
I want to do a test and see if the page loads without currentSession or currentGm set
the page loads just fine


2026-02-04 05:39:56

did some checks in 'fillCurrentGm.php' to deal with muid not set gracefully
did the same with 'fillCurrentSession.php'

2026-02-04 06:10:06

back to what I was doing in the main thread....


I don't know what it is waiting for, but I need a delay between readVariablesFromSessionStorage(); and the rest of the code...

document.addEventListener('DOMContentLoaded', (event) =>
{
   readVariablesFromSessionStorage();
   setTimeout(checkLoaded, 0); // schedule the callback to run asynchronously after the current synchronous code finishes executing
   setupSettingsDialog();
   //setupTestButtons();
});

done...


2026-02-04 07:10:38
spent over 2 hours fixing this...

now what?
a few minor tweaks:
- text labels for timeline element are not clipped to the edges of the chart area
- do datatables for gm table section also




what if I try to make range exactly what I tell it instead of what data it finds?
optional?

I do not have that range in js...or do I??

php could just enter marker values
tried that...

now try keeping track of range in js

let timelineDataRangeOptionD1 = 0;
let timelineDataRangeOptionD2 = 0;

set when calling fetch

what format is it?
jsdate?
ms epoch

it is a date I am expecting to send to echarts

Rethinking here....

I don't know if I want to mess with the datarange, i need to get things outside of it to show nicely
maybe I should just be modifying the view range
I think this all started when the datarange end fell short of the current time....then I could not zoom into that...

I think I am going to leave it as it is, there does not seem to be an easy way to improve upon what I've got...


2026-02-05 05:11:28

fought with datatables for a bit, can't seem to get it to display borders how I want
specifically bottom of header and bottom of table, gave up and decided to live with it
reduced height of sessions table
added datatables to gm table

made a test slider and used it to set icon height to 16







how about when setting datarange....
you know the actual range could be larger (if includes data point that cross boundaries)
or smaller (no larger than data size)

so how about automatically setting the view range to the value chosen with datarange?

the selections would need to match...

look at them and also see if I can reduce length and have title tooltips..i can

Duration:      13 19:28:20



i like this custom tooltip position way better than what I used to have....



   tooltip:
   {
//      position: 'top',


        position: function (point, params, dom, rect, size) {
            // point is the current mouse position (e.g., [x, y]) in pixel coordinates

            // Example 1: Offset the tooltip by a fixed amount (10px right, 10px down)
            // return [point[0] + 10, point[1] + 10];

            // Example 2: Place the tooltip at a specific Y-coordinate (e.g., 20% from the top)
            // return [point[0], '20%'];

            // Example 3: More advanced positioning to ensure it stays within the chart boundaries
            var x = point[0];
            var y = point[1];
            var tooltipWidth = size.contentSize[0];
            var tooltipHeight = size.contentSize[1];
            var chartWidth = size.viewSize[0];

            // If the tooltip would go off the right edge, flip it to the left
            if (x + tooltipWidth > chartWidth) {
                x -= tooltipWidth + 20; // add some padding
            } else {
                x += 10; // default offset
            }
            
            // Similar check for vertical position
            if (y + tooltipHeight > size.viewSize[1]) {
                y -= tooltipHeight;
            }

            return [x, y];
        },







option = {
    // ... other options
    tooltip: {
        trigger: 'axis', // 'axis' or 'item' trigger, the callback works for both
        position: function (point, params, dom, rect, size) {
            // point is the current mouse position (e.g., [x, y]) in pixel coordinates

            // Example 1: Offset the tooltip by a fixed amount (10px right, 10px down)
            // return [point[0] + 10, point[1] + 10];

            // Example 2: Place the tooltip at a specific Y-coordinate (e.g., 20% from the top)
            // return [point[0], '20%'];

            // Example 3: More advanced positioning to ensure it stays within the chart boundaries
            var x = point[0];
            var y = point[1];
            var tooltipWidth = size.contentSize[0];
            var tooltipHeight = size.contentSize[1];
            var chartWidth = size.viewSize[0];

            // If the tooltip would go off the right edge, flip it to the left
            if (x + tooltipWidth > chartWidth) {
                x -= tooltipWidth + 20; // add some padding
            } else {
                x += 10; // default offset
            }
            
            // Similar check for vertical position
            if (y + tooltipHeight > size.viewSize[1]) {
                y -= tooltipHeight;
            }

            return [x, y];
        },
        // Optional: you can also use a custom formatter callback to structure the content
        formatter: function (params) {
            var res = params[0].name;
            for (var i = 0, l = params.length; i < l; i++) {
                res += '<br/>' + params[i].seriesName + ' : ' + params[i].value;
            }
            return res;
        }
    },
    xAxis: {
        // ... xAxis configuration
    },
    yAxis: {
        // ... yAxis configuration
    },
    series: [
        // ... series data
    ]
};



2026-02-06 07:03:27

settings-
use table for inner controls structure so that:
labels are in first col  right justified
controls are in second col left justified
this will make things line up nicer

old:

               <div style="display:flex flex-direction:column">
                  <div class="controlLine"><label>Color Slider Enable:                                           <input id="colorSliderEnableCheckbox" type="checkbox"></label></div>
                  <div class="controlLine"><label for: "colorSliderWidthSlider">Color Slider Width:</label>      <input id="colorSliderWidthSlider" type="range" min=40 max=800></div>
                  <div class="controlLine"><label for: "rangeTableTextSizeSlider">Range Table Text Size:</label> <input id="rangeTableTextSizeSlider" type="range" min=0.5 max=1 step=0.01></div>
                  <div class="controlLine"><label>Use Datatables:                                                <input id="useDatatablesCheckbox" type="checkbox"></label></div>
               </div>
table?

grid could work

also flex box if I make the label a fixed size...done

2026-02-07 02:33:12



/* this is the stupid hack I have to do to get a bottom border on datatables */
.dt-layout-table
{
   border-bottom          : 1px solid;
}


/* the entire area */

/*
#mySessionsTable_wrapper
{
   border          : 1px solid #FF0000;
}

*/


/* the table only */
.dt-layout-table
{
   border-bottom          : 1px solid;




/*
   border          : 1px solid #00FF00;

   border          : 1px solid var(--sessionsTableColor);

   border          : 1px solid var(--sessionsTableColor);
   padding: 5px;
 */




   
}


/* also does elements outside table */
.dt-layout-cell
{
/*   border          : 1px solid #00FF00;


   border          : 1px solid var(--sessionsTableColor);

*/

}


.dt-layout-head
{
/*   border          : 1px solid #00FF00;

   border          : 1px solid var(--sessionsTableColor);
*/

}




/*

.dt-layout-row
{
   border          : 1px solid #0000FF;
   
}

*/



/*

.sessionsTableTable tbody tr td
{
    border-bottom: 1px solid #ddd;  Bottom of each row
}

*/

/*

table.dataTable {
    border-collapse: collapse !important;
    border-bottom: 1px solid #111; Bottom of the whole table
}

table.dataTable tbody tr td {
    border-bottom: 1px solid #ddd;  Bottom of each row
}

*/





2026-02-07 03:58:29
I want to be done with sessions

one last bug...text labels are not clipped...

old:

                  // text overlay 
                  {
                     type: 'text',
                     style:
                     {
                        text: elementName,
                        fill: '#FFFFFF',
                        x: start[0]+8, 
                        y: (start[1]-height/2) + 8,
                        textAlign: 'left',
                        textVerticalAlign: 'top',
                        width: width, 
                        overflow: 'truncate', 
                     }
                  }



new.. make text part of first rect....


               type: 'group',
               children:
               [
                  // main gradient filled rect
                  {
                     type: 'rect',
                     transition: ["shape"],
                     shape: rect,
                     style:
                     {
                        fill:
                        {
                           type: 'linear',
                           x: 0, y: 0, x2: 0, y2: 1,
                           colorStops:
                           [
                              { offset: 0.0, color: getHSL(api.value(3), 0.1) },
                              { offset: 1.0, color: getHSL(api.value(3), 1.0) }
                           ]
                        },
                     },

                     // text overlay 
                     textContent: {
                        type: 'text',
                        style:
                        {
                           text: elementName,
                           fill: '#FFFFFF',
                           x: start[0]+8, 
                           y: (start[1]-height/2) + 8,
                           textAlign: 'left',
                           textVerticalAlign: 'top',
                           width: width, 
                           height: height,
                           overflow: 'truncate', 
                        },
                        textConfig:
                        {
                           position: 'inside' // Position text inside rect
                        }
                        
                     }

                  },
                   
                  // highlight selected items with rect frame
                  {
                     type: 'rect',
                     shape: rect,
                     style:
                     {
                        fill: 'none', 
                        lineWidth: 2,  
                        stroke: isSelected ? highlightBorderColor : 'none',
                     }
                  },

/*


2026-02-07 04:36:27

now sessions is done

It would be fun to do the transport controls for demo mode...


I should commit....



2026-02-07 05:00:19

------------------------------------------------------------------------------
transport controls while playing back demo
very similar to demo record
a way to pause, rewind, speed-up, change current player, etc...


look to demo record for a start

demorecord might be broken after gm changes....









2026-02-07 05:14:11

i would like to fix all compiler warnings and make project compile clean

C:\pm\src\mwEnemyVinePod.cpp: In member function 'void mwEnemy::move_vinepod(int)':
C:\pm\src\mwEnemyVinePod.cpp:140:13: warning: ISO C++ forbids variable length array 'dest' [-Wvla]





   if (Ei[e][20] & PM_ENEMY_VINEPOD_USE_SPLINE)
   {
      // create and fill the spline array
      int np = Ei[e][17]+1; // number of points
      float dest[np*2] = {};
      float pnts[8] = {};
      vinepod_fill_points_array(e, np, pnts, dest);


replace with vector??


#include <vector> // Required header for std::vector

    // declare a vector with 'n' elements
    std::vector<int> a(n); 

    // You can still access elements using the [] syntax
    for (size_t i = 0; i < n; i++) {
        a[i] = i * 2;
    }
    
    // Example usage
    for (size_t i = 0; i < n; i++) {
        std::cout << a[i] << " ";
    }


I don't think I can...at some point I need to call:

void al_calculate_spline(float* dest, int stride, const float points[8],
   float thickness, int num_segments)



Source Code

Calculates a Bzier spline given 4 control points.
If thickness <= 0, then num_segments of points are required in the destination,
otherwise twice as many are needed.

The destination buffer should consist of regularly spaced (by distance of stride bytes) doublets of floats,
corresponding to x and y coordinates of the vertices.

I should just pick a max value....

Ei[][17] max value is 400.

i use (max+1)*2 for 802...just go with 1000...





next...

what is max filesize?

   if (fsize > 200000)


      char dmp[fsize + 128];



void mwNetgame::client_proc_sfil_packet(int i)
{
   int seq     = mPacketBuffer.PacketGetInt32(i);
   int max_seq = mPacketBuffer.PacketGetInt32(i);
   int sb      = mPacketBuffer.PacketGetInt32(i);
   int sz      = mPacketBuffer.PacketGetInt32(i);
   int id      = mPacketBuffer.PacketGetInt32(i);
   int fsize   = mPacketBuffer.PacketGetInt32(i); // uncompressed file size

   //printf("rx sfil piece [%d of %d] id:[%d] st:%4d sz:%4d fsz:%4d\n", seq+1, max_seq, id, sb, sz, fsize);

   memcpy(client_sfil_buffer + sb, mPacketBuffer.rx_buf[i].data+28, sz);    // put the piece of data in the buffer
   client_sfil_buffer_pieces[seq] = id;                                     // mark it with id

   int complete = 1;                                         // did we just get the last piece? (yes by default)
   for (int i=0; i< max_seq; i++)
      if (client_sfil_buffer_pieces[i] != id) complete = 0;  // no, if any piece does not have latest id

   if (complete)
   {
      // uncompress
      char dmp[fsize + 128];
      uLongf destLen = sizeof(dmp);
      uncompress((Bytef*)dmp, (uLongf*)&destLen, (Bytef*)client_sfil_buffer, sizeof(client_sfil_buffer));

      // copy to variables
      char fname[256];




now I have 7 of these: output may be truncated....
all of them use strncpy(


In modern C++ and even C programming, strncpy is generally discouraged. Safer and more intuitive alternatives include: 

    std::string (C++): The best solution in C++ is to use the std::string class, which handles memory management, length tracking, and null-termination automatically, eliminating these issues entirely.
    snprintf (C/C++): This function guarantees null-termination if the buffer size is provided correctly (e.g., snprintf(dest, sizeof(dest), "%s", src);). It returns the number of characters that would have been written, allowing you to detect truncation.




C:\pm\src\mwPlayer.cpp: In member function 'char* mwPlayer::get_player_name(int, char*, int)':
C:\pm\src\mwPlayer.cpp:1343:11: warning: 'char* strncpy(char*, const char*, size_t)' output may be tru


char buffer[10];
snprintf(buffer, sizeof(buffer), "%s %d", "Hello", 12345);
// buffer will contain "Hello 123" (truncated to fit 9 chars + '\0')



//      if (loop > 0) strncpy(log_lines[num_lines++], buff, 99); // copy only first 99 char (and only copy if length > 0)
      if (loop > 0) snprintf(log_lines[num_lines++], 100, "%s", buff); // copy only first 99 char (and only copy if length > 0)


no more compiler warnings!!!



back to make demorecord work...

in this function:

void mwDemoRecord::fill_player_sections(void)
{

this section will need to be fixed:


            if (mGameMoves.arr[x][1] == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)
            {
               f1 = mGameMoves.arr[x][0];
               col = mGameMoves.arr[x][3];
            }






this section as well



   for (int i=gm1; i<gm2; i++)
   {
      int gi = lnk_arr[i]; // get actual game move index from link translation table
      int f = mGameMoves.arr[gi][0];
      int t = mGameMoves.arr[gi][1];
      int p = mGameMoves.arr[gi][2];
      int v = mGameMoves.arr[gi][3];

      
      sprintf(msg, "%s", mGameMoves.get_gm_text2(i, f, t, p, v, msg));
      if (dump) printf("%s\n", msg);



and this...


char* mwGameMoves::get_gm_text2(int gm, int f, int t, int p, int v, char* tmp)
{
   char dsc[80] = {0};
   if (t == PM_GAMEMOVE_TYPE_LEVEL_START)     sprintf(dsc, " START LEVEL %d", v);
   if (t == PM_GAMEMOVE_TYPE_PLAYER_ACTIVE)   sprintf(dsc, " P%d ACTIVE", p);





2026-02-07 07:07:28

I now have demo record not crashing...

I just want a nice overlay for demo play....


can I do that in screen overlay?


I have a rect, now put a widget on it...done


how do I do an async button again?
anytime I click it freezes...
I also want a slider for speed and position

don't worry about async controls
do
play
stop
speed
timeline position
active player
checkbox to stop at end or continue


I will need a place to save these variables....


   int controls_paused;
   int controls_speed;
   int restore_speed;


i did paused, now where do I actually pause it??

what if I just don't increment frame?

next speed adjust slider

next timeline slider


Now I need a way to reset all this when leaving demo mode


I wish I had some hooks for when demo started and ended...


implement check box, pause when done
needed to prevent auto completion
will I pause at level done? sure, why not


I wish I could simplify the process of ending demo

2026-02-07 11:51:15
in clion i am using C++14
what about linux?
C++17

i changed cmakelists and now am using c++17 in clion



now what?

I want to make the pause when done button work...

what do I want it to do?

freeze until any key is pressed?

the end goal is...

show the end of level just like a normal level
every player to have their own stat box...
but no countdown, just wait for the local player to press any





I have one function that checks for level done

int mwDemoMode::check_level_done() const
{
   if (mPlayer.syn[0].level_done_mode)
   {
      if (mPlayer.syn[0].level_done_mode == 1) return 1;
      if (mLoop.frame_num > mPlayer.syn[0].level_done_frame + 280)  return 1; // 280 frames past level done (80) for seek and 5s more
   }
   else if (mLoop.frame_num > last_frame + 400) return 1; // 10s past last game move
   return 0;
}






this is the place where I should do different checks, based on what I want

demomode level done:

freeze mode...

if actually level done, then stop at stats with any key

if falls off the end, pop up level ended box

find a level to test with...

30s
pm C:\pm\savegame\demo\TAS\lev009-4P-30.gm


5s
pm C:\pm\savegame\demo\TAS\lev8.gm


one of the first things I need to do is modify that function so that it does not just timeout

can I tell the difference between a level that was completed with an exit
and one that just ran out of game moves

there could be a times when the level done occurs well past the last game move



2026-02-07 13:11:30

for now... when exiting with level done, instead of going to step 5 go to step 20


step 20 will be be the one that waits forever for a local keypress
I want to stop the loop in that case



now put a continue button on the controls, but only if paused in mode 20

  ya += 24;



   if ((mDemoMode.controls_paused) && (mPlayer.syn[0].level_done_mode == 20))
   {

      if (mWidget.buttont(xc-32, ya, xc+32, bts, 0,0,0,0, 0,11,15, 0,  1,0,0,0, "Continue"))
      {
         mPlayer.syn[0].level_done_mode = 1;
      }


   }





This is actually working out pretty well...

I need to do something with the end of the slider..added 80

it is looking good


so...if I dont have pause checked I have to wait for the 15 seconds?

it looks like I do...unless the level has ack after...

I don't like it when it runs after...
I think I will have 2 options...
wait till continue is pressed
immediately continue
damnit, i really kind of want a delay also...


but I don't want the frame counter to keep going

try 21 



there is a bug here:

int mwGameMoves::has_player_acknowledged(int p)
{
   if (mPlayer.syn[p].paused_type == 3) return 1; // headless server player
   int start_pos = entry_pos;
   int end_pos = start_pos - 1000;
   if (end_pos < 0) end_pos = 0;
   for (int x=start_pos; x>end_pos; x--) // look back for ack
      if ((arr[x][1] == PM_GAMEMOVE_TYPE_LEVEL_DONE_ACK) && (arr[x][2] == p)) return 1;
   return 0;
}

I do not check if the ack frame is <= current frame...duh...

if there is one at all it will trigger immediately...fixed


this seems to be working well...

in level done all I need was one extra state 20

I have not tested what would happen with a no exit gm

do it fool!!


2026-02-07 15:23:17


this is coming along very well

I want to make the control panel look nicer

start with the speed slider
min default max slider (all in one row) done...
is the speed restored when leaving? no...fixed



I want a nice way to pick the active player in a demo
make the control panel collapsable

minimized to bottom border
small controls
bigger controls with more info

when waiting for continue, also accept keypress without cancelling mode 2..done
if cancelled make sure paused is off...done



I want a nice way to pick the active player in a demo

make a button widget with player icon


2026-02-08 05:39:00

sowhere in demo playback I need to check if active local player is valid
not just when switching view

there could be many reasons alp is no longer valid
level change, player quit...etc

done

when changing player and demo is paused, draw current frame dome and works well
why do players labels only show on player 0 fixed

now how does remote only look on demo? only alp is not drawn

2026-02-08 06:43:54

now show alp on buttons
text overlay for demo will not be needed anymore
shows player list and percent done by time and gm, 

make the player buttons nicer
fade the frame a bit
have outline for active
make overall frame for them..

2026-02-08 08:27:02

looks great...now what?

back to the main frame

I want a few title bar controls...+ - etc

I want to be able to send it to the bottom title bar


make just another button +/-
I will need a controls_mode variable in the class

I have it working...


when minimized to bottom border:
replace old bottom message....

put the button in the extreme lower left corner and never move it...


I have so many different styles of buttons

they all have a rect with text in it

they all have y and height

x can be x1, x2, or xc and auto width

frame can be faded or outline or invisible

the new way I want to do this is:

5 variables to describe rect
first one is type

3 var for x, 3 for y

1 type

type 0 abs x1, x2
type 1 abs x1, width
type 3 abs x2, width
type 4 abs x1, auto text width x2
type 5 abs x2, auto text width x1
type 6 abs xc, auto text width x1 and x2

same for y


then a few colors
c0 main
c1 back
c2 text color
c3 highlight


then a value for rounding the rect

then the frame...
frame type
0 none
1 frame only
2 frame and highlight  

background type
0 solid
1 transparent
2 faded

I want a variable that get actual width and height added to...no


2026-02-08 16:44:17

I now have a common bottom row
I want a very small counter, or timeline slider also
I want a percent done in both time and game moves
I want a player line very small on the bottom row...done
I could put the next random demo button somewhere else


2026-02-08 19:51:07

I think I am done for now...


I should commit











































  























































































































































































































































































   
   
   







































